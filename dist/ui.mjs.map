{"version":3,"sources":["../src/ui/context.tsx","../src/lib/cn.ts","../src/ui/components/ControlButton.tsx","../src/ui/components/ModelSelector.tsx","../src/lib/models.ts","../src/lib/theme-constants.ts","../src/lib/safari-fixes.ts","../src/ui/hooks/useTheme.tsx","../src/ui/components/Portal.tsx","../node_modules/@tiptap/core/src/helpers/createChainableState.ts","../node_modules/@tiptap/core/src/CommandManager.ts","../node_modules/@tiptap/core/src/commands/index.ts","../node_modules/@tiptap/core/src/commands/blur.ts","../node_modules/@tiptap/core/src/commands/clearContent.ts","../node_modules/@tiptap/core/src/commands/clearNodes.ts","../node_modules/@tiptap/core/src/commands/command.ts","../node_modules/@tiptap/core/src/commands/createParagraphNear.ts","../node_modules/@tiptap/core/src/commands/cut.ts","../node_modules/@tiptap/core/src/commands/deleteCurrentNode.ts","../node_modules/@tiptap/core/src/helpers/getNodeType.ts","../node_modules/@tiptap/core/src/commands/deleteNode.ts","../node_modules/@tiptap/core/src/commands/deleteRange.ts","../node_modules/@tiptap/core/src/commands/deleteSelection.ts","../node_modules/@tiptap/core/src/commands/enter.ts","../node_modules/@tiptap/core/src/commands/exitCode.ts","../node_modules/@tiptap/core/src/commands/extendMarkRange.ts","../node_modules/@tiptap/core/src/utilities/isRegExp.ts","../node_modules/@tiptap/core/src/utilities/objectIncludes.ts","../node_modules/@tiptap/core/src/helpers/getMarkRange.ts","../node_modules/@tiptap/core/src/helpers/getMarkType.ts","../node_modules/@tiptap/core/src/commands/first.ts","../node_modules/@tiptap/core/src/helpers/isTextSelection.ts","../node_modules/@tiptap/core/src/helpers/resolveFocusPosition.ts","../node_modules/@tiptap/core/src/utilities/minMax.ts","../node_modules/@tiptap/core/src/utilities/isAndroid.ts","../node_modules/@tiptap/core/src/utilities/isiOS.ts","../node_modules/@tiptap/core/src/utilities/isSafari.ts","../node_modules/@tiptap/core/src/commands/focus.ts","../node_modules/@tiptap/core/src/commands/forEach.ts","../node_modules/@tiptap/core/src/commands/insertContent.ts","../node_modules/@tiptap/core/src/commands/insertContentAt.ts","../node_modules/@tiptap/core/src/helpers/createNodeFromContent.ts","../node_modules/@tiptap/core/src/utilities/elementFromString.ts","../node_modules/@tiptap/core/src/helpers/selectionToInsertionEnd.ts","../node_modules/@tiptap/core/src/commands/join.ts","../node_modules/@tiptap/core/src/commands/joinItemBackward.ts","../node_modules/@tiptap/core/src/commands/joinItemForward.ts","../node_modules/@tiptap/core/src/commands/joinTextblockBackward.ts","../node_modules/@tiptap/core/src/commands/joinTextblockForward.ts","../node_modules/@tiptap/core/src/utilities/isMacOS.ts","../node_modules/@tiptap/core/src/commands/keyboardShortcut.ts","../node_modules/@tiptap/core/src/commands/lift.ts","../node_modules/@tiptap/core/src/helpers/isNodeActive.ts","../node_modules/@tiptap/core/src/commands/liftEmptyBlock.ts","../node_modules/@tiptap/core/src/commands/liftListItem.ts","../node_modules/@tiptap/core/src/commands/newlineInCode.ts","../node_modules/@tiptap/core/src/helpers/getSchemaTypeNameByName.ts","../node_modules/@tiptap/core/src/utilities/deleteProps.ts","../node_modules/@tiptap/core/src/commands/resetAttributes.ts","../node_modules/@tiptap/core/src/commands/scrollIntoView.ts","../node_modules/@tiptap/core/src/commands/selectAll.ts","../node_modules/@tiptap/core/src/commands/selectNodeBackward.ts","../node_modules/@tiptap/core/src/commands/selectNodeForward.ts","../node_modules/@tiptap/core/src/commands/selectParentNode.ts","../node_modules/@tiptap/core/src/commands/selectTextblockEnd.ts","../node_modules/@tiptap/core/src/commands/selectTextblockStart.ts","../node_modules/@tiptap/core/src/helpers/createDocument.ts","../node_modules/@tiptap/core/src/commands/setContent.ts","../node_modules/@tiptap/core/src/helpers/getMarkAttributes.ts","../node_modules/@tiptap/core/src/helpers/combineTransactionSteps.ts","../node_modules/@tiptap/core/src/helpers/defaultBlockAt.ts","../node_modules/@tiptap/core/src/helpers/findChildren.ts","../node_modules/@tiptap/core/src/helpers/findChildrenInRange.ts","../node_modules/@tiptap/core/src/helpers/findParentNodeClosestToPos.ts","../node_modules/@tiptap/core/src/helpers/findParentNode.ts","../node_modules/@tiptap/core/src/helpers/getExtensionField.ts","../node_modules/@tiptap/core/src/helpers/flattenExtensions.ts","../node_modules/@tiptap/core/src/helpers/generateHTML.ts","../node_modules/@tiptap/core/src/helpers/getHTMLFromFragment.ts","../node_modules/@tiptap/core/src/helpers/getSchemaByResolvedExtensions.ts","../node_modules/@tiptap/core/src/utilities/isFunction.ts","../node_modules/@tiptap/core/src/utilities/callOrReturn.ts","../node_modules/@tiptap/core/src/utilities/isEmptyObject.ts","../node_modules/@tiptap/core/src/helpers/splitExtensions.ts","../node_modules/@tiptap/core/src/helpers/getAttributesFromExtensions.ts","../node_modules/@tiptap/core/src/utilities/mergeAttributes.ts","../node_modules/@tiptap/core/src/helpers/getRenderedAttributes.ts","../node_modules/@tiptap/core/src/utilities/fromString.ts","../node_modules/@tiptap/core/src/helpers/injectExtensionAttributesToParseRule.ts","../node_modules/@tiptap/core/src/utilities/findDuplicates.ts","../node_modules/@tiptap/core/src/helpers/sortExtensions.ts","../node_modules/@tiptap/core/src/helpers/resolveExtensions.ts","../node_modules/@tiptap/core/src/helpers/getSchema.ts","../node_modules/@tiptap/core/src/helpers/generateJSON.ts","../node_modules/@tiptap/core/src/helpers/generateText.ts","../node_modules/@tiptap/core/src/helpers/getTextBetween.ts","../node_modules/@tiptap/core/src/helpers/getText.ts","../node_modules/@tiptap/core/src/helpers/getTextSerializersFromSchema.ts","../node_modules/@tiptap/core/src/helpers/getNodeAttributes.ts","../node_modules/@tiptap/core/src/helpers/getAttributes.ts","../node_modules/@tiptap/core/src/utilities/removeDuplicates.ts","../node_modules/@tiptap/core/src/helpers/getChangedRanges.ts","../node_modules/@tiptap/core/src/helpers/getDebugJSON.ts","../node_modules/@tiptap/core/src/helpers/getMarksBetween.ts","../node_modules/@tiptap/core/src/helpers/getNodeAtPosition.ts","../node_modules/@tiptap/core/src/helpers/getSchemaTypeByName.ts","../node_modules/@tiptap/core/src/helpers/getSplittedAttributes.ts","../node_modules/@tiptap/core/src/helpers/getTextContentFromNodes.ts","../node_modules/@tiptap/core/src/helpers/isMarkActive.ts","../node_modules/@tiptap/core/src/helpers/isActive.ts","../node_modules/@tiptap/core/src/helpers/isAtEndOfNode.ts","../node_modules/@tiptap/core/src/helpers/isAtStartOfNode.ts","../node_modules/@tiptap/core/src/helpers/isExtensionRulesEnabled.ts","../node_modules/@tiptap/core/src/helpers/isList.ts","../node_modules/@tiptap/core/src/helpers/isNodeEmpty.ts","../node_modules/@tiptap/core/src/helpers/isNodeSelection.ts","../node_modules/@tiptap/core/src/helpers/MappablePosition.ts","../node_modules/@tiptap/core/src/helpers/posToDOMRect.ts","../node_modules/@tiptap/core/src/helpers/rewriteUnknownContent.ts","../node_modules/@tiptap/core/src/commands/setMark.ts","../node_modules/@tiptap/core/src/commands/setMeta.ts","../node_modules/@tiptap/core/src/commands/setNode.ts","../node_modules/@tiptap/core/src/commands/setNodeSelection.ts","../node_modules/@tiptap/core/src/commands/setTextDirection.ts","../node_modules/@tiptap/core/src/commands/setTextSelection.ts","../node_modules/@tiptap/core/src/commands/sinkListItem.ts","../node_modules/@tiptap/core/src/commands/splitBlock.ts","../node_modules/@tiptap/core/src/commands/splitListItem.ts","../node_modules/@tiptap/core/src/commands/toggleList.ts","../node_modules/@tiptap/core/src/commands/toggleMark.ts","../node_modules/@tiptap/core/src/commands/toggleNode.ts","../node_modules/@tiptap/core/src/commands/toggleWrap.ts","../node_modules/@tiptap/core/src/commands/undoInputRule.ts","../node_modules/@tiptap/core/src/commands/unsetAllMarks.ts","../node_modules/@tiptap/core/src/commands/unsetMark.ts","../node_modules/@tiptap/core/src/commands/unsetTextDirection.ts","../node_modules/@tiptap/core/src/commands/updateAttributes.ts","../node_modules/@tiptap/core/src/commands/wrapIn.ts","../node_modules/@tiptap/core/src/commands/wrapInList.ts","../node_modules/@tiptap/core/src/Editor.ts","../node_modules/@tiptap/core/src/EventEmitter.ts","../node_modules/@tiptap/core/src/ExtensionManager.ts","../node_modules/@tiptap/core/src/InputRule.ts","../node_modules/@tiptap/core/src/utilities/isPlainObject.ts","../node_modules/@tiptap/core/src/utilities/mergeDeep.ts","../node_modules/@tiptap/core/src/Extendable.ts","../node_modules/@tiptap/core/src/Mark.ts","../node_modules/@tiptap/core/src/PasteRule.ts","../node_modules/@tiptap/core/src/utilities/isNumber.ts","../node_modules/@tiptap/core/src/extensions/index.ts","../node_modules/@tiptap/core/src/extensions/clipboardTextSerializer.ts","../node_modules/@tiptap/core/src/Extension.ts","../node_modules/@tiptap/core/src/extensions/commands.ts","../node_modules/@tiptap/core/src/extensions/delete.ts","../node_modules/@tiptap/core/src/extensions/drop.ts","../node_modules/@tiptap/core/src/extensions/editable.ts","../node_modules/@tiptap/core/src/extensions/focusEvents.ts","../node_modules/@tiptap/core/src/extensions/keymap.ts","../node_modules/@tiptap/core/src/extensions/paste.ts","../node_modules/@tiptap/core/src/extensions/tabindex.ts","../node_modules/@tiptap/core/src/extensions/textDirection.ts","../node_modules/@tiptap/core/src/NodePos.ts","../node_modules/@tiptap/core/src/style.ts","../node_modules/@tiptap/core/src/utilities/createStyleTag.ts","../node_modules/@tiptap/core/src/inputRules/markInputRule.ts","../node_modules/@tiptap/core/src/inputRules/nodeInputRule.ts","../node_modules/@tiptap/core/src/inputRules/textblockTypeInputRule.ts","../node_modules/@tiptap/core/src/inputRules/textInputRule.ts","../node_modules/@tiptap/core/src/inputRules/wrappingInputRule.ts","../node_modules/@tiptap/core/src/jsx-runtime.ts","../node_modules/@tiptap/core/src/lib/ResizableNodeView.ts","../node_modules/@tiptap/core/src/utilities/canInsertNode.ts","../node_modules/@tiptap/core/src/utilities/escapeForRegEx.ts","../node_modules/@tiptap/core/src/utilities/isString.ts","../node_modules/@tiptap/core/src/utilities/markdown/index.ts","../node_modules/@tiptap/core/src/utilities/markdown/attributeUtils.ts","../node_modules/@tiptap/core/src/utilities/markdown/createAtomBlockMarkdownSpec.ts","../node_modules/@tiptap/core/src/utilities/markdown/createBlockMarkdownSpec.ts","../node_modules/@tiptap/core/src/utilities/markdown/createInlineMarkdownSpec.ts","../node_modules/@tiptap/core/src/utilities/markdown/parseIndentedBlocks.ts","../node_modules/@tiptap/core/src/utilities/markdown/renderNestedMarkdownContent.ts","../node_modules/@tiptap/core/src/MarkView.ts","../node_modules/@tiptap/core/src/Node.ts","../node_modules/@tiptap/core/src/NodeView.ts","../node_modules/@tiptap/core/src/pasteRules/markPasteRule.ts","../node_modules/@tiptap/core/src/pasteRules/nodePasteRule.ts","../node_modules/@tiptap/core/src/pasteRules/textPasteRule.ts","../node_modules/@tiptap/core/src/Tracker.ts","../src/lib/comment-mark.ts","../src/lib/sse.ts","../src/ui/hooks/useChat.tsx","../node_modules/@tiptap/extension-heading/src/heading.ts","../node_modules/@tiptap/extension-heading/src/index.ts","../node_modules/@tiptap/extension-paragraph/src/paragraph.ts","../node_modules/@tiptap/extension-paragraph/src/index.ts","../node_modules/@tiptap/extension-list/src/bullet-list/bullet-list.ts","../node_modules/@tiptap/extension-list/src/item/list-item.ts","../node_modules/@tiptap/extension-list/src/keymap/list-keymap.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/index.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/findListItemPos.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/getNextListDepth.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/handleBackspace.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/hasListBefore.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/hasListItemBefore.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/listItemHasSubList.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/handleDelete.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/nextListIsDeeper.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/nextListIsHigher.ts","../node_modules/@tiptap/extension-list/src/keymap/listHelpers/hasListItemAfter.ts","../node_modules/@tiptap/extension-list/src/kit/index.ts","../node_modules/@tiptap/extension-list/src/ordered-list/ordered-list.ts","../node_modules/@tiptap/extension-list/src/ordered-list/utils.ts","../node_modules/@tiptap/extension-list/src/task-item/task-item.ts","../node_modules/@tiptap/extension-list/src/task-list/task-list.ts","../node_modules/@tiptap/extension-bullet-list/src/index.ts","../node_modules/@tiptap/extension-ordered-list/src/index.ts","../node_modules/@tiptap/extension-list-item/src/index.ts","../node_modules/@tiptap/extension-code/src/code.ts","../node_modules/@tiptap/extension-code/src/index.ts","../node_modules/@tiptap/extension-code-block/src/code-block.ts","../node_modules/@tiptap/extension-code-block/src/index.ts","../node_modules/@tiptap/core/src/jsx-runtime.ts","../node_modules/@tiptap/core/jsx-runtime/index.js","../node_modules/@tiptap/extension-blockquote/src/blockquote.tsx","../node_modules/@tiptap/extension-blockquote/src/index.ts","../node_modules/@tiptap/extension-horizontal-rule/src/horizontal-rule.ts","../node_modules/@tiptap/extension-horizontal-rule/src/index.ts","../src/lib/markdown.ts","../src/ui/components/TiptapEditor.tsx","../src/ui/components/ChatPanel.tsx","../src/ui/dashboard.tsx","../src/ui/pages/WriterDashboard.tsx","../src/ui/components/Skeleton.tsx","../src/ui/components/PageContainer.tsx","../src/lib/format.ts","../src/ui/pages/EditorPage.tsx","../src/ui/components/EditorToolbar.tsx","../src/ui/components/toolbar/ToolbarButton.tsx","../src/ui/components/toolbar/FormatButtons.tsx","../src/lib/markdown-helpers.ts","../src/ui/components/toolbar/BlockButtons.tsx","../src/ui/components/toolbar/MediaButtons.tsx","../src/ui/components/toolbar/HistoryButtons.tsx","../src/ui/components/RevisionHistoryDropdown.tsx","../src/ui/components/Dropdown.tsx","../src/ui/components/CommentsPanel.tsx","../src/ui/components/CommentThread.tsx","../src/lib/comments.ts","../src/ui/components/TagsSection.tsx","../src/ui/components/ExpandableSection.tsx","../src/ui/hooks/useComments.ts","../src/ui/pages/settings/index.tsx","../src/ui/pages/settings/UsersSettings.tsx","../src/ui/pages/settings/GeneralSettings.tsx","../src/ui/pages/settings/IntegrationsSettings.tsx","../src/ui/pages/settings/CommentsSettings.tsx","../src/ui/pages/settings/AISettings.tsx","../src/ui/pages/settings/CollapsibleTemplate.tsx","../src/ui/pages/settings/TagsSettings.tsx","../src/ui/pages/settings/TopicsSettings.tsx","../src/ui/pages/settings/PostsSettings.tsx","../src/ui/pages/settings/RevisionsSettings.tsx","../src/ui/components/Navbar.tsx","../src/ui/components/ThemeToggle.tsx","../src/ui/components/Icons.tsx","../src/ui/components/ChatButton.tsx","../src/ui/components/ThemeProvider.tsx","../src/ui/hooks/useKeyboard.ts","../src/ui/components/Toaster.tsx","../src/ui/index.ts","../src/ui/hooks/useAIModels.ts","../src/ui/shortcuts.ts","../src/ui/components/GlobalShortcuts.tsx","../src/ui/components/SeoSection.tsx"],"sourcesContent":["'use client'\n\nimport { createContext, useContext, useState, useEffect, useCallback, useMemo, useRef, type ReactNode } from 'react'\nimport type { CustomFieldConfig, StylesConfig } from './types'\nimport type { EditCommand, EditHandler } from '../types/editor'\n\n// Re-export for backward compatibility\nexport type { EditCommand, EditHandler } from '../types/editor'\n\nexport interface DashboardConfig {\n  fields: CustomFieldConfig[]\n  styles: Required<StylesConfig>\n}\n\n// Session info (provided by the host app)\nexport interface SessionUser {\n  id?: string\n  name?: string | null\n  email?: string\n  role?: string\n}\n\nexport interface Session {\n  user?: SessionUser\n}\n\n// Shared data fetched once by the provider\nexport interface SharedData {\n  counts: Record<string, number>\n  settings: { autoDraftEnabled: boolean; postUrlPattern: string }\n  posts: unknown[]\n  suggestedPosts: unknown[]\n  aiSettings: { defaultModel: string; availableModels: unknown[] }\n}\n\n// Editor content for parent app integration (e.g., chat context)\nexport interface EditorContent {\n  title: string\n  subtitle: string\n  markdown: string\n}\n\n// Editor state exposed to parent app\nexport interface EditorState {\n  hasUnsavedChanges: boolean\n  status: 'draft' | 'published'\n  savingAs: 'draft' | 'published' | null\n  onSave: (status: 'draft' | 'published') => void\n  confirmLeave: () => boolean\n  // Content for chat integration\n  content: EditorContent\n}\n\nexport interface DashboardContextValue {\n  basePath: string\n  apiBasePath: string\n  styles: Required<StylesConfig>\n  fields: CustomFieldConfig[]\n  currentPath: string\n  navigate: (path: string, options?: { skipConfirmation?: boolean; replace?: boolean }) => void\n  goBack: () => void\n  canGoBack: boolean\n  config: DashboardConfig\n  // Session\n  session: Session | null\n  // Shared data\n  sharedData: SharedData | null\n  sharedDataLoading: boolean\n  refetchSharedData: () => Promise<void>\n  updateSharedPost: (post: { id: string; [key: string]: unknown }) => void\n  removeSharedPost: (postId: string) => void\n  // Editor state callback (for parent app integration)\n  onEditorStateChange?: (state: EditorState | null) => void\n  // Edit handler registration (for AI agent mode)\n  onRegisterEditHandler?: (handler: EditHandler | null) => void\n}\n\nconst DashboardContext = createContext<DashboardContextValue | null>(null)\n\nexport function useDashboardContext() {\n  const ctx = useContext(DashboardContext)\n  if (!ctx) throw new Error('useDashboardContext must be used within DashboardProvider')\n  return ctx\n}\n\nconst DEFAULT_STYLES: Required<StylesConfig> = {\n  container: 'max-w-[680px] mx-auto px-6',\n  title: 'text-2xl font-bold leading-tight',\n  subtitle: 'text-base text-muted-foreground leading-snug',\n  byline: 'text-sm text-muted-foreground',\n  prose: 'prose',\n}\n\nfunction extractPath(pathname: string, basePath: string): string {\n  const normalized = pathname.replace(/\\/$/, '')\n  const base = basePath.replace(/\\/$/, '')\n  if (normalized === base) return '/'\n  if (normalized.startsWith(base + '/')) return normalized.slice(base.length) || '/'\n  return '/'\n}\n\ninterface DashboardProviderProps {\n  basePath?: string\n  apiBasePath?: string\n  styles?: StylesConfig\n  fields?: CustomFieldConfig[]\n  session?: Session | null\n  onEditorStateChange?: (state: EditorState | null) => void\n  onRegisterEditHandler?: (handler: EditHandler | null) => void\n  children: ReactNode\n}\n\nexport function DashboardProvider({\n  basePath = '/writer',\n  apiBasePath = '/api/cms',\n  styles,\n  fields = [],\n  session = null,\n  onEditorStateChange,\n  onRegisterEditHandler,\n  children,\n}: DashboardProviderProps) {\n  const [currentPath, setCurrentPath] = useState('/')\n  const [sharedData, setSharedData] = useState<SharedData | null>(null)\n  const [sharedDataLoading, setSharedDataLoading] = useState(true)\n  // Track navigation history within the dashboard\n  const [historyDepth, setHistoryDepth] = useState(0)\n  // Track editor state for navigation warnings\n  const editorStateRef = useRef<EditorState | null>(null)\n  \n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      setCurrentPath(extractPath(window.location.pathname, basePath))\n      const handlePopState = () => {\n        // Check for unsaved changes before allowing back navigation\n        if (editorStateRef.current?.hasUnsavedChanges) {\n          if (!editorStateRef.current.confirmLeave()) {\n            // User cancelled - push the current path back to history\n            const currentFullPath = basePath + (currentPath === '/' ? '' : currentPath)\n            window.history.pushState({}, '', currentFullPath)\n            return\n          }\n        }\n        setCurrentPath(extractPath(window.location.pathname, basePath))\n        // Decrement history depth on back navigation\n        setHistoryDepth(d => Math.max(0, d - 1))\n      }\n      window.addEventListener('popstate', handlePopState)\n      return () => window.removeEventListener('popstate', handlePopState)\n    }\n  }, [basePath, currentPath])\n\n  const navigate = useCallback((path: string, options?: { skipConfirmation?: boolean; replace?: boolean }) => {\n    // Check for unsaved changes before navigating (unless explicitly skipped, e.g. after save)\n    if (!options?.skipConfirmation && editorStateRef.current?.hasUnsavedChanges) {\n      if (!editorStateRef.current.confirmLeave()) {\n        return // User cancelled navigation\n      }\n    }\n    const fullPath = path.startsWith('/') ? basePath + path : basePath + '/' + path\n    if (options?.replace) {\n      // Replace current history entry (used after saving new posts)\n      window.history.replaceState({}, '', fullPath)\n    } else {\n      window.history.pushState({}, '', fullPath)\n      // Only increment history depth on push, not replace\n      setHistoryDepth(d => d + 1)\n    }\n    setCurrentPath(path.startsWith('/') ? path : '/' + path)\n  }, [basePath])\n\n  const goBack = useCallback(() => {\n    if (historyDepth > 0) {\n      // We have navigation history, use browser back\n      // The popstate handler will check for unsaved changes\n      window.history.back()\n    } else {\n      // No history (user landed directly on subpage), navigate to root\n      navigate('/')\n    }\n  }, [historyDepth, navigate])\n\n  const canGoBack = historyDepth > 0\n\n  // Fetch all shared data once on mount\n  const fetchSharedData = useCallback(async () => {\n    setSharedDataLoading(true)\n    try {\n      const [countsRes, settingsRes, postsRes, aiSettingsRes] = await Promise.all([\n        fetch(`${apiBasePath}/admin/counts`).then(r => r.ok ? r.json() : null),\n        fetch(`${apiBasePath}/settings`).then(r => r.ok ? r.json() : null),\n        fetch(`${apiBasePath}/posts`).then(r => r.ok ? r.json() : null),\n        fetch(`${apiBasePath}/ai/settings`).then(r => r.ok ? r.json() : null),\n      ])\n\n      const autoDraftEnabled = settingsRes?.data?.autoDraftEnabled ?? false\n      const postUrlPattern = settingsRes?.data?.postUrlPattern ?? '/e/{slug}'\n\n      // Fetch suggested posts only if autoDraft is enabled\n      let suggestedPosts: unknown[] = []\n      if (autoDraftEnabled) {\n        const suggestedRes = await fetch(`${apiBasePath}/posts?status=suggested`).then(r => r.ok ? r.json() : null)\n        suggestedPosts = suggestedRes?.data || []\n      }\n\n      setSharedData({\n        counts: countsRes?.data || {},\n        settings: { autoDraftEnabled, postUrlPattern },\n        posts: postsRes?.data || [],\n        suggestedPosts,\n        aiSettings: {\n          defaultModel: aiSettingsRes?.data?.defaultModel || 'claude-sonnet',\n          availableModels: aiSettingsRes?.data?.availableModels || [],\n        },\n      })\n    } catch (err) {\n      console.error('Failed to fetch shared data:', err)\n      setSharedData({\n        counts: {},\n        settings: { autoDraftEnabled: false, postUrlPattern: '/e/{slug}' },\n        posts: [],\n        suggestedPosts: [],\n        aiSettings: { defaultModel: 'claude-sonnet', availableModels: [] },\n      })\n    } finally {\n      setSharedDataLoading(false)\n    }\n  }, [apiBasePath])\n\n  useEffect(() => {\n    fetchSharedData()\n  }, [fetchSharedData])\n\n  // Update a single post in shared data (add or update)\n  const updateSharedPost = useCallback((post: { id: string; [key: string]: unknown }) => {\n    setSharedData(prev => {\n      if (!prev) return prev\n      const existingIndex = prev.posts.findIndex((p: any) => p.id === post.id)\n      let updatedPosts: unknown[]\n      if (existingIndex >= 0) {\n        // Update existing post\n        updatedPosts = [...prev.posts]\n        updatedPosts[existingIndex] = post\n      } else {\n        // Add new post at the beginning\n        updatedPosts = [post, ...prev.posts]\n      }\n      return { ...prev, posts: updatedPosts }\n    })\n  }, [])\n\n  // Remove a post from shared data (for deletions)\n  const removeSharedPost = useCallback((postId: string) => {\n    setSharedData(prev => {\n      if (!prev) return prev\n      return { ...prev, posts: prev.posts.filter((p: any) => p.id !== postId) }\n    })\n  }, [])\n\n  // Wrap onEditorStateChange to track editor state for navigation warnings\n  const handleEditorStateChange = useCallback((state: EditorState | null) => {\n    editorStateRef.current = state\n    onEditorStateChange?.(state)\n  }, [onEditorStateChange])\n\n  const mergedStyles = useMemo<Required<StylesConfig>>(\n    () => ({ ...DEFAULT_STYLES, ...styles }),\n    [styles]\n  )\n  \n  const config = useMemo<DashboardConfig>(\n    () => ({ fields, styles: mergedStyles }),\n    [fields, mergedStyles]\n  )\n\n  const contextValue = useMemo<DashboardContextValue>(() => ({\n    basePath, \n    apiBasePath, \n    styles: mergedStyles, \n    fields, \n    currentPath, \n    navigate,\n    goBack,\n    canGoBack,\n    config,\n    session,\n    sharedData,\n    sharedDataLoading,\n    refetchSharedData: fetchSharedData,\n    updateSharedPost,\n    removeSharedPost,\n    onEditorStateChange: handleEditorStateChange,\n    onRegisterEditHandler,\n  }), [\n    basePath,\n    apiBasePath,\n    mergedStyles,\n    fields,\n    currentPath,\n    navigate,\n    goBack,\n    canGoBack,\n    config,\n    session,\n    sharedData,\n    sharedDataLoading,\n    fetchSharedData,\n    updateSharedPost,\n    removeSharedPost,\n    handleEditorStateChange,\n    onRegisterEditHandler,\n  ])\n\n  return (\n    <DashboardContext.Provider value={contextValue}>\n      {children}\n    </DashboardContext.Provider>\n  )\n}\n\nexport { DashboardContext }\n","import { clsx, type ClassValue } from 'clsx'\nimport { twMerge } from 'tailwind-merge'\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","'use client'\n\nimport { forwardRef } from 'react'\n\ninterface ControlButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  active?: boolean\n}\n\nexport const ControlButton = forwardRef<HTMLButtonElement, ControlButtonProps>(\n  ({ className = '', active, disabled, children, type = 'button', ...props }, ref) => {\n    const baseClasses = \"inline-flex items-center gap-1 p-1 text-sm transition-colors focus:outline-none\"\n    const stateClasses = disabled\n      ? \"text-muted-foreground/30 cursor-not-allowed\"\n      : active\n        ? \"text-ab-active\"\n        : \"text-muted-foreground active:text-foreground md:hover:text-foreground\"\n    \n    return (\n      <button\n        ref={ref}\n        type={type}\n        disabled={disabled}\n        className={`${baseClasses} ${stateClasses} ${className}`}\n        {...props}\n      >\n        {children}\n      </button>\n    )\n  }\n)\n\nControlButton.displayName = 'ControlButton'\n","'use client'\n\nimport { useState, useRef, useEffect } from 'react'\nimport { ChevronDown, Check } from 'lucide-react'\nimport type { AIModelOption } from '../../lib/models'\n\ninterface ModelSelectorProps {\n  models: AIModelOption[]\n  selectedModel: string\n  onModelChange: (id: string) => void\n  currentModel?: AIModelOption\n}\n\nexport function ModelSelector({\n  models,\n  selectedModel,\n  onModelChange,\n  currentModel,\n}: ModelSelectorProps) {\n  const [open, setOpen] = useState(false)\n  const ref = useRef<HTMLDivElement>(null)\n  const displayModel = currentModel ?? models.find(m => m.id === selectedModel)\n\n  useEffect(() => {\n    function handleClick(e: MouseEvent) {\n      if (ref.current && !ref.current.contains(e.target as Node)) {\n        setOpen(false)\n      }\n    }\n    document.addEventListener('mousedown', handleClick)\n    return () => document.removeEventListener('mousedown', handleClick)\n  }, [])\n\n  return (\n    <div ref={ref} className=\"relative\">\n      <button\n        type=\"button\"\n        onClick={() => setOpen(!open)}\n        className=\"inline-flex items-center gap-1 px-2.5 py-1 text-sm font-medium rounded-full bg-muted text-muted-foreground transition-colors\"\n      >\n        {displayModel?.name || 'Select model'}\n        <ChevronDown className=\"w-3 h-3 opacity-60\" />\n      </button>\n      {open && (\n        <div className=\"absolute bottom-full left-0 mb-1 min-w-[180px] bg-popover border border-border rounded-lg shadow-lg z-[100] py-1\">\n          {models.map(model => (\n            <button\n              key={model.id}\n              onClick={() => { onModelChange(model.id); setOpen(false) }}\n              className=\"w-full px-3 py-2 text-left text-sm hover:bg-accent flex items-center justify-between\"\n            >\n              <span>{model.name}</span>\n              {selectedModel === model.id && <Check className=\"w-4 h-4\" />}\n            </button>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n","/** Word count options for essay generation */\nexport const LENGTH_OPTIONS = [300, 500, 800, 1000] as const\nexport type LengthOption = (typeof LENGTH_OPTIONS)[number]\n\n/** AI model option for UI dropdowns */\nexport interface AIModelOption {\n  id: string\n  name: string\n  description: string\n  hasNativeSearch: boolean\n}\n\n/** Default models - can be overridden by API */\nexport const DEFAULT_MODELS: AIModelOption[] = [\n  { id: 'claude-sonnet', name: 'Sonnet 4.5', description: 'Fast, capable', hasNativeSearch: false },\n  { id: 'claude-opus', name: 'Opus 4.5', description: 'Highest quality', hasNativeSearch: false },\n  { id: 'gpt-5.2', name: 'GPT-5.2', description: 'Latest OpenAI', hasNativeSearch: true },\n  { id: 'gpt-5-mini', name: 'GPT-5 Mini', description: 'Fast and efficient', hasNativeSearch: true },\n]\n","/**\n * Theme color constants for autoblogger\n * \n * These values are the source of truth for theme colors.\n * The CSS file (autoblogger.css) uses the same values but can't import from TS.\n */\n\nexport const THEME_COLORS = {\n  light: {\n    background: '#ffffff',\n  },\n  dark: {\n    background: 'hsl(240 10% 3.9%)',\n  },\n} as const\n\nexport type ThemeMode = keyof typeof THEME_COLORS\n\n/** Get background color for a theme */\nexport const getThemeBackground = (theme: ThemeMode): string =>\n  THEME_COLORS[theme].background\n","/**\n * iOS Safari specific fixes and utilities\n */\n\n/** Detect iOS Safari (mobile Safari or PWA) */\nexport const isIOSSafari = (): boolean => {\n  if (typeof navigator === 'undefined') return false\n  const ua = navigator.userAgent\n  const isIOS = /iPad|iPhone|iPod/.test(ua) || \n    (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1)\n  const isSafari = /Safari/.test(ua) && !/Chrome|CriOS|FxiOS/.test(ua)\n  return isIOS && isSafari\n}\n\n/** \n * iOS Safari doesn't repaint the safe-area on theme change.\n * Briefly render an element there to force a repaint with the correct color.\n */\nexport const repaintIOSSafeArea = (bgColor: string): void => {\n  if (!isIOSSafari() || typeof document === 'undefined') return\n  \n  const el = document.createElement('div')\n  el.style.cssText = `position:fixed;bottom:0;left:0;right:0;height:34px;background:${bgColor};z-index:2147483647;pointer-events:none;`\n  document.body.appendChild(el)\n  setTimeout(() => el.remove(), 50)\n}\n","'use client'\n\nimport { createContext, useContext, useState, useEffect, useLayoutEffect, useCallback, useRef, type ReactNode } from 'react'\nimport { getThemeBackground } from '../../lib/theme-constants'\nimport { repaintIOSSafeArea } from '../../lib/safari-fixes'\n\ntype Theme = 'light' | 'dark' | 'system'\ntype ResolvedTheme = 'light' | 'dark'\n\ninterface ThemeContextValue {\n  theme: Theme\n  resolvedTheme: ResolvedTheme\n  setTheme: (theme: Theme) => void\n}\n\nconst STORAGE_KEY = 'autoblogger-theme'\n\nconst ThemeContext = createContext<ThemeContextValue | null>(null)\n\nfunction getSystemTheme(): ResolvedTheme {\n  if (typeof window === 'undefined') return 'light'\n  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'\n}\n\nfunction getStoredTheme(): Theme {\n  if (typeof window === 'undefined') return 'system'\n  try {\n    const stored = localStorage.getItem(STORAGE_KEY)\n    if (stored === 'light' || stored === 'dark' || stored === 'system') {\n      return stored\n    }\n  } catch {\n    // localStorage not available\n  }\n  return 'system'\n}\n\nfunction resolveTheme(theme: Theme): ResolvedTheme {\n  if (theme === 'system') {\n    return getSystemTheme()\n  }\n  return theme\n}\n\ninterface AutobloggerThemeProviderProps {\n  children: ReactNode\n  /** Additional classes to apply to the container */\n  className?: string\n  /** Ref callback to get the container element for applying .dark class */\n  onContainerRef?: (el: HTMLDivElement | null) => void\n}\n\n// Get initial theme synchronously to prevent flash\nfunction getInitialTheme(): { theme: Theme; resolved: ResolvedTheme } {\n  if (typeof window === 'undefined') {\n    return { theme: 'system', resolved: 'light' }\n  }\n  const theme = getStoredTheme()\n  const resolved = resolveTheme(theme)\n  return { theme, resolved }\n}\n\nexport function AutobloggerThemeProvider({ children, className, onContainerRef }: AutobloggerThemeProviderProps) {\n  // Initialize with the correct theme immediately (prevents flash)\n  const [initialState] = useState(() => getInitialTheme())\n  const [theme, setThemeState] = useState<Theme>(initialState.theme)\n  const [resolvedTheme, setResolvedTheme] = useState<ResolvedTheme>(initialState.resolved)\n  const [mounted, setMounted] = useState(false)\n  const [containerEl, setContainerEl] = useState<HTMLDivElement | null>(null)\n  const initializedRef = useRef(false)\n\n  // Set body background IMMEDIATELY on first client render (before effects)\n  // This prevents the flash by setting colors before paint\n  if (typeof window !== 'undefined' && !initializedRef.current) {\n    initializedRef.current = true\n    const bgColor = getThemeBackground(initialState.resolved)\n    document.body.style.background = bgColor\n    document.documentElement.style.background = bgColor\n  }\n\n  // Mark as mounted after first render\n  useEffect(() => {\n    setMounted(true)\n  }, [])\n\n  // Listen for system theme changes\n  useEffect(() => {\n    if (typeof window === 'undefined') return\n\n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)')\n    const handleChange = () => {\n      if (theme === 'system') {\n        setResolvedTheme(getSystemTheme())\n      }\n    }\n\n    mediaQuery.addEventListener('change', handleChange)\n    return () => mediaQuery.removeEventListener('change', handleChange)\n  }, [theme])\n\n  // Apply .dark class to container element (for theme CSS variables)\n  useEffect(() => {\n    if (!containerEl) return\n    \n    if (resolvedTheme === 'dark') {\n      containerEl.classList.add('dark')\n    } else {\n      containerEl.classList.remove('dark')\n    }\n  }, [resolvedTheme, containerEl])\n\n  // iOS Safari viewport fix: Set body background directly to prevent bleed-through\n  // When Safari's address bar animates, gaps can show the underlying body color.\n  // We sync body's background with autoblogger's theme to prevent this.\n  // Using useLayoutEffect to run synchronously before browser paint.\n  const useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect\n  \n  useIsomorphicLayoutEffect(() => {\n    if (typeof document === 'undefined' || !mounted) return\n    \n    const bgColor = getThemeBackground(resolvedTheme)\n    \n    // Set background on both html and body for full coverage\n    document.body.style.background = bgColor\n    document.documentElement.style.background = bgColor\n    \n    return () => {\n      // Clear the background styles when autoblogger unmounts\n      document.body.style.background = ''\n      document.documentElement.style.background = ''\n    }\n  }, [resolvedTheme, mounted])\n\n  const setTheme = useCallback((newTheme: Theme) => {\n    setThemeState(newTheme)\n    setResolvedTheme(resolveTheme(newTheme))\n    \n    try {\n      localStorage.setItem(STORAGE_KEY, newTheme)\n    } catch {\n      // localStorage not available\n    }\n    \n    // iOS Safari safe-area repaint fix\n    repaintIOSSafeArea(getThemeBackground(resolveTheme(newTheme)))\n  }, [])\n\n  const handleContainerRef = useCallback((el: HTMLDivElement | null) => {\n    setContainerEl(el)\n    onContainerRef?.(el)\n  }, [onContainerRef])\n\n  // Provide actual theme values (initialized synchronously on client)\n  const value: ThemeContextValue = {\n    theme,\n    resolvedTheme,\n    setTheme,\n  }\n\n  // Use actual resolved theme for classes and attributes (no waiting for mounted)\n  const darkClass = resolvedTheme === 'dark' ? 'dark' : ''\n  const combinedClassName = ['autoblogger', darkClass, className].filter(Boolean).join(' ')\n  const themeAttr = resolvedTheme\n\n  return (\n    <ThemeContext.Provider value={value}>\n      <div \n        ref={handleContainerRef}\n        className={combinedClassName}\n        data-autoblogger-root=\"\"\n        data-theme={themeAttr}\n        suppressHydrationWarning\n      >\n        {children}\n      </div>\n    </ThemeContext.Provider>\n  )\n}\n\nexport function useAutobloggerTheme(): ThemeContextValue {\n  const context = useContext(ThemeContext)\n  if (!context) {\n    throw new Error('useAutobloggerTheme must be used within AutobloggerThemeProvider')\n  }\n  return context\n}\n\n// For backwards compatibility with components that used useTheme from next-themes\nexport function useTheme() {\n  return useAutobloggerTheme()\n}\n","'use client'\n\nimport { useState, useEffect, type ReactNode } from 'react'\nimport { createPortal } from 'react-dom'\nimport { useAutobloggerTheme } from '../hooks/useTheme'\nimport { cn } from '../../lib/cn'\n\ninterface AutobloggerPortalProps {\n  children: ReactNode\n  /** Additional classes for the portal container */\n  className?: string\n  /** Custom styles for the portal container */\n  style?: React.CSSProperties\n}\n\n/**\n * Portal component that renders children to document.body while maintaining\n * autoblogger theme context (including dark mode).\n * \n * Use this instead of raw createPortal to ensure portaled content\n * respects the current theme.\n */\nexport function AutobloggerPortal({ children, className, style }: AutobloggerPortalProps) {\n  const { resolvedTheme } = useAutobloggerTheme()\n  const [mounted, setMounted] = useState(false)\n\n  useEffect(() => {\n    setMounted(true)\n  }, [])\n\n  if (!mounted) return null\n\n  // The wrapper provides theme context (CSS variables + dark class) for portaled content.\n  // Children use position:fixed so they position themselves relative to the viewport.\n  // Note: This wrapper is for theme context only - don't add data-autoblogger-root\n  // which would apply viewport fixing that conflicts with child positioning.\n  return createPortal(\n    <div \n      className={cn('autoblogger', resolvedTheme === 'dark' && 'dark', className)}\n      style={style}\n      data-theme={resolvedTheme}\n    >\n      {children}\n    </div>,\n    document.body\n  )\n}\n","import type { EditorState, Transaction } from '@tiptap/pm/state'\n\n/**\n * Takes a Transaction & Editor State and turns it into a chainable state object\n * @param config The transaction and state to create the chainable state from\n * @returns A chainable Editor state object\n */\nexport function createChainableState(config: { transaction: Transaction; state: EditorState }): EditorState {\n  const { state, transaction } = config\n  let { selection } = transaction\n  let { doc } = transaction\n  let { storedMarks } = transaction\n\n  return {\n    ...state,\n    apply: state.apply.bind(state),\n    applyTransaction: state.applyTransaction.bind(state),\n    plugins: state.plugins,\n    schema: state.schema,\n    reconfigure: state.reconfigure.bind(state),\n    toJSON: state.toJSON.bind(state),\n    get storedMarks() {\n      return storedMarks\n    },\n    get selection() {\n      return selection\n    },\n    get doc() {\n      return doc\n    },\n    get tr() {\n      selection = transaction.selection\n      doc = transaction.doc\n      storedMarks = transaction.storedMarks\n\n      return transaction\n    },\n  }\n}\n","import type { EditorState, Transaction } from '@tiptap/pm/state'\n\nimport type { Editor } from './Editor.js'\nimport { createChainableState } from './helpers/createChainableState.js'\nimport type { AnyCommands, CanCommands, ChainedCommands, CommandProps, SingleCommands } from './types.js'\n\nexport class CommandManager {\n  editor: Editor\n\n  rawCommands: AnyCommands\n\n  customState?: EditorState\n\n  constructor(props: { editor: Editor; state?: EditorState }) {\n    this.editor = props.editor\n    this.rawCommands = this.editor.extensionManager.commands\n    this.customState = props.state\n  }\n\n  get hasCustomState(): boolean {\n    return !!this.customState\n  }\n\n  get state(): EditorState {\n    return this.customState || this.editor.state\n  }\n\n  get commands(): SingleCommands {\n    const { rawCommands, editor, state } = this\n    const { view } = editor\n    const { tr } = state\n    const props = this.buildProps(tr)\n\n    return Object.fromEntries(\n      Object.entries(rawCommands).map(([name, command]) => {\n        const method = (...args: any[]) => {\n          const callback = command(...args)(props)\n\n          if (!tr.getMeta('preventDispatch') && !this.hasCustomState) {\n            view.dispatch(tr)\n          }\n\n          return callback\n        }\n\n        return [name, method]\n      }),\n    ) as unknown as SingleCommands\n  }\n\n  get chain(): () => ChainedCommands {\n    return () => this.createChain()\n  }\n\n  get can(): () => CanCommands {\n    return () => this.createCan()\n  }\n\n  public createChain(startTr?: Transaction, shouldDispatch = true): ChainedCommands {\n    const { rawCommands, editor, state } = this\n    const { view } = editor\n    const callbacks: boolean[] = []\n    const hasStartTransaction = !!startTr\n    const tr = startTr || state.tr\n\n    const run = () => {\n      if (!hasStartTransaction && shouldDispatch && !tr.getMeta('preventDispatch') && !this.hasCustomState) {\n        view.dispatch(tr)\n      }\n\n      return callbacks.every(callback => callback === true)\n    }\n\n    const chain = {\n      ...Object.fromEntries(\n        Object.entries(rawCommands).map(([name, command]) => {\n          const chainedCommand = (...args: never[]) => {\n            const props = this.buildProps(tr, shouldDispatch)\n            const callback = command(...args)(props)\n\n            callbacks.push(callback)\n\n            return chain\n          }\n\n          return [name, chainedCommand]\n        }),\n      ),\n      run,\n    } as unknown as ChainedCommands\n\n    return chain\n  }\n\n  public createCan(startTr?: Transaction): CanCommands {\n    const { rawCommands, state } = this\n    const dispatch = false\n    const tr = startTr || state.tr\n    const props = this.buildProps(tr, dispatch)\n    const formattedCommands = Object.fromEntries(\n      Object.entries(rawCommands).map(([name, command]) => {\n        return [name, (...args: never[]) => command(...args)({ ...props, dispatch: undefined })]\n      }),\n    ) as unknown as SingleCommands\n\n    return {\n      ...formattedCommands,\n      chain: () => this.createChain(tr, dispatch),\n    } as CanCommands\n  }\n\n  public buildProps(tr: Transaction, shouldDispatch = true): CommandProps {\n    const { rawCommands, editor, state } = this\n    const { view } = editor\n\n    const props: CommandProps = {\n      tr,\n      editor,\n      view,\n      state: createChainableState({\n        state,\n        transaction: tr,\n      }),\n      dispatch: shouldDispatch ? () => undefined : undefined,\n      chain: () => this.createChain(tr, shouldDispatch),\n      can: () => this.createCan(tr),\n      get commands() {\n        return Object.fromEntries(\n          Object.entries(rawCommands).map(([name, command]) => {\n            return [name, (...args: never[]) => command(...args)(props)]\n          }),\n        ) as unknown as SingleCommands\n      },\n    }\n\n    return props\n  }\n}\n","export * from './blur.js'\nexport * from './clearContent.js'\nexport * from './clearNodes.js'\nexport * from './command.js'\nexport * from './createParagraphNear.js'\nexport * from './cut.js'\nexport * from './deleteCurrentNode.js'\nexport * from './deleteNode.js'\nexport * from './deleteRange.js'\nexport * from './deleteSelection.js'\nexport * from './enter.js'\nexport * from './exitCode.js'\nexport * from './extendMarkRange.js'\nexport * from './first.js'\nexport * from './focus.js'\nexport * from './forEach.js'\nexport * from './insertContent.js'\nexport * from './insertContentAt.js'\nexport * from './join.js'\nexport * from './joinItemBackward.js'\nexport * from './joinItemForward.js'\nexport * from './joinTextblockBackward.js'\nexport * from './joinTextblockForward.js'\nexport * from './keyboardShortcut.js'\nexport * from './lift.js'\nexport * from './liftEmptyBlock.js'\nexport * from './liftListItem.js'\nexport * from './newlineInCode.js'\nexport * from './resetAttributes.js'\nexport * from './scrollIntoView.js'\nexport * from './selectAll.js'\nexport * from './selectNodeBackward.js'\nexport * from './selectNodeForward.js'\nexport * from './selectParentNode.js'\nexport * from './selectTextblockEnd.js'\nexport * from './selectTextblockStart.js'\nexport * from './setContent.js'\nexport * from './setMark.js'\nexport * from './setMeta.js'\nexport * from './setNode.js'\nexport * from './setNodeSelection.js'\nexport * from './setTextDirection.js'\nexport * from './setTextSelection.js'\nexport * from './sinkListItem.js'\nexport * from './splitBlock.js'\nexport * from './splitListItem.js'\nexport * from './toggleList.js'\nexport * from './toggleMark.js'\nexport * from './toggleNode.js'\nexport * from './toggleWrap.js'\nexport * from './undoInputRule.js'\nexport * from './unsetAllMarks.js'\nexport * from './unsetMark.js'\nexport * from './unsetTextDirection.js'\nexport * from './updateAttributes.js'\nexport * from './wrapIn.js'\nexport * from './wrapInList.js'\n","import type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    blur: {\n      /**\n       * Removes focus from the editor.\n       * @example editor.commands.blur()\n       */\n      blur: () => ReturnType\n    }\n  }\n}\n\nexport const blur: RawCommands['blur'] =\n  () =>\n  ({ editor, view }) => {\n    requestAnimationFrame(() => {\n      if (!editor.isDestroyed) {\n        ;(view.dom as HTMLElement).blur()\n\n        // Browsers should remove the caret on blur but safari does not.\n        // See: https://github.com/ueberdosis/tiptap/issues/2405\n        window?.getSelection()?.removeAllRanges()\n      }\n    })\n\n    return true\n  }\n","import type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    clearContent: {\n      /**\n       * Clear the whole document.\n       * @example editor.commands.clearContent()\n       */\n      clearContent: (\n        /**\n         * Whether to emit an update event.\n         * @default true\n         */\n        emitUpdate?: boolean,\n      ) => ReturnType\n    }\n  }\n}\n\nexport const clearContent: RawCommands['clearContent'] =\n  (emitUpdate = true) =>\n  ({ commands }) => {\n    return commands.setContent('', { emitUpdate })\n  }\n","import { liftTarget } from '@tiptap/pm/transform'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    clearNodes: {\n      /**\n       * Normalize nodes to a simple paragraph.\n       * @example editor.commands.clearNodes()\n       */\n      clearNodes: () => ReturnType\n    }\n  }\n}\n\nexport const clearNodes: RawCommands['clearNodes'] =\n  () =>\n  ({ state, tr, dispatch }) => {\n    const { selection } = tr\n    const { ranges } = selection\n\n    if (!dispatch) {\n      return true\n    }\n\n    ranges.forEach(({ $from, $to }) => {\n      state.doc.nodesBetween($from.pos, $to.pos, (node, pos) => {\n        if (node.type.isText) {\n          return\n        }\n\n        const { doc, mapping } = tr\n        const $mappedFrom = doc.resolve(mapping.map(pos))\n        const $mappedTo = doc.resolve(mapping.map(pos + node.nodeSize))\n        const nodeRange = $mappedFrom.blockRange($mappedTo)\n\n        if (!nodeRange) {\n          return\n        }\n\n        const targetLiftDepth = liftTarget(nodeRange)\n\n        if (node.type.isTextblock) {\n          const { defaultType } = $mappedFrom.parent.contentMatchAt($mappedFrom.index())\n\n          tr.setNodeMarkup(nodeRange.start, defaultType)\n        }\n\n        if (targetLiftDepth || targetLiftDepth === 0) {\n          tr.lift(nodeRange, targetLiftDepth)\n        }\n      })\n    })\n\n    return true\n  }\n","import type { Command, RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    command: {\n      /**\n       * Define a command inline.\n       * @param fn The command function.\n       * @example\n       * editor.commands.command(({ tr, state }) => {\n       *   ...\n       *   return true\n       * })\n       */\n      command: (fn: (props: Parameters<Command>[0]) => boolean) => ReturnType\n    }\n  }\n}\n\nexport const command: RawCommands['command'] = fn => props => {\n  return fn(props)\n}\n","import { createParagraphNear as originalCreateParagraphNear } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    createParagraphNear: {\n      /**\n       * Create a paragraph nearby.\n       * @example editor.commands.createParagraphNear()\n       */\n      createParagraphNear: () => ReturnType\n    }\n  }\n}\n\nexport const createParagraphNear: RawCommands['createParagraphNear'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalCreateParagraphNear(state, dispatch)\n  }\n","import { TextSelection } from '@tiptap/pm/state'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    cut: {\n      /**\n       * Cuts content from a range and inserts it at a given position.\n       * @param range The range to cut.\n       * @param range.from The start position of the range.\n       * @param range.to The end position of the range.\n       * @param targetPos The position to insert the content at.\n       * @example editor.commands.cut({ from: 1, to: 3 }, 5)\n       */\n      cut: ({ from, to }: { from: number; to: number }, targetPos: number) => ReturnType\n    }\n  }\n}\n\nexport const cut: RawCommands['cut'] =\n  (originRange, targetPos) =>\n  ({ editor, tr }) => {\n    const { state } = editor\n\n    const contentSlice = state.doc.slice(originRange.from, originRange.to)\n\n    tr.deleteRange(originRange.from, originRange.to)\n    const newPos = tr.mapping.map(targetPos)\n\n    tr.insert(newPos, contentSlice.content)\n\n    tr.setSelection(new TextSelection(tr.doc.resolve(Math.max(newPos - 1, 0))))\n\n    return true\n  }\n","import type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    deleteCurrentNode: {\n      /**\n       * Delete the node that currently has the selection anchor.\n       * @example editor.commands.deleteCurrentNode()\n       */\n      deleteCurrentNode: () => ReturnType\n    }\n  }\n}\n\nexport const deleteCurrentNode: RawCommands['deleteCurrentNode'] =\n  () =>\n  ({ tr, dispatch }) => {\n    const { selection } = tr\n    const currentNode = selection.$anchor.node()\n\n    // if there is content inside the current node, break out of this command\n    if (currentNode.content.size > 0) {\n      return false\n    }\n\n    const $pos = tr.selection.$anchor\n\n    for (let depth = $pos.depth; depth > 0; depth -= 1) {\n      const node = $pos.node(depth)\n\n      if (node.type === currentNode.type) {\n        if (dispatch) {\n          const from = $pos.before(depth)\n          const to = $pos.after(depth)\n\n          tr.delete(from, to).scrollIntoView()\n        }\n\n        return true\n      }\n    }\n\n    return false\n  }\n","import type { NodeType, Schema } from '@tiptap/pm/model'\n\nexport function getNodeType(nameOrType: string | NodeType, schema: Schema): NodeType {\n  if (typeof nameOrType === 'string') {\n    if (!schema.nodes[nameOrType]) {\n      throw Error(`There is no node type named '${nameOrType}'. Maybe you forgot to add the extension?`)\n    }\n\n    return schema.nodes[nameOrType]\n  }\n\n  return nameOrType\n}\n","import type { NodeType } from '@tiptap/pm/model'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    deleteNode: {\n      /**\n       * Delete a node with a given type or name.\n       * @param typeOrName The type or name of the node.\n       * @example editor.commands.deleteNode('paragraph')\n       */\n      deleteNode: (typeOrName: string | NodeType) => ReturnType\n    }\n  }\n}\n\nexport const deleteNode: RawCommands['deleteNode'] =\n  typeOrName =>\n  ({ tr, state, dispatch }) => {\n    const type = getNodeType(typeOrName, state.schema)\n    const $pos = tr.selection.$anchor\n\n    for (let depth = $pos.depth; depth > 0; depth -= 1) {\n      const node = $pos.node(depth)\n\n      if (node.type === type) {\n        if (dispatch) {\n          const from = $pos.before(depth)\n          const to = $pos.after(depth)\n\n          tr.delete(from, to).scrollIntoView()\n        }\n\n        return true\n      }\n    }\n\n    return false\n  }\n","import type { Range, RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    deleteRange: {\n      /**\n       * Delete a given range.\n       * @param range The range to delete.\n       * @example editor.commands.deleteRange({ from: 1, to: 3 })\n       */\n      deleteRange: (range: Range) => ReturnType\n    }\n  }\n}\n\nexport const deleteRange: RawCommands['deleteRange'] =\n  range =>\n  ({ tr, dispatch }) => {\n    const { from, to } = range\n\n    if (dispatch) {\n      tr.delete(from, to)\n    }\n\n    return true\n  }\n","import { deleteSelection as originalDeleteSelection } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    deleteSelection: {\n      /**\n       * Delete the selection, if there is one.\n       * @example editor.commands.deleteSelection()\n       */\n      deleteSelection: () => ReturnType\n    }\n  }\n}\n\nexport const deleteSelection: RawCommands['deleteSelection'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalDeleteSelection(state, dispatch)\n  }\n","import type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    enter: {\n      /**\n       * Trigger enter.\n       * @example editor.commands.enter()\n       */\n      enter: () => ReturnType\n    }\n  }\n}\n\nexport const enter: RawCommands['enter'] =\n  () =>\n  ({ commands }) => {\n    return commands.keyboardShortcut('Enter')\n  }\n","import { exitCode as originalExitCode } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    exitCode: {\n      /**\n       * Exit from a code block.\n       * @example editor.commands.exitCode()\n       */\n      exitCode: () => ReturnType\n    }\n  }\n}\n\nexport const exitCode: RawCommands['exitCode'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalExitCode(state, dispatch)\n  }\n","import type { MarkType } from '@tiptap/pm/model'\nimport { TextSelection } from '@tiptap/pm/state'\n\nimport { getMarkRange } from '../helpers/getMarkRange.js'\nimport { getMarkType } from '../helpers/getMarkType.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    extendMarkRange: {\n      /**\n       * Extends the text selection to the current mark by type or name.\n       * @param typeOrName The type or name of the mark.\n       * @param attributes The attributes of the mark.\n       * @example editor.commands.extendMarkRange('bold')\n       * @example editor.commands.extendMarkRange('mention', { userId: \"1\" })\n       */\n      extendMarkRange: (\n        /**\n         * The type or name of the mark.\n         */\n        typeOrName: string | MarkType,\n\n        /**\n         * The attributes of the mark.\n         */\n        attributes?: Record<string, any>,\n      ) => ReturnType\n    }\n  }\n}\n\nexport const extendMarkRange: RawCommands['extendMarkRange'] =\n  (typeOrName, attributes = {}) =>\n  ({ tr, state, dispatch }) => {\n    const type = getMarkType(typeOrName, state.schema)\n    const { doc, selection } = tr\n    const { $from, from, to } = selection\n\n    if (dispatch) {\n      const range = getMarkRange($from, type, attributes)\n\n      if (range && range.from <= from && range.to >= to) {\n        const newSelection = TextSelection.create(doc, range.from, range.to)\n\n        tr.setSelection(newSelection)\n      }\n    }\n\n    return true\n  }\n","export function isRegExp(value: any): value is RegExp {\n  return Object.prototype.toString.call(value) === '[object RegExp]'\n}\n","import { isRegExp } from './isRegExp.js'\n\n/**\n * Check if object1 includes object2\n * @param object1 Object\n * @param object2 Object\n */\nexport function objectIncludes(\n  object1: Record<string, any>,\n  object2: Record<string, any>,\n  options: { strict: boolean } = { strict: true },\n): boolean {\n  const keys = Object.keys(object2)\n\n  if (!keys.length) {\n    return true\n  }\n\n  return keys.every(key => {\n    if (options.strict) {\n      return object2[key] === object1[key]\n    }\n\n    if (isRegExp(object2[key])) {\n      return object2[key].test(object1[key])\n    }\n\n    return object2[key] === object1[key]\n  })\n}\n","import type { Mark as ProseMirrorMark, MarkType, ResolvedPos } from '@tiptap/pm/model'\n\nimport type { Range } from '../types.js'\nimport { objectIncludes } from '../utilities/objectIncludes.js'\n\nfunction findMarkInSet(\n  marks: ProseMirrorMark[],\n  type: MarkType,\n  attributes: Record<string, any> = {},\n): ProseMirrorMark | undefined {\n  return marks.find(item => {\n    return (\n      item.type === type &&\n      objectIncludes(\n        // Only check equality for the attributes that are provided\n        Object.fromEntries(Object.keys(attributes).map(k => [k, item.attrs[k]])),\n        attributes,\n      )\n    )\n  })\n}\n\nfunction isMarkInSet(marks: ProseMirrorMark[], type: MarkType, attributes: Record<string, any> = {}): boolean {\n  return !!findMarkInSet(marks, type, attributes)\n}\n\n/**\n * Get the range of a mark at a resolved position.\n */\nexport function getMarkRange(\n  /**\n   * The position to get the mark range for.\n   */\n  $pos: ResolvedPos,\n  /**\n   * The mark type to get the range for.\n   */\n  type: MarkType,\n  /**\n   * The attributes to match against.\n   * If not provided, only the first mark at the position will be matched.\n   */\n  attributes?: Record<string, any>,\n): Range | void {\n  if (!$pos || !type) {\n    return\n  }\n  let start = $pos.parent.childAfter($pos.parentOffset)\n\n  // If the cursor is at the start of a text node that does not have the mark, look backward\n  if (!start.node || !start.node.marks.some(mark => mark.type === type)) {\n    start = $pos.parent.childBefore($pos.parentOffset)\n  }\n\n  // If there is no text node with the mark even backward, return undefined\n  if (!start.node || !start.node.marks.some(mark => mark.type === type)) {\n    return\n  }\n\n  // Default to only matching against the first mark's attributes\n  attributes = attributes || start.node.marks[0]?.attrs\n\n  // We now know that the cursor is either at the start, middle or end of a text node with the specified mark\n  // so we can look it up on the targeted mark\n  const mark = findMarkInSet([...start.node.marks], type, attributes)\n\n  if (!mark) {\n    return\n  }\n\n  let startIndex = start.index\n  let startPos = $pos.start() + start.offset\n  let endIndex = startIndex + 1\n  let endPos = startPos + start.node.nodeSize\n\n  while (startIndex > 0 && isMarkInSet([...$pos.parent.child(startIndex - 1).marks], type, attributes)) {\n    startIndex -= 1\n    startPos -= $pos.parent.child(startIndex).nodeSize\n  }\n\n  while (endIndex < $pos.parent.childCount && isMarkInSet([...$pos.parent.child(endIndex).marks], type, attributes)) {\n    endPos += $pos.parent.child(endIndex).nodeSize\n    endIndex += 1\n  }\n\n  return {\n    from: startPos,\n    to: endPos,\n  }\n}\n","import type { MarkType, Schema } from '@tiptap/pm/model'\n\nexport function getMarkType(nameOrType: string | MarkType, schema: Schema): MarkType {\n  if (typeof nameOrType === 'string') {\n    if (!schema.marks[nameOrType]) {\n      throw Error(`There is no mark type named '${nameOrType}'. Maybe you forgot to add the extension?`)\n    }\n\n    return schema.marks[nameOrType]\n  }\n\n  return nameOrType\n}\n","import type { Command, CommandProps, RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    first: {\n      /**\n       * Runs one command after the other and stops at the first which returns true.\n       * @param commands The commands to run.\n       * @example editor.commands.first([command1, command2])\n       */\n      first: (commands: Command[] | ((props: CommandProps) => Command[])) => ReturnType\n    }\n  }\n}\n\nexport const first: RawCommands['first'] = commands => props => {\n  const items = typeof commands === 'function' ? commands(props) : commands\n\n  for (let i = 0; i < items.length; i += 1) {\n    if (items[i](props)) {\n      return true\n    }\n  }\n\n  return false\n}\n","import { TextSelection } from '@tiptap/pm/state'\n\nexport function isTextSelection(value: unknown): value is TextSelection {\n  return value instanceof TextSelection\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\nimport { Selection, TextSelection } from '@tiptap/pm/state'\n\nimport type { FocusPosition } from '../types.js'\nimport { minMax } from '../utilities/minMax.js'\n\nexport function resolveFocusPosition(doc: ProseMirrorNode, position: FocusPosition = null): Selection | null {\n  if (!position) {\n    return null\n  }\n\n  const selectionAtStart = Selection.atStart(doc)\n  const selectionAtEnd = Selection.atEnd(doc)\n\n  if (position === 'start' || position === true) {\n    return selectionAtStart\n  }\n\n  if (position === 'end') {\n    return selectionAtEnd\n  }\n\n  const minPos = selectionAtStart.from\n  const maxPos = selectionAtEnd.to\n\n  if (position === 'all') {\n    return TextSelection.create(doc, minMax(0, minPos, maxPos), minMax(doc.content.size, minPos, maxPos))\n  }\n\n  return TextSelection.create(doc, minMax(position, minPos, maxPos), minMax(position, minPos, maxPos))\n}\n","export function minMax(value = 0, min = 0, max = 0): number {\n  return Math.min(Math.max(value, min), max)\n}\n","export function isAndroid(): boolean {\n  return navigator.platform === 'Android' || /android/i.test(navigator.userAgent)\n}\n","export function isiOS(): boolean {\n  return (\n    ['iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod'].includes(navigator.platform) ||\n    // iPad on iOS 13 detection\n    (navigator.userAgent.includes('Mac') && 'ontouchend' in document)\n  )\n}\n","/**\n * Detects if the current browser is Safari (but not iOS Safari or Chrome).\n * @returns `true` if the browser is Safari, `false` otherwise.\n * @example\n * if (isSafari()) {\n *   // Safari-specific handling\n * }\n */\nexport function isSafari(): boolean {\n  return typeof navigator !== 'undefined' ? /^((?!chrome|android).)*safari/i.test(navigator.userAgent) : false\n}\n","import { isTextSelection } from '../helpers/isTextSelection.js'\nimport { resolveFocusPosition } from '../helpers/resolveFocusPosition.js'\nimport type { FocusPosition, RawCommands } from '../types.js'\nimport { isAndroid } from '../utilities/isAndroid.js'\nimport { isiOS } from '../utilities/isiOS.js'\nimport { isSafari } from '../utilities/isSafari.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    focus: {\n      /**\n       * Focus the editor at the given position.\n       * @param position The position to focus at.\n       * @param options.scrollIntoView Scroll the focused position into view after focusing\n       * @example editor.commands.focus()\n       * @example editor.commands.focus(32, { scrollIntoView: false })\n       */\n      focus: (\n        /**\n         * The position to focus at.\n         */\n        position?: FocusPosition,\n\n        /**\n         * Optional options\n         * @default { scrollIntoView: true }\n         */\n        options?: {\n          scrollIntoView?: boolean\n        },\n      ) => ReturnType\n    }\n  }\n}\n\nexport const focus: RawCommands['focus'] =\n  (position = null, options = {}) =>\n  ({ editor, view, tr, dispatch }) => {\n    options = {\n      scrollIntoView: true,\n      ...options,\n    }\n\n    const delayedFocus = () => {\n      // focus within `requestAnimationFrame` breaks focus on iOS and Android\n      // so we have to call this\n      if (isiOS() || isAndroid()) {\n        ;(view.dom as HTMLElement).focus()\n      }\n\n      // Safari requires preventScroll to avoid the browser scrolling to the\n      // top of the editor when focus is called before the selection is set.\n      // We exclude iOS and Android since they are already handled above.\n      // see: https://github.com/ueberdosis/tiptap/issues/7318\n      if (isSafari() && !isiOS() && !isAndroid()) {\n        ;(view.dom as HTMLElement).focus({ preventScroll: true })\n      }\n\n      // For React we have to focus asynchronously. Otherwise wild things happen.\n      // see: https://github.com/ueberdosis/tiptap/issues/1520\n      requestAnimationFrame(() => {\n        if (!editor.isDestroyed) {\n          view.focus()\n\n          if (options?.scrollIntoView) {\n            editor.commands.scrollIntoView()\n          }\n        }\n      })\n    }\n\n    if ((view.hasFocus() && position === null) || position === false) {\n      return true\n    }\n\n    // we dont try to resolve a NodeSelection or CellSelection\n    if (dispatch && position === null && !isTextSelection(editor.state.selection)) {\n      delayedFocus()\n      return true\n    }\n\n    // pass through tr.doc instead of editor.state.doc\n    // since transactions could change the editors state before this command has been run\n    const selection = resolveFocusPosition(tr.doc, position) || editor.state.selection\n    const isSameSelection = editor.state.selection.eq(selection)\n\n    if (dispatch) {\n      if (!isSameSelection) {\n        tr.setSelection(selection)\n      }\n\n      // `tr.setSelection` resets the stored marks\n      // so well restore them if the selection is the same as before\n      if (isSameSelection && tr.storedMarks) {\n        tr.setStoredMarks(tr.storedMarks)\n      }\n\n      delayedFocus()\n    }\n\n    return true\n  }\n","import type { CommandProps, RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    forEach: {\n      /**\n       * Loop through an array of items.\n       */\n      forEach: <T>(\n        items: T[],\n        fn: (\n          item: T,\n          props: CommandProps & {\n            index: number\n          },\n        ) => boolean,\n      ) => ReturnType\n    }\n  }\n}\n\nexport const forEach: RawCommands['forEach'] = (items, fn) => props => {\n  return items.every((item, index) => fn(item, { ...props, index }))\n}\n","import type { Fragment, Node as ProseMirrorNode, ParseOptions } from '@tiptap/pm/model'\n\nimport type { Content, RawCommands } from '../types.js'\n\nexport interface InsertContentOptions {\n  /**\n   * Options for parsing the content.\n   */\n  parseOptions?: ParseOptions\n\n  /**\n   * Whether to update the selection after inserting the content.\n   */\n  updateSelection?: boolean\n  applyInputRules?: boolean\n  applyPasteRules?: boolean\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    insertContent: {\n      /**\n       * Insert a node or string of HTML at the current position.\n       * @example editor.commands.insertContent('<h1>Example</h1>')\n       * @example editor.commands.insertContent('<h1>Example</h1>', { updateSelection: false })\n       */\n      insertContent: (\n        /**\n         * The ProseMirror content to insert.\n         */\n        value: Content | ProseMirrorNode | Fragment,\n\n        /**\n         * Optional options\n         */\n        options?: InsertContentOptions,\n      ) => ReturnType\n    }\n  }\n}\n\nexport const insertContent: RawCommands['insertContent'] =\n  (value, options) =>\n  ({ tr, commands }) => {\n    return commands.insertContentAt({ from: tr.selection.from, to: tr.selection.to }, value, options)\n  }\n","import type { Node as ProseMirrorNode, ParseOptions } from '@tiptap/pm/model'\nimport { Fragment } from '@tiptap/pm/model'\n\nimport { createNodeFromContent } from '../helpers/createNodeFromContent.js'\nimport { selectionToInsertionEnd } from '../helpers/selectionToInsertionEnd.js'\nimport type { Content, Range, RawCommands } from '../types.js'\n\nexport interface InsertContentAtOptions {\n  /**\n   * Options for parsing the content.\n   */\n  parseOptions?: ParseOptions\n\n  /**\n   * Whether to update the selection after inserting the content.\n   */\n  updateSelection?: boolean\n\n  /**\n   * Whether to apply input rules after inserting the content.\n   */\n  applyInputRules?: boolean\n\n  /**\n   * Whether to apply paste rules after inserting the content.\n   */\n  applyPasteRules?: boolean\n\n  /**\n   * Whether to throw an error if the content is invalid.\n   */\n  errorOnInvalidContent?: boolean\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    insertContentAt: {\n      /**\n       * Insert a node or string of HTML at a specific position.\n       * @example editor.commands.insertContentAt(0, '<h1>Example</h1>')\n       */\n      insertContentAt: (\n        /**\n         * The position to insert the content at.\n         */\n        position: number | Range,\n\n        /**\n         * The ProseMirror content to insert.\n         */\n        value: Content | ProseMirrorNode | Fragment,\n\n        /**\n         * Optional options\n         */\n        options?: InsertContentAtOptions,\n      ) => ReturnType\n    }\n  }\n}\n\nconst isFragment = (nodeOrFragment: ProseMirrorNode | Fragment): nodeOrFragment is Fragment => {\n  return !('type' in nodeOrFragment)\n}\n\nexport const insertContentAt: RawCommands['insertContentAt'] =\n  (position, value, options) =>\n  ({ tr, dispatch, editor }) => {\n    if (dispatch) {\n      options = {\n        parseOptions: editor.options.parseOptions,\n        updateSelection: true,\n        applyInputRules: false,\n        applyPasteRules: false,\n        ...options,\n      }\n\n      let content: Fragment | ProseMirrorNode\n\n      const emitContentError = (error: Error) => {\n        editor.emit('contentError', {\n          editor,\n          error,\n          disableCollaboration: () => {\n            if (\n              'collaboration' in editor.storage &&\n              typeof editor.storage.collaboration === 'object' &&\n              editor.storage.collaboration\n            ) {\n              ;(editor.storage.collaboration as any).isDisabled = true\n            }\n          },\n        })\n      }\n\n      const parseOptions: ParseOptions = {\n        preserveWhitespace: 'full',\n        ...options.parseOptions,\n      }\n\n      // If `emitContentError` is enabled, we want to check the content for errors\n      // but ignore them (do not remove the invalid content from the document)\n      if (!options.errorOnInvalidContent && !editor.options.enableContentCheck && editor.options.emitContentError) {\n        try {\n          createNodeFromContent(value, editor.schema, {\n            parseOptions,\n            errorOnInvalidContent: true,\n          })\n        } catch (e) {\n          emitContentError(e as Error)\n        }\n      }\n\n      try {\n        content = createNodeFromContent(value, editor.schema, {\n          parseOptions,\n          errorOnInvalidContent: options.errorOnInvalidContent ?? editor.options.enableContentCheck,\n        })\n      } catch (e) {\n        emitContentError(e as Error)\n        return false\n      }\n\n      let { from, to } =\n        typeof position === 'number' ? { from: position, to: position } : { from: position.from, to: position.to }\n\n      let isOnlyTextContent = true\n      let isOnlyBlockContent = true\n      const nodes = isFragment(content) ? content : [content]\n\n      nodes.forEach(node => {\n        // check if added node is valid\n        node.check()\n\n        isOnlyTextContent = isOnlyTextContent ? node.isText && node.marks.length === 0 : false\n\n        isOnlyBlockContent = isOnlyBlockContent ? node.isBlock : false\n      })\n\n      // check if we can replace the wrapping node by\n      // the newly inserted content\n      // example:\n      // replace an empty paragraph by an inserted image\n      // instead of inserting the image below the paragraph\n      if (from === to && isOnlyBlockContent) {\n        const { parent } = tr.doc.resolve(from)\n        const isEmptyTextBlock = parent.isTextblock && !parent.type.spec.code && !parent.childCount\n\n        if (isEmptyTextBlock) {\n          from -= 1\n          to += 1\n        }\n      }\n\n      let newContent\n\n      // if there is only plain text we have to use `insertText`\n      // because this will keep the current marks\n      if (isOnlyTextContent) {\n        // if value is string, we can use it directly\n        // otherwise if it is an array, we have to join it\n        if (Array.isArray(value)) {\n          newContent = value.map(v => v.text || '').join('')\n        } else if (value instanceof Fragment) {\n          let text = ''\n\n          value.forEach(node => {\n            if (node.text) {\n              text += node.text\n            }\n          })\n\n          newContent = text\n        } else if (typeof value === 'object' && !!value && !!value.text) {\n          newContent = value.text\n        } else {\n          newContent = value as string\n        }\n\n        tr.insertText(newContent, from, to)\n      } else {\n        newContent = content\n\n        const $from = tr.doc.resolve(from)\n        const $fromNode = $from.node()\n        const fromSelectionAtStart = $from.parentOffset === 0\n        const isTextSelection = $fromNode.isText || $fromNode.isTextblock\n        const hasContent = $fromNode.content.size > 0\n\n        if (fromSelectionAtStart && isTextSelection && hasContent) {\n          from = Math.max(0, from - 1)\n        }\n\n        tr.replaceWith(from, to, newContent)\n      }\n\n      // set cursor at end of inserted content\n      if (options.updateSelection) {\n        selectionToInsertionEnd(tr, tr.steps.length - 1, -1)\n      }\n\n      if (options.applyInputRules) {\n        tr.setMeta('applyInputRules', { from, text: newContent })\n      }\n\n      if (options.applyPasteRules) {\n        tr.setMeta('applyPasteRules', { from, text: newContent })\n      }\n    }\n\n    return true\n  }\n","import type { ParseOptions } from '@tiptap/pm/model'\nimport { DOMParser, Fragment, Node as ProseMirrorNode, Schema } from '@tiptap/pm/model'\n\nimport type { Content } from '../types.js'\nimport { elementFromString } from '../utilities/elementFromString.js'\n\nexport type CreateNodeFromContentOptions = {\n  slice?: boolean\n  parseOptions?: ParseOptions\n  errorOnInvalidContent?: boolean\n}\n\n/**\n * Takes a JSON or HTML content and creates a Prosemirror node or fragment from it.\n * @param content The JSON or HTML content to create the node from\n * @param schema The Prosemirror schema to use for the node\n * @param options Options for the parser\n * @returns The created Prosemirror node or fragment\n */\nexport function createNodeFromContent(\n  content: Content | ProseMirrorNode | Fragment,\n  schema: Schema,\n  options?: CreateNodeFromContentOptions,\n): ProseMirrorNode | Fragment {\n  if (content instanceof ProseMirrorNode || content instanceof Fragment) {\n    return content\n  }\n  options = {\n    slice: true,\n    parseOptions: {},\n    ...options,\n  }\n\n  const isJSONContent = typeof content === 'object' && content !== null\n  const isTextContent = typeof content === 'string'\n\n  if (isJSONContent) {\n    try {\n      const isArrayContent = Array.isArray(content) && content.length > 0\n\n      // if the JSON Content is an array of nodes, create a fragment for each node\n      if (isArrayContent) {\n        return Fragment.fromArray(content.map(item => schema.nodeFromJSON(item)))\n      }\n\n      const node = schema.nodeFromJSON(content)\n\n      if (options.errorOnInvalidContent) {\n        node.check()\n      }\n\n      return node\n    } catch (error) {\n      if (options.errorOnInvalidContent) {\n        throw new Error('[tiptap error]: Invalid JSON content', { cause: error as Error })\n      }\n\n      console.warn('[tiptap warn]: Invalid content.', 'Passed value:', content, 'Error:', error)\n\n      return createNodeFromContent('', schema, options)\n    }\n  }\n\n  if (isTextContent) {\n    // Check for invalid content\n    if (options.errorOnInvalidContent) {\n      let hasInvalidContent = false\n      let invalidContent = ''\n\n      // A copy of the current schema with a catch-all node at the end\n      const contentCheckSchema = new Schema({\n        topNode: schema.spec.topNode,\n        marks: schema.spec.marks,\n        // Prosemirror's schemas are executed such that: the last to execute, matches last\n        // This means that we can add a catch-all node at the end of the schema to catch any content that we don't know how to handle\n        nodes: schema.spec.nodes.append({\n          __tiptap__private__unknown__catch__all__node: {\n            content: 'inline*',\n            group: 'block',\n            parseDOM: [\n              {\n                tag: '*',\n                getAttrs: e => {\n                  // If this is ever called, we know that the content has something that we don't know how to handle in the schema\n                  hasInvalidContent = true\n                  // Try to stringify the element for a more helpful error message\n                  invalidContent = typeof e === 'string' ? e : e.outerHTML\n                  return null\n                },\n              },\n            ],\n          },\n        }),\n      })\n\n      if (options.slice) {\n        DOMParser.fromSchema(contentCheckSchema).parseSlice(elementFromString(content), options.parseOptions)\n      } else {\n        DOMParser.fromSchema(contentCheckSchema).parse(elementFromString(content), options.parseOptions)\n      }\n\n      if (options.errorOnInvalidContent && hasInvalidContent) {\n        throw new Error('[tiptap error]: Invalid HTML content', {\n          cause: new Error(`Invalid element found: ${invalidContent}`),\n        })\n      }\n    }\n\n    const parser = DOMParser.fromSchema(schema)\n\n    if (options.slice) {\n      return parser.parseSlice(elementFromString(content), options.parseOptions).content\n    }\n\n    return parser.parse(elementFromString(content), options.parseOptions)\n  }\n\n  return createNodeFromContent('', schema, options)\n}\n","const removeWhitespaces = (node: HTMLElement) => {\n  const children = node.childNodes\n\n  for (let i = children.length - 1; i >= 0; i -= 1) {\n    const child = children[i]\n\n    if (child.nodeType === 3 && child.nodeValue && /^(\\n\\s\\s|\\n)$/.test(child.nodeValue)) {\n      node.removeChild(child)\n    } else if (child.nodeType === 1) {\n      removeWhitespaces(child as HTMLElement)\n    }\n  }\n\n  return node\n}\n\nexport function elementFromString(value: string): HTMLElement {\n  if (typeof window === 'undefined') {\n    throw new Error('[tiptap error]: there is no window object available, so this function cannot be used')\n  }\n  // add a wrapper to preserve leading and trailing whitespace\n  const wrappedValue = `<body>${value}</body>`\n\n  const html = new window.DOMParser().parseFromString(wrappedValue, 'text/html').body\n\n  return removeWhitespaces(html)\n}\n","import type { Transaction } from '@tiptap/pm/state'\nimport { Selection } from '@tiptap/pm/state'\nimport { ReplaceAroundStep, ReplaceStep } from '@tiptap/pm/transform'\n\n// source: https://github.com/ProseMirror/prosemirror-state/blob/master/src/selection.js#L466\nexport function selectionToInsertionEnd(tr: Transaction, startLen: number, bias: number) {\n  const last = tr.steps.length - 1\n\n  if (last < startLen) {\n    return\n  }\n\n  const step = tr.steps[last]\n\n  if (!(step instanceof ReplaceStep || step instanceof ReplaceAroundStep)) {\n    return\n  }\n\n  const map = tr.mapping.maps[last]\n  let end = 0\n\n  map.forEach((_from, _to, _newFrom, newTo) => {\n    if (end === 0) {\n      end = newTo\n    }\n  })\n\n  tr.setSelection(Selection.near(tr.doc.resolve(end), bias))\n}\n","import {\n  joinBackward as originalJoinBackward,\n  joinDown as originalJoinDown,\n  joinForward as originalJoinForward,\n  joinUp as originalJoinUp,\n} from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    joinUp: {\n      /**\n       * Join the selected block or, if there is a text selection, the closest ancestor block of the selection that can be joined, with the sibling above it.\n       * @example editor.commands.joinUp()\n       */\n      joinUp: () => ReturnType\n    }\n    joinDown: {\n      /**\n       * Join the selected block, or the closest ancestor of the selection that can be joined, with the sibling after it.\n       * @example editor.commands.joinDown()\n       */\n      joinDown: () => ReturnType\n    }\n    joinBackward: {\n      /**\n       * If the selection is empty and at the start of a textblock, try to reduce the distance between that block and the one before itif there's a block directly before it that can be joined, join them.\n       * If not, try to move the selected block closer to the next one in the document structure by lifting it out of its\n       * parent or moving it into a parent of the previous block. Will use the view for accurate (bidi-aware) start-of-textblock detection if given.\n       * @example editor.commands.joinBackward()\n       */\n      joinBackward: () => ReturnType\n    }\n    joinForward: {\n      /**\n       * If the selection is empty and the cursor is at the end of a textblock, try to reduce or remove the boundary between that block and the one after it,\n       * either by joining them or by moving the other block closer to this one in the tree structure.\n       * Will use the view for accurate start-of-textblock detection if given.\n       * @example editor.commands.joinForward()\n       */\n      joinForward: () => ReturnType\n    }\n  }\n}\n\nexport const joinUp: RawCommands['joinUp'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalJoinUp(state, dispatch)\n  }\n\nexport const joinDown: RawCommands['joinDown'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalJoinDown(state, dispatch)\n  }\n\nexport const joinBackward: RawCommands['joinBackward'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalJoinBackward(state, dispatch)\n  }\n\nexport const joinForward: RawCommands['joinForward'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalJoinForward(state, dispatch)\n  }\n","import { joinPoint } from '@tiptap/pm/transform'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    joinItemBackward: {\n      /**\n       * Join two items backward.\n       * @example editor.commands.joinItemBackward()\n       */\n      joinItemBackward: () => ReturnType\n    }\n  }\n}\n\nexport const joinItemBackward: RawCommands['joinItemBackward'] =\n  () =>\n  ({ state, dispatch, tr }) => {\n    try {\n      const point = joinPoint(state.doc, state.selection.$from.pos, -1)\n\n      if (point === null || point === undefined) {\n        return false\n      }\n\n      tr.join(point, 2)\n\n      if (dispatch) {\n        dispatch(tr)\n      }\n\n      return true\n    } catch {\n      return false\n    }\n  }\n","import { joinPoint } from '@tiptap/pm/transform'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    joinItemForward: {\n      /**\n       * Join two items Forwards.\n       * @example editor.commands.joinItemForward()\n       */\n      joinItemForward: () => ReturnType\n    }\n  }\n}\n\nexport const joinItemForward: RawCommands['joinItemForward'] =\n  () =>\n  ({ state, dispatch, tr }) => {\n    try {\n      const point = joinPoint(state.doc, state.selection.$from.pos, +1)\n\n      if (point === null || point === undefined) {\n        return false\n      }\n\n      tr.join(point, 2)\n\n      if (dispatch) {\n        dispatch(tr)\n      }\n\n      return true\n    } catch {\n      return false\n    }\n  }\n","import { joinTextblockBackward as originalCommand } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    joinTextblockBackward: {\n      /**\n       * A more limited form of joinBackward that only tries to join the current textblock to the one before it, if the cursor is at the start of a textblock.\n       */\n      joinTextblockBackward: () => ReturnType\n    }\n  }\n}\n\nexport const joinTextblockBackward: RawCommands['joinTextblockBackward'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalCommand(state, dispatch)\n  }\n","import { joinTextblockForward as originalCommand } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    joinTextblockForward: {\n      /**\n       * A more limited form of joinForward that only tries to join the current textblock to the one after it, if the cursor is at the end of a textblock.\n       */\n      joinTextblockForward: () => ReturnType\n    }\n  }\n}\n\nexport const joinTextblockForward: RawCommands['joinTextblockForward'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalCommand(state, dispatch)\n  }\n","export function isMacOS(): boolean {\n  return typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false\n}\n","import type { RawCommands } from '../types.js'\nimport { isiOS } from '../utilities/isiOS.js'\nimport { isMacOS } from '../utilities/isMacOS.js'\n\nfunction normalizeKeyName(name: string) {\n  const parts = name.split(/-(?!$)/)\n  let result = parts[parts.length - 1]\n\n  if (result === 'Space') {\n    result = ' '\n  }\n\n  let alt\n  let ctrl\n  let shift\n  let meta\n\n  for (let i = 0; i < parts.length - 1; i += 1) {\n    const mod = parts[i]\n\n    if (/^(cmd|meta|m)$/i.test(mod)) {\n      meta = true\n    } else if (/^a(lt)?$/i.test(mod)) {\n      alt = true\n    } else if (/^(c|ctrl|control)$/i.test(mod)) {\n      ctrl = true\n    } else if (/^s(hift)?$/i.test(mod)) {\n      shift = true\n    } else if (/^mod$/i.test(mod)) {\n      if (isiOS() || isMacOS()) {\n        meta = true\n      } else {\n        ctrl = true\n      }\n    } else {\n      throw new Error(`Unrecognized modifier name: ${mod}`)\n    }\n  }\n\n  if (alt) {\n    result = `Alt-${result}`\n  }\n\n  if (ctrl) {\n    result = `Ctrl-${result}`\n  }\n\n  if (meta) {\n    result = `Meta-${result}`\n  }\n\n  if (shift) {\n    result = `Shift-${result}`\n  }\n\n  return result\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    keyboardShortcut: {\n      /**\n       * Trigger a keyboard shortcut.\n       * @param name The name of the keyboard shortcut.\n       * @example editor.commands.keyboardShortcut('Mod-b')\n       */\n      keyboardShortcut: (name: string) => ReturnType\n    }\n  }\n}\n\nexport const keyboardShortcut: RawCommands['keyboardShortcut'] =\n  name =>\n  ({ editor, view, tr, dispatch }) => {\n    const keys = normalizeKeyName(name).split(/-(?!$)/)\n    const key = keys.find(item => !['Alt', 'Ctrl', 'Meta', 'Shift'].includes(item))\n    const event = new KeyboardEvent('keydown', {\n      key: key === 'Space' ? ' ' : key,\n      altKey: keys.includes('Alt'),\n      ctrlKey: keys.includes('Ctrl'),\n      metaKey: keys.includes('Meta'),\n      shiftKey: keys.includes('Shift'),\n      bubbles: true,\n      cancelable: true,\n    })\n\n    const capturedTransaction = editor.captureTransaction(() => {\n      view.someProp('handleKeyDown', f => f(view, event))\n    })\n\n    capturedTransaction?.steps.forEach(step => {\n      const newStep = step.map(tr.mapping)\n\n      if (newStep && dispatch) {\n        tr.maybeStep(newStep)\n      }\n    })\n\n    return true\n  }\n","import { lift as originalLift } from '@tiptap/pm/commands'\nimport type { NodeType } from '@tiptap/pm/model'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport { isNodeActive } from '../helpers/isNodeActive.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    lift: {\n      /**\n       * Removes an existing wrap if possible lifting the node out of it\n       * @param typeOrName The type or name of the node.\n       * @param attributes The attributes of the node.\n       * @example editor.commands.lift('paragraph')\n       * @example editor.commands.lift('heading', { level: 1 })\n       */\n      lift: (typeOrName: string | NodeType, attributes?: Record<string, any>) => ReturnType\n    }\n  }\n}\n\nexport const lift: RawCommands['lift'] =\n  (typeOrName, attributes = {}) =>\n  ({ state, dispatch }) => {\n    const type = getNodeType(typeOrName, state.schema)\n    const isActive = isNodeActive(state, type, attributes)\n\n    if (!isActive) {\n      return false\n    }\n\n    return originalLift(state, dispatch)\n  }\n","import type { NodeType } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\n\nimport type { NodeRange } from '../types.js'\nimport { objectIncludes } from '../utilities/objectIncludes.js'\nimport { getNodeType } from './getNodeType.js'\n\nexport function isNodeActive(\n  state: EditorState,\n  typeOrName: NodeType | string | null,\n  attributes: Record<string, any> = {},\n): boolean {\n  const { from, to, empty } = state.selection\n  const type = typeOrName ? getNodeType(typeOrName, state.schema) : null\n\n  const nodeRanges: NodeRange[] = []\n\n  state.doc.nodesBetween(from, to, (node, pos) => {\n    if (node.isText) {\n      return\n    }\n\n    const relativeFrom = Math.max(from, pos)\n    const relativeTo = Math.min(to, pos + node.nodeSize)\n\n    nodeRanges.push({\n      node,\n      from: relativeFrom,\n      to: relativeTo,\n    })\n  })\n\n  const selectionRange = to - from\n  const matchedNodeRanges = nodeRanges\n    .filter(nodeRange => {\n      if (!type) {\n        return true\n      }\n\n      return type.name === nodeRange.node.type.name\n    })\n    .filter(nodeRange => objectIncludes(nodeRange.node.attrs, attributes, { strict: false }))\n\n  if (empty) {\n    return !!matchedNodeRanges.length\n  }\n\n  const range = matchedNodeRanges.reduce((sum, nodeRange) => sum + nodeRange.to - nodeRange.from, 0)\n\n  return range >= selectionRange\n}\n","import { liftEmptyBlock as originalLiftEmptyBlock } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    liftEmptyBlock: {\n      /**\n       * If the cursor is in an empty textblock that can be lifted, lift the block.\n       * @example editor.commands.liftEmptyBlock()\n       */\n      liftEmptyBlock: () => ReturnType\n    }\n  }\n}\n\nexport const liftEmptyBlock: RawCommands['liftEmptyBlock'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalLiftEmptyBlock(state, dispatch)\n  }\n","import type { NodeType } from '@tiptap/pm/model'\nimport { liftListItem as originalLiftListItem } from '@tiptap/pm/schema-list'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    liftListItem: {\n      /**\n       * Create a command to lift the list item around the selection up into a wrapping list.\n       * @param typeOrName The type or name of the node.\n       * @example editor.commands.liftListItem('listItem')\n       */\n      liftListItem: (typeOrName: string | NodeType) => ReturnType\n    }\n  }\n}\n\nexport const liftListItem: RawCommands['liftListItem'] =\n  typeOrName =>\n  ({ state, dispatch }) => {\n    const type = getNodeType(typeOrName, state.schema)\n\n    return originalLiftListItem(type)(state, dispatch)\n  }\n","import { newlineInCode as originalNewlineInCode } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    newlineInCode: {\n      /**\n       * Add a newline character in code.\n       * @example editor.commands.newlineInCode()\n       */\n      newlineInCode: () => ReturnType\n    }\n  }\n}\n\nexport const newlineInCode: RawCommands['newlineInCode'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalNewlineInCode(state, dispatch)\n  }\n","import type { Schema } from '@tiptap/pm/model'\n\n/**\n * Get the type of a schema item by its name.\n * @param name The name of the schema item\n * @param schema The Prosemiror schema to search in\n * @returns The type of the schema item (`node` or `mark`), or null if it doesn't exist\n */\nexport function getSchemaTypeNameByName(name: string, schema: Schema): 'node' | 'mark' | null {\n  if (schema.nodes[name]) {\n    return 'node'\n  }\n\n  if (schema.marks[name]) {\n    return 'mark'\n  }\n\n  return null\n}\n","/**\n * Remove a property or an array of properties from an object\n * @param obj Object\n * @param key Key to remove\n */\nexport function deleteProps(obj: Record<string, any>, propOrProps: string | string[]): Record<string, any> {\n  const props = typeof propOrProps === 'string' ? [propOrProps] : propOrProps\n\n  return Object.keys(obj).reduce((newObj: Record<string, any>, prop) => {\n    if (!props.includes(prop)) {\n      newObj[prop] = obj[prop]\n    }\n\n    return newObj\n  }, {})\n}\n","import type { MarkType, NodeType } from '@tiptap/pm/model'\n\nimport { getMarkType } from '../helpers/getMarkType.js'\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport { getSchemaTypeNameByName } from '../helpers/getSchemaTypeNameByName.js'\nimport type { RawCommands } from '../types.js'\nimport { deleteProps } from '../utilities/deleteProps.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    resetAttributes: {\n      /**\n       * Resets some node attributes to the default value.\n       * @param typeOrName The type or name of the node.\n       * @param attributes The attributes of the node to reset.\n       * @example editor.commands.resetAttributes('heading', 'level')\n       */\n      resetAttributes: (typeOrName: string | NodeType | MarkType, attributes: string | string[]) => ReturnType\n    }\n  }\n}\n\nexport const resetAttributes: RawCommands['resetAttributes'] =\n  (typeOrName, attributes) =>\n  ({ tr, state, dispatch }) => {\n    let nodeType: NodeType | null = null\n    let markType: MarkType | null = null\n\n    const schemaType = getSchemaTypeNameByName(\n      typeof typeOrName === 'string' ? typeOrName : typeOrName.name,\n      state.schema,\n    )\n\n    if (!schemaType) {\n      return false\n    }\n\n    if (schemaType === 'node') {\n      nodeType = getNodeType(typeOrName as NodeType, state.schema)\n    }\n\n    if (schemaType === 'mark') {\n      markType = getMarkType(typeOrName as MarkType, state.schema)\n    }\n\n    let canReset = false\n\n    tr.selection.ranges.forEach(range => {\n      state.doc.nodesBetween(range.$from.pos, range.$to.pos, (node, pos) => {\n        if (nodeType && nodeType === node.type) {\n          canReset = true\n\n          if (dispatch) {\n            tr.setNodeMarkup(pos, undefined, deleteProps(node.attrs, attributes))\n          }\n        }\n\n        if (markType && node.marks.length) {\n          node.marks.forEach(mark => {\n            if (markType === mark.type) {\n              canReset = true\n\n              if (dispatch) {\n                tr.addMark(pos, pos + node.nodeSize, markType.create(deleteProps(mark.attrs, attributes)))\n              }\n            }\n          })\n        }\n      })\n    })\n\n    return canReset\n  }\n","import type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    scrollIntoView: {\n      /**\n       * Scroll the selection into view.\n       * @example editor.commands.scrollIntoView()\n       */\n      scrollIntoView: () => ReturnType\n    }\n  }\n}\n\nexport const scrollIntoView: RawCommands['scrollIntoView'] =\n  () =>\n  ({ tr, dispatch }) => {\n    if (dispatch) {\n      tr.scrollIntoView()\n    }\n\n    return true\n  }\n","import { AllSelection } from '@tiptap/pm/state'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    selectAll: {\n      /**\n       * Select the whole document.\n       * @example editor.commands.selectAll()\n       */\n      selectAll: () => ReturnType\n    }\n  }\n}\n\nexport const selectAll: RawCommands['selectAll'] =\n  () =>\n  ({ tr, dispatch }) => {\n    if (dispatch) {\n      const selection = new AllSelection(tr.doc)\n\n      tr.setSelection(selection)\n    }\n\n    return true\n  }\n","import { selectNodeBackward as originalSelectNodeBackward } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    selectNodeBackward: {\n      /**\n       * Select a node backward.\n       * @example editor.commands.selectNodeBackward()\n       */\n      selectNodeBackward: () => ReturnType\n    }\n  }\n}\n\nexport const selectNodeBackward: RawCommands['selectNodeBackward'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalSelectNodeBackward(state, dispatch)\n  }\n","import { selectNodeForward as originalSelectNodeForward } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    selectNodeForward: {\n      /**\n       * Select a node forward.\n       * @example editor.commands.selectNodeForward()\n       */\n      selectNodeForward: () => ReturnType\n    }\n  }\n}\n\nexport const selectNodeForward: RawCommands['selectNodeForward'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalSelectNodeForward(state, dispatch)\n  }\n","import { selectParentNode as originalSelectParentNode } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    selectParentNode: {\n      /**\n       * Select the parent node.\n       * @example editor.commands.selectParentNode()\n       */\n      selectParentNode: () => ReturnType\n    }\n  }\n}\n\nexport const selectParentNode: RawCommands['selectParentNode'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalSelectParentNode(state, dispatch)\n  }\n","// @ts-ignore\n// TODO: add types to @types/prosemirror-commands\nimport { selectTextblockEnd as originalSelectTextblockEnd } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    selectTextblockEnd: {\n      /**\n       * Moves the cursor to the end of current text block.\n       * @example editor.commands.selectTextblockEnd()\n       */\n      selectTextblockEnd: () => ReturnType\n    }\n  }\n}\n\nexport const selectTextblockEnd: RawCommands['selectTextblockEnd'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalSelectTextblockEnd(state, dispatch)\n  }\n","// @ts-ignore\n// TODO: add types to @types/prosemirror-commands\nimport { selectTextblockStart as originalSelectTextblockStart } from '@tiptap/pm/commands'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    selectTextblockStart: {\n      /**\n       * Moves the cursor to the start of current text block.\n       * @example editor.commands.selectTextblockStart()\n       */\n      selectTextblockStart: () => ReturnType\n    }\n  }\n}\n\nexport const selectTextblockStart: RawCommands['selectTextblockStart'] =\n  () =>\n  ({ state, dispatch }) => {\n    return originalSelectTextblockStart(state, dispatch)\n  }\n","import type { Fragment, Node as ProseMirrorNode, ParseOptions, Schema } from '@tiptap/pm/model'\n\nimport type { Content } from '../types.js'\nimport { createNodeFromContent } from './createNodeFromContent.js'\n\n/**\n * Create a new Prosemirror document node from content.\n * @param content The JSON or HTML content to create the document from\n * @param schema The Prosemirror schema to use for the document\n * @param parseOptions Options for the parser\n * @returns The created Prosemirror document node\n */\nexport function createDocument(\n  content: Content | ProseMirrorNode | Fragment,\n  schema: Schema,\n  parseOptions: ParseOptions = {},\n  options: { errorOnInvalidContent?: boolean } = {},\n): ProseMirrorNode {\n  return createNodeFromContent(content, schema, {\n    slice: false,\n    parseOptions,\n    errorOnInvalidContent: options.errorOnInvalidContent,\n  }) as ProseMirrorNode\n}\n","import type { Fragment, Node as ProseMirrorNode, ParseOptions } from '@tiptap/pm/model'\n\nimport { createDocument } from '../helpers/createDocument.js'\nimport type { Content, RawCommands } from '../types.js'\n\nexport interface SetContentOptions {\n  /**\n   * Options for parsing the content.\n   * @default {}\n   */\n  parseOptions?: ParseOptions\n\n  /**\n   * Whether to throw an error if the content is invalid.\n   */\n  errorOnInvalidContent?: boolean\n\n  /**\n   * Whether to emit an update event.\n   * @default true\n   */\n  emitUpdate?: boolean\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    setContent: {\n      /**\n       * Replace the whole document with new content.\n       * @param content The new content.\n       * @param emitUpdate Whether to emit an update event.\n       * @param parseOptions Options for parsing the content.\n       * @example editor.commands.setContent('<p>Example text</p>')\n       */\n      setContent: (\n        /**\n         * The new content.\n         */\n        content: Content | Fragment | ProseMirrorNode,\n\n        /**\n         * Options for `setContent`.\n         */\n        options?: SetContentOptions,\n      ) => ReturnType\n    }\n  }\n}\n\nexport const setContent: RawCommands['setContent'] =\n  (content, { errorOnInvalidContent, emitUpdate = true, parseOptions = {} } = {}) =>\n  ({ editor, tr, dispatch, commands }) => {\n    const { doc } = tr\n\n    // This is to keep backward compatibility with the previous behavior\n    // TODO remove this in the next major version\n    if (parseOptions.preserveWhitespace !== 'full') {\n      const document = createDocument(content, editor.schema, parseOptions, {\n        errorOnInvalidContent: errorOnInvalidContent ?? editor.options.enableContentCheck,\n      })\n\n      if (dispatch) {\n        tr.replaceWith(0, doc.content.size, document).setMeta('preventUpdate', !emitUpdate)\n      }\n      return true\n    }\n\n    if (dispatch) {\n      tr.setMeta('preventUpdate', !emitUpdate)\n    }\n\n    return commands.insertContentAt({ from: 0, to: doc.content.size }, content, {\n      parseOptions,\n      errorOnInvalidContent: errorOnInvalidContent ?? editor.options.enableContentCheck,\n    })\n  }\n","import type { Mark, MarkType } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\n\nimport { getMarkType } from './getMarkType.js'\n\nexport function getMarkAttributes(state: EditorState, typeOrName: string | MarkType): Record<string, any> {\n  const type = getMarkType(typeOrName, state.schema)\n  const { from, to, empty } = state.selection\n  const marks: Mark[] = []\n\n  if (empty) {\n    if (state.storedMarks) {\n      marks.push(...state.storedMarks)\n    }\n\n    marks.push(...state.selection.$head.marks())\n  } else {\n    state.doc.nodesBetween(from, to, node => {\n      marks.push(...node.marks)\n    })\n  }\n\n  const mark = marks.find(markItem => markItem.type.name === type.name)\n\n  if (!mark) {\n    return {}\n  }\n\n  return { ...mark.attrs }\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\nimport type { Transaction } from '@tiptap/pm/state'\nimport { Transform } from '@tiptap/pm/transform'\n\n/**\n * Returns a new `Transform` based on all steps of the passed transactions.\n * @param oldDoc The Prosemirror node to start from\n * @param transactions The transactions to combine\n * @returns A new `Transform` with all steps of the passed transactions\n */\nexport function combineTransactionSteps(oldDoc: ProseMirrorNode, transactions: Transaction[]): Transform {\n  const transform = new Transform(oldDoc)\n\n  transactions.forEach(transaction => {\n    transaction.steps.forEach(step => {\n      transform.step(step)\n    })\n  })\n\n  return transform\n}\n","import type { ContentMatch, NodeType } from '@tiptap/pm/model'\n\n/**\n * Gets the default block type at a given match\n * @param match The content match to get the default block type from\n * @returns The default block type or null\n */\nexport function defaultBlockAt(match: ContentMatch): NodeType | null {\n  for (let i = 0; i < match.edgeCount; i += 1) {\n    const { type } = match.edge(i)\n\n    if (type.isTextblock && !type.hasRequiredAttrs()) {\n      return type\n    }\n  }\n\n  return null\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\n\nimport type { NodeWithPos, Predicate } from '../types.js'\n\n/**\n * Find children inside a Prosemirror node that match a predicate.\n * @param node The Prosemirror node to search in\n * @param predicate The predicate to match\n * @returns An array of nodes with their positions\n */\nexport function findChildren(node: ProseMirrorNode, predicate: Predicate): NodeWithPos[] {\n  const nodesWithPos: NodeWithPos[] = []\n\n  node.descendants((child, pos) => {\n    if (predicate(child)) {\n      nodesWithPos.push({\n        node: child,\n        pos,\n      })\n    }\n  })\n\n  return nodesWithPos\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\n\nimport type { NodeWithPos, Predicate, Range } from '../types.js'\n\n/**\n * Same as `findChildren` but searches only within a `range`.\n * @param node The Prosemirror node to search in\n * @param range The range to search in\n * @param predicate The predicate to match\n * @returns An array of nodes with their positions\n */\nexport function findChildrenInRange(node: ProseMirrorNode, range: Range, predicate: Predicate): NodeWithPos[] {\n  const nodesWithPos: NodeWithPos[] = []\n\n  // if (range.from === range.to) {\n  //   const nodeAt = node.nodeAt(range.from)\n\n  //   if (nodeAt) {\n  //     nodesWithPos.push({\n  //       node: nodeAt,\n  //       pos: range.from,\n  //     })\n  //   }\n  // }\n\n  node.nodesBetween(range.from, range.to, (child, pos) => {\n    if (predicate(child)) {\n      nodesWithPos.push({\n        node: child,\n        pos,\n      })\n    }\n  })\n\n  return nodesWithPos\n}\n","import type { Node as ProseMirrorNode, ResolvedPos } from '@tiptap/pm/model'\n\nimport type { Predicate } from '../types.js'\n\n/**\n * Finds the closest parent node to a resolved position that matches a predicate.\n * @param $pos The resolved position to search from\n * @param predicate The predicate to match\n * @returns The closest parent node to the resolved position that matches the predicate\n * @example ```js\n * findParentNodeClosestToPos($from, node => node.type.name === 'paragraph')\n * ```\n */\nexport function findParentNodeClosestToPos(\n  $pos: ResolvedPos,\n  predicate: Predicate,\n):\n  | {\n      pos: number\n      start: number\n      depth: number\n      node: ProseMirrorNode\n    }\n  | undefined {\n  for (let i = $pos.depth; i > 0; i -= 1) {\n    const node = $pos.node(i)\n\n    if (predicate(node)) {\n      return {\n        pos: i > 0 ? $pos.before(i) : 0,\n        start: $pos.start(i),\n        depth: i,\n        node,\n      }\n    }\n  }\n}\n","import type { Selection } from '@tiptap/pm/state'\n\nimport type { Predicate } from '../types.js'\nimport { findParentNodeClosestToPos } from './findParentNodeClosestToPos.js'\n\n/**\n * Finds the closest parent node to the current selection that matches a predicate.\n * @param predicate The predicate to match\n * @returns A command that finds the closest parent node to the current selection that matches the predicate\n * @example ```js\n * findParentNode(node => node.type.name === 'paragraph')\n * ```\n */\nexport function findParentNode(\n  predicate: Predicate,\n): (selection: Selection) => ReturnType<typeof findParentNodeClosestToPos> {\n  return (selection: Selection) => findParentNodeClosestToPos(selection.$from, predicate)\n}\n","import type { ExtensionConfig } from '../Extension.js'\nimport type { MarkConfig } from '../Mark.js'\nimport type { NodeConfig } from '../Node.js'\nimport type { AnyExtension, MaybeThisParameterType, RemoveThis } from '../types.js'\n\n/**\n * Returns a field from an extension\n * @param extension The Tiptap extension\n * @param field The field, for example `renderHTML` or `priority`\n * @param context The context object that should be passed as `this` into the function\n * @returns The field value\n */\nexport function getExtensionField<T = any, E extends AnyExtension = any>(\n  extension: E,\n  field: keyof ExtensionConfig | keyof MarkConfig | keyof NodeConfig,\n  context?: Omit<MaybeThisParameterType<T>, 'parent'>,\n): RemoveThis<T> {\n  if (extension.config[field as keyof typeof extension.config] === undefined && extension.parent) {\n    return getExtensionField(extension.parent, field, context)\n  }\n\n  if (typeof extension.config[field as keyof typeof extension.config] === 'function') {\n    const value = (extension.config[field as keyof typeof extension.config] as any).bind({\n      ...context,\n      parent: extension.parent ? getExtensionField(extension.parent, field, context) : null,\n    })\n\n    return value\n  }\n\n  return extension.config[field as keyof typeof extension.config] as RemoveThis<T>\n}\n","import type { AnyConfig, Extensions } from '../types.js'\nimport { getExtensionField } from './getExtensionField.js'\n\n/**\n * Create a flattened array of extensions by traversing the `addExtensions` field.\n * @param extensions An array of Tiptap extensions\n * @returns A flattened array of Tiptap extensions\n */\nexport function flattenExtensions(extensions: Extensions): Extensions {\n  return (\n    extensions\n      .map(extension => {\n        const context = {\n          name: extension.name,\n          options: extension.options,\n          storage: extension.storage,\n        }\n\n        const addExtensions = getExtensionField<AnyConfig['addExtensions']>(extension, 'addExtensions', context)\n\n        if (addExtensions) {\n          return [extension, ...flattenExtensions(addExtensions())]\n        }\n\n        return extension\n      })\n      // `Infinity` will break TypeScript so we set a number that is probably high enough\n      .flat(10)\n  )\n}\n","import { Node } from '@tiptap/pm/model'\n\nimport type { Extensions, JSONContent } from '../types.js'\nimport { getHTMLFromFragment } from './getHTMLFromFragment.js'\nimport { getSchema } from './getSchema.js'\n\n/**\n * Generate HTML from a JSONContent\n * @param doc The JSONContent to generate HTML from\n * @param extensions The extensions to use for the schema\n * @returns The generated HTML\n */\nexport function generateHTML(doc: JSONContent, extensions: Extensions): string {\n  const schema = getSchema(extensions)\n  const contentNode = Node.fromJSON(schema, doc)\n\n  return getHTMLFromFragment(contentNode.content, schema)\n}\n","import type { Fragment, Schema } from '@tiptap/pm/model'\nimport { DOMSerializer } from '@tiptap/pm/model'\n\nexport function getHTMLFromFragment(fragment: Fragment, schema: Schema): string {\n  const documentFragment = DOMSerializer.fromSchema(schema).serializeFragment(fragment)\n\n  const temporaryDocument = document.implementation.createHTMLDocument()\n  const container = temporaryDocument.createElement('div')\n\n  container.appendChild(documentFragment)\n\n  return container.innerHTML\n}\n","import type { MarkSpec, NodeSpec, TagParseRule } from '@tiptap/pm/model'\nimport { Schema } from '@tiptap/pm/model'\n\nimport type { Editor, MarkConfig, NodeConfig } from '../index.js'\nimport type { AnyConfig, Extensions } from '../types.js'\nimport { callOrReturn } from '../utilities/callOrReturn.js'\nimport { isEmptyObject } from '../utilities/isEmptyObject.js'\nimport { getAttributesFromExtensions } from './getAttributesFromExtensions.js'\nimport { getExtensionField } from './getExtensionField.js'\nimport { getRenderedAttributes } from './getRenderedAttributes.js'\nimport { injectExtensionAttributesToParseRule } from './injectExtensionAttributesToParseRule.js'\nimport { splitExtensions } from './splitExtensions.js'\n\nfunction cleanUpSchemaItem<T>(data: T) {\n  return Object.fromEntries(\n    // @ts-ignore\n    Object.entries(data).filter(([key, value]) => {\n      if (key === 'attrs' && isEmptyObject(value as object | undefined)) {\n        return false\n      }\n\n      return value !== null && value !== undefined\n    }),\n  ) as T\n}\n\n/**\n * Builds an attribute spec tuple for ProseMirror schema from an extension attribute.\n * @param extensionAttribute The extension attribute to build the spec for\n * @returns A tuple of [attributeName, spec]\n */\nfunction buildAttributeSpec(\n  extensionAttribute: ReturnType<typeof getAttributesFromExtensions>[number],\n): [string, Record<string, any>] {\n  const spec: Record<string, any> = {}\n\n  // Only include 'default' if the attribute is not required and default is set on the attribute\n  if (!extensionAttribute?.attribute?.isRequired && 'default' in (extensionAttribute?.attribute || {})) {\n    spec.default = extensionAttribute.attribute.default\n  }\n\n  // Only include 'validate' if it's defined\n  if (extensionAttribute?.attribute?.validate !== undefined) {\n    spec.validate = extensionAttribute.attribute.validate\n  }\n\n  return [extensionAttribute.name, spec]\n}\n\n/**\n * Creates a new Prosemirror schema based on the given extensions.\n * @param extensions An array of Tiptap extensions\n * @param editor The editor instance\n * @returns A Prosemirror schema\n */\nexport function getSchemaByResolvedExtensions(extensions: Extensions, editor?: Editor): Schema {\n  const allAttributes = getAttributesFromExtensions(extensions)\n  const { nodeExtensions, markExtensions } = splitExtensions(extensions)\n  const topNode = nodeExtensions.find(extension => getExtensionField(extension, 'topNode'))?.name\n\n  const nodes = Object.fromEntries(\n    nodeExtensions.map(extension => {\n      const extensionAttributes = allAttributes.filter(attribute => attribute.type === extension.name)\n      const context = {\n        name: extension.name,\n        options: extension.options,\n        storage: extension.storage,\n        editor,\n      }\n\n      const extraNodeFields = extensions.reduce((fields, e) => {\n        const extendNodeSchema = getExtensionField<AnyConfig['extendNodeSchema']>(e, 'extendNodeSchema', context)\n\n        return {\n          ...fields,\n          ...(extendNodeSchema ? extendNodeSchema(extension) : {}),\n        }\n      }, {})\n\n      const schema: NodeSpec = cleanUpSchemaItem({\n        ...extraNodeFields,\n        content: callOrReturn(getExtensionField<NodeConfig['content']>(extension, 'content', context)),\n        marks: callOrReturn(getExtensionField<NodeConfig['marks']>(extension, 'marks', context)),\n        group: callOrReturn(getExtensionField<NodeConfig['group']>(extension, 'group', context)),\n        inline: callOrReturn(getExtensionField<NodeConfig['inline']>(extension, 'inline', context)),\n        atom: callOrReturn(getExtensionField<NodeConfig['atom']>(extension, 'atom', context)),\n        selectable: callOrReturn(getExtensionField<NodeConfig['selectable']>(extension, 'selectable', context)),\n        draggable: callOrReturn(getExtensionField<NodeConfig['draggable']>(extension, 'draggable', context)),\n        code: callOrReturn(getExtensionField<NodeConfig['code']>(extension, 'code', context)),\n        whitespace: callOrReturn(getExtensionField<NodeConfig['whitespace']>(extension, 'whitespace', context)),\n        linebreakReplacement: callOrReturn(\n          getExtensionField<NodeConfig['linebreakReplacement']>(extension, 'linebreakReplacement', context),\n        ),\n        defining: callOrReturn(getExtensionField<NodeConfig['defining']>(extension, 'defining', context)),\n        isolating: callOrReturn(getExtensionField<NodeConfig['isolating']>(extension, 'isolating', context)),\n        attrs: Object.fromEntries(extensionAttributes.map(buildAttributeSpec)),\n      })\n\n      const parseHTML = callOrReturn(getExtensionField<NodeConfig['parseHTML']>(extension, 'parseHTML', context))\n\n      if (parseHTML) {\n        schema.parseDOM = parseHTML.map(parseRule =>\n          injectExtensionAttributesToParseRule(parseRule, extensionAttributes),\n        ) as TagParseRule[]\n      }\n\n      const renderHTML = getExtensionField<NodeConfig['renderHTML']>(extension, 'renderHTML', context)\n\n      if (renderHTML) {\n        schema.toDOM = node =>\n          renderHTML({\n            node,\n            HTMLAttributes: getRenderedAttributes(node, extensionAttributes),\n          })\n      }\n\n      const renderText = getExtensionField<NodeConfig['renderText']>(extension, 'renderText', context)\n\n      if (renderText) {\n        schema.toText = renderText\n      }\n\n      return [extension.name, schema]\n    }),\n  )\n\n  const marks = Object.fromEntries(\n    markExtensions.map(extension => {\n      const extensionAttributes = allAttributes.filter(attribute => attribute.type === extension.name)\n      const context = {\n        name: extension.name,\n        options: extension.options,\n        storage: extension.storage,\n        editor,\n      }\n\n      const extraMarkFields = extensions.reduce((fields, e) => {\n        const extendMarkSchema = getExtensionField<AnyConfig['extendMarkSchema']>(e, 'extendMarkSchema', context)\n\n        return {\n          ...fields,\n          ...(extendMarkSchema ? extendMarkSchema(extension as any) : {}),\n        }\n      }, {})\n\n      const schema: MarkSpec = cleanUpSchemaItem({\n        ...extraMarkFields,\n        inclusive: callOrReturn(getExtensionField<MarkConfig['inclusive']>(extension, 'inclusive', context)),\n        excludes: callOrReturn(getExtensionField<MarkConfig['excludes']>(extension, 'excludes', context)),\n        group: callOrReturn(getExtensionField<MarkConfig['group']>(extension, 'group', context)),\n        spanning: callOrReturn(getExtensionField<MarkConfig['spanning']>(extension, 'spanning', context)),\n        code: callOrReturn(getExtensionField<MarkConfig['code']>(extension, 'code', context)),\n        attrs: Object.fromEntries(extensionAttributes.map(buildAttributeSpec)),\n      })\n\n      const parseHTML = callOrReturn(getExtensionField<MarkConfig['parseHTML']>(extension, 'parseHTML', context))\n\n      if (parseHTML) {\n        schema.parseDOM = parseHTML.map(parseRule =>\n          injectExtensionAttributesToParseRule(parseRule, extensionAttributes),\n        )\n      }\n\n      const renderHTML = getExtensionField<MarkConfig['renderHTML']>(extension, 'renderHTML', context)\n\n      if (renderHTML) {\n        schema.toDOM = mark =>\n          renderHTML({\n            mark,\n            HTMLAttributes: getRenderedAttributes(mark, extensionAttributes),\n          })\n      }\n\n      return [extension.name, schema]\n    }),\n  )\n\n  return new Schema({\n    topNode,\n    nodes,\n    marks,\n  })\n}\n","// eslint-disable-next-line @typescript-eslint/no-unsafe-function-type\nexport function isFunction(value: any): value is Function {\n  return typeof value === 'function'\n}\n","import type { MaybeReturnType } from '../types.js'\nimport { isFunction } from './isFunction.js'\n\n/**\n * Optionally calls `value` as a function.\n * Otherwise it is returned directly.\n * @param value Function or any value.\n * @param context Optional context to bind to function.\n * @param props Optional props to pass to function.\n */\nexport function callOrReturn<T>(value: T, context: any = undefined, ...props: any[]): MaybeReturnType<T> {\n  if (isFunction(value)) {\n    if (context) {\n      return value.bind(context)(...props)\n    }\n\n    return value(...props)\n  }\n\n  return value as MaybeReturnType<T>\n}\n","export function isEmptyObject(value = {}): boolean {\n  return Object.keys(value).length === 0 && value.constructor === Object\n}\n","import type { Extension } from '../Extension.js'\nimport type { Mark } from '../Mark.js'\nimport type { Node } from '../Node.js'\nimport type { Extensions } from '../types.js'\n\nexport function splitExtensions(extensions: Extensions) {\n  const baseExtensions = extensions.filter(extension => extension.type === 'extension') as Extension[]\n  const nodeExtensions = extensions.filter(extension => extension.type === 'node') as Node[]\n  const markExtensions = extensions.filter(extension => extension.type === 'mark') as Mark[]\n\n  return {\n    baseExtensions,\n    nodeExtensions,\n    markExtensions,\n  }\n}\n","import type { MarkConfig, NodeConfig } from '../index.js'\nimport type { AnyConfig, Attribute, Attributes, ExtensionAttribute, Extensions } from '../types.js'\nimport { getExtensionField } from './getExtensionField.js'\nimport { splitExtensions } from './splitExtensions.js'\n\n/**\n * Get a list of all extension attributes defined in `addAttribute` and `addGlobalAttribute`.\n * @param extensions List of extensions\n */\nexport function getAttributesFromExtensions(extensions: Extensions): ExtensionAttribute[] {\n  const extensionAttributes: ExtensionAttribute[] = []\n  const { nodeExtensions, markExtensions } = splitExtensions(extensions)\n  const nodeAndMarkExtensions = [...nodeExtensions, ...markExtensions]\n  const defaultAttribute: Required<Omit<Attribute, 'validate'>> & Pick<Attribute, 'validate'> = {\n    default: null,\n    validate: undefined,\n    rendered: true,\n    renderHTML: null,\n    parseHTML: null,\n    keepOnSplit: true,\n    isRequired: false,\n  }\n\n  extensions.forEach(extension => {\n    const context = {\n      name: extension.name,\n      options: extension.options,\n      storage: extension.storage,\n      extensions: nodeAndMarkExtensions,\n    }\n\n    const addGlobalAttributes = getExtensionField<AnyConfig['addGlobalAttributes']>(\n      extension,\n      'addGlobalAttributes',\n      context,\n    )\n\n    if (!addGlobalAttributes) {\n      return\n    }\n\n    const globalAttributes = addGlobalAttributes()\n\n    globalAttributes.forEach(globalAttribute => {\n      globalAttribute.types.forEach(type => {\n        Object.entries(globalAttribute.attributes).forEach(([name, attribute]) => {\n          extensionAttributes.push({\n            type,\n            name,\n            attribute: {\n              ...defaultAttribute,\n              ...attribute,\n            },\n          })\n        })\n      })\n    })\n  })\n\n  nodeAndMarkExtensions.forEach(extension => {\n    const context = {\n      name: extension.name,\n      options: extension.options,\n      storage: extension.storage,\n    }\n\n    const addAttributes = getExtensionField<NodeConfig['addAttributes'] | MarkConfig['addAttributes']>(\n      extension,\n      'addAttributes',\n      context,\n    )\n\n    if (!addAttributes) {\n      return\n    }\n\n    // TODO: remove `as Attributes`\n    const attributes = addAttributes() as Attributes\n\n    Object.entries(attributes).forEach(([name, attribute]) => {\n      const mergedAttr = {\n        ...defaultAttribute,\n        ...attribute,\n      }\n\n      if (typeof mergedAttr?.default === 'function') {\n        mergedAttr.default = mergedAttr.default()\n      }\n\n      if (mergedAttr?.isRequired && mergedAttr?.default === undefined) {\n        delete mergedAttr.default\n      }\n\n      extensionAttributes.push({\n        type: extension.name,\n        name,\n        attribute: mergedAttr,\n      })\n    })\n  })\n\n  return extensionAttributes\n}\n","export function mergeAttributes(...objects: Record<string, any>[]): Record<string, any> {\n  return objects\n    .filter(item => !!item)\n    .reduce((items, item) => {\n      const mergedAttributes = { ...items }\n\n      Object.entries(item).forEach(([key, value]) => {\n        const exists = mergedAttributes[key]\n\n        if (!exists) {\n          mergedAttributes[key] = value\n\n          return\n        }\n\n        if (key === 'class') {\n          const valueClasses: string[] = value ? String(value).split(' ') : []\n          const existingClasses: string[] = mergedAttributes[key] ? mergedAttributes[key].split(' ') : []\n\n          const insertClasses = valueClasses.filter(valueClass => !existingClasses.includes(valueClass))\n\n          mergedAttributes[key] = [...existingClasses, ...insertClasses].join(' ')\n        } else if (key === 'style') {\n          const newStyles: string[] = value\n            ? value\n                .split(';')\n                .map((style: string) => style.trim())\n                .filter(Boolean)\n            : []\n          const existingStyles: string[] = mergedAttributes[key]\n            ? mergedAttributes[key]\n                .split(';')\n                .map((style: string) => style.trim())\n                .filter(Boolean)\n            : []\n\n          const styleMap = new Map<string, string>()\n\n          existingStyles.forEach(style => {\n            const [property, val] = style.split(':').map(part => part.trim())\n\n            styleMap.set(property, val)\n          })\n\n          newStyles.forEach(style => {\n            const [property, val] = style.split(':').map(part => part.trim())\n\n            styleMap.set(property, val)\n          })\n\n          mergedAttributes[key] = Array.from(styleMap.entries())\n            .map(([property, val]) => `${property}: ${val}`)\n            .join('; ')\n        } else {\n          mergedAttributes[key] = value\n        }\n      })\n\n      return mergedAttributes\n    }, {})\n}\n","import type { Mark, Node } from '@tiptap/pm/model'\n\nimport type { ExtensionAttribute } from '../types.js'\nimport { mergeAttributes } from '../utilities/mergeAttributes.js'\n\nexport function getRenderedAttributes(\n  nodeOrMark: Node | Mark,\n  extensionAttributes: ExtensionAttribute[],\n): Record<string, any> {\n  return extensionAttributes\n    .filter(attribute => attribute.type === nodeOrMark.type.name)\n    .filter(item => item.attribute.rendered)\n    .map(item => {\n      if (!item.attribute.renderHTML) {\n        return {\n          [item.name]: nodeOrMark.attrs[item.name],\n        }\n      }\n\n      return item.attribute.renderHTML(nodeOrMark.attrs) || {}\n    })\n    .reduce((attributes, attribute) => mergeAttributes(attributes, attribute), {})\n}\n","export function fromString(value: any): any {\n  if (typeof value !== 'string') {\n    return value\n  }\n\n  if (value.match(/^[+-]?(?:\\d*\\.)?\\d+$/)) {\n    return Number(value)\n  }\n\n  if (value === 'true') {\n    return true\n  }\n\n  if (value === 'false') {\n    return false\n  }\n\n  return value\n}\n","import type { ParseRule } from '@tiptap/pm/model'\n\nimport type { ExtensionAttribute } from '../types.js'\nimport { fromString } from '../utilities/fromString.js'\n\n/**\n * This function merges extension attributes into parserule attributes (`attrs` or `getAttrs`).\n * Cancels when `getAttrs` returned `false`.\n * @param parseRule ProseMirror ParseRule\n * @param extensionAttributes List of attributes to inject\n */\nexport function injectExtensionAttributesToParseRule(\n  parseRule: ParseRule,\n  extensionAttributes: ExtensionAttribute[],\n): ParseRule {\n  if ('style' in parseRule) {\n    return parseRule\n  }\n\n  return {\n    ...parseRule,\n    getAttrs: (node: HTMLElement) => {\n      const oldAttributes = parseRule.getAttrs ? parseRule.getAttrs(node) : parseRule.attrs\n\n      if (oldAttributes === false) {\n        return false\n      }\n\n      const newAttributes = extensionAttributes.reduce((items, item) => {\n        const value = item.attribute.parseHTML\n          ? item.attribute.parseHTML(node)\n          : fromString(node.getAttribute(item.name))\n\n        if (value === null || value === undefined) {\n          return items\n        }\n\n        return {\n          ...items,\n          [item.name]: value,\n        }\n      }, {})\n\n      return { ...oldAttributes, ...newAttributes }\n    },\n  }\n}\n","/**\n * Find duplicates in an array.\n */\nexport function findDuplicates<T>(items: T[]): T[] {\n  const filtered = items.filter((el, index) => items.indexOf(el) !== index)\n\n  return Array.from(new Set(filtered))\n}\n","import type { AnyConfig, Extensions } from '../types.js'\nimport { getExtensionField } from './getExtensionField.js'\n\n/**\n * Sort extensions by priority.\n * @param extensions An array of Tiptap extensions\n * @returns A sorted array of Tiptap extensions by priority\n */\nexport function sortExtensions(extensions: Extensions): Extensions {\n  const defaultPriority = 100\n\n  return extensions.sort((a, b) => {\n    const priorityA = getExtensionField<AnyConfig['priority']>(a, 'priority') || defaultPriority\n    const priorityB = getExtensionField<AnyConfig['priority']>(b, 'priority') || defaultPriority\n\n    if (priorityA > priorityB) {\n      return -1\n    }\n\n    if (priorityA < priorityB) {\n      return 1\n    }\n\n    return 0\n  })\n}\n","import type { Extensions } from '../types.js'\nimport { findDuplicates } from '../utilities/findDuplicates.js'\nimport { flattenExtensions } from './flattenExtensions.js'\nimport { sortExtensions } from './sortExtensions.js'\n\n/**\n * Returns a flattened and sorted extension list while\n * also checking for duplicated extensions and warns the user.\n * @param extensions An array of Tiptap extensions\n * @returns An flattened and sorted array of Tiptap extensions\n */\nexport function resolveExtensions(extensions: Extensions): Extensions {\n  const resolvedExtensions = sortExtensions(flattenExtensions(extensions))\n  const duplicatedNames = findDuplicates(resolvedExtensions.map(extension => extension.name))\n\n  if (duplicatedNames.length) {\n    console.warn(\n      `[tiptap warn]: Duplicate extension names found: [${duplicatedNames\n        .map(item => `'${item}'`)\n        .join(', ')}]. This can lead to issues.`,\n    )\n  }\n\n  return resolvedExtensions\n}\n","import type { Schema } from '@tiptap/pm/model'\n\nimport type { Editor } from '../Editor.js'\nimport type { Extensions } from '../types.js'\nimport { getSchemaByResolvedExtensions } from './getSchemaByResolvedExtensions.js'\nimport { resolveExtensions } from './resolveExtensions.js'\n\nexport function getSchema(extensions: Extensions, editor?: Editor): Schema {\n  const resolvedExtensions = resolveExtensions(extensions)\n\n  return getSchemaByResolvedExtensions(resolvedExtensions, editor)\n}\n","import { DOMParser } from '@tiptap/pm/model'\n\nimport type { Extensions } from '../types.js'\nimport { elementFromString } from '../utilities/elementFromString.js'\nimport { getSchema } from './getSchema.js'\n\n/**\n * Generate JSONContent from HTML\n * @param html The HTML to generate JSONContent from\n * @param extensions The extensions to use for the schema\n * @returns The generated JSONContent\n */\nexport function generateJSON(html: string, extensions: Extensions): Record<string, any> {\n  const schema = getSchema(extensions)\n  const dom = elementFromString(html)\n\n  return DOMParser.fromSchema(schema).parse(dom).toJSON()\n}\n","import { Node } from '@tiptap/pm/model'\n\nimport type { Extensions, JSONContent, TextSerializer } from '../types.js'\nimport { getSchema } from './getSchema.js'\nimport { getText } from './getText.js'\nimport { getTextSerializersFromSchema } from './getTextSerializersFromSchema.js'\n\n/**\n * Generate raw text from a JSONContent\n * @param doc The JSONContent to generate text from\n * @param extensions The extensions to use for the schema\n * @param options Options for the text generation f.e. blockSeparator or textSerializers\n * @returns The generated text\n */\nexport function generateText(\n  doc: JSONContent,\n  extensions: Extensions,\n  options?: {\n    blockSeparator?: string\n    textSerializers?: Record<string, TextSerializer>\n  },\n): string {\n  const { blockSeparator = '\\n\\n', textSerializers = {} } = options || {}\n  const schema = getSchema(extensions)\n  const contentNode = Node.fromJSON(schema, doc)\n\n  return getText(contentNode, {\n    blockSeparator,\n    textSerializers: {\n      ...getTextSerializersFromSchema(schema),\n      ...textSerializers,\n    },\n  })\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\n\nimport type { Range, TextSerializer } from '../types.js'\n\n/**\n * Gets the text between two positions in a Prosemirror node\n * and serializes it using the given text serializers and block separator (see getText)\n * @param startNode The Prosemirror node to start from\n * @param range The range of the text to get\n * @param options Options for the text serializer & block separator\n * @returns The text between the two positions\n */\nexport function getTextBetween(\n  startNode: ProseMirrorNode,\n  range: Range,\n  options?: {\n    blockSeparator?: string\n    textSerializers?: Record<string, TextSerializer>\n  },\n): string {\n  const { from, to } = range\n  const { blockSeparator = '\\n\\n', textSerializers = {} } = options || {}\n  let text = ''\n\n  startNode.nodesBetween(from, to, (node, pos, parent, index) => {\n    if (node.isBlock && pos > from) {\n      text += blockSeparator\n    }\n\n    const textSerializer = textSerializers?.[node.type.name]\n\n    if (textSerializer) {\n      if (parent) {\n        text += textSerializer({\n          node,\n          pos,\n          parent,\n          index,\n          range,\n        })\n      }\n      // do not descend into child nodes when there exists a serializer\n      return false\n    }\n\n    if (node.isText) {\n      text += node?.text?.slice(Math.max(from, pos) - pos, to - pos) // eslint-disable-line\n    }\n  })\n\n  return text\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\n\nimport type { TextSerializer } from '../types.js'\nimport { getTextBetween } from './getTextBetween.js'\n\n/**\n * Gets the text of a Prosemirror node\n * @param node The Prosemirror node\n * @param options Options for the text serializer & block separator\n * @returns The text of the node\n * @example ```js\n * const text = getText(node, { blockSeparator: '\\n' })\n * ```\n */\nexport function getText(\n  node: ProseMirrorNode,\n  options?: {\n    blockSeparator?: string\n    textSerializers?: Record<string, TextSerializer>\n  },\n) {\n  const range = {\n    from: 0,\n    to: node.content.size,\n  }\n\n  return getTextBetween(node, range, options)\n}\n","import type { Schema } from '@tiptap/pm/model'\n\nimport type { TextSerializer } from '../types.js'\n\n/**\n * Find text serializers `toText` in a Prosemirror schema\n * @param schema The Prosemirror schema to search in\n * @returns A record of text serializers by node name\n */\nexport function getTextSerializersFromSchema(schema: Schema): Record<string, TextSerializer> {\n  return Object.fromEntries(\n    Object.entries(schema.nodes)\n      .filter(([, node]) => node.spec.toText)\n      .map(([name, node]) => [name, node.spec.toText]),\n  )\n}\n","import type { Node, NodeType } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\n\nimport { getNodeType } from './getNodeType.js'\n\nexport function getNodeAttributes(state: EditorState, typeOrName: string | NodeType): Record<string, any> {\n  const type = getNodeType(typeOrName, state.schema)\n  const { from, to } = state.selection\n  const nodes: Node[] = []\n\n  state.doc.nodesBetween(from, to, node => {\n    nodes.push(node)\n  })\n\n  const node = nodes.reverse().find(nodeItem => nodeItem.type.name === type.name)\n\n  if (!node) {\n    return {}\n  }\n\n  return { ...node.attrs }\n}\n","import type { MarkType, NodeType } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\n\nimport { getMarkAttributes } from './getMarkAttributes.js'\nimport { getNodeAttributes } from './getNodeAttributes.js'\nimport { getSchemaTypeNameByName } from './getSchemaTypeNameByName.js'\n\n/**\n * Get node or mark attributes by type or name on the current editor state\n * @param state The current editor state\n * @param typeOrName The node or mark type or name\n * @returns The attributes of the node or mark or an empty object\n */\nexport function getAttributes(state: EditorState, typeOrName: string | NodeType | MarkType): Record<string, any> {\n  const schemaType = getSchemaTypeNameByName(\n    typeof typeOrName === 'string' ? typeOrName : typeOrName.name,\n    state.schema,\n  )\n\n  if (schemaType === 'node') {\n    return getNodeAttributes(state, typeOrName as NodeType)\n  }\n\n  if (schemaType === 'mark') {\n    return getMarkAttributes(state, typeOrName as MarkType)\n  }\n\n  return {}\n}\n","/**\n * Removes duplicated values within an array.\n * Supports numbers, strings and objects.\n */\nexport function removeDuplicates<T>(array: T[], by = JSON.stringify): T[] {\n  const seen: Record<any, any> = {}\n\n  return array.filter(item => {\n    const key = by(item)\n\n    return Object.prototype.hasOwnProperty.call(seen, key) ? false : (seen[key] = true)\n  })\n}\n","import type { Step, Transform } from '@tiptap/pm/transform'\n\nimport type { Range } from '../types.js'\nimport { removeDuplicates } from '../utilities/removeDuplicates.js'\n\nexport type ChangedRange = {\n  oldRange: Range\n  newRange: Range\n}\n\n/**\n * Removes duplicated ranges and ranges that are\n * fully captured by other ranges.\n */\nfunction simplifyChangedRanges(changes: ChangedRange[]): ChangedRange[] {\n  const uniqueChanges = removeDuplicates(changes)\n\n  return uniqueChanges.length === 1\n    ? uniqueChanges\n    : uniqueChanges.filter((change, index) => {\n        const rest = uniqueChanges.filter((_, i) => i !== index)\n\n        return !rest.some(otherChange => {\n          return (\n            change.oldRange.from >= otherChange.oldRange.from &&\n            change.oldRange.to <= otherChange.oldRange.to &&\n            change.newRange.from >= otherChange.newRange.from &&\n            change.newRange.to <= otherChange.newRange.to\n          )\n        })\n      })\n}\n\n/**\n * Returns a list of changed ranges\n * based on the first and last state of all steps.\n */\nexport function getChangedRanges(transform: Transform): ChangedRange[] {\n  const { mapping, steps } = transform\n  const changes: ChangedRange[] = []\n\n  mapping.maps.forEach((stepMap, index) => {\n    const ranges: Range[] = []\n\n    // This accounts for step changes where no range was actually altered\n    // e.g. when setting a mark, node attribute, etc.\n    // @ts-ignore\n    if (!stepMap.ranges.length) {\n      const { from, to } = steps[index] as Step & {\n        from?: number\n        to?: number\n      }\n\n      if (from === undefined || to === undefined) {\n        return\n      }\n\n      ranges.push({ from, to })\n    } else {\n      stepMap.forEach((from, to) => {\n        ranges.push({ from, to })\n      })\n    }\n\n    ranges.forEach(({ from, to }) => {\n      const newStart = mapping.slice(index).map(from, -1)\n      const newEnd = mapping.slice(index).map(to)\n      const oldStart = mapping.invert().map(newStart, -1)\n      const oldEnd = mapping.invert().map(newEnd)\n\n      changes.push({\n        oldRange: {\n          from: oldStart,\n          to: oldEnd,\n        },\n        newRange: {\n          from: newStart,\n          to: newEnd,\n        },\n      })\n    })\n  })\n\n  return simplifyChangedRanges(changes)\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\n\nimport type { JSONContent } from '../types.js'\n\ninterface DebugJSONContent extends JSONContent {\n  from: number\n  to: number\n}\n\nexport function getDebugJSON(node: ProseMirrorNode, startOffset = 0): DebugJSONContent {\n  const isTopNode = node.type === node.type.schema.topNodeType\n  const increment = isTopNode ? 0 : 1\n  const from = startOffset\n  const to = from + node.nodeSize\n  const marks = node.marks.map(mark => {\n    const output: { type: string; attrs?: Record<string, any> } = {\n      type: mark.type.name,\n    }\n\n    if (Object.keys(mark.attrs).length) {\n      output.attrs = { ...mark.attrs }\n    }\n\n    return output\n  })\n  const attrs = { ...node.attrs }\n  const output: DebugJSONContent = {\n    type: node.type.name,\n    from,\n    to,\n  }\n\n  if (Object.keys(attrs).length) {\n    output.attrs = attrs\n  }\n\n  if (marks.length) {\n    output.marks = marks\n  }\n\n  if (node.content.childCount) {\n    output.content = []\n\n    node.forEach((child, offset) => {\n      output.content?.push(getDebugJSON(child, startOffset + offset + increment))\n    })\n  }\n\n  if (node.text) {\n    output.text = node.text\n  }\n\n  return output\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\n\nimport type { MarkRange } from '../types.js'\nimport { getMarkRange } from './getMarkRange.js'\n\nexport function getMarksBetween(from: number, to: number, doc: ProseMirrorNode): MarkRange[] {\n  const marks: MarkRange[] = []\n\n  // get all inclusive marks on empty selection\n  if (from === to) {\n    doc\n      .resolve(from)\n      .marks()\n      .forEach(mark => {\n        const $pos = doc.resolve(from)\n        const range = getMarkRange($pos, mark.type)\n\n        if (!range) {\n          return\n        }\n\n        marks.push({\n          mark,\n          ...range,\n        })\n      })\n  } else {\n    doc.nodesBetween(from, to, (node, pos) => {\n      if (!node || node?.nodeSize === undefined) {\n        return\n      }\n\n      marks.push(\n        ...node.marks.map(mark => ({\n          from: pos,\n          to: pos + node.nodeSize,\n          mark,\n        })),\n      )\n    })\n  }\n\n  return marks\n}\n","import type { Node, NodeType } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\n\n/**\n * Finds the first node of a given type or name in the current selection.\n * @param state The editor state.\n * @param typeOrName The node type or name.\n * @param pos The position to start searching from.\n * @param maxDepth The maximum depth to search.\n * @returns The node and the depth as an array.\n */\nexport const getNodeAtPosition = (state: EditorState, typeOrName: string | NodeType, pos: number, maxDepth = 20) => {\n  const $pos = state.doc.resolve(pos)\n\n  let currentDepth = maxDepth\n  let node: Node | null = null\n\n  while (currentDepth > 0 && node === null) {\n    const currentNode = $pos.node(currentDepth)\n\n    if (currentNode?.type.name === typeOrName) {\n      node = currentNode\n    } else {\n      currentDepth -= 1\n    }\n  }\n\n  return [node, currentDepth] as [Node | null, number]\n}\n","import type { MarkType, NodeType, Schema } from '@tiptap/pm/model'\n\n/**\n * Tries to get a node or mark type by its name.\n * @param name The name of the node or mark type\n * @param schema The Prosemiror schema to search in\n * @returns The node or mark type, or null if it doesn't exist\n */\nexport function getSchemaTypeByName(name: string, schema: Schema): NodeType | MarkType | null {\n  return schema.nodes[name] || schema.marks[name] || null\n}\n","import type { ExtensionAttribute } from '../types.js'\n\n/**\n * Return attributes of an extension that should be splitted by keepOnSplit flag\n * @param extensionAttributes Array of extension attributes\n * @param typeName The type of the extension\n * @param attributes The attributes of the extension\n * @returns The splitted attributes\n */\nexport function getSplittedAttributes(\n  extensionAttributes: ExtensionAttribute[],\n  typeName: string,\n  attributes: Record<string, any>,\n): Record<string, any> {\n  return Object.fromEntries(\n    Object.entries(attributes).filter(([name]) => {\n      const extensionAttribute = extensionAttributes.find(item => {\n        return item.type === typeName && item.name === name\n      })\n\n      if (!extensionAttribute) {\n        return false\n      }\n\n      return extensionAttribute.attribute.keepOnSplit\n    }),\n  )\n}\n","import type { ResolvedPos } from '@tiptap/pm/model'\n\n/**\n * Returns the text content of a resolved prosemirror position\n * @param $from The resolved position to get the text content from\n * @param maxMatch The maximum number of characters to match\n * @returns The text content\n */\nexport const getTextContentFromNodes = ($from: ResolvedPos, maxMatch = 500) => {\n  let textBefore = ''\n\n  const sliceEndPos = $from.parentOffset\n\n  $from.parent.nodesBetween(Math.max(0, sliceEndPos - maxMatch), sliceEndPos, (node, pos, parent, index) => {\n    const chunk =\n      node.type.spec.toText?.({\n        node,\n        pos,\n        parent,\n        index,\n      }) ||\n      node.textContent ||\n      '%leaf%'\n\n    textBefore += node.isAtom && !node.isText ? chunk : chunk.slice(0, Math.max(0, sliceEndPos - pos))\n  })\n\n  return textBefore\n}\n","import type { MarkType } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\n\nimport type { MarkRange } from '../types.js'\nimport { objectIncludes } from '../utilities/objectIncludes.js'\nimport { getMarkType } from './getMarkType.js'\n\nexport function isMarkActive(\n  state: EditorState,\n  typeOrName: MarkType | string | null,\n  attributes: Record<string, any> = {},\n): boolean {\n  const { empty, ranges } = state.selection\n  const type = typeOrName ? getMarkType(typeOrName, state.schema) : null\n\n  if (empty) {\n    return !!(state.storedMarks || state.selection.$from.marks())\n      .filter(mark => {\n        if (!type) {\n          return true\n        }\n\n        return type.name === mark.type.name\n      })\n      .find(mark => objectIncludes(mark.attrs, attributes, { strict: false }))\n  }\n\n  let selectionRange = 0\n  const markRanges: MarkRange[] = []\n\n  ranges.forEach(({ $from, $to }) => {\n    const from = $from.pos\n    const to = $to.pos\n\n    state.doc.nodesBetween(from, to, (node, pos) => {\n      if (!node.isText && !node.marks.length) {\n        return\n      }\n\n      const relativeFrom = Math.max(from, pos)\n      const relativeTo = Math.min(to, pos + node.nodeSize)\n      const range = relativeTo - relativeFrom\n\n      selectionRange += range\n\n      markRanges.push(\n        ...node.marks.map(mark => ({\n          mark,\n          from: relativeFrom,\n          to: relativeTo,\n        })),\n      )\n    })\n  })\n\n  if (selectionRange === 0) {\n    return false\n  }\n\n  // calculate range of matched mark\n  const matchedRange = markRanges\n    .filter(markRange => {\n      if (!type) {\n        return true\n      }\n\n      return type.name === markRange.mark.type.name\n    })\n    .filter(markRange => objectIncludes(markRange.mark.attrs, attributes, { strict: false }))\n    .reduce((sum, markRange) => sum + markRange.to - markRange.from, 0)\n\n  // calculate range of marks that excludes the searched mark\n  // for example `code` doesnt allow any other marks\n  const excludedRange = markRanges\n    .filter(markRange => {\n      if (!type) {\n        return true\n      }\n\n      return markRange.mark.type !== type && markRange.mark.type.excludes(type)\n    })\n    .reduce((sum, markRange) => sum + markRange.to - markRange.from, 0)\n\n  // we only include the result of `excludedRange`\n  // if there is a match at all\n  const range = matchedRange > 0 ? matchedRange + excludedRange : matchedRange\n\n  return range >= selectionRange\n}\n","import type { EditorState } from '@tiptap/pm/state'\n\nimport { getSchemaTypeNameByName } from './getSchemaTypeNameByName.js'\nimport { isMarkActive } from './isMarkActive.js'\nimport { isNodeActive } from './isNodeActive.js'\n\nexport function isActive(state: EditorState, name: string | null, attributes: Record<string, any> = {}): boolean {\n  if (!name) {\n    return isNodeActive(state, null, attributes) || isMarkActive(state, null, attributes)\n  }\n\n  const schemaType = getSchemaTypeNameByName(name, state.schema)\n\n  if (schemaType === 'node') {\n    return isNodeActive(state, name, attributes)\n  }\n\n  if (schemaType === 'mark') {\n    return isMarkActive(state, name, attributes)\n  }\n\n  return false\n}\n","import type { EditorState } from '@tiptap/pm/state'\n\nimport { findParentNode } from './findParentNode.js'\n\nexport const isAtEndOfNode = (state: EditorState, nodeType?: string) => {\n  const { $from, $to, $anchor } = state.selection\n\n  if (nodeType) {\n    const parentNode = findParentNode(node => node.type.name === nodeType)(state.selection)\n\n    if (!parentNode) {\n      return false\n    }\n\n    const $parentPos = state.doc.resolve(parentNode.pos + 1)\n\n    if ($anchor.pos + 1 === $parentPos.end()) {\n      return true\n    }\n\n    return false\n  }\n\n  if ($to.parentOffset < $to.parent.nodeSize - 2 || $from.pos !== $to.pos) {\n    return false\n  }\n\n  return true\n}\n","import type { EditorState } from '@tiptap/pm/state'\n\nexport const isAtStartOfNode = (state: EditorState) => {\n  const { $from, $to } = state.selection\n\n  if ($from.parentOffset > 0 || $from.pos !== $to.pos) {\n    return false\n  }\n\n  return true\n}\n","import type { AnyExtension, EnableRules } from '../types.js'\n\nexport function isExtensionRulesEnabled(extension: AnyExtension, enabled: EnableRules): boolean {\n  if (Array.isArray(enabled)) {\n    return enabled.some(enabledExtension => {\n      const name = typeof enabledExtension === 'string' ? enabledExtension : enabledExtension.name\n\n      return name === extension.name\n    })\n  }\n\n  return enabled\n}\n","import { getExtensionField } from '../helpers/getExtensionField.js'\nimport type { NodeConfig } from '../index.js'\nimport type { Extensions } from '../types.js'\nimport { callOrReturn } from '../utilities/callOrReturn.js'\nimport { splitExtensions } from './splitExtensions.js'\n\nexport function isList(name: string, extensions: Extensions): boolean {\n  const { nodeExtensions } = splitExtensions(extensions)\n  const extension = nodeExtensions.find(item => item.name === name)\n\n  if (!extension) {\n    return false\n  }\n\n  const context = {\n    name: extension.name,\n    options: extension.options,\n    storage: extension.storage,\n  }\n  const group = callOrReturn(getExtensionField<NodeConfig['group']>(extension, 'group', context))\n\n  if (typeof group !== 'string') {\n    return false\n  }\n\n  return group.split(' ').includes('list')\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\n\n/**\n * Returns true if the given prosemirror node is empty.\n */\nexport function isNodeEmpty(\n  node: ProseMirrorNode,\n  {\n    checkChildren = true,\n    ignoreWhitespace = false,\n  }: {\n    /**\n     * When true (default), it will also check if all children are empty.\n     */\n    checkChildren?: boolean\n    /**\n     * When true, it will ignore whitespace when checking for emptiness.\n     */\n    ignoreWhitespace?: boolean\n  } = {},\n): boolean {\n  if (ignoreWhitespace) {\n    if (node.type.name === 'hardBreak') {\n      // Hard breaks are considered empty\n      return true\n    }\n    if (node.isText) {\n      return /^\\s*$/m.test(node.text ?? '')\n    }\n  }\n\n  if (node.isText) {\n    return !node.text\n  }\n\n  if (node.isAtom || node.isLeaf) {\n    return false\n  }\n\n  if (node.content.childCount === 0) {\n    return true\n  }\n\n  if (checkChildren) {\n    let isContentEmpty = true\n\n    node.content.forEach(childNode => {\n      if (isContentEmpty === false) {\n        // Exit early for perf\n        return\n      }\n\n      if (!isNodeEmpty(childNode, { ignoreWhitespace, checkChildren })) {\n        isContentEmpty = false\n      }\n    })\n\n    return isContentEmpty\n  }\n\n  return false\n}\n","import { NodeSelection } from '@tiptap/pm/state'\n\nexport function isNodeSelection(value: unknown): value is NodeSelection {\n  return value instanceof NodeSelection\n}\n","import type { Transaction } from '@tiptap/pm/state'\nimport type { MapResult } from '@tiptap/pm/transform'\n\n/**\n * A class that represents a mappable position in the editor. It can be extended\n * by other extensions to add additional position mapping capabilities.\n */\nexport class MappablePosition {\n  /**\n   * The absolute position in the editor.\n   */\n  public position: number\n\n  constructor(position: number) {\n    this.position = position\n  }\n\n  /**\n   * Creates a MappablePosition from a JSON object.\n   */\n  static fromJSON(json: any): MappablePosition {\n    return new MappablePosition(json.position)\n  }\n\n  /**\n   * Converts the MappablePosition to a JSON object.\n   */\n  toJSON(): any {\n    return {\n      position: this.position,\n    }\n  }\n}\n\n/**\n * The result of the getUpdatedPosition function.\n */\nexport interface GetUpdatedPositionResult {\n  position: MappablePosition\n  mapResult: MapResult | null\n}\n\n/**\n * Calculates the new position after applying a transaction.\n *\n * @returns The new mappable position and the map result.\n */\nexport function getUpdatedPosition(position: MappablePosition, transaction: Transaction): GetUpdatedPositionResult {\n  const mapResult = transaction.mapping.mapResult(position.position)\n  return {\n    position: new MappablePosition(mapResult.pos),\n    mapResult,\n  }\n}\n\n/**\n * Creates a MappablePosition from a position number. This is the default\n * implementation for Tiptap core. It can be overridden by other Tiptap\n * extensions.\n *\n * @param position The position (as a number) where the MappablePosition will be created.\n * @returns A new MappablePosition instance at the given position.\n */\nexport function createMappablePosition(position: number): MappablePosition {\n  return new MappablePosition(position)\n}\n","import type { EditorView } from '@tiptap/pm/view'\n\nimport { minMax } from '../utilities/minMax.js'\n\nexport function posToDOMRect(view: EditorView, from: number, to: number): DOMRect {\n  const minPos = 0\n  const maxPos = view.state.doc.content.size\n  const resolvedFrom = minMax(from, minPos, maxPos)\n  const resolvedEnd = minMax(to, minPos, maxPos)\n  const start = view.coordsAtPos(resolvedFrom)\n  const end = view.coordsAtPos(resolvedEnd, -1)\n  const top = Math.min(start.top, end.top)\n  const bottom = Math.max(start.bottom, end.bottom)\n  const left = Math.min(start.left, end.left)\n  const right = Math.max(start.right, end.right)\n  const width = right - left\n  const height = bottom - top\n  const x = left\n  const y = top\n  const data = {\n    top,\n    bottom,\n    left,\n    right,\n    width,\n    height,\n    x,\n    y,\n  }\n\n  return {\n    ...data,\n    toJSON: () => data,\n  }\n}\n","import type { Schema } from '@tiptap/pm/model'\n\nimport type { JSONContent } from '../types.js'\n\ntype RewriteUnknownContentOptions = {\n  /**\n   * If true, unknown nodes will be treated as paragraphs\n   * @default true\n   */\n  fallbackToParagraph?: boolean\n}\n\ntype RewrittenContent = {\n  /**\n   * The original JSON content that was rewritten\n   */\n  original: JSONContent\n  /**\n   * The name of the node or mark that was unsupported\n   */\n  unsupported: string\n}[]\n\n/**\n * The actual implementation of the rewriteUnknownContent function\n */\nfunction rewriteUnknownContentInner({\n  json,\n  validMarks,\n  validNodes,\n  options,\n  rewrittenContent = [],\n}: {\n  json: JSONContent\n  validMarks: Set<string>\n  validNodes: Set<string>\n  options?: RewriteUnknownContentOptions\n  rewrittenContent?: RewrittenContent\n}): {\n  /**\n   * The cleaned JSON content\n   */\n  json: JSONContent | null\n  /**\n   * The array of nodes and marks that were rewritten\n   */\n  rewrittenContent: RewrittenContent\n} {\n  if (json.marks && Array.isArray(json.marks)) {\n    json.marks = json.marks.filter(mark => {\n      const name = typeof mark === 'string' ? mark : mark.type\n\n      if (validMarks.has(name)) {\n        return true\n      }\n\n      rewrittenContent.push({\n        original: JSON.parse(JSON.stringify(mark)),\n        unsupported: name,\n      })\n      // Just ignore any unknown marks\n      return false\n    })\n  }\n\n  if (json.content && Array.isArray(json.content)) {\n    json.content = json.content\n      .map(\n        value =>\n          rewriteUnknownContentInner({\n            json: value,\n            validMarks,\n            validNodes,\n            options,\n            rewrittenContent,\n          }).json,\n      )\n      .filter(a => a !== null && a !== undefined)\n  }\n\n  if (json.type && !validNodes.has(json.type)) {\n    rewrittenContent.push({\n      original: JSON.parse(JSON.stringify(json)),\n      unsupported: json.type,\n    })\n\n    if (json.content && Array.isArray(json.content) && options?.fallbackToParagraph !== false) {\n      // Just treat it like a paragraph and hope for the best\n      json.type = 'paragraph'\n\n      return {\n        json,\n        rewrittenContent,\n      }\n    }\n\n    // or just omit it entirely\n    return {\n      json: null,\n      rewrittenContent,\n    }\n  }\n\n  return { json, rewrittenContent }\n}\n\n/**\n * Rewrite unknown nodes and marks within JSON content\n * Allowing for user within the editor\n */\nexport function rewriteUnknownContent(\n  /**\n   * The JSON content to clean of unknown nodes and marks\n   */\n  json: JSONContent,\n  /**\n   * The schema to use for validation\n   */\n  schema: Schema,\n  /**\n   * Options for the cleaning process\n   */\n  options?: RewriteUnknownContentOptions,\n): {\n  /**\n   * The cleaned JSON content\n   */\n  json: JSONContent | null\n  /**\n   * The array of nodes and marks that were rewritten\n   */\n  rewrittenContent: {\n    /**\n     * The original JSON content that was rewritten\n     */\n    original: JSONContent\n    /**\n     * The name of the node or mark that was unsupported\n     */\n    unsupported: string\n  }[]\n} {\n  return rewriteUnknownContentInner({\n    json,\n    validNodes: new Set(Object.keys(schema.nodes)),\n    validMarks: new Set(Object.keys(schema.marks)),\n    options,\n  })\n}\n","import type { MarkType, ResolvedPos } from '@tiptap/pm/model'\nimport type { EditorState, Transaction } from '@tiptap/pm/state'\n\nimport { getMarkAttributes } from '../helpers/getMarkAttributes.js'\nimport { getMarkType } from '../helpers/getMarkType.js'\nimport { isTextSelection } from '../helpers/index.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    setMark: {\n      /**\n       * Add a mark with new attributes.\n       * @param typeOrName The mark type or name.\n       * @example editor.commands.setMark('bold', { level: 1 })\n       */\n      setMark: (typeOrName: string | MarkType, attributes?: Record<string, any>) => ReturnType\n    }\n  }\n}\n\nfunction canSetMark(state: EditorState, tr: Transaction, newMarkType: MarkType) {\n  const { selection } = tr\n  let cursor: ResolvedPos | null = null\n\n  if (isTextSelection(selection)) {\n    cursor = selection.$cursor\n  }\n\n  if (cursor) {\n    const currentMarks = state.storedMarks ?? cursor.marks()\n    const parentAllowsMarkType = cursor.parent.type.allowsMarkType(newMarkType)\n\n    // There can be no current marks that exclude the new mark, and the parent must allow this mark type\n    return (\n      parentAllowsMarkType &&\n      (!!newMarkType.isInSet(currentMarks) || !currentMarks.some(mark => mark.type.excludes(newMarkType)))\n    )\n  }\n\n  const { ranges } = selection\n\n  return ranges.some(({ $from, $to }) => {\n    let someNodeSupportsMark =\n      $from.depth === 0 ? state.doc.inlineContent && state.doc.type.allowsMarkType(newMarkType) : false\n\n    state.doc.nodesBetween($from.pos, $to.pos, (node, _pos, parent) => {\n      // If we already found a mark that we can enable, return false to bypass the remaining search\n      if (someNodeSupportsMark) {\n        return false\n      }\n\n      if (node.isInline) {\n        const parentAllowsMarkType = !parent || parent.type.allowsMarkType(newMarkType)\n        const currentMarksAllowMarkType =\n          !!newMarkType.isInSet(node.marks) || !node.marks.some(otherMark => otherMark.type.excludes(newMarkType))\n\n        someNodeSupportsMark = parentAllowsMarkType && currentMarksAllowMarkType\n      }\n      return !someNodeSupportsMark\n    })\n\n    return someNodeSupportsMark\n  })\n}\nexport const setMark: RawCommands['setMark'] =\n  (typeOrName, attributes = {}) =>\n  ({ tr, state, dispatch }) => {\n    const { selection } = tr\n    const { empty, ranges } = selection\n    const type = getMarkType(typeOrName, state.schema)\n\n    if (dispatch) {\n      if (empty) {\n        const oldAttributes = getMarkAttributes(state, type)\n\n        tr.addStoredMark(\n          type.create({\n            ...oldAttributes,\n            ...attributes,\n          }),\n        )\n      } else {\n        ranges.forEach(range => {\n          const from = range.$from.pos\n          const to = range.$to.pos\n\n          state.doc.nodesBetween(from, to, (node, pos) => {\n            const trimmedFrom = Math.max(pos, from)\n            const trimmedTo = Math.min(pos + node.nodeSize, to)\n            const someHasMark = node.marks.find(mark => mark.type === type)\n\n            // if there is already a mark of this type\n            // we know that we have to merge its attributes\n            // otherwise we add a fresh new mark\n            if (someHasMark) {\n              node.marks.forEach(mark => {\n                if (type === mark.type) {\n                  tr.addMark(\n                    trimmedFrom,\n                    trimmedTo,\n                    type.create({\n                      ...mark.attrs,\n                      ...attributes,\n                    }),\n                  )\n                }\n              })\n            } else {\n              tr.addMark(trimmedFrom, trimmedTo, type.create(attributes))\n            }\n          })\n        })\n      }\n    }\n\n    return canSetMark(state, tr, type)\n  }\n","import type { Plugin, PluginKey } from '@tiptap/pm/state'\n\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    setMeta: {\n      /**\n       * Store a metadata property in the current transaction.\n       * @param key The key of the metadata property.\n       * @param value The value to store.\n       * @example editor.commands.setMeta('foo', 'bar')\n       */\n      setMeta: (key: string | Plugin | PluginKey, value: any) => ReturnType\n    }\n  }\n}\n\nexport const setMeta: RawCommands['setMeta'] =\n  (key, value) =>\n  ({ tr }) => {\n    tr.setMeta(key, value)\n\n    return true\n  }\n","import { setBlockType } from '@tiptap/pm/commands'\nimport type { NodeType } from '@tiptap/pm/model'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    setNode: {\n      /**\n       * Replace a given range with a node.\n       * @param typeOrName The type or name of the node\n       * @param attributes The attributes of the node\n       * @example editor.commands.setNode('paragraph')\n       */\n      setNode: (typeOrName: string | NodeType, attributes?: Record<string, any>) => ReturnType\n    }\n  }\n}\n\nexport const setNode: RawCommands['setNode'] =\n  (typeOrName, attributes = {}) =>\n  ({ state, dispatch, chain }) => {\n    const type = getNodeType(typeOrName, state.schema)\n\n    let attributesToCopy: Record<string, any> | undefined\n\n    if (state.selection.$anchor.sameParent(state.selection.$head)) {\n      // only copy attributes if the selection is pointing to a node of the same type\n      attributesToCopy = state.selection.$anchor.parent.attrs\n    }\n\n    // TODO: use a fallback like insertContent?\n    if (!type.isTextblock) {\n      console.warn('[tiptap warn]: Currently \"setNode()\" only supports text block nodes.')\n\n      return false\n    }\n\n    return (\n      chain()\n        // try to convert node to default node if needed\n        .command(({ commands }) => {\n          const canSetBlock = setBlockType(type, { ...attributesToCopy, ...attributes })(state)\n\n          if (canSetBlock) {\n            return true\n          }\n\n          return commands.clearNodes()\n        })\n        .command(({ state: updatedState }) => {\n          return setBlockType(type, { ...attributesToCopy, ...attributes })(updatedState, dispatch)\n        })\n        .run()\n    )\n  }\n","import { NodeSelection } from '@tiptap/pm/state'\n\nimport type { RawCommands } from '../types.js'\nimport { minMax } from '../utilities/minMax.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    setNodeSelection: {\n      /**\n       * Creates a NodeSelection.\n       * @param position - Position of the node.\n       * @example editor.commands.setNodeSelection(10)\n       */\n      setNodeSelection: (position: number) => ReturnType\n    }\n  }\n}\n\nexport const setNodeSelection: RawCommands['setNodeSelection'] =\n  position =>\n  ({ tr, dispatch }) => {\n    if (dispatch) {\n      const { doc } = tr\n      const from = minMax(position, 0, doc.content.size)\n      const selection = NodeSelection.create(doc, from)\n\n      tr.setSelection(selection)\n    }\n\n    return true\n  }\n","import type { Range, RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    setTextDirection: {\n      /**\n       * Set the text direction for nodes.\n       * If no position is provided, it will use the current selection.\n       * @param direction The text direction to set ('ltr', 'rtl', or 'auto')\n       * @param position Optional position or range to apply the direction to\n       * @example editor.commands.setTextDirection('rtl')\n       * @example editor.commands.setTextDirection('ltr', { from: 0, to: 10 })\n       */\n      setTextDirection: (direction: 'ltr' | 'rtl' | 'auto', position?: number | Range) => ReturnType\n    }\n  }\n}\n\nexport const setTextDirection: RawCommands['setTextDirection'] =\n  (direction, position) =>\n  ({ tr, state, dispatch }) => {\n    const { selection } = state\n    let from: number\n    let to: number\n\n    if (typeof position === 'number') {\n      from = position\n      to = position\n    } else if (position && 'from' in position && 'to' in position) {\n      from = position.from\n      to = position.to\n    } else {\n      from = selection.from\n      to = selection.to\n    }\n\n    if (dispatch) {\n      tr.doc.nodesBetween(from, to, (node, pos) => {\n        if (node.isText) {\n          return\n        }\n\n        tr.setNodeMarkup(pos, undefined, {\n          ...node.attrs,\n          dir: direction,\n        })\n      })\n    }\n\n    return true\n  }\n","import { TextSelection } from '@tiptap/pm/state'\n\nimport type { Range, RawCommands } from '../types.js'\nimport { minMax } from '../utilities/minMax.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    setTextSelection: {\n      /**\n       * Creates a TextSelection.\n       * @param position The position of the selection.\n       * @example editor.commands.setTextSelection(10)\n       */\n      setTextSelection: (position: number | Range) => ReturnType\n    }\n  }\n}\n\nexport const setTextSelection: RawCommands['setTextSelection'] =\n  position =>\n  ({ tr, dispatch }) => {\n    if (dispatch) {\n      const { doc } = tr\n      const { from, to } = typeof position === 'number' ? { from: position, to: position } : position\n      const minPos = TextSelection.atStart(doc).from\n      const maxPos = TextSelection.atEnd(doc).to\n      const resolvedFrom = minMax(from, minPos, maxPos)\n      const resolvedEnd = minMax(to, minPos, maxPos)\n      const selection = TextSelection.create(doc, resolvedFrom, resolvedEnd)\n\n      tr.setSelection(selection)\n    }\n\n    return true\n  }\n","import type { NodeType } from '@tiptap/pm/model'\nimport { sinkListItem as originalSinkListItem } from '@tiptap/pm/schema-list'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    sinkListItem: {\n      /**\n       * Sink the list item down into an inner list.\n       * @param typeOrName The type or name of the node.\n       * @example editor.commands.sinkListItem('listItem')\n       */\n      sinkListItem: (typeOrName: string | NodeType) => ReturnType\n    }\n  }\n}\n\nexport const sinkListItem: RawCommands['sinkListItem'] =\n  typeOrName =>\n  ({ state, dispatch }) => {\n    const type = getNodeType(typeOrName, state.schema)\n\n    return originalSinkListItem(type)(state, dispatch)\n  }\n","import type { EditorState } from '@tiptap/pm/state'\nimport { NodeSelection, TextSelection } from '@tiptap/pm/state'\nimport { canSplit } from '@tiptap/pm/transform'\n\nimport { defaultBlockAt } from '../helpers/defaultBlockAt.js'\nimport { getSplittedAttributes } from '../helpers/getSplittedAttributes.js'\nimport type { RawCommands } from '../types.js'\n\nfunction ensureMarks(state: EditorState, splittableMarks?: string[]) {\n  const marks = state.storedMarks || (state.selection.$to.parentOffset && state.selection.$from.marks())\n\n  if (marks) {\n    const filteredMarks = marks.filter(mark => splittableMarks?.includes(mark.type.name))\n\n    state.tr.ensureMarks(filteredMarks)\n  }\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    splitBlock: {\n      /**\n       * Forks a new node from an existing node.\n       * @param options.keepMarks Keep marks from the previous node.\n       * @example editor.commands.splitBlock()\n       * @example editor.commands.splitBlock({ keepMarks: true })\n       */\n      splitBlock: (options?: { keepMarks?: boolean }) => ReturnType\n    }\n  }\n}\n\nexport const splitBlock: RawCommands['splitBlock'] =\n  ({ keepMarks = true } = {}) =>\n  ({ tr, state, dispatch, editor }) => {\n    const { selection, doc } = tr\n    const { $from, $to } = selection\n    const extensionAttributes = editor.extensionManager.attributes\n    const newAttributes = getSplittedAttributes(extensionAttributes, $from.node().type.name, $from.node().attrs)\n\n    if (selection instanceof NodeSelection && selection.node.isBlock) {\n      if (!$from.parentOffset || !canSplit(doc, $from.pos)) {\n        return false\n      }\n\n      if (dispatch) {\n        if (keepMarks) {\n          ensureMarks(state, editor.extensionManager.splittableMarks)\n        }\n\n        tr.split($from.pos).scrollIntoView()\n      }\n\n      return true\n    }\n\n    if (!$from.parent.isBlock) {\n      return false\n    }\n\n    const atEnd = $to.parentOffset === $to.parent.content.size\n\n    const deflt = $from.depth === 0 ? undefined : defaultBlockAt($from.node(-1).contentMatchAt($from.indexAfter(-1)))\n\n    let types =\n      atEnd && deflt\n        ? [\n            {\n              type: deflt,\n              attrs: newAttributes,\n            },\n          ]\n        : undefined\n\n    let can = canSplit(tr.doc, tr.mapping.map($from.pos), 1, types)\n\n    if (!types && !can && canSplit(tr.doc, tr.mapping.map($from.pos), 1, deflt ? [{ type: deflt }] : undefined)) {\n      can = true\n      types = deflt\n        ? [\n            {\n              type: deflt,\n              attrs: newAttributes,\n            },\n          ]\n        : undefined\n    }\n\n    if (dispatch) {\n      if (can) {\n        if (selection instanceof TextSelection) {\n          tr.deleteSelection()\n        }\n\n        tr.split(tr.mapping.map($from.pos), 1, types)\n\n        if (deflt && !atEnd && !$from.parentOffset && $from.parent.type !== deflt) {\n          const first = tr.mapping.map($from.before())\n          const $first = tr.doc.resolve(first)\n\n          if ($from.node(-1).canReplaceWith($first.index(), $first.index() + 1, deflt)) {\n            tr.setNodeMarkup(tr.mapping.map($from.before()), deflt)\n          }\n        }\n      }\n\n      if (keepMarks) {\n        ensureMarks(state, editor.extensionManager.splittableMarks)\n      }\n\n      tr.scrollIntoView()\n    }\n\n    return can\n  }\n","import type { Node as ProseMirrorNode, NodeType } from '@tiptap/pm/model'\nimport { Fragment, Slice } from '@tiptap/pm/model'\nimport { TextSelection } from '@tiptap/pm/state'\nimport { canSplit } from '@tiptap/pm/transform'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport { getSplittedAttributes } from '../helpers/getSplittedAttributes.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    splitListItem: {\n      /**\n       * Splits one list item into two list items.\n       * @param typeOrName The type or name of the node.\n       * @param overrideAttrs The attributes to ensure on the new node.\n       * @example editor.commands.splitListItem('listItem')\n       */\n      splitListItem: (typeOrName: string | NodeType, overrideAttrs?: Record<string, any>) => ReturnType\n    }\n  }\n}\n\nexport const splitListItem: RawCommands['splitListItem'] =\n  (typeOrName, overrideAttrs = {}) =>\n  ({ tr, state, dispatch, editor }) => {\n    const type = getNodeType(typeOrName, state.schema)\n    const { $from, $to } = state.selection\n\n    // @ts-ignore\n    // eslint-disable-next-line\n    const node: ProseMirrorNode = state.selection.node\n\n    if ((node && node.isBlock) || $from.depth < 2 || !$from.sameParent($to)) {\n      return false\n    }\n\n    const grandParent = $from.node(-1)\n\n    if (grandParent.type !== type) {\n      return false\n    }\n\n    const extensionAttributes = editor.extensionManager.attributes\n\n    if ($from.parent.content.size === 0 && $from.node(-1).childCount === $from.indexAfter(-1)) {\n      // In an empty block. If this is a nested list, the wrapping\n      // list item should be split. Otherwise, bail out and let next\n      // command handle lifting.\n      if ($from.depth === 2 || $from.node(-3).type !== type || $from.index(-2) !== $from.node(-2).childCount - 1) {\n        return false\n      }\n\n      if (dispatch) {\n        let wrap = Fragment.empty\n        // eslint-disable-next-line\n        const depthBefore = $from.index(-1) ? 1 : $from.index(-2) ? 2 : 3\n\n        // Build a fragment containing empty versions of the structure\n        // from the outer list item to the parent node of the cursor\n        for (let d = $from.depth - depthBefore; d >= $from.depth - 3; d -= 1) {\n          wrap = Fragment.from($from.node(d).copy(wrap))\n        }\n\n        const depthAfter =\n          // eslint-disable-next-line no-nested-ternary\n          $from.indexAfter(-1) < $from.node(-2).childCount\n            ? 1\n            : $from.indexAfter(-2) < $from.node(-3).childCount\n              ? 2\n              : 3\n\n        // Add a second list item with an empty default start node\n        const newNextTypeAttributes = {\n          ...getSplittedAttributes(extensionAttributes, $from.node().type.name, $from.node().attrs),\n          ...overrideAttrs,\n        }\n        const nextType = type.contentMatch.defaultType?.createAndFill(newNextTypeAttributes) || undefined\n\n        wrap = wrap.append(Fragment.from(type.createAndFill(null, nextType) || undefined))\n\n        const start = $from.before($from.depth - (depthBefore - 1))\n\n        tr.replace(start, $from.after(-depthAfter), new Slice(wrap, 4 - depthBefore, 0))\n\n        let sel = -1\n\n        tr.doc.nodesBetween(start, tr.doc.content.size, (n, pos) => {\n          if (sel > -1) {\n            return false\n          }\n\n          if (n.isTextblock && n.content.size === 0) {\n            sel = pos + 1\n          }\n        })\n\n        if (sel > -1) {\n          tr.setSelection(TextSelection.near(tr.doc.resolve(sel)))\n        }\n\n        tr.scrollIntoView()\n      }\n\n      return true\n    }\n\n    const nextType = $to.pos === $from.end() ? grandParent.contentMatchAt(0).defaultType : null\n\n    const newTypeAttributes = {\n      ...getSplittedAttributes(extensionAttributes, grandParent.type.name, grandParent.attrs),\n      ...overrideAttrs,\n    }\n    const newNextTypeAttributes = {\n      ...getSplittedAttributes(extensionAttributes, $from.node().type.name, $from.node().attrs),\n      ...overrideAttrs,\n    }\n\n    tr.delete($from.pos, $to.pos)\n\n    const types = nextType\n      ? [\n          { type, attrs: newTypeAttributes },\n          { type: nextType, attrs: newNextTypeAttributes },\n        ]\n      : [{ type, attrs: newTypeAttributes }]\n\n    if (!canSplit(tr.doc, $from.pos, 2)) {\n      return false\n    }\n\n    if (dispatch) {\n      const { selection, storedMarks } = state\n      const { splittableMarks } = editor.extensionManager\n      const marks = storedMarks || (selection.$to.parentOffset && selection.$from.marks())\n\n      tr.split($from.pos, 2, types).scrollIntoView()\n\n      if (!marks || !dispatch) {\n        return true\n      }\n\n      const filteredMarks = marks.filter(mark => splittableMarks.includes(mark.type.name))\n\n      tr.ensureMarks(filteredMarks)\n    }\n\n    return true\n  }\n","import type { NodeType } from '@tiptap/pm/model'\nimport type { Transaction } from '@tiptap/pm/state'\nimport { canJoin } from '@tiptap/pm/transform'\n\nimport { findParentNode } from '../helpers/findParentNode.js'\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport { isList } from '../helpers/isList.js'\nimport type { RawCommands } from '../types.js'\n\nconst joinListBackwards = (tr: Transaction, listType: NodeType): boolean => {\n  const list = findParentNode(node => node.type === listType)(tr.selection)\n\n  if (!list) {\n    return true\n  }\n\n  const before = tr.doc.resolve(Math.max(0, list.pos - 1)).before(list.depth)\n\n  if (before === undefined) {\n    return true\n  }\n\n  const nodeBefore = tr.doc.nodeAt(before)\n  const canJoinBackwards = list.node.type === nodeBefore?.type && canJoin(tr.doc, list.pos)\n\n  if (!canJoinBackwards) {\n    return true\n  }\n\n  tr.join(list.pos)\n\n  return true\n}\n\nconst joinListForwards = (tr: Transaction, listType: NodeType): boolean => {\n  const list = findParentNode(node => node.type === listType)(tr.selection)\n\n  if (!list) {\n    return true\n  }\n\n  const after = tr.doc.resolve(list.start).after(list.depth)\n\n  if (after === undefined) {\n    return true\n  }\n\n  const nodeAfter = tr.doc.nodeAt(after)\n  const canJoinForwards = list.node.type === nodeAfter?.type && canJoin(tr.doc, after)\n\n  if (!canJoinForwards) {\n    return true\n  }\n\n  tr.join(after)\n\n  return true\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    toggleList: {\n      /**\n       * Toggle between different list types.\n       * @param listTypeOrName The type or name of the list.\n       * @param itemTypeOrName The type or name of the list item.\n       * @param keepMarks Keep marks when toggling.\n       * @param attributes Attributes for the new list.\n       * @example editor.commands.toggleList('bulletList', 'listItem')\n       */\n      toggleList: (\n        listTypeOrName: string | NodeType,\n        itemTypeOrName: string | NodeType,\n        keepMarks?: boolean,\n        attributes?: Record<string, any>,\n      ) => ReturnType\n    }\n  }\n}\n\nexport const toggleList: RawCommands['toggleList'] =\n  (listTypeOrName, itemTypeOrName, keepMarks, attributes = {}) =>\n  ({ editor, tr, state, dispatch, chain, commands, can }) => {\n    const { extensions, splittableMarks } = editor.extensionManager\n    const listType = getNodeType(listTypeOrName, state.schema)\n    const itemType = getNodeType(itemTypeOrName, state.schema)\n    const { selection, storedMarks } = state\n    const { $from, $to } = selection\n    const range = $from.blockRange($to)\n\n    const marks = storedMarks || (selection.$to.parentOffset && selection.$from.marks())\n\n    if (!range) {\n      return false\n    }\n\n    const parentList = findParentNode(node => isList(node.type.name, extensions))(selection)\n\n    if (range.depth >= 1 && parentList && range.depth - parentList.depth <= 1) {\n      // remove list\n      if (parentList.node.type === listType) {\n        return commands.liftListItem(itemType)\n      }\n\n      // change list type\n      if (isList(parentList.node.type.name, extensions) && listType.validContent(parentList.node.content) && dispatch) {\n        return chain()\n          .command(() => {\n            tr.setNodeMarkup(parentList.pos, listType)\n\n            return true\n          })\n          .command(() => joinListBackwards(tr, listType))\n          .command(() => joinListForwards(tr, listType))\n          .run()\n      }\n    }\n    if (!keepMarks || !marks || !dispatch) {\n      return (\n        chain()\n          // try to convert node to default node if needed\n          .command(() => {\n            const canWrapInList = can().wrapInList(listType, attributes)\n\n            if (canWrapInList) {\n              return true\n            }\n\n            return commands.clearNodes()\n          })\n          .wrapInList(listType, attributes)\n          .command(() => joinListBackwards(tr, listType))\n          .command(() => joinListForwards(tr, listType))\n          .run()\n      )\n    }\n\n    return (\n      chain()\n        // try to convert node to default node if needed\n        .command(() => {\n          const canWrapInList = can().wrapInList(listType, attributes)\n\n          const filteredMarks = marks.filter(mark => splittableMarks.includes(mark.type.name))\n\n          tr.ensureMarks(filteredMarks)\n\n          if (canWrapInList) {\n            return true\n          }\n\n          return commands.clearNodes()\n        })\n        .wrapInList(listType, attributes)\n        .command(() => joinListBackwards(tr, listType))\n        .command(() => joinListForwards(tr, listType))\n        .run()\n    )\n  }\n","import type { MarkType } from '@tiptap/pm/model'\n\nimport { getMarkType } from '../helpers/getMarkType.js'\nimport { isMarkActive } from '../helpers/isMarkActive.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    toggleMark: {\n      /**\n       * Toggle a mark on and off.\n       * @param typeOrName The mark type or name.\n       * @param attributes The attributes of the mark.\n       * @param options.extendEmptyMarkRange Removes the mark even across the current selection. Defaults to `false`.\n       * @example editor.commands.toggleMark('bold')\n       */\n      toggleMark: (\n        /**\n         * The mark type or name.\n         */\n        typeOrName: string | MarkType,\n\n        /**\n         * The attributes of the mark.\n         */\n        attributes?: Record<string, any>,\n\n        options?: {\n          /**\n           * Removes the mark even across the current selection. Defaults to `false`.\n           */\n          extendEmptyMarkRange?: boolean\n        },\n      ) => ReturnType\n    }\n  }\n}\n\nexport const toggleMark: RawCommands['toggleMark'] =\n  (typeOrName, attributes = {}, options = {}) =>\n  ({ state, commands }) => {\n    const { extendEmptyMarkRange = false } = options\n    const type = getMarkType(typeOrName, state.schema)\n    const isActive = isMarkActive(state, type, attributes)\n\n    if (isActive) {\n      return commands.unsetMark(type, { extendEmptyMarkRange })\n    }\n\n    return commands.setMark(type, attributes)\n  }\n","import type { NodeType } from '@tiptap/pm/model'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport { isNodeActive } from '../helpers/isNodeActive.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    toggleNode: {\n      /**\n       * Toggle a node with another node.\n       * @param typeOrName The type or name of the node.\n       * @param toggleTypeOrName The type or name of the node to toggle.\n       * @param attributes The attributes of the node.\n       * @example editor.commands.toggleNode('heading', 'paragraph')\n       */\n      toggleNode: (\n        typeOrName: string | NodeType,\n        toggleTypeOrName: string | NodeType,\n        attributes?: Record<string, any>,\n      ) => ReturnType\n    }\n  }\n}\n\nexport const toggleNode: RawCommands['toggleNode'] =\n  (typeOrName, toggleTypeOrName, attributes = {}) =>\n  ({ state, commands }) => {\n    const type = getNodeType(typeOrName, state.schema)\n    const toggleType = getNodeType(toggleTypeOrName, state.schema)\n    const isActive = isNodeActive(state, type, attributes)\n\n    let attributesToCopy: Record<string, any> | undefined\n\n    if (state.selection.$anchor.sameParent(state.selection.$head)) {\n      // only copy attributes if the selection is pointing to a node of the same type\n      attributesToCopy = state.selection.$anchor.parent.attrs\n    }\n\n    if (isActive) {\n      return commands.setNode(toggleType, attributesToCopy)\n    }\n\n    // If the node is not active, we want to set the new node type with the given attributes\n    // Copying over the attributes from the current node if the selection is pointing to a node of the same type\n    return commands.setNode(type, { ...attributesToCopy, ...attributes })\n  }\n","import type { NodeType } from '@tiptap/pm/model'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport { isNodeActive } from '../helpers/isNodeActive.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    toggleWrap: {\n      /**\n       * Wraps nodes in another node, or removes an existing wrap.\n       * @param typeOrName The type or name of the node.\n       * @param attributes The attributes of the node.\n       * @example editor.commands.toggleWrap('blockquote')\n       */\n      toggleWrap: (typeOrName: string | NodeType, attributes?: Record<string, any>) => ReturnType\n    }\n  }\n}\n\nexport const toggleWrap: RawCommands['toggleWrap'] =\n  (typeOrName, attributes = {}) =>\n  ({ state, commands }) => {\n    const type = getNodeType(typeOrName, state.schema)\n    const isActive = isNodeActive(state, type, attributes)\n\n    if (isActive) {\n      return commands.lift(type)\n    }\n\n    return commands.wrapIn(type, attributes)\n  }\n","import type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    undoInputRule: {\n      /**\n       * Undo an input rule.\n       * @example editor.commands.undoInputRule()\n       */\n      undoInputRule: () => ReturnType\n    }\n  }\n}\n\nexport const undoInputRule: RawCommands['undoInputRule'] =\n  () =>\n  ({ state, dispatch }) => {\n    const plugins = state.plugins\n\n    for (let i = 0; i < plugins.length; i += 1) {\n      const plugin = plugins[i]\n      let undoable\n\n      // @ts-ignore\n      // eslint-disable-next-line\n      if (plugin.spec.isInputRules && (undoable = plugin.getState(state))) {\n        if (dispatch) {\n          const tr = state.tr\n          const toUndo = undoable.transform\n\n          for (let j = toUndo.steps.length - 1; j >= 0; j -= 1) {\n            tr.step(toUndo.steps[j].invert(toUndo.docs[j]))\n          }\n\n          if (undoable.text) {\n            const marks = tr.doc.resolve(undoable.from).marks()\n\n            tr.replaceWith(undoable.from, undoable.to, state.schema.text(undoable.text, marks))\n          } else {\n            tr.delete(undoable.from, undoable.to)\n          }\n        }\n\n        return true\n      }\n    }\n\n    return false\n  }\n","import type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    unsetAllMarks: {\n      /**\n       * Remove all marks in the current selection.\n       * @example editor.commands.unsetAllMarks()\n       */\n      unsetAllMarks: () => ReturnType\n    }\n  }\n}\n\nexport const unsetAllMarks: RawCommands['unsetAllMarks'] =\n  () =>\n  ({ tr, dispatch }) => {\n    const { selection } = tr\n    const { empty, ranges } = selection\n\n    if (empty) {\n      return true\n    }\n\n    if (dispatch) {\n      ranges.forEach(range => {\n        tr.removeMark(range.$from.pos, range.$to.pos)\n      })\n    }\n\n    return true\n  }\n","import type { MarkType } from '@tiptap/pm/model'\n\nimport { getMarkRange } from '../helpers/getMarkRange.js'\nimport { getMarkType } from '../helpers/getMarkType.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    unsetMark: {\n      /**\n       * Remove all marks in the current selection.\n       * @param typeOrName The mark type or name.\n       * @param options.extendEmptyMarkRange Removes the mark even across the current selection. Defaults to `false`.\n       * @example editor.commands.unsetMark('bold')\n       */\n      unsetMark: (\n        /**\n         * The mark type or name.\n         */\n        typeOrName: string | MarkType,\n\n        options?: {\n          /**\n           * Removes the mark even across the current selection. Defaults to `false`.\n           */\n          extendEmptyMarkRange?: boolean\n        },\n      ) => ReturnType\n    }\n  }\n}\n\nexport const unsetMark: RawCommands['unsetMark'] =\n  (typeOrName, options = {}) =>\n  ({ tr, state, dispatch }) => {\n    const { extendEmptyMarkRange = false } = options\n    const { selection } = tr\n    const type = getMarkType(typeOrName, state.schema)\n    const { $from, empty, ranges } = selection\n\n    if (!dispatch) {\n      return true\n    }\n\n    if (empty && extendEmptyMarkRange) {\n      let { from, to } = selection\n      const attrs = $from.marks().find(mark => mark.type === type)?.attrs\n      const range = getMarkRange($from, type, attrs)\n\n      if (range) {\n        from = range.from\n        to = range.to\n      }\n\n      tr.removeMark(from, to, type)\n    } else {\n      ranges.forEach(range => {\n        tr.removeMark(range.$from.pos, range.$to.pos, type)\n      })\n    }\n\n    tr.removeStoredMark(type)\n\n    return true\n  }\n","import type { Range, RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    unsetTextDirection: {\n      /**\n       * Remove the text direction attribute from nodes.\n       * If no position is provided, it will use the current selection.\n       * @param position Optional position or range to remove the direction from\n       * @example editor.commands.unsetTextDirection()\n       * @example editor.commands.unsetTextDirection({ from: 0, to: 10 })\n       */\n      unsetTextDirection: (position?: number | Range) => ReturnType\n    }\n  }\n}\n\nexport const unsetTextDirection: RawCommands['unsetTextDirection'] =\n  position =>\n  ({ tr, state, dispatch }) => {\n    const { selection } = state\n    let from: number\n    let to: number\n\n    if (typeof position === 'number') {\n      from = position\n      to = position\n    } else if (position && 'from' in position && 'to' in position) {\n      from = position.from\n      to = position.to\n    } else {\n      from = selection.from\n      to = selection.to\n    }\n\n    if (dispatch) {\n      tr.doc.nodesBetween(from, to, (node, pos) => {\n        if (node.isText) {\n          return\n        }\n\n        const newAttrs = { ...node.attrs }\n\n        delete newAttrs.dir\n\n        tr.setNodeMarkup(pos, undefined, newAttrs)\n      })\n    }\n\n    return true\n  }\n","import type { Mark, MarkType, Node, NodeType } from '@tiptap/pm/model'\nimport type { SelectionRange } from '@tiptap/pm/state'\n\nimport { getMarkType } from '../helpers/getMarkType.js'\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport { getSchemaTypeNameByName } from '../helpers/getSchemaTypeNameByName.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    updateAttributes: {\n      /**\n       * Update attributes of a node or mark.\n       * @param typeOrName The type or name of the node or mark.\n       * @param attributes The attributes of the node or mark.\n       * @example editor.commands.updateAttributes('mention', { userId: \"2\" })\n       */\n      updateAttributes: (\n        /**\n         * The type or name of the node or mark.\n         */\n        typeOrName: string | NodeType | MarkType,\n\n        /**\n         * The attributes of the node or mark.\n         */\n        attributes: Record<string, any>,\n      ) => ReturnType\n    }\n  }\n}\n\nexport const updateAttributes: RawCommands['updateAttributes'] =\n  (typeOrName, attributes = {}) =>\n  ({ tr, state, dispatch }) => {\n    let nodeType: NodeType | null = null\n    let markType: MarkType | null = null\n\n    const schemaType = getSchemaTypeNameByName(\n      typeof typeOrName === 'string' ? typeOrName : typeOrName.name,\n      state.schema,\n    )\n\n    if (!schemaType) {\n      return false\n    }\n\n    if (schemaType === 'node') {\n      nodeType = getNodeType(typeOrName as NodeType, state.schema)\n    }\n\n    if (schemaType === 'mark') {\n      markType = getMarkType(typeOrName as MarkType, state.schema)\n    }\n\n    let canUpdate = false\n\n    tr.selection.ranges.forEach((range: SelectionRange) => {\n      const from = range.$from.pos\n      const to = range.$to.pos\n\n      let lastPos: number | undefined\n      let lastNode: Node | undefined\n      let trimmedFrom: number\n      let trimmedTo: number\n\n      if (tr.selection.empty) {\n        state.doc.nodesBetween(from, to, (node: Node, pos: number) => {\n          if (nodeType && nodeType === node.type) {\n            canUpdate = true\n            trimmedFrom = Math.max(pos, from)\n            trimmedTo = Math.min(pos + node.nodeSize, to)\n            lastPos = pos\n            lastNode = node\n          }\n        })\n      } else {\n        state.doc.nodesBetween(from, to, (node: Node, pos: number) => {\n          if (pos < from && nodeType && nodeType === node.type) {\n            canUpdate = true\n            trimmedFrom = Math.max(pos, from)\n            trimmedTo = Math.min(pos + node.nodeSize, to)\n            lastPos = pos\n            lastNode = node\n          }\n\n          if (pos >= from && pos <= to) {\n            if (nodeType && nodeType === node.type) {\n              canUpdate = true\n\n              if (dispatch) {\n                tr.setNodeMarkup(pos, undefined, {\n                  ...node.attrs,\n                  ...attributes,\n                })\n              }\n            }\n\n            if (markType && node.marks.length) {\n              node.marks.forEach((mark: Mark) => {\n                if (markType === mark.type) {\n                  canUpdate = true\n\n                  if (dispatch) {\n                    const trimmedFrom2 = Math.max(pos, from)\n                    const trimmedTo2 = Math.min(pos + node.nodeSize, to)\n\n                    tr.addMark(\n                      trimmedFrom2,\n                      trimmedTo2,\n                      markType.create({\n                        ...mark.attrs,\n                        ...attributes,\n                      }),\n                    )\n                  }\n                }\n              })\n            }\n          }\n        })\n      }\n\n      if (lastNode) {\n        if (lastPos !== undefined && dispatch) {\n          tr.setNodeMarkup(lastPos, undefined, {\n            ...lastNode.attrs,\n            ...attributes,\n          })\n        }\n\n        if (markType && lastNode.marks.length) {\n          lastNode.marks.forEach((mark: Mark) => {\n            if (markType === mark.type && dispatch) {\n              tr.addMark(\n                trimmedFrom,\n                trimmedTo,\n                markType.create({\n                  ...mark.attrs,\n                  ...attributes,\n                }),\n              )\n            }\n          })\n        }\n      }\n    })\n\n    return canUpdate\n  }\n","import { wrapIn as originalWrapIn } from '@tiptap/pm/commands'\nimport type { NodeType } from '@tiptap/pm/model'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    wrapIn: {\n      /**\n       * Wraps nodes in another node.\n       * @param typeOrName The type or name of the node.\n       * @param attributes The attributes of the node.\n       * @example editor.commands.wrapIn('blockquote')\n       */\n      wrapIn: (typeOrName: string | NodeType, attributes?: Record<string, any>) => ReturnType\n    }\n  }\n}\n\nexport const wrapIn: RawCommands['wrapIn'] =\n  (typeOrName, attributes = {}) =>\n  ({ state, dispatch }) => {\n    const type = getNodeType(typeOrName, state.schema)\n\n    return originalWrapIn(type, attributes)(state, dispatch)\n  }\n","import type { NodeType } from '@tiptap/pm/model'\nimport { wrapInList as originalWrapInList } from '@tiptap/pm/schema-list'\n\nimport { getNodeType } from '../helpers/getNodeType.js'\nimport type { RawCommands } from '../types.js'\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    wrapInList: {\n      /**\n       * Wrap a node in a list.\n       * @param typeOrName The type or name of the node.\n       * @param attributes The attributes of the node.\n       * @example editor.commands.wrapInList('bulletList')\n       */\n      wrapInList: (typeOrName: string | NodeType, attributes?: Record<string, any>) => ReturnType\n    }\n  }\n}\n\nexport const wrapInList: RawCommands['wrapInList'] =\n  (typeOrName, attributes = {}) =>\n  ({ state, dispatch }) => {\n    const type = getNodeType(typeOrName, state.schema)\n\n    return originalWrapInList(type, attributes)(state, dispatch)\n  }\n","/* eslint-disable @typescript-eslint/no-empty-object-type */\nimport type { MarkType, Node as ProseMirrorNode, NodeType, Schema } from '@tiptap/pm/model'\nimport type { Plugin, PluginKey, Transaction } from '@tiptap/pm/state'\nimport { EditorState } from '@tiptap/pm/state'\nimport { EditorView } from '@tiptap/pm/view'\n\nimport { CommandManager } from './CommandManager.js'\nimport { EventEmitter } from './EventEmitter.js'\nimport { ExtensionManager } from './ExtensionManager.js'\nimport {\n  ClipboardTextSerializer,\n  Commands,\n  Delete,\n  Drop,\n  Editable,\n  FocusEvents,\n  Keymap,\n  Paste,\n  Tabindex,\n  TextDirection,\n} from './extensions/index.js'\nimport { createDocument } from './helpers/createDocument.js'\nimport { getAttributes } from './helpers/getAttributes.js'\nimport { getHTMLFromFragment } from './helpers/getHTMLFromFragment.js'\nimport { getText } from './helpers/getText.js'\nimport { getTextSerializersFromSchema } from './helpers/getTextSerializersFromSchema.js'\nimport { isActive } from './helpers/isActive.js'\nimport { isNodeEmpty } from './helpers/isNodeEmpty.js'\nimport { createMappablePosition, getUpdatedPosition } from './helpers/MappablePosition.js'\nimport { resolveFocusPosition } from './helpers/resolveFocusPosition.js'\nimport type { Storage } from './index.js'\nimport { NodePos } from './NodePos.js'\nimport { style } from './style.js'\nimport type {\n  CanCommands,\n  ChainedCommands,\n  DocumentType,\n  EditorEvents,\n  EditorOptions,\n  NodeType as TNodeType,\n  SingleCommands,\n  TextSerializer,\n  TextType as TTextType,\n  Utils,\n} from './types.js'\nimport { createStyleTag } from './utilities/createStyleTag.js'\nimport { isFunction } from './utilities/isFunction.js'\n\nexport * as extensions from './extensions/index.js'\n\n// @ts-ignore\nexport interface TiptapEditorHTMLElement extends HTMLElement {\n  editor?: Editor\n}\n\nexport class Editor extends EventEmitter<EditorEvents> {\n  private commandManager!: CommandManager\n\n  public extensionManager!: ExtensionManager\n\n  private css: HTMLStyleElement | null = null\n\n  private className = 'tiptap'\n\n  public schema!: Schema\n\n  private editorView: EditorView | null = null\n\n  public isFocused = false\n\n  private editorState!: EditorState\n\n  /**\n   * The editor is considered initialized after the `create` event has been emitted.\n   */\n  public isInitialized = false\n\n  public extensionStorage: Storage = {} as Storage\n\n  /**\n   * A unique ID for this editor instance.\n   */\n  public instanceId = Math.random().toString(36).slice(2, 9)\n\n  public options: EditorOptions = {\n    element: typeof document !== 'undefined' ? document.createElement('div') : null,\n    content: '',\n    injectCSS: true,\n    injectNonce: undefined,\n    extensions: [],\n    autofocus: false,\n    editable: true,\n    textDirection: undefined,\n    editorProps: {},\n    parseOptions: {},\n    coreExtensionOptions: {},\n    enableInputRules: true,\n    enablePasteRules: true,\n    enableCoreExtensions: true,\n    enableContentCheck: false,\n    emitContentError: false,\n    onBeforeCreate: () => null,\n    onCreate: () => null,\n    onMount: () => null,\n    onUnmount: () => null,\n    onUpdate: () => null,\n    onSelectionUpdate: () => null,\n    onTransaction: () => null,\n    onFocus: () => null,\n    onBlur: () => null,\n    onDestroy: () => null,\n    onContentError: ({ error }) => {\n      throw error\n    },\n    onPaste: () => null,\n    onDrop: () => null,\n    onDelete: () => null,\n    enableExtensionDispatchTransaction: true,\n  }\n\n  constructor(options: Partial<EditorOptions> = {}) {\n    super()\n    this.setOptions(options)\n    this.createExtensionManager()\n    this.createCommandManager()\n    this.createSchema()\n    this.on('beforeCreate', this.options.onBeforeCreate)\n    this.emit('beforeCreate', { editor: this })\n    this.on('mount', this.options.onMount)\n    this.on('unmount', this.options.onUnmount)\n    this.on('contentError', this.options.onContentError)\n    this.on('create', this.options.onCreate)\n    this.on('update', this.options.onUpdate)\n    this.on('selectionUpdate', this.options.onSelectionUpdate)\n    this.on('transaction', this.options.onTransaction)\n    this.on('focus', this.options.onFocus)\n    this.on('blur', this.options.onBlur)\n    this.on('destroy', this.options.onDestroy)\n    this.on('drop', ({ event, slice, moved }) => this.options.onDrop(event, slice, moved))\n    this.on('paste', ({ event, slice }) => this.options.onPaste(event, slice))\n    this.on('delete', this.options.onDelete)\n\n    const initialDoc = this.createDoc()\n    const selection = resolveFocusPosition(initialDoc, this.options.autofocus)\n\n    // Set editor state immediately, so that it's available independently from the view\n    this.editorState = EditorState.create({\n      doc: initialDoc,\n      schema: this.schema,\n      selection: selection || undefined,\n    })\n\n    if (this.options.element) {\n      this.mount(this.options.element)\n    }\n  }\n\n  /**\n   * Attach the editor to the DOM, creating a new editor view.\n   */\n  public mount(el: NonNullable<EditorOptions['element']> & {}) {\n    if (typeof document === 'undefined') {\n      throw new Error(\n        `[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.`,\n      )\n    }\n    this.createView(el)\n    this.emit('mount', { editor: this })\n\n    if (this.css && !document.head.contains(this.css)) {\n      document.head.appendChild(this.css)\n    }\n\n    window.setTimeout(() => {\n      if (this.isDestroyed) {\n        return\n      }\n\n      if (this.options.autofocus !== false && this.options.autofocus !== null) {\n        this.commands.focus(this.options.autofocus)\n      }\n      this.emit('create', { editor: this })\n      this.isInitialized = true\n    }, 0)\n  }\n\n  /**\n   * Remove the editor from the DOM, but still allow remounting at a different point in time\n   */\n  public unmount() {\n    if (this.editorView) {\n      // Cleanup our reference to prevent circular references which caused memory leaks\n      // @ts-ignore\n      const dom = this.editorView.dom as TiptapEditorHTMLElement\n\n      if (dom?.editor) {\n        delete dom.editor\n      }\n      this.editorView.destroy()\n    }\n    this.editorView = null\n    this.isInitialized = false\n\n    // Safely remove CSS element with fallback for test environments\n    // Only remove CSS if no other editors exist in the document after unmount\n    if (this.css && !document.querySelectorAll(`.${this.className}`).length) {\n      try {\n        if (typeof this.css.remove === 'function') {\n          this.css.remove()\n        } else if (this.css.parentNode) {\n          this.css.parentNode.removeChild(this.css)\n        }\n      } catch (error) {\n        // Silently handle any unexpected DOM removal errors in test environments\n        console.warn('Failed to remove CSS element:', error)\n      }\n    }\n    this.css = null\n    this.emit('unmount', { editor: this })\n  }\n\n  /**\n   * Returns the editor storage.\n   */\n  public get storage(): Storage {\n    return this.extensionStorage\n  }\n\n  /**\n   * An object of all registered commands.\n   */\n  public get commands(): SingleCommands {\n    return this.commandManager.commands\n  }\n\n  /**\n   * Create a command chain to call multiple commands at once.\n   */\n  public chain(): ChainedCommands {\n    return this.commandManager.chain()\n  }\n\n  /**\n   * Check if a command or a command chain can be executed. Without executing it.\n   */\n  public can(): CanCommands {\n    return this.commandManager.can()\n  }\n\n  /**\n   * Inject CSS styles.\n   */\n  private injectCSS(): void {\n    if (this.options.injectCSS && typeof document !== 'undefined') {\n      this.css = createStyleTag(style, this.options.injectNonce)\n    }\n  }\n\n  /**\n   * Update editor options.\n   *\n   * @param options A list of options\n   */\n  public setOptions(options: Partial<EditorOptions> = {}): void {\n    this.options = {\n      ...this.options,\n      ...options,\n    }\n\n    if (!this.editorView || !this.state || this.isDestroyed) {\n      return\n    }\n\n    if (this.options.editorProps) {\n      this.view.setProps(this.options.editorProps)\n    }\n\n    this.view.updateState(this.state)\n  }\n\n  /**\n   * Update editable state of the editor.\n   */\n  public setEditable(editable: boolean, emitUpdate = true): void {\n    this.setOptions({ editable })\n\n    if (emitUpdate) {\n      this.emit('update', { editor: this, transaction: this.state.tr, appendedTransactions: [] })\n    }\n  }\n\n  /**\n   * Returns whether the editor is editable.\n   */\n  public get isEditable(): boolean {\n    // since plugins are applied after creating the view\n    // `editable` is always `true` for one tick.\n    // thats why we also have to check for `options.editable`\n    return this.options.editable && this.view && this.view.editable\n  }\n\n  /**\n   * Returns the editor state.\n   */\n  public get view(): EditorView {\n    if (this.editorView) {\n      return this.editorView\n    }\n\n    return new Proxy(\n      {\n        state: this.editorState,\n        updateState: (state: EditorState): ReturnType<EditorView['updateState']> => {\n          this.editorState = state\n        },\n        dispatch: (tr: Transaction): ReturnType<EditorView['dispatch']> => {\n          this.dispatchTransaction(tr)\n        },\n\n        // Stub some commonly accessed properties to prevent errors\n        composing: false,\n        dragging: null,\n        editable: true,\n        isDestroyed: false,\n      } as EditorView,\n      {\n        get: (obj, key) => {\n          if (this.editorView) {\n            // If the editor view is available, but the caller has a stale reference to the proxy,\n            // Just return what the editor view has.\n            return this.editorView[key as keyof EditorView]\n          }\n          // Specifically always return the most recent editorState\n          if (key === 'state') {\n            return this.editorState\n          }\n          if (key in obj) {\n            return Reflect.get(obj, key)\n          }\n\n          // We throw an error here, because we know the view is not available\n          throw new Error(\n            `[tiptap error]: The editor view is not available. Cannot access view['${key as string}']. The editor may not be mounted yet.`,\n          )\n        },\n      },\n    ) as EditorView\n  }\n\n  /**\n   * Returns the editor state.\n   */\n  public get state(): EditorState {\n    if (this.editorView) {\n      this.editorState = this.view.state\n    }\n\n    return this.editorState\n  }\n\n  /**\n   * Register a ProseMirror plugin.\n   *\n   * @param plugin A ProseMirror plugin\n   * @param handlePlugins Control how to merge the plugin into the existing plugins.\n   * @returns The new editor state\n   */\n  public registerPlugin(\n    plugin: Plugin,\n    handlePlugins?: (newPlugin: Plugin, plugins: Plugin[]) => Plugin[],\n  ): EditorState {\n    const plugins = isFunction(handlePlugins)\n      ? handlePlugins(plugin, [...this.state.plugins])\n      : [...this.state.plugins, plugin]\n\n    const state = this.state.reconfigure({ plugins })\n\n    this.view.updateState(state)\n\n    return state\n  }\n\n  /**\n   * Unregister a ProseMirror plugin.\n   *\n   * @param nameOrPluginKeyToRemove The plugins name\n   * @returns The new editor state or undefined if the editor is destroyed\n   */\n  public unregisterPlugin(\n    nameOrPluginKeyToRemove: string | PluginKey | (string | PluginKey)[],\n  ): EditorState | undefined {\n    if (this.isDestroyed) {\n      return undefined\n    }\n\n    const prevPlugins = this.state.plugins\n    let plugins = prevPlugins\n\n    ;([] as (string | PluginKey)[]).concat(nameOrPluginKeyToRemove).forEach(nameOrPluginKey => {\n      // @ts-ignore\n      const name = typeof nameOrPluginKey === 'string' ? `${nameOrPluginKey}$` : nameOrPluginKey.key\n\n      // @ts-ignore\n      plugins = plugins.filter(plugin => !plugin.key.startsWith(name))\n    })\n\n    if (prevPlugins.length === plugins.length) {\n      // No plugin was removed, so we dont need to update the state\n      return undefined\n    }\n\n    const state = this.state.reconfigure({\n      plugins,\n    })\n\n    this.view.updateState(state)\n\n    return state\n  }\n\n  /**\n   * Creates an extension manager.\n   */\n  private createExtensionManager(): void {\n    const coreExtensions = this.options.enableCoreExtensions\n      ? [\n          Editable,\n          ClipboardTextSerializer.configure({\n            blockSeparator: this.options.coreExtensionOptions?.clipboardTextSerializer?.blockSeparator,\n          }),\n          Commands,\n          FocusEvents,\n          Keymap,\n          Tabindex,\n          Drop,\n          Paste,\n          Delete,\n          TextDirection.configure({\n            direction: this.options.textDirection,\n          }),\n        ].filter(ext => {\n          if (typeof this.options.enableCoreExtensions === 'object') {\n            return (\n              this.options.enableCoreExtensions[ext.name as keyof typeof this.options.enableCoreExtensions] !== false\n            )\n          }\n          return true\n        })\n      : []\n    const allExtensions = [...coreExtensions, ...this.options.extensions].filter(extension => {\n      return ['extension', 'node', 'mark'].includes(extension?.type)\n    })\n\n    this.extensionManager = new ExtensionManager(allExtensions, this)\n  }\n\n  /**\n   * Creates an command manager.\n   */\n  private createCommandManager(): void {\n    this.commandManager = new CommandManager({\n      editor: this,\n    })\n  }\n\n  /**\n   * Creates a ProseMirror schema.\n   */\n  private createSchema(): void {\n    this.schema = this.extensionManager.schema\n  }\n\n  /**\n   * Creates the initial document.\n   */\n  private createDoc(): ProseMirrorNode {\n    let doc: ProseMirrorNode\n\n    try {\n      doc = createDocument(this.options.content, this.schema, this.options.parseOptions, {\n        errorOnInvalidContent: this.options.enableContentCheck,\n      })\n    } catch (e) {\n      if (\n        !(e instanceof Error) ||\n        !['[tiptap error]: Invalid JSON content', '[tiptap error]: Invalid HTML content'].includes(e.message)\n      ) {\n        // Not the content error we were expecting\n        throw e\n      }\n      this.emit('contentError', {\n        editor: this,\n        error: e as Error,\n        disableCollaboration: () => {\n          if (\n            'collaboration' in this.storage &&\n            typeof this.storage.collaboration === 'object' &&\n            this.storage.collaboration\n          ) {\n            ;(this.storage.collaboration as any).isDisabled = true\n          }\n          // To avoid syncing back invalid content, reinitialize the extensions without the collaboration extension\n          this.options.extensions = this.options.extensions.filter(extension => extension.name !== 'collaboration')\n\n          // Restart the initialization process by recreating the extension manager with the new set of extensions\n          this.createExtensionManager()\n        },\n      })\n\n      // Content is invalid, but attempt to create it anyway, stripping out the invalid parts\n      doc = createDocument(this.options.content, this.schema, this.options.parseOptions, {\n        errorOnInvalidContent: false,\n      })\n    }\n    return doc\n  }\n\n  /**\n   * Creates a ProseMirror view.\n   */\n  private createView(element: NonNullable<EditorOptions['element']>): void {\n    const { editorProps, enableExtensionDispatchTransaction } = this.options\n    // If a user provided a custom `dispatchTransaction` through `editorProps`,\n    // we use that as the base dispatch function.\n    // Otherwise, we use Tiptap's internal `dispatchTransaction` method.\n    const baseDispatch = (editorProps as any).dispatchTransaction || this.dispatchTransaction.bind(this)\n    const dispatch = enableExtensionDispatchTransaction\n      ? this.extensionManager.dispatchTransaction(baseDispatch)\n      : baseDispatch\n\n    this.editorView = new EditorView(element, {\n      ...editorProps,\n      attributes: {\n        // add `role=\"textbox\"` to the editor element\n        role: 'textbox',\n        ...editorProps?.attributes,\n      },\n      dispatchTransaction: dispatch,\n      state: this.editorState,\n      markViews: this.extensionManager.markViews,\n      nodeViews: this.extensionManager.nodeViews,\n    })\n\n    // `editor.view` is not yet available at this time.\n    // Therefore we will add all plugins and node views directly afterwards.\n    const newState = this.state.reconfigure({\n      plugins: this.extensionManager.plugins,\n    })\n\n    this.view.updateState(newState)\n\n    this.prependClass()\n    this.injectCSS()\n\n    // Lets store the editor instance in the DOM element.\n    // So well have access to it for tests.\n    // @ts-ignore\n    const dom = this.view.dom as TiptapEditorHTMLElement\n\n    dom.editor = this\n  }\n\n  /**\n   * Creates all node and mark views.\n   */\n  public createNodeViews(): void {\n    if (this.view.isDestroyed) {\n      return\n    }\n\n    this.view.setProps({\n      markViews: this.extensionManager.markViews,\n      nodeViews: this.extensionManager.nodeViews,\n    })\n  }\n\n  /**\n   * Prepend class name to element.\n   */\n  public prependClass(): void {\n    this.view.dom.className = `${this.className} ${this.view.dom.className}`\n  }\n\n  public isCapturingTransaction = false\n\n  private capturedTransaction: Transaction | null = null\n\n  public captureTransaction(fn: () => void) {\n    this.isCapturingTransaction = true\n    fn()\n    this.isCapturingTransaction = false\n\n    const tr = this.capturedTransaction\n\n    this.capturedTransaction = null\n\n    return tr\n  }\n\n  /**\n   * The callback over which to send transactions (state updates) produced by the view.\n   *\n   * @param transaction An editor state transaction\n   */\n  private dispatchTransaction(transaction: Transaction): void {\n    // if the editor / the view of the editor was destroyed\n    // the transaction should not be dispatched as there is no view anymore.\n    if (this.view.isDestroyed) {\n      return\n    }\n\n    if (this.isCapturingTransaction) {\n      if (!this.capturedTransaction) {\n        this.capturedTransaction = transaction\n\n        return\n      }\n\n      transaction.steps.forEach(step => this.capturedTransaction?.step(step))\n\n      return\n    }\n\n    // Apply transaction and get resulting state and transactions\n    const { state, transactions } = this.state.applyTransaction(transaction)\n    const selectionHasChanged = !this.state.selection.eq(state.selection)\n    const rootTrWasApplied = transactions.includes(transaction)\n    const prevState = this.state\n\n    this.emit('beforeTransaction', {\n      editor: this,\n      transaction,\n      nextState: state,\n    })\n\n    // If transaction was filtered out, we can return early\n    if (!rootTrWasApplied) {\n      return\n    }\n\n    this.view.updateState(state)\n\n    // Emit transaction event with appended transactions info\n    this.emit('transaction', {\n      editor: this,\n      transaction,\n      appendedTransactions: transactions.slice(1),\n    })\n\n    if (selectionHasChanged) {\n      this.emit('selectionUpdate', {\n        editor: this,\n        transaction,\n      })\n    }\n\n    // Only emit the latest between focus and blur events\n    const mostRecentFocusTr = transactions.findLast(tr => tr.getMeta('focus') || tr.getMeta('blur'))\n    const focus = mostRecentFocusTr?.getMeta('focus')\n    const blur = mostRecentFocusTr?.getMeta('blur')\n\n    if (focus) {\n      this.emit('focus', {\n        editor: this,\n        event: focus.event,\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        transaction: mostRecentFocusTr!,\n      })\n    }\n\n    if (blur) {\n      this.emit('blur', {\n        editor: this,\n        event: blur.event,\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        transaction: mostRecentFocusTr!,\n      })\n    }\n\n    // Compare states for update event\n    if (\n      transaction.getMeta('preventUpdate') ||\n      !transactions.some(tr => tr.docChanged) ||\n      prevState.doc.eq(state.doc)\n    ) {\n      return\n    }\n\n    this.emit('update', {\n      editor: this,\n      transaction,\n      appendedTransactions: transactions.slice(1),\n    })\n  }\n\n  /**\n   * Get attributes of the currently selected node or mark.\n   */\n  public getAttributes(nameOrType: string | NodeType | MarkType): Record<string, any> {\n    return getAttributes(this.state, nameOrType)\n  }\n\n  /**\n   * Returns if the currently selected node or mark is active.\n   *\n   * @param name Name of the node or mark\n   * @param attributes Attributes of the node or mark\n   */\n  public isActive(name: string, attributes?: {}): boolean\n  public isActive(attributes: {}): boolean\n  public isActive(nameOrAttributes: string, attributesOrUndefined?: {}): boolean {\n    const name = typeof nameOrAttributes === 'string' ? nameOrAttributes : null\n\n    const attributes = typeof nameOrAttributes === 'string' ? attributesOrUndefined : nameOrAttributes\n\n    return isActive(this.state, name, attributes)\n  }\n\n  /**\n   * Get the document as JSON.\n   */\n  public getJSON(): DocumentType<\n    Record<string, any> | undefined,\n    TNodeType<string, undefined | Record<string, any>, any, (TNodeType | TTextType)[]>[]\n  > {\n    return this.state.doc.toJSON()\n  }\n\n  /**\n   * Get the document as HTML.\n   */\n  public getHTML(): string {\n    return getHTMLFromFragment(this.state.doc.content, this.schema)\n  }\n\n  /**\n   * Get the document as text.\n   */\n  public getText(options?: { blockSeparator?: string; textSerializers?: Record<string, TextSerializer> }): string {\n    const { blockSeparator = '\\n\\n', textSerializers = {} } = options || {}\n\n    return getText(this.state.doc, {\n      blockSeparator,\n      textSerializers: {\n        ...getTextSerializersFromSchema(this.schema),\n        ...textSerializers,\n      },\n    })\n  }\n\n  /**\n   * Check if there is no content.\n   */\n  public get isEmpty(): boolean {\n    return isNodeEmpty(this.state.doc)\n  }\n\n  /**\n   * Destroy the editor.\n   */\n  public destroy(): void {\n    this.emit('destroy')\n\n    this.unmount()\n\n    this.removeAllListeners()\n  }\n\n  /**\n   * Check if the editor is already destroyed.\n   */\n  public get isDestroyed(): boolean {\n    return this.editorView?.isDestroyed ?? true\n  }\n\n  public $node(selector: string, attributes?: { [key: string]: any }): NodePos | null {\n    return this.$doc?.querySelector(selector, attributes) || null\n  }\n\n  public $nodes(selector: string, attributes?: { [key: string]: any }): NodePos[] | null {\n    return this.$doc?.querySelectorAll(selector, attributes) || null\n  }\n\n  public $pos(pos: number) {\n    const $pos = this.state.doc.resolve(pos)\n\n    return new NodePos($pos, this)\n  }\n\n  get $doc() {\n    return this.$pos(0)\n  }\n\n  /**\n   * Returns a set of utilities for working with positions and ranges.\n   */\n  public utils: Utils = {\n    getUpdatedPosition,\n    createMappablePosition,\n  }\n}\n","type StringKeyOf<T> = Extract<keyof T, string>\ntype CallbackType<T extends Record<string, any>, EventName extends StringKeyOf<T>> = T[EventName] extends any[]\n  ? T[EventName]\n  : [T[EventName]]\ntype CallbackFunction<T extends Record<string, any>, EventName extends StringKeyOf<T>> = (\n  ...props: CallbackType<T, EventName>\n) => any\n\nexport class EventEmitter<T extends Record<string, any>> {\n  private callbacks: { [key: string]: Array<(...args: any[]) => void> } = {}\n\n  public on<EventName extends StringKeyOf<T>>(event: EventName, fn: CallbackFunction<T, EventName>): this {\n    if (!this.callbacks[event]) {\n      this.callbacks[event] = []\n    }\n\n    this.callbacks[event].push(fn)\n\n    return this\n  }\n\n  public emit<EventName extends StringKeyOf<T>>(event: EventName, ...args: CallbackType<T, EventName>): this {\n    const callbacks = this.callbacks[event]\n\n    if (callbacks) {\n      callbacks.forEach(callback => callback.apply(this, args))\n    }\n\n    return this\n  }\n\n  public off<EventName extends StringKeyOf<T>>(event: EventName, fn?: CallbackFunction<T, EventName>): this {\n    const callbacks = this.callbacks[event]\n\n    if (callbacks) {\n      if (fn) {\n        this.callbacks[event] = callbacks.filter(callback => callback !== fn)\n      } else {\n        delete this.callbacks[event]\n      }\n    }\n\n    return this\n  }\n\n  public once<EventName extends StringKeyOf<T>>(event: EventName, fn: CallbackFunction<T, EventName>): this {\n    const onceFn = (...args: CallbackType<T, EventName>) => {\n      this.off(event, onceFn)\n      fn.apply(this, args)\n    }\n\n    return this.on(event, onceFn)\n  }\n\n  public removeAllListeners(): void {\n    this.callbacks = {}\n  }\n}\n","import { keymap } from '@tiptap/pm/keymap'\nimport type { Schema } from '@tiptap/pm/model'\nimport type { Plugin, Transaction } from '@tiptap/pm/state'\nimport type { MarkViewConstructor, NodeViewConstructor } from '@tiptap/pm/view'\n\nimport type { Editor } from './Editor.js'\nimport {\n  flattenExtensions,\n  getAttributesFromExtensions,\n  getExtensionField,\n  getNodeType,\n  getRenderedAttributes,\n  getSchemaByResolvedExtensions,\n  getSchemaTypeByName,\n  isExtensionRulesEnabled,\n  resolveExtensions,\n  sortExtensions,\n  splitExtensions,\n} from './helpers/index.js'\nimport { type MarkConfig, type NodeConfig, type Storage, getMarkType, updateMarkViewAttributes } from './index.js'\nimport { inputRulesPlugin } from './InputRule.js'\nimport { Mark } from './Mark.js'\nimport { pasteRulesPlugin } from './PasteRule.js'\nimport type { AnyConfig, Extensions, RawCommands } from './types.js'\nimport { callOrReturn } from './utilities/callOrReturn.js'\n\nexport class ExtensionManager {\n  editor: Editor\n\n  schema: Schema\n\n  /**\n   * A flattened and sorted array of all extensions\n   */\n  extensions: Extensions\n\n  /**\n   * A non-flattened array of base extensions (no sub-extensions)\n   */\n  baseExtensions: Extensions\n\n  splittableMarks: string[] = []\n\n  constructor(extensions: Extensions, editor: Editor) {\n    this.editor = editor\n    this.baseExtensions = extensions\n    this.extensions = resolveExtensions(extensions)\n    this.schema = getSchemaByResolvedExtensions(this.extensions, editor)\n    this.setupExtensions()\n  }\n\n  static resolve = resolveExtensions\n\n  static sort = sortExtensions\n\n  static flatten = flattenExtensions\n\n  /**\n   * Get all commands from the extensions.\n   * @returns An object with all commands where the key is the command name and the value is the command function\n   */\n  get commands(): RawCommands {\n    return this.extensions.reduce((commands, extension) => {\n      const context = {\n        name: extension.name,\n        options: extension.options,\n        storage: this.editor.extensionStorage[extension.name as keyof Storage],\n        editor: this.editor,\n        type: getSchemaTypeByName(extension.name, this.schema),\n      }\n\n      const addCommands = getExtensionField<AnyConfig['addCommands']>(extension, 'addCommands', context)\n\n      if (!addCommands) {\n        return commands\n      }\n\n      return {\n        ...commands,\n        ...addCommands(),\n      }\n    }, {} as RawCommands)\n  }\n\n  /**\n   * Get all registered Prosemirror plugins from the extensions.\n   * @returns An array of Prosemirror plugins\n   */\n  get plugins(): Plugin[] {\n    const { editor } = this\n\n    // With ProseMirror, first plugins within an array are executed first.\n    // In Tiptap, we provide the ability to override plugins,\n    // so it feels more natural to run plugins at the end of an array first.\n    // Thats why we have to reverse the `extensions` array and sort again\n    // based on the `priority` option.\n    const extensions = sortExtensions([...this.extensions].reverse())\n\n    const allPlugins = extensions.flatMap(extension => {\n      const context = {\n        name: extension.name,\n        options: extension.options,\n        storage: this.editor.extensionStorage[extension.name as keyof Storage],\n        editor,\n        type: getSchemaTypeByName(extension.name, this.schema),\n      }\n\n      const plugins: Plugin[] = []\n\n      const addKeyboardShortcuts = getExtensionField<AnyConfig['addKeyboardShortcuts']>(\n        extension,\n        'addKeyboardShortcuts',\n        context,\n      )\n\n      let defaultBindings: Record<string, () => boolean> = {}\n\n      // bind exit handling\n      if (extension.type === 'mark' && getExtensionField<MarkConfig['exitable']>(extension, 'exitable', context)) {\n        defaultBindings.ArrowRight = () => Mark.handleExit({ editor, mark: extension as Mark })\n      }\n\n      if (addKeyboardShortcuts) {\n        const bindings = Object.fromEntries(\n          Object.entries(addKeyboardShortcuts()).map(([shortcut, method]) => {\n            return [shortcut, () => method({ editor })]\n          }),\n        )\n\n        defaultBindings = { ...defaultBindings, ...bindings }\n      }\n\n      const keyMapPlugin = keymap(defaultBindings)\n\n      plugins.push(keyMapPlugin)\n\n      const addInputRules = getExtensionField<AnyConfig['addInputRules']>(extension, 'addInputRules', context)\n\n      if (isExtensionRulesEnabled(extension, editor.options.enableInputRules) && addInputRules) {\n        const rules = addInputRules()\n\n        if (rules && rules.length) {\n          const inputResult = inputRulesPlugin({\n            editor,\n            rules,\n          })\n\n          const inputPlugins = Array.isArray(inputResult) ? inputResult : [inputResult]\n\n          plugins.push(...inputPlugins)\n        }\n      }\n\n      const addPasteRules = getExtensionField<AnyConfig['addPasteRules']>(extension, 'addPasteRules', context)\n\n      if (isExtensionRulesEnabled(extension, editor.options.enablePasteRules) && addPasteRules) {\n        const rules = addPasteRules()\n\n        if (rules && rules.length) {\n          const pasteRules = pasteRulesPlugin({ editor, rules })\n\n          plugins.push(...pasteRules)\n        }\n      }\n\n      const addProseMirrorPlugins = getExtensionField<AnyConfig['addProseMirrorPlugins']>(\n        extension,\n        'addProseMirrorPlugins',\n        context,\n      )\n\n      if (addProseMirrorPlugins) {\n        const proseMirrorPlugins = addProseMirrorPlugins()\n\n        plugins.push(...proseMirrorPlugins)\n      }\n\n      return plugins\n    })\n\n    return allPlugins\n  }\n\n  /**\n   * Get all attributes from the extensions.\n   * @returns An array of attributes\n   */\n  get attributes() {\n    return getAttributesFromExtensions(this.extensions)\n  }\n\n  /**\n   * Get all node views from the extensions.\n   * @returns An object with all node views where the key is the node name and the value is the node view function\n   */\n  get nodeViews(): Record<string, NodeViewConstructor> {\n    const { editor } = this\n    const { nodeExtensions } = splitExtensions(this.extensions)\n\n    return Object.fromEntries(\n      nodeExtensions\n        .filter(extension => !!getExtensionField(extension, 'addNodeView'))\n        .map(extension => {\n          const extensionAttributes = this.attributes.filter(attribute => attribute.type === extension.name)\n          const context = {\n            name: extension.name,\n            options: extension.options,\n            storage: this.editor.extensionStorage[extension.name as keyof Storage],\n            editor,\n            type: getNodeType(extension.name, this.schema),\n          }\n          const addNodeView = getExtensionField<NodeConfig['addNodeView']>(extension, 'addNodeView', context)\n\n          if (!addNodeView) {\n            return []\n          }\n\n          const nodeViewResult = addNodeView()\n\n          if (!nodeViewResult) {\n            return []\n          }\n\n          const nodeview: NodeViewConstructor = (node, view, getPos, decorations, innerDecorations) => {\n            const HTMLAttributes = getRenderedAttributes(node, extensionAttributes)\n\n            return nodeViewResult({\n              // pass-through\n              node,\n              view,\n              getPos: getPos as () => number,\n              decorations,\n              innerDecorations,\n              // tiptap-specific\n              editor,\n              extension,\n              HTMLAttributes,\n            })\n          }\n\n          return [extension.name, nodeview]\n        }),\n    )\n  }\n\n  /**\n   * Get the composed dispatchTransaction function from all extensions.\n   * @param baseDispatch The base dispatch function (e.g. from the editor or user props)\n   * @returns A composed dispatch function\n   */\n  dispatchTransaction(baseDispatch: (tr: Transaction) => void): (tr: Transaction) => void {\n    const { editor } = this\n    const extensions = sortExtensions([...this.extensions].reverse())\n\n    return extensions.reduceRight((next, extension) => {\n      const context = {\n        name: extension.name,\n        options: extension.options,\n        storage: this.editor.extensionStorage[extension.name as keyof Storage],\n        editor,\n        type: getSchemaTypeByName(extension.name, this.schema),\n      }\n\n      const dispatchTransaction = getExtensionField<AnyConfig['dispatchTransaction']>(\n        extension,\n        'dispatchTransaction',\n        context,\n      )\n\n      if (!dispatchTransaction) {\n        return next\n      }\n\n      return (transaction: Transaction) => {\n        dispatchTransaction.call(context, { transaction, next })\n      }\n    }, baseDispatch)\n  }\n\n  get markViews(): Record<string, MarkViewConstructor> {\n    const { editor } = this\n    const { markExtensions } = splitExtensions(this.extensions)\n\n    return Object.fromEntries(\n      markExtensions\n        .filter(extension => !!getExtensionField(extension, 'addMarkView'))\n        .map(extension => {\n          const extensionAttributes = this.attributes.filter(attribute => attribute.type === extension.name)\n          const context = {\n            name: extension.name,\n            options: extension.options,\n            storage: this.editor.extensionStorage[extension.name as keyof Storage],\n            editor,\n            type: getMarkType(extension.name, this.schema),\n          }\n          const addMarkView = getExtensionField<MarkConfig['addMarkView']>(extension, 'addMarkView', context)\n\n          if (!addMarkView) {\n            return []\n          }\n\n          const markView: MarkViewConstructor = (mark, view, inline) => {\n            const HTMLAttributes = getRenderedAttributes(mark, extensionAttributes)\n\n            return addMarkView()({\n              // pass-through\n              mark,\n              view,\n              inline,\n              // tiptap-specific\n              editor,\n              extension,\n              HTMLAttributes,\n              updateAttributes: (attrs: Record<string, any>) => {\n                updateMarkViewAttributes(mark, editor, attrs)\n              },\n            })\n          }\n\n          return [extension.name, markView]\n        }),\n    )\n  }\n\n  /**\n   * Go through all extensions, create extension storages & setup marks\n   * & bind editor event listener.\n   */\n  private setupExtensions() {\n    const extensions = this.extensions\n    // re-initialize the extension storage object instance\n    this.editor.extensionStorage = Object.fromEntries(\n      extensions.map(extension => [extension.name, extension.storage]),\n    ) as unknown as Storage\n\n    extensions.forEach(extension => {\n      const context = {\n        name: extension.name,\n        options: extension.options,\n        storage: this.editor.extensionStorage[extension.name as keyof Storage],\n        editor: this.editor,\n        type: getSchemaTypeByName(extension.name, this.schema),\n      }\n\n      if (extension.type === 'mark') {\n        const keepOnSplit = callOrReturn(getExtensionField(extension, 'keepOnSplit', context)) ?? true\n\n        if (keepOnSplit) {\n          this.splittableMarks.push(extension.name)\n        }\n      }\n\n      const onBeforeCreate = getExtensionField<AnyConfig['onBeforeCreate']>(extension, 'onBeforeCreate', context)\n      const onCreate = getExtensionField<AnyConfig['onCreate']>(extension, 'onCreate', context)\n      const onUpdate = getExtensionField<AnyConfig['onUpdate']>(extension, 'onUpdate', context)\n      const onSelectionUpdate = getExtensionField<AnyConfig['onSelectionUpdate']>(\n        extension,\n        'onSelectionUpdate',\n        context,\n      )\n      const onTransaction = getExtensionField<AnyConfig['onTransaction']>(extension, 'onTransaction', context)\n      const onFocus = getExtensionField<AnyConfig['onFocus']>(extension, 'onFocus', context)\n      const onBlur = getExtensionField<AnyConfig['onBlur']>(extension, 'onBlur', context)\n      const onDestroy = getExtensionField<AnyConfig['onDestroy']>(extension, 'onDestroy', context)\n\n      if (onBeforeCreate) {\n        this.editor.on('beforeCreate', onBeforeCreate)\n      }\n\n      if (onCreate) {\n        this.editor.on('create', onCreate)\n      }\n\n      if (onUpdate) {\n        this.editor.on('update', onUpdate)\n      }\n\n      if (onSelectionUpdate) {\n        this.editor.on('selectionUpdate', onSelectionUpdate)\n      }\n\n      if (onTransaction) {\n        this.editor.on('transaction', onTransaction)\n      }\n\n      if (onFocus) {\n        this.editor.on('focus', onFocus)\n      }\n\n      if (onBlur) {\n        this.editor.on('blur', onBlur)\n      }\n\n      if (onDestroy) {\n        this.editor.on('destroy', onDestroy)\n      }\n    })\n  }\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\nimport { Fragment } from '@tiptap/pm/model'\nimport type { EditorState, TextSelection } from '@tiptap/pm/state'\nimport { Plugin } from '@tiptap/pm/state'\n\nimport { CommandManager } from './CommandManager.js'\nimport type { Editor } from './Editor.js'\nimport { createChainableState } from './helpers/createChainableState.js'\nimport { getHTMLFromFragment } from './helpers/getHTMLFromFragment.js'\nimport { getTextContentFromNodes } from './helpers/getTextContentFromNodes.js'\nimport type { CanCommands, ChainedCommands, ExtendedRegExpMatchArray, Range, SingleCommands } from './types.js'\nimport { isRegExp } from './utilities/isRegExp.js'\n\nexport type InputRuleMatch = {\n  index: number\n  text: string\n  replaceWith?: string\n  match?: RegExpMatchArray\n  data?: Record<string, any>\n}\n\nexport type InputRuleFinder = RegExp | ((text: string) => InputRuleMatch | null)\n\nexport class InputRule {\n  find: InputRuleFinder\n\n  handler: (props: {\n    state: EditorState\n    range: Range\n    match: ExtendedRegExpMatchArray\n    commands: SingleCommands\n    chain: () => ChainedCommands\n    can: () => CanCommands\n  }) => void | null\n\n  undoable: boolean\n\n  constructor(config: {\n    find: InputRuleFinder\n    handler: (props: {\n      state: EditorState\n      range: Range\n      match: ExtendedRegExpMatchArray\n      commands: SingleCommands\n      chain: () => ChainedCommands\n      can: () => CanCommands\n    }) => void | null\n    undoable?: boolean\n  }) {\n    this.find = config.find\n    this.handler = config.handler\n    this.undoable = config.undoable ?? true\n  }\n}\n\nconst inputRuleMatcherHandler = (text: string, find: InputRuleFinder): ExtendedRegExpMatchArray | null => {\n  if (isRegExp(find)) {\n    return find.exec(text)\n  }\n\n  const inputRuleMatch = find(text)\n\n  if (!inputRuleMatch) {\n    return null\n  }\n\n  const result: ExtendedRegExpMatchArray = [inputRuleMatch.text]\n\n  result.index = inputRuleMatch.index\n  result.input = text\n  result.data = inputRuleMatch.data\n\n  if (inputRuleMatch.replaceWith) {\n    if (!inputRuleMatch.text.includes(inputRuleMatch.replaceWith)) {\n      console.warn('[tiptap warn]: \"inputRuleMatch.replaceWith\" must be part of \"inputRuleMatch.text\".')\n    }\n\n    result.push(inputRuleMatch.replaceWith)\n  }\n\n  return result\n}\n\nfunction run(config: {\n  editor: Editor\n  from: number\n  to: number\n  text: string\n  rules: InputRule[]\n  plugin: Plugin\n}): boolean {\n  const { editor, from, to, text, rules, plugin } = config\n  const { view } = editor\n\n  if (view.composing) {\n    return false\n  }\n\n  const $from = view.state.doc.resolve(from)\n\n  if (\n    // check for code node\n    $from.parent.type.spec.code ||\n    // check for code mark\n    !!($from.nodeBefore || $from.nodeAfter)?.marks.find(mark => mark.type.spec.code)\n  ) {\n    return false\n  }\n\n  let matched = false\n\n  const textBefore = getTextContentFromNodes($from) + text\n\n  rules.forEach(rule => {\n    if (matched) {\n      return\n    }\n\n    const match = inputRuleMatcherHandler(textBefore, rule.find)\n\n    if (!match) {\n      return\n    }\n\n    const tr = view.state.tr\n    const state = createChainableState({\n      state: view.state,\n      transaction: tr,\n    })\n    const range = {\n      from: from - (match[0].length - text.length),\n      to,\n    }\n\n    const { commands, chain, can } = new CommandManager({\n      editor,\n      state,\n    })\n\n    const handler = rule.handler({\n      state,\n      range,\n      match,\n      commands,\n      chain,\n      can,\n    })\n\n    // stop if there are no changes\n    if (handler === null || !tr.steps.length) {\n      return\n    }\n\n    // store transform as meta data\n    // so we can undo input rules within the `undoInputRules` command\n    if (rule.undoable) {\n      tr.setMeta(plugin, {\n        transform: tr,\n        from,\n        to,\n        text,\n      })\n    }\n\n    view.dispatch(tr)\n    matched = true\n  })\n\n  return matched\n}\n\n/**\n * Create an input rules plugin. When enabled, it will cause text\n * input that matches any of the given rules to trigger the rules\n * action.\n */\nexport function inputRulesPlugin(props: { editor: Editor; rules: InputRule[] }): Plugin {\n  const { editor, rules } = props\n  const plugin = new Plugin({\n    state: {\n      init() {\n        return null\n      },\n      apply(tr, prev, state) {\n        const stored = tr.getMeta(plugin)\n\n        if (stored) {\n          return stored\n        }\n\n        // if InputRule is triggered by insertContent()\n        const simulatedInputMeta = tr.getMeta('applyInputRules') as\n          | undefined\n          | {\n              from: number\n              text: string | ProseMirrorNode | Fragment\n            }\n        const isSimulatedInput = !!simulatedInputMeta\n\n        if (isSimulatedInput) {\n          setTimeout(() => {\n            let { text } = simulatedInputMeta\n\n            if (typeof text === 'string') {\n              text = text as string\n            } else {\n              text = getHTMLFromFragment(Fragment.from(text), state.schema)\n            }\n\n            const { from } = simulatedInputMeta\n            const to = from + text.length\n\n            run({\n              editor,\n              from,\n              to,\n              text,\n              rules,\n              plugin,\n            })\n          })\n        }\n\n        return tr.selectionSet || tr.docChanged ? null : prev\n      },\n    },\n\n    props: {\n      handleTextInput(view, from, to, text) {\n        return run({\n          editor,\n          from,\n          to,\n          text,\n          rules,\n          plugin,\n        })\n      },\n\n      handleDOMEvents: {\n        compositionend: view => {\n          setTimeout(() => {\n            const { $cursor } = view.state.selection as TextSelection\n\n            if ($cursor) {\n              run({\n                editor,\n                from: $cursor.pos,\n                to: $cursor.pos,\n                text: '',\n                rules,\n                plugin,\n              })\n            }\n          })\n\n          return false\n        },\n      },\n\n      // add support for input rules to trigger on enter\n      // this is useful for example for code blocks\n      handleKeyDown(view, event) {\n        if (event.key !== 'Enter') {\n          return false\n        }\n\n        const { $cursor } = view.state.selection as TextSelection\n\n        if ($cursor) {\n          return run({\n            editor,\n            from: $cursor.pos,\n            to: $cursor.pos,\n            text: '\\n',\n            rules,\n            plugin,\n          })\n        }\n\n        return false\n      },\n    },\n\n    // @ts-ignore\n    isInputRules: true,\n  }) as Plugin\n\n  return plugin\n}\n","// see: https://github.com/mesqueeb/is-what/blob/88d6e4ca92fb2baab6003c54e02eedf4e729e5ab/src/index.ts\n\nfunction getType(value: any): string {\n  return Object.prototype.toString.call(value).slice(8, -1)\n}\n\nexport function isPlainObject(value: any): value is Record<string, any> {\n  if (getType(value) !== 'Object') {\n    return false\n  }\n\n  return value.constructor === Object && Object.getPrototypeOf(value) === Object.prototype\n}\n","import { isPlainObject } from './isPlainObject.js'\n\nexport function mergeDeep(target: Record<string, any>, source: Record<string, any>): Record<string, any> {\n  const output = { ...target }\n\n  if (isPlainObject(target) && isPlainObject(source)) {\n    Object.keys(source).forEach(key => {\n      if (isPlainObject(source[key]) && isPlainObject(target[key])) {\n        output[key] = mergeDeep(target[key], source[key])\n      } else {\n        output[key] = source[key]\n      }\n    })\n  }\n\n  return output\n}\n","import type { Plugin } from '@tiptap/pm/state'\n\nimport type { Editor } from './Editor.js'\nimport { getExtensionField } from './helpers/getExtensionField.js'\nimport type { ExtensionConfig, MarkConfig, NodeConfig } from './index.js'\nimport type { InputRule } from './InputRule.js'\nimport type { Mark } from './Mark.js'\nimport type { Node } from './Node.js'\nimport type { PasteRule } from './PasteRule.js'\nimport type {\n  AnyConfig,\n  DispatchTransactionProps,\n  EditorEvents,\n  Extensions,\n  GlobalAttributes,\n  JSONContent,\n  KeyboardShortcutCommand,\n  MarkdownParseHelpers,\n  MarkdownParseResult,\n  MarkdownRendererHelpers,\n  MarkdownToken,\n  MarkdownTokenizer,\n  ParentConfig,\n  RawCommands,\n  RenderContext,\n} from './types.js'\nimport { callOrReturn } from './utilities/callOrReturn.js'\nimport { mergeDeep } from './utilities/mergeDeep.js'\n\nexport interface ExtendableConfig<\n  Options = any,\n  Storage = any,\n  Config extends\n    | ExtensionConfig<Options, Storage>\n    | NodeConfig<Options, Storage>\n    | MarkConfig<Options, Storage>\n    | ExtendableConfig<Options, Storage> = ExtendableConfig<Options, Storage, any, any>,\n  PMType = any,\n> {\n  /**\n   * The extension name - this must be unique.\n   * It will be used to identify the extension.\n   *\n   * @example 'myExtension'\n   */\n  name: string\n\n  /**\n   * The priority of your extension. The higher, the earlier it will be called\n   * and will take precedence over other extensions with a lower priority.\n   * @default 100\n   * @example 101\n   */\n  priority?: number\n\n  /**\n   * This method will add options to this extension\n   * @see https://tiptap.dev/docs/editor/guide/custom-extensions#settings\n   * @example\n   * addOptions() {\n   *  return {\n   *    myOption: 'foo',\n   *    myOtherOption: 10,\n   * }\n   */\n  addOptions?: (this: { name: string; parent: ParentConfig<Config>['addOptions'] }) => Options\n\n  /**\n   * The default storage this extension can save data to.\n   * @see https://tiptap.dev/docs/editor/guide/custom-extensions#storage\n   * @example\n   * defaultStorage: {\n   *   prefetchedUsers: [],\n   *   loading: false,\n   * }\n   */\n  addStorage?: (this: { name: string; options: Options; parent: ParentConfig<Config>['addStorage'] }) => Storage\n\n  /**\n   * This function adds globalAttributes to specific nodes.\n   * @see https://tiptap.dev/docs/editor/guide/custom-extensions#global-attributes\n   * @example\n   * addGlobalAttributes() {\n   *   return [\n   *     {\n           // Extend the following extensions\n   *       types: [\n   *         'heading',\n   *         'paragraph',\n   *       ],\n   *       //  with those attributes\n   *       attributes: {\n   *         textAlign: {\n   *           default: 'left',\n   *           renderHTML: attributes => ({\n   *             style: `text-align: ${attributes.textAlign}`,\n   *           }),\n   *           parseHTML: element => element.style.textAlign || 'left',\n   *         },\n   *       },\n   *     },\n   *   ]\n   * }\n   */\n  addGlobalAttributes?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    extensions: (Node | Mark)[]\n    parent: ParentConfig<Config>['addGlobalAttributes']\n  }) => GlobalAttributes\n\n  /**\n   * This function adds commands to the editor\n   * @see https://tiptap.dev/docs/editor/guide/custom-extensions#commands\n   * @example\n   * addCommands() {\n   *   return {\n   *     myCommand: () => ({ chain }) => chain().setMark('type', 'foo').run(),\n   *   }\n   * }\n   */\n  addCommands?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    editor: Editor\n    type: PMType\n    parent: ParentConfig<Config>['addCommands']\n  }) => Partial<RawCommands>\n\n  /**\n   * This function registers keyboard shortcuts.\n   * @see https://tiptap.dev/docs/editor/guide/custom-extensions#keyboard-shortcuts\n   * @example\n   * addKeyboardShortcuts() {\n   *   return {\n   *     'Mod-l': () => this.editor.commands.toggleBulletList(),\n   *   }\n   * },\n   */\n  addKeyboardShortcuts?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    editor: Editor\n    type: PMType\n    parent: ParentConfig<Config>['addKeyboardShortcuts']\n  }) => {\n    [key: string]: KeyboardShortcutCommand\n  }\n\n  /**\n   * This function adds input rules to the editor.\n   * @see https://tiptap.dev/docs/editor/guide/custom-extensions#input-rules\n   * @example\n   * addInputRules() {\n   *   return [\n   *     markInputRule({\n   *       find: inputRegex,\n   *       type: this.type,\n   *     }),\n   *   ]\n   * },\n   */\n  addInputRules?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    editor: Editor\n    type: PMType\n    parent: ParentConfig<Config>['addInputRules']\n  }) => InputRule[]\n\n  /**\n   * This function adds paste rules to the editor.\n   * @see https://tiptap.dev/docs/editor/guide/custom-extensions#paste-rules\n   * @example\n   * addPasteRules() {\n   *   return [\n   *     markPasteRule({\n   *       find: pasteRegex,\n   *       type: this.type,\n   *     }),\n   *   ]\n   * },\n   */\n  addPasteRules?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    editor: Editor\n    type: PMType\n    parent: ParentConfig<Config>['addPasteRules']\n  }) => PasteRule[]\n\n  /**\n   * This function adds Prosemirror plugins to the editor\n   * @see https://tiptap.dev/docs/editor/guide/custom-extensions#prosemirror-plugins\n   * @example\n   * addProseMirrorPlugins() {\n   *   return [\n   *     customPlugin(),\n   *   ]\n   * }\n   */\n  addProseMirrorPlugins?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    editor: Editor\n    type: PMType\n    parent: ParentConfig<Config>['addProseMirrorPlugins']\n  }) => Plugin[]\n\n  /**\n   * This function adds additional extensions to the editor. This is useful for\n   * building extension kits.\n   * @example\n   * addExtensions() {\n   *   return [\n   *     BulletList,\n   *     OrderedList,\n   *     ListItem\n   *   ]\n   * }\n   */\n  addExtensions?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    parent: ParentConfig<Config>['addExtensions']\n  }) => Extensions\n\n  /**\n   * The markdown token name\n   *\n   * This is the name of the token that this extension uses to parse and render markdown and comes from the Marked Lexer.\n   *\n   * @see https://github.com/markedjs/marked/blob/master/src/Tokens.ts\n   *\n   */\n  markdownTokenName?: string\n\n  /**\n   * The parse function used by the markdown parser to convert markdown tokens to ProseMirror nodes.\n   */\n  parseMarkdown?: (token: MarkdownToken, helpers: MarkdownParseHelpers) => MarkdownParseResult\n\n  /**\n   * The serializer function used by the markdown serializer to convert ProseMirror nodes to markdown tokens.\n   */\n  renderMarkdown?: (node: JSONContent, helpers: MarkdownRendererHelpers, ctx: RenderContext) => string\n\n  /**\n   * The markdown tokenizer responsible for turning a markdown string into tokens\n   *\n   * Custom tokenizers are only needed when you want to parse non-standard markdown token.\n   */\n  markdownTokenizer?: MarkdownTokenizer\n\n  /**\n   * Optional markdown options for indentation\n   */\n  markdownOptions?: {\n    /**\n     * Defines if this markdown element should indent it's child elements\n     */\n    indentsContent?: boolean\n  }\n\n  /**\n   * This function extends the schema of the node.\n   * @example\n   * extendNodeSchema() {\n   *   return {\n   *     group: 'inline',\n   *     selectable: false,\n   *   }\n   * }\n   */\n  extendNodeSchema?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          parent: ParentConfig<Config>['extendNodeSchema']\n        },\n        extension: Node,\n      ) => Record<string, any>)\n    | null\n\n  /**\n   * This function extends the schema of the mark.\n   * @example\n   * extendMarkSchema() {\n   *   return {\n   *     group: 'inline',\n   *     selectable: false,\n   *   }\n   * }\n   */\n  extendMarkSchema?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          parent: ParentConfig<Config>['extendMarkSchema']\n        },\n        extension: Mark,\n      ) => Record<string, any>)\n    | null\n\n  /**\n   * The editor is not ready yet.\n   */\n  onBeforeCreate?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['onBeforeCreate']\n        },\n        event: EditorEvents['beforeCreate'],\n      ) => void)\n    | null\n\n  /**\n   * The editor is ready.\n   */\n  onCreate?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['onCreate']\n        },\n        event: EditorEvents['create'],\n      ) => void)\n    | null\n\n  /**\n   * The content has changed.\n   */\n  onUpdate?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['onUpdate']\n        },\n        event: EditorEvents['update'],\n      ) => void)\n    | null\n\n  /**\n   * The selection has changed.\n   */\n  onSelectionUpdate?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['onSelectionUpdate']\n        },\n        event: EditorEvents['selectionUpdate'],\n      ) => void)\n    | null\n\n  /**\n   * The editor state has changed.\n   */\n  onTransaction?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['onTransaction']\n        },\n        event: EditorEvents['transaction'],\n      ) => void)\n    | null\n\n  /**\n   * The editor is focused.\n   */\n  onFocus?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['onFocus']\n        },\n        event: EditorEvents['focus'],\n      ) => void)\n    | null\n\n  /**\n   * The editor isnt focused anymore.\n   */\n  onBlur?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['onBlur']\n        },\n        event: EditorEvents['blur'],\n      ) => void)\n    | null\n\n  /**\n   * The editor is destroyed.\n   */\n  onDestroy?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['onDestroy']\n        },\n        event: EditorEvents['destroy'],\n      ) => void)\n    | null\n\n  /**\n   * This hook allows you to intercept and modify transactions before they are dispatched.\n   *\n   * Example\n   * ```ts\n   * dispatchTransaction({ transaction, next }) {\n   *   console.log('Dispatching transaction:', transaction)\n   *   next(transaction)\n   * }\n   * ```\n   *\n   * @param props - The dispatch transaction props\n   */\n  dispatchTransaction?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          editor: Editor\n          type: PMType\n          parent: ParentConfig<Config>['dispatchTransaction']\n        },\n        props: DispatchTransactionProps,\n      ) => void)\n    | null\n}\n\nexport class Extendable<\n  Options = any,\n  Storage = any,\n  Config = ExtensionConfig<Options, Storage> | NodeConfig<Options, Storage> | MarkConfig<Options, Storage>,\n> {\n  type = 'extendable'\n  parent: Extendable | null = null\n\n  child: Extendable | null = null\n\n  name = ''\n\n  config: Config = {\n    name: this.name,\n  } as Config\n\n  constructor(config: Partial<Config> = {}) {\n    this.config = {\n      ...this.config,\n      ...config,\n    }\n\n    this.name = (this.config as any).name\n  }\n\n  get options(): Options {\n    return {\n      ...(callOrReturn(\n        getExtensionField<AnyConfig['addOptions']>(this as any, 'addOptions', {\n          name: this.name,\n        }),\n      ) || {}),\n    }\n  }\n\n  get storage(): Readonly<Storage> {\n    return {\n      ...(callOrReturn(\n        getExtensionField<AnyConfig['addStorage']>(this as any, 'addStorage', {\n          name: this.name,\n          options: this.options,\n        }),\n      ) || {}),\n    }\n  }\n\n  configure(options: Partial<Options> = {}) {\n    const extension = this.extend<Options, Storage, Config>({\n      ...this.config,\n      addOptions: () => {\n        return mergeDeep(this.options as Record<string, any>, options) as Options\n      },\n    })\n\n    extension.name = this.name\n    extension.parent = this.parent\n\n    return extension\n  }\n\n  extend<\n    ExtendedOptions = Options,\n    ExtendedStorage = Storage,\n    ExtendedConfig =\n      | ExtensionConfig<ExtendedOptions, ExtendedStorage>\n      | NodeConfig<ExtendedOptions, ExtendedStorage>\n      | MarkConfig<ExtendedOptions, ExtendedStorage>,\n  >(extendedConfig: Partial<ExtendedConfig> = {}): Extendable<ExtendedOptions, ExtendedStorage> {\n    const extension = new (this.constructor as any)({ ...this.config, ...extendedConfig })\n\n    extension.parent = this\n    this.child = extension\n    extension.name = 'name' in extendedConfig ? extendedConfig.name : extension.parent.name\n\n    return extension\n  }\n}\n","import type { DOMOutputSpec, Mark as ProseMirrorMark, MarkSpec, MarkType } from '@tiptap/pm/model'\n\nimport type { Editor } from './Editor.js'\nimport type { ExtendableConfig } from './Extendable.js'\nimport { Extendable } from './Extendable.js'\nimport type { Attributes, MarkViewRenderer, ParentConfig } from './types.js'\n\nexport interface MarkConfig<Options = any, Storage = any>\n  extends ExtendableConfig<Options, Storage, MarkConfig<Options, Storage>, MarkType> {\n  /**\n   * Mark View\n   */\n  addMarkView?:\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        editor: Editor\n        type: MarkType\n        parent: ParentConfig<MarkConfig<Options, Storage>>['addMarkView']\n      }) => MarkViewRenderer)\n    | null\n\n  /**\n   * Keep mark after split node\n   */\n  keepOnSplit?: boolean | (() => boolean)\n\n  /**\n   * Inclusive\n   */\n  inclusive?:\n    | MarkSpec['inclusive']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<MarkConfig<Options, Storage>>['inclusive']\n        editor?: Editor\n      }) => MarkSpec['inclusive'])\n\n  /**\n   * Excludes\n   */\n  excludes?:\n    | MarkSpec['excludes']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<MarkConfig<Options, Storage>>['excludes']\n        editor?: Editor\n      }) => MarkSpec['excludes'])\n\n  /**\n   * Marks this Mark as exitable\n   */\n  exitable?: boolean | (() => boolean)\n\n  /**\n   * Group\n   */\n  group?:\n    | MarkSpec['group']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<MarkConfig<Options, Storage>>['group']\n        editor?: Editor\n      }) => MarkSpec['group'])\n\n  /**\n   * Spanning\n   */\n  spanning?:\n    | MarkSpec['spanning']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<MarkConfig<Options, Storage>>['spanning']\n        editor?: Editor\n      }) => MarkSpec['spanning'])\n\n  /**\n   * Code\n   */\n  code?:\n    | boolean\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<MarkConfig<Options, Storage>>['code']\n        editor?: Editor\n      }) => boolean)\n\n  /**\n   * Parse HTML\n   */\n  parseHTML?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    parent: ParentConfig<MarkConfig<Options, Storage>>['parseHTML']\n    editor?: Editor\n  }) => MarkSpec['parseDOM']\n\n  /**\n   * Render HTML\n   */\n  renderHTML?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          parent: ParentConfig<MarkConfig<Options, Storage>>['renderHTML']\n          editor?: Editor\n        },\n        props: {\n          mark: ProseMirrorMark\n          HTMLAttributes: Record<string, any>\n        },\n      ) => DOMOutputSpec)\n    | null\n\n  /**\n   * Attributes\n   */\n  addAttributes?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    parent: ParentConfig<MarkConfig<Options, Storage>>['addAttributes']\n    editor?: Editor\n    // eslint-disable-next-line @typescript-eslint/no-empty-object-type\n  }) => Attributes | {}\n}\n\n/**\n * The Mark class is used to create custom mark extensions.\n * @see https://tiptap.dev/api/extensions#create-a-new-extension\n */\nexport class Mark<Options = any, Storage = any> extends Extendable<Options, Storage, MarkConfig<Options, Storage>> {\n  type = 'mark'\n\n  /**\n   * Create a new Mark instance\n   * @param config - Mark configuration object or a function that returns a configuration object\n   */\n  static create<O = any, S = any>(config: Partial<MarkConfig<O, S>> | (() => Partial<MarkConfig<O, S>>) = {}) {\n    // If the config is a function, execute it to get the configuration object\n    const resolvedConfig = typeof config === 'function' ? config() : config\n    return new Mark<O, S>(resolvedConfig)\n  }\n\n  static handleExit({ editor, mark }: { editor: Editor; mark: Mark }) {\n    const { tr } = editor.state\n    const currentPos = editor.state.selection.$from\n    const isAtEnd = currentPos.pos === currentPos.end()\n\n    if (isAtEnd) {\n      const currentMarks = currentPos.marks()\n      const isInMark = !!currentMarks.find(m => m?.type.name === mark.name)\n\n      if (!isInMark) {\n        return false\n      }\n\n      const removeMark = currentMarks.find(m => m?.type.name === mark.name)\n\n      if (removeMark) {\n        tr.removeStoredMark(removeMark)\n      }\n      tr.insertText(' ', currentPos.pos)\n\n      editor.view.dispatch(tr)\n\n      return true\n    }\n\n    return false\n  }\n\n  configure(options?: Partial<Options>) {\n    return super.configure(options) as Mark<Options, Storage>\n  }\n\n  extend<\n    ExtendedOptions = Options,\n    ExtendedStorage = Storage,\n    ExtendedConfig extends MarkConfig<ExtendedOptions, ExtendedStorage> = MarkConfig<ExtendedOptions, ExtendedStorage>,\n  >(\n    extendedConfig?:\n      | (() => Partial<ExtendedConfig>)\n      | (Partial<ExtendedConfig> &\n          ThisType<{\n            name: string\n            options: ExtendedOptions\n            storage: ExtendedStorage\n            editor: Editor\n            type: MarkType\n          }>),\n  ): Mark<ExtendedOptions, ExtendedStorage> {\n    // If the extended config is a function, execute it to get the configuration object\n    const resolvedConfig = typeof extendedConfig === 'function' ? extendedConfig() : extendedConfig\n    return super.extend(resolvedConfig) as Mark<ExtendedOptions, ExtendedStorage>\n  }\n}\n","import type { Node as ProseMirrorNode } from '@tiptap/pm/model'\nimport { Fragment } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\nimport { Plugin } from '@tiptap/pm/state'\n\nimport { CommandManager } from './CommandManager.js'\nimport type { Editor } from './Editor.js'\nimport { createChainableState } from './helpers/createChainableState.js'\nimport { getHTMLFromFragment } from './helpers/getHTMLFromFragment.js'\nimport type { CanCommands, ChainedCommands, ExtendedRegExpMatchArray, Range, SingleCommands } from './types.js'\nimport { isNumber } from './utilities/isNumber.js'\nimport { isRegExp } from './utilities/isRegExp.js'\n\nexport type PasteRuleMatch = {\n  index: number\n  text: string\n  replaceWith?: string\n  match?: RegExpMatchArray\n  data?: Record<string, any>\n}\n\nexport type PasteRuleFinder =\n  | RegExp\n  | ((text: string, event?: ClipboardEvent | null) => PasteRuleMatch[] | null | undefined)\n\n/**\n * Paste rules are used to react to pasted content.\n * @see https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#paste-rules\n */\nexport class PasteRule {\n  find: PasteRuleFinder\n\n  handler: (props: {\n    state: EditorState\n    range: Range\n    match: ExtendedRegExpMatchArray\n    commands: SingleCommands\n    chain: () => ChainedCommands\n    can: () => CanCommands\n    pasteEvent: ClipboardEvent | null\n    dropEvent: DragEvent | null\n  }) => void | null\n\n  constructor(config: {\n    find: PasteRuleFinder\n    handler: (props: {\n      can: () => CanCommands\n      chain: () => ChainedCommands\n      commands: SingleCommands\n      dropEvent: DragEvent | null\n      match: ExtendedRegExpMatchArray\n      pasteEvent: ClipboardEvent | null\n      range: Range\n      state: EditorState\n    }) => void | null\n  }) {\n    this.find = config.find\n    this.handler = config.handler\n  }\n}\n\nconst pasteRuleMatcherHandler = (\n  text: string,\n  find: PasteRuleFinder,\n  event?: ClipboardEvent | null,\n): ExtendedRegExpMatchArray[] => {\n  if (isRegExp(find)) {\n    return [...text.matchAll(find)]\n  }\n\n  const matches = find(text, event)\n\n  if (!matches) {\n    return []\n  }\n\n  return matches.map(pasteRuleMatch => {\n    const result: ExtendedRegExpMatchArray = [pasteRuleMatch.text]\n\n    result.index = pasteRuleMatch.index\n    result.input = text\n    result.data = pasteRuleMatch.data\n\n    if (pasteRuleMatch.replaceWith) {\n      if (!pasteRuleMatch.text.includes(pasteRuleMatch.replaceWith)) {\n        console.warn('[tiptap warn]: \"pasteRuleMatch.replaceWith\" must be part of \"pasteRuleMatch.text\".')\n      }\n\n      result.push(pasteRuleMatch.replaceWith)\n    }\n\n    return result\n  })\n}\n\nfunction run(config: {\n  editor: Editor\n  state: EditorState\n  from: number\n  to: number\n  rule: PasteRule\n  pasteEvent: ClipboardEvent | null\n  dropEvent: DragEvent | null\n}): boolean {\n  const { editor, state, from, to, rule, pasteEvent, dropEvent } = config\n\n  const { commands, chain, can } = new CommandManager({\n    editor,\n    state,\n  })\n\n  const handlers: (void | null)[] = []\n\n  state.doc.nodesBetween(from, to, (node, pos) => {\n    // Skip code blocks and non-textual nodes.\n    // Be defensive: `node` may be a Fragment without a `type`. Only text,\n    // inline, or textblock nodes are processed by paste rules.\n    if (node.type?.spec?.code || !(node.isText || node.isTextblock || node.isInline)) {\n      return\n    }\n\n    // For textblock and inline/text nodes, compute the range relative to the node.\n    // Prefer `node.nodeSize` when available (some Node shapes expose this),\n    // otherwise fall back to `node.content?.size`. Default to 0 if neither exists.\n    const contentSize = node.content?.size ?? node.nodeSize ?? 0\n    const resolvedFrom = Math.max(from, pos)\n    const resolvedTo = Math.min(to, pos + contentSize)\n\n    // If the resolved range is empty or invalid for this node, skip it. This\n    // avoids calling `textBetween` with start > end which can cause internal\n    // Fragment/Node traversal to access undefined `nodeSize` values.\n    if (resolvedFrom >= resolvedTo) {\n      return\n    }\n\n    const textToMatch = node.isText\n      ? node.text || ''\n      : node.textBetween(resolvedFrom - pos, resolvedTo - pos, undefined, '\\ufffc')\n\n    const matches = pasteRuleMatcherHandler(textToMatch, rule.find, pasteEvent)\n\n    matches.forEach(match => {\n      if (match.index === undefined) {\n        return\n      }\n\n      const start = resolvedFrom + match.index + 1\n      const end = start + match[0].length\n      const range = {\n        from: state.tr.mapping.map(start),\n        to: state.tr.mapping.map(end),\n      }\n\n      const handler = rule.handler({\n        state,\n        range,\n        match,\n        commands,\n        chain,\n        can,\n        pasteEvent,\n        dropEvent,\n      })\n\n      handlers.push(handler)\n    })\n  })\n\n  const success = handlers.every(handler => handler !== null)\n\n  return success\n}\n\n// When dragging across editors, must get another editor instance to delete selection content.\nlet tiptapDragFromOtherEditor: Editor | null = null\n\nconst createClipboardPasteEvent = (text: string) => {\n  const event = new ClipboardEvent('paste', {\n    clipboardData: new DataTransfer(),\n  })\n\n  event.clipboardData?.setData('text/html', text)\n\n  return event\n}\n\n/**\n * Create an paste rules plugin. When enabled, it will cause pasted\n * text that matches any of the given rules to trigger the rules\n * action.\n */\nexport function pasteRulesPlugin(props: { editor: Editor; rules: PasteRule[] }): Plugin[] {\n  const { editor, rules } = props\n  let dragSourceElement: Element | null = null\n  let isPastedFromProseMirror = false\n  let isDroppedFromProseMirror = false\n  let pasteEvent = typeof ClipboardEvent !== 'undefined' ? new ClipboardEvent('paste') : null\n  let dropEvent: DragEvent | null\n\n  try {\n    dropEvent = typeof DragEvent !== 'undefined' ? new DragEvent('drop') : null\n  } catch {\n    dropEvent = null\n  }\n\n  const processEvent = ({\n    state,\n    from,\n    to,\n    rule,\n    pasteEvt,\n  }: {\n    state: EditorState\n    from: number\n    to: { b: number }\n    rule: PasteRule\n    pasteEvt: ClipboardEvent | null\n  }) => {\n    const tr = state.tr\n    const chainableState = createChainableState({\n      state,\n      transaction: tr,\n    })\n\n    const handler = run({\n      editor,\n      state: chainableState,\n      from: Math.max(from - 1, 0),\n      to: to.b - 1,\n      rule,\n      pasteEvent: pasteEvt,\n      dropEvent,\n    })\n\n    if (!handler || !tr.steps.length) {\n      return\n    }\n\n    try {\n      dropEvent = typeof DragEvent !== 'undefined' ? new DragEvent('drop') : null\n    } catch {\n      dropEvent = null\n    }\n    pasteEvent = typeof ClipboardEvent !== 'undefined' ? new ClipboardEvent('paste') : null\n\n    return tr\n  }\n\n  const plugins = rules.map(rule => {\n    return new Plugin({\n      // we register a global drag handler to track the current drag source element\n      view(view) {\n        const handleDragstart = (event: DragEvent) => {\n          dragSourceElement = view.dom.parentElement?.contains(event.target as Element) ? view.dom.parentElement : null\n\n          if (dragSourceElement) {\n            tiptapDragFromOtherEditor = editor\n          }\n        }\n\n        const handleDragend = () => {\n          if (tiptapDragFromOtherEditor) {\n            tiptapDragFromOtherEditor = null\n          }\n        }\n\n        window.addEventListener('dragstart', handleDragstart)\n        window.addEventListener('dragend', handleDragend)\n\n        return {\n          destroy() {\n            window.removeEventListener('dragstart', handleDragstart)\n            window.removeEventListener('dragend', handleDragend)\n          },\n        }\n      },\n\n      props: {\n        handleDOMEvents: {\n          drop: (view, event: Event) => {\n            isDroppedFromProseMirror = dragSourceElement === view.dom.parentElement\n            dropEvent = event as DragEvent\n\n            if (!isDroppedFromProseMirror) {\n              const dragFromOtherEditor = tiptapDragFromOtherEditor\n\n              if (dragFromOtherEditor?.isEditable) {\n                // setTimeout to avoid the wrong content after drop, timeout arg can't be empty or 0\n                setTimeout(() => {\n                  const selection = dragFromOtherEditor.state.selection\n\n                  if (selection) {\n                    dragFromOtherEditor.commands.deleteRange({ from: selection.from, to: selection.to })\n                  }\n                }, 10)\n              }\n            }\n            return false\n          },\n\n          paste: (_view, event: Event) => {\n            const html = (event as ClipboardEvent).clipboardData?.getData('text/html')\n\n            pasteEvent = event as ClipboardEvent\n\n            isPastedFromProseMirror = !!html?.includes('data-pm-slice')\n\n            return false\n          },\n        },\n      },\n\n      appendTransaction: (transactions, oldState, state) => {\n        const transaction = transactions[0]\n        const isPaste = transaction.getMeta('uiEvent') === 'paste' && !isPastedFromProseMirror\n        const isDrop = transaction.getMeta('uiEvent') === 'drop' && !isDroppedFromProseMirror\n\n        // if PasteRule is triggered by insertContent()\n        const simulatedPasteMeta = transaction.getMeta('applyPasteRules') as\n          | undefined\n          | { from: number; text: string | ProseMirrorNode | Fragment }\n        const isSimulatedPaste = !!simulatedPasteMeta\n\n        if (!isPaste && !isDrop && !isSimulatedPaste) {\n          return\n        }\n\n        // Handle simulated paste\n        if (isSimulatedPaste) {\n          let { text } = simulatedPasteMeta\n\n          if (typeof text === 'string') {\n            text = text as string\n          } else {\n            text = getHTMLFromFragment(Fragment.from(text), state.schema)\n          }\n\n          const { from } = simulatedPasteMeta\n          const to = from + text.length\n\n          const pasteEvt = createClipboardPasteEvent(text)\n\n          return processEvent({\n            rule,\n            state,\n            from,\n            to: { b: to },\n            pasteEvt,\n          })\n        }\n\n        // handle actual paste/drop\n        const from = oldState.doc.content.findDiffStart(state.doc.content)\n        const to = oldState.doc.content.findDiffEnd(state.doc.content)\n\n        // stop if there is no changed range\n        if (!isNumber(from) || !to || from === to.b) {\n          return\n        }\n\n        return processEvent({\n          rule,\n          state,\n          from,\n          to,\n          pasteEvt: pasteEvent,\n        })\n      },\n    })\n  })\n\n  return plugins\n}\n","export function isNumber(value: any): value is number {\n  return typeof value === 'number'\n}\n","export { ClipboardTextSerializer } from './clipboardTextSerializer.js'\nexport { Commands } from './commands.js'\nexport { Delete } from './delete.js'\nexport { Drop } from './drop.js'\nexport { Editable } from './editable.js'\nexport { FocusEvents, focusEventsPluginKey } from './focusEvents.js'\nexport { Keymap } from './keymap.js'\nexport { Paste } from './paste.js'\nexport { Tabindex } from './tabindex.js'\nexport { TextDirection } from './textDirection.js'\n","import { Plugin, PluginKey } from '@tiptap/pm/state'\n\nimport { Extension } from '../Extension.js'\nimport { getTextBetween } from '../helpers/getTextBetween.js'\nimport { getTextSerializersFromSchema } from '../helpers/getTextSerializersFromSchema.js'\n\nexport type ClipboardTextSerializerOptions = {\n  blockSeparator?: string\n}\n\nexport const ClipboardTextSerializer = Extension.create<ClipboardTextSerializerOptions>({\n  name: 'clipboardTextSerializer',\n\n  addOptions() {\n    return {\n      blockSeparator: undefined,\n    }\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: new PluginKey('clipboardTextSerializer'),\n        props: {\n          clipboardTextSerializer: () => {\n            const { editor } = this\n            const { state, schema } = editor\n            const { doc, selection } = state\n            const { ranges } = selection\n            const from = Math.min(...ranges.map(range => range.$from.pos))\n            const to = Math.max(...ranges.map(range => range.$to.pos))\n            const textSerializers = getTextSerializersFromSchema(schema)\n            const range = { from, to }\n\n            return getTextBetween(doc, range, {\n              ...(this.options.blockSeparator !== undefined ? { blockSeparator: this.options.blockSeparator } : {}),\n              textSerializers,\n            })\n          },\n        },\n      }),\n    ]\n  },\n})\n","import type { Editor } from './Editor.js'\nimport { type ExtendableConfig, Extendable } from './Extendable.js'\n\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\nexport interface ExtensionConfig<Options = any, Storage = any>\n  extends ExtendableConfig<Options, Storage, ExtensionConfig<Options, Storage>, null> {}\n\n/**\n * The Extension class is the base class for all extensions.\n * @see https://tiptap.dev/api/extensions#create-a-new-extension\n */\nexport class Extension<Options = any, Storage = any> extends Extendable<\n  Options,\n  Storage,\n  ExtensionConfig<Options, Storage>\n> {\n  type = 'extension'\n\n  /**\n   * Create a new Extension instance\n   * @param config - Extension configuration object or a function that returns a configuration object\n   */\n  static create<O = any, S = any>(\n    config: Partial<ExtensionConfig<O, S>> | (() => Partial<ExtensionConfig<O, S>>) = {},\n  ) {\n    // If the config is a function, execute it to get the configuration object\n    const resolvedConfig = typeof config === 'function' ? config() : config\n    return new Extension<O, S>(resolvedConfig)\n  }\n\n  configure(options?: Partial<Options>) {\n    return super.configure(options) as Extension<Options, Storage>\n  }\n\n  extend<\n    ExtendedOptions = Options,\n    ExtendedStorage = Storage,\n    ExtendedConfig = ExtensionConfig<ExtendedOptions, ExtendedStorage>,\n  >(\n    extendedConfig?:\n      | (() => Partial<ExtendedConfig>)\n      | (Partial<ExtendedConfig> &\n          ThisType<{\n            name: string\n            options: ExtendedOptions\n            storage: ExtendedStorage\n            editor: Editor\n            type: null\n          }>),\n  ): Extension<ExtendedOptions, ExtendedStorage> {\n    // If the extended config is a function, execute it to get the configuration object\n    const resolvedConfig = typeof extendedConfig === 'function' ? extendedConfig() : extendedConfig\n    return super.extend(resolvedConfig) as Extension<ExtendedOptions, ExtendedStorage>\n  }\n}\n","import * as commands from '../commands/index.js'\nimport { Extension } from '../Extension.js'\n\nexport * from '../commands/index.js'\n\nexport const Commands = Extension.create({\n  name: 'commands',\n\n  addCommands() {\n    return {\n      ...commands,\n    }\n  },\n})\n","import { RemoveMarkStep } from '@tiptap/pm/transform'\n\nimport { Extension } from '../Extension.js'\nimport { combineTransactionSteps, getChangedRanges } from '../helpers/index.js'\n\n/**\n * This extension allows you to be notified when the user deletes content you are interested in.\n */\nexport const Delete = Extension.create({\n  name: 'delete',\n\n  onUpdate({ transaction, appendedTransactions }) {\n    const callback = () => {\n      if (\n        this.editor.options.coreExtensionOptions?.delete?.filterTransaction?.(transaction) ??\n        transaction.getMeta('y-sync$')\n      ) {\n        return\n      }\n      const nextTransaction = combineTransactionSteps(transaction.before, [transaction, ...appendedTransactions])\n      const changes = getChangedRanges(nextTransaction)\n\n      changes.forEach(change => {\n        if (\n          nextTransaction.mapping.mapResult(change.oldRange.from).deletedAfter &&\n          nextTransaction.mapping.mapResult(change.oldRange.to).deletedBefore\n        ) {\n          nextTransaction.before.nodesBetween(change.oldRange.from, change.oldRange.to, (node, from) => {\n            const to = from + node.nodeSize - 2\n            const isFullyWithinRange = change.oldRange.from <= from && to <= change.oldRange.to\n\n            this.editor.emit('delete', {\n              type: 'node',\n              node,\n              from,\n              to,\n              newFrom: nextTransaction.mapping.map(from),\n              newTo: nextTransaction.mapping.map(to),\n              deletedRange: change.oldRange,\n              newRange: change.newRange,\n              partial: !isFullyWithinRange,\n              editor: this.editor,\n              transaction,\n              combinedTransform: nextTransaction,\n            })\n          })\n        }\n      })\n\n      const mapping = nextTransaction.mapping\n      nextTransaction.steps.forEach((step, index) => {\n        if (step instanceof RemoveMarkStep) {\n          const newStart = mapping.slice(index).map(step.from, -1)\n          const newEnd = mapping.slice(index).map(step.to)\n          const oldStart = mapping.invert().map(newStart, -1)\n          const oldEnd = mapping.invert().map(newEnd)\n\n          const foundBeforeMark = nextTransaction.doc.nodeAt(newStart - 1)?.marks.some(mark => mark.eq(step.mark))\n          const foundAfterMark = nextTransaction.doc.nodeAt(newEnd)?.marks.some(mark => mark.eq(step.mark))\n\n          this.editor.emit('delete', {\n            type: 'mark',\n            mark: step.mark,\n            from: step.from,\n            to: step.to,\n            deletedRange: {\n              from: oldStart,\n              to: oldEnd,\n            },\n            newRange: {\n              from: newStart,\n              to: newEnd,\n            },\n            partial: Boolean(foundAfterMark || foundBeforeMark),\n            editor: this.editor,\n            transaction,\n            combinedTransform: nextTransaction,\n          })\n        }\n      })\n    }\n\n    if (this.editor.options.coreExtensionOptions?.delete?.async ?? true) {\n      setTimeout(callback, 0)\n    } else {\n      callback()\n    }\n  },\n})\n","import { Plugin, PluginKey } from '@tiptap/pm/state'\n\nimport { Extension } from '../Extension.js'\n\nexport const Drop = Extension.create({\n  name: 'drop',\n\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: new PluginKey('tiptapDrop'),\n\n        props: {\n          handleDrop: (_, e, slice, moved) => {\n            this.editor.emit('drop', {\n              editor: this.editor,\n              event: e,\n              slice,\n              moved,\n            })\n          },\n        },\n      }),\n    ]\n  },\n})\n","import { Plugin, PluginKey } from '@tiptap/pm/state'\n\nimport { Extension } from '../Extension.js'\n\nexport const Editable = Extension.create({\n  name: 'editable',\n\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: new PluginKey('editable'),\n        props: {\n          editable: () => this.editor.options.editable,\n        },\n      }),\n    ]\n  },\n})\n","import { Plugin, PluginKey } from '@tiptap/pm/state'\n\nimport { Extension } from '../Extension.js'\n\nexport const focusEventsPluginKey = new PluginKey('focusEvents')\n\nexport const FocusEvents = Extension.create({\n  name: 'focusEvents',\n\n  addProseMirrorPlugins() {\n    const { editor } = this\n\n    return [\n      new Plugin({\n        key: focusEventsPluginKey,\n        props: {\n          handleDOMEvents: {\n            focus: (view, event: Event) => {\n              editor.isFocused = true\n\n              const transaction = editor.state.tr.setMeta('focus', { event }).setMeta('addToHistory', false)\n\n              view.dispatch(transaction)\n\n              return false\n            },\n            blur: (view, event: Event) => {\n              editor.isFocused = false\n\n              const transaction = editor.state.tr.setMeta('blur', { event }).setMeta('addToHistory', false)\n\n              view.dispatch(transaction)\n\n              return false\n            },\n          },\n        },\n      }),\n    ]\n  },\n})\n","import { Plugin, PluginKey, Selection } from '@tiptap/pm/state'\n\nimport { CommandManager } from '../CommandManager.js'\nimport { Extension } from '../Extension.js'\nimport { createChainableState } from '../helpers/createChainableState.js'\nimport { isNodeEmpty } from '../helpers/isNodeEmpty.js'\nimport { isiOS } from '../utilities/isiOS.js'\nimport { isMacOS } from '../utilities/isMacOS.js'\n\nexport const Keymap = Extension.create({\n  name: 'keymap',\n\n  addKeyboardShortcuts() {\n    const handleBackspace = () =>\n      this.editor.commands.first(({ commands }) => [\n        () => commands.undoInputRule(),\n\n        // maybe convert first text block node to default node\n        () =>\n          commands.command(({ tr }) => {\n            const { selection, doc } = tr\n            const { empty, $anchor } = selection\n            const { pos, parent } = $anchor\n            const $parentPos = $anchor.parent.isTextblock && pos > 0 ? tr.doc.resolve(pos - 1) : $anchor\n            const parentIsIsolating = $parentPos.parent.type.spec.isolating\n\n            const parentPos = $anchor.pos - $anchor.parentOffset\n\n            const isAtStart =\n              parentIsIsolating && $parentPos.parent.childCount === 1\n                ? parentPos === $anchor.pos\n                : Selection.atStart(doc).from === pos\n\n            if (\n              !empty ||\n              !parent.type.isTextblock ||\n              parent.textContent.length ||\n              !isAtStart ||\n              (isAtStart && $anchor.parent.type.name === 'paragraph') // prevent clearNodes when no nodes to clear, otherwise history stack is appended\n            ) {\n              return false\n            }\n\n            return commands.clearNodes()\n          }),\n\n        () => commands.deleteSelection(),\n        () => commands.joinBackward(),\n        () => commands.selectNodeBackward(),\n      ])\n\n    const handleDelete = () =>\n      this.editor.commands.first(({ commands }) => [\n        () => commands.deleteSelection(),\n        () => commands.deleteCurrentNode(),\n        () => commands.joinForward(),\n        () => commands.selectNodeForward(),\n      ])\n\n    const handleEnter = () =>\n      this.editor.commands.first(({ commands }) => [\n        () => commands.newlineInCode(),\n        () => commands.createParagraphNear(),\n        () => commands.liftEmptyBlock(),\n        () => commands.splitBlock(),\n      ])\n\n    const baseKeymap = {\n      Enter: handleEnter,\n      'Mod-Enter': () => this.editor.commands.exitCode(),\n      Backspace: handleBackspace,\n      'Mod-Backspace': handleBackspace,\n      'Shift-Backspace': handleBackspace,\n      Delete: handleDelete,\n      'Mod-Delete': handleDelete,\n      'Mod-a': () => this.editor.commands.selectAll(),\n    }\n\n    const pcKeymap = {\n      ...baseKeymap,\n    }\n\n    const macKeymap = {\n      ...baseKeymap,\n      'Ctrl-h': handleBackspace,\n      'Alt-Backspace': handleBackspace,\n      'Ctrl-d': handleDelete,\n      'Ctrl-Alt-Backspace': handleDelete,\n      'Alt-Delete': handleDelete,\n      'Alt-d': handleDelete,\n      'Ctrl-a': () => this.editor.commands.selectTextblockStart(),\n      'Ctrl-e': () => this.editor.commands.selectTextblockEnd(),\n    }\n\n    if (isiOS() || isMacOS()) {\n      return macKeymap\n    }\n\n    return pcKeymap\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      // With this plugin we check if the whole document was selected and deleted.\n      // In this case we will additionally call `clearNodes()` to convert e.g. a heading\n      // to a paragraph if necessary.\n      // This is an alternative to ProseMirror's `AllSelection`, which doesnt work well\n      // with many other commands.\n      new Plugin({\n        key: new PluginKey('clearDocument'),\n        appendTransaction: (transactions, oldState, newState) => {\n          if (transactions.some(tr => tr.getMeta('composition'))) {\n            return\n          }\n\n          const docChanges = transactions.some(transaction => transaction.docChanged) && !oldState.doc.eq(newState.doc)\n\n          const ignoreTr = transactions.some(transaction => transaction.getMeta('preventClearDocument'))\n\n          if (!docChanges || ignoreTr) {\n            return\n          }\n\n          const { empty, from, to } = oldState.selection\n          const allFrom = Selection.atStart(oldState.doc).from\n          const allEnd = Selection.atEnd(oldState.doc).to\n          const allWasSelected = from === allFrom && to === allEnd\n\n          if (empty || !allWasSelected) {\n            return\n          }\n\n          const isEmpty = isNodeEmpty(newState.doc)\n\n          if (!isEmpty) {\n            return\n          }\n\n          const tr = newState.tr\n          const state = createChainableState({\n            state: newState,\n            transaction: tr,\n          })\n          const { commands } = new CommandManager({\n            editor: this.editor,\n            state,\n          })\n\n          commands.clearNodes()\n\n          if (!tr.steps.length) {\n            return\n          }\n\n          return tr\n        },\n      }),\n    ]\n  },\n})\n","import { Plugin, PluginKey } from '@tiptap/pm/state'\n\nimport { Extension } from '../Extension.js'\n\nexport const Paste = Extension.create({\n  name: 'paste',\n\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: new PluginKey('tiptapPaste'),\n\n        props: {\n          handlePaste: (_view, e, slice) => {\n            this.editor.emit('paste', {\n              editor: this.editor,\n              event: e,\n              slice,\n            })\n          },\n        },\n      }),\n    ]\n  },\n})\n","import { Plugin, PluginKey } from '@tiptap/pm/state'\n\nimport { Extension } from '../Extension.js'\n\nexport const Tabindex = Extension.create({\n  name: 'tabindex',\n\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: new PluginKey('tabindex'),\n        props: {\n          attributes: (): { [name: string]: string } => (this.editor.isEditable ? { tabindex: '0' } : {}),\n        },\n      }),\n    ]\n  },\n})\n","import { Plugin, PluginKey } from '@tiptap/pm/state'\n\nimport { Extension } from '../Extension.js'\nimport { splitExtensions } from '../helpers/splitExtensions.js'\n\nexport interface TextDirectionOptions {\n  direction: 'ltr' | 'rtl' | 'auto' | undefined\n}\n\n/**\n * The TextDirection extension adds support for setting text direction (LTR/RTL/auto)\n * on all nodes in the editor.\n *\n * This extension adds a global `dir` attribute to all node types, which can be used\n * to control bidirectional text rendering. The direction can be set globally via\n * editor options or per-node using commands.\n */\nexport const TextDirection = Extension.create<TextDirectionOptions>({\n  name: 'textDirection',\n\n  addOptions() {\n    return {\n      direction: undefined,\n    }\n  },\n\n  addGlobalAttributes() {\n    // Only add the dir attribute to nodes if text direction is configured\n    // This prevents null/undefined values from appearing in JSON exports\n    if (!this.options.direction) {\n      return []\n    }\n\n    const { nodeExtensions } = splitExtensions(this.extensions)\n\n    return [\n      {\n        types: nodeExtensions.filter(extension => extension.name !== 'text').map(extension => extension.name),\n        attributes: {\n          dir: {\n            default: this.options.direction,\n            parseHTML: element => {\n              const dir = element.getAttribute('dir')\n\n              if (dir && (dir === 'ltr' || dir === 'rtl' || dir === 'auto')) {\n                return dir\n              }\n\n              return this.options.direction\n            },\n            renderHTML: attributes => {\n              if (!attributes.dir) {\n                return {}\n              }\n\n              return {\n                dir: attributes.dir,\n              }\n            },\n          },\n        },\n      },\n    ]\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      new Plugin({\n        key: new PluginKey('textDirection'),\n        props: {\n          attributes: (): { [name: string]: string } => {\n            const direction = this.options.direction\n\n            if (!direction) {\n              return {}\n            }\n\n            return {\n              dir: direction,\n            }\n          },\n        },\n      }),\n    ]\n  },\n})\n","import type { Fragment, Node, ResolvedPos } from '@tiptap/pm/model'\n\nimport type { Editor } from './Editor.js'\nimport type { Content, Range } from './types.js'\n\nexport class NodePos {\n  private resolvedPos: ResolvedPos\n\n  private isBlock: boolean\n\n  private editor: Editor\n\n  private get name(): string {\n    return this.node.type.name\n  }\n\n  constructor(pos: ResolvedPos, editor: Editor, isBlock = false, node: Node | null = null) {\n    this.isBlock = isBlock\n    this.resolvedPos = pos\n    this.editor = editor\n    this.currentNode = node\n  }\n\n  private currentNode: Node | null = null\n\n  get node(): Node {\n    return this.currentNode || this.resolvedPos.node()\n  }\n\n  get element(): HTMLElement {\n    return this.editor.view.domAtPos(this.pos).node as HTMLElement\n  }\n\n  public actualDepth: number | null = null\n\n  get depth(): number {\n    return this.actualDepth ?? this.resolvedPos.depth\n  }\n\n  get pos(): number {\n    return this.resolvedPos.pos\n  }\n\n  get content(): Fragment {\n    return this.node.content\n  }\n\n  set content(content: Content) {\n    let from = this.from\n    let to = this.to\n\n    if (this.isBlock) {\n      if (this.content.size === 0) {\n        console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`)\n        return\n      }\n\n      from = this.from + 1\n      to = this.to - 1\n    }\n\n    this.editor.commands.insertContentAt({ from, to }, content)\n  }\n\n  get attributes(): { [key: string]: any } {\n    return this.node.attrs\n  }\n\n  get textContent(): string {\n    return this.node.textContent\n  }\n\n  get size(): number {\n    return this.node.nodeSize\n  }\n\n  get from(): number {\n    if (this.isBlock) {\n      return this.pos\n    }\n\n    return this.resolvedPos.start(this.resolvedPos.depth)\n  }\n\n  get range(): Range {\n    return {\n      from: this.from,\n      to: this.to,\n    }\n  }\n\n  get to(): number {\n    if (this.isBlock) {\n      return this.pos + this.size\n    }\n\n    return this.resolvedPos.end(this.resolvedPos.depth) + (this.node.isText ? 0 : 1)\n  }\n\n  get parent(): NodePos | null {\n    if (this.depth === 0) {\n      return null\n    }\n\n    const parentPos = this.resolvedPos.start(this.resolvedPos.depth - 1)\n    const $pos = this.resolvedPos.doc.resolve(parentPos)\n\n    return new NodePos($pos, this.editor)\n  }\n\n  get before(): NodePos | null {\n    let $pos = this.resolvedPos.doc.resolve(this.from - (this.isBlock ? 1 : 2))\n\n    if ($pos.depth !== this.depth) {\n      $pos = this.resolvedPos.doc.resolve(this.from - 3)\n    }\n\n    return new NodePos($pos, this.editor)\n  }\n\n  get after(): NodePos | null {\n    let $pos = this.resolvedPos.doc.resolve(this.to + (this.isBlock ? 2 : 1))\n\n    if ($pos.depth !== this.depth) {\n      $pos = this.resolvedPos.doc.resolve(this.to + 3)\n    }\n\n    return new NodePos($pos, this.editor)\n  }\n\n  get children(): NodePos[] {\n    const children: NodePos[] = []\n\n    this.node.content.forEach((node, offset) => {\n      const isBlock = node.isBlock && !node.isTextblock\n      const isNonTextAtom = node.isAtom && !node.isText\n\n      const targetPos = this.pos + offset + (isNonTextAtom ? 0 : 1)\n\n      // Check if targetPos is within valid document range\n      if (targetPos < 0 || targetPos > this.resolvedPos.doc.nodeSize - 2) {\n        return\n      }\n\n      const $pos = this.resolvedPos.doc.resolve(targetPos)\n\n      if (!isBlock && $pos.depth <= this.depth) {\n        return\n      }\n\n      const childNodePos = new NodePos($pos, this.editor, isBlock, isBlock ? node : null)\n\n      if (isBlock) {\n        childNodePos.actualDepth = this.depth + 1\n      }\n\n      children.push(new NodePos($pos, this.editor, isBlock, isBlock ? node : null))\n    })\n\n    return children\n  }\n\n  get firstChild(): NodePos | null {\n    return this.children[0] || null\n  }\n\n  get lastChild(): NodePos | null {\n    const children = this.children\n\n    return children[children.length - 1] || null\n  }\n\n  closest(selector: string, attributes: { [key: string]: any } = {}): NodePos | null {\n    let node: NodePos | null = null\n    let currentNode = this.parent\n\n    while (currentNode && !node) {\n      if (currentNode.node.type.name === selector) {\n        if (Object.keys(attributes).length > 0) {\n          const nodeAttributes = currentNode.node.attrs\n          const attrKeys = Object.keys(attributes)\n\n          for (let index = 0; index < attrKeys.length; index += 1) {\n            const key = attrKeys[index]\n\n            if (nodeAttributes[key] !== attributes[key]) {\n              break\n            }\n          }\n        } else {\n          node = currentNode\n        }\n      }\n\n      currentNode = currentNode.parent\n    }\n\n    return node\n  }\n\n  querySelector(selector: string, attributes: { [key: string]: any } = {}): NodePos | null {\n    return this.querySelectorAll(selector, attributes, true)[0] || null\n  }\n\n  querySelectorAll(selector: string, attributes: { [key: string]: any } = {}, firstItemOnly = false): NodePos[] {\n    let nodes: NodePos[] = []\n\n    if (!this.children || this.children.length === 0) {\n      return nodes\n    }\n    const attrKeys = Object.keys(attributes)\n\n    /**\n     * Finds all children recursively that match the selector and attributes\n     * If firstItemOnly is true, it will return the first item found\n     */\n    this.children.forEach(childPos => {\n      // If we already found a node and we only want the first item, we dont need to keep going\n      if (firstItemOnly && nodes.length > 0) {\n        return\n      }\n\n      if (childPos.node.type.name === selector) {\n        const doesAllAttributesMatch = attrKeys.every(key => attributes[key] === childPos.node.attrs[key])\n\n        if (doesAllAttributesMatch) {\n          nodes.push(childPos)\n        }\n      }\n\n      // If we already found a node and we only want the first item, we can stop here and skip the recursion\n      if (firstItemOnly && nodes.length > 0) {\n        return\n      }\n\n      nodes = nodes.concat(childPos.querySelectorAll(selector, attributes, firstItemOnly))\n    })\n\n    return nodes\n  }\n\n  setAttribute(attributes: { [key: string]: any }) {\n    const { tr } = this.editor.state\n\n    tr.setNodeMarkup(this.from, undefined, {\n      ...this.node.attrs,\n      ...attributes,\n    })\n\n    this.editor.view.dispatch(tr)\n  }\n}\n","export const style = `.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: \"liga\" 0; /* the above doesn't seem to work in Edge */\n}\n\n.ProseMirror [contenteditable=\"false\"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable=\"false\"] [contenteditable=\"true\"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: \"\";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}`\n","export function createStyleTag(style: string, nonce?: string, suffix?: string): HTMLStyleElement {\n  const tiptapStyleTag = <HTMLStyleElement>(\n    document.querySelector(`style[data-tiptap-style${suffix ? `-${suffix}` : ''}]`)\n  )\n\n  if (tiptapStyleTag !== null) {\n    return tiptapStyleTag\n  }\n\n  const styleNode = document.createElement('style')\n\n  if (nonce) {\n    styleNode.setAttribute('nonce', nonce)\n  }\n\n  styleNode.setAttribute(`data-tiptap-style${suffix ? `-${suffix}` : ''}`, '')\n  styleNode.innerHTML = style\n  document.getElementsByTagName('head')[0].appendChild(styleNode)\n\n  return styleNode\n}\n","import type { MarkType } from '@tiptap/pm/model'\n\nimport { getMarksBetween } from '../helpers/getMarksBetween.js'\nimport type { InputRuleFinder } from '../InputRule.js'\nimport { InputRule } from '../InputRule.js'\nimport type { ExtendedRegExpMatchArray } from '../types.js'\nimport { callOrReturn } from '../utilities/callOrReturn.js'\n\n/**\n * Build an input rule that adds a mark when the\n * matched text is typed into it.\n * @see https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#input-rules\n */\nexport function markInputRule(config: {\n  find: InputRuleFinder\n  type: MarkType\n  undoable?: boolean\n  getAttributes?: Record<string, any> | ((match: ExtendedRegExpMatchArray) => Record<string, any>) | false | null\n}) {\n  return new InputRule({\n    find: config.find,\n    handler: ({ state, range, match }) => {\n      const attributes = callOrReturn(config.getAttributes, undefined, match)\n\n      if (attributes === false || attributes === null) {\n        return null\n      }\n\n      const { tr } = state\n      const captureGroup = match[match.length - 1]\n      const fullMatch = match[0]\n\n      if (captureGroup) {\n        const startSpaces = fullMatch.search(/\\S/)\n        const textStart = range.from + fullMatch.indexOf(captureGroup)\n        const textEnd = textStart + captureGroup.length\n\n        const excludedMarks = getMarksBetween(range.from, range.to, state.doc)\n          .filter(item => {\n            // @ts-ignore\n            const excluded = item.mark.type.excluded as MarkType[]\n\n            return excluded.find(type => type === config.type && type !== item.mark.type)\n          })\n          .filter(item => item.to > textStart)\n\n        if (excludedMarks.length) {\n          return null\n        }\n\n        if (textEnd < range.to) {\n          tr.delete(textEnd, range.to)\n        }\n\n        if (textStart > range.from) {\n          tr.delete(range.from + startSpaces, textStart)\n        }\n\n        const markEnd = range.from + startSpaces + captureGroup.length\n\n        tr.addMark(range.from + startSpaces, markEnd, config.type.create(attributes || {}))\n\n        tr.removeStoredMark(config.type)\n      }\n    },\n    undoable: config.undoable,\n  })\n}\n","import type { NodeType } from '@tiptap/pm/model'\n\nimport type { InputRuleFinder } from '../InputRule.js'\nimport { InputRule } from '../InputRule.js'\nimport type { ExtendedRegExpMatchArray } from '../types.js'\nimport { callOrReturn } from '../utilities/callOrReturn.js'\n\n/**\n * Build an input rule that adds a node when the\n * matched text is typed into it.\n * @see https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#input-rules\n */\nexport function nodeInputRule(config: {\n  /**\n   * The regex to match.\n   */\n  find: InputRuleFinder\n\n  /**\n   * The node type to add.\n   */\n  type: NodeType\n\n  /**\n   * Whether the input rule should be undoable\n   * when the user presses backspace.\n   */\n  undoable?: boolean\n\n  /**\n   * A function that returns the attributes for the node\n   * can also be an object of attributes\n   */\n  getAttributes?: Record<string, any> | ((match: ExtendedRegExpMatchArray) => Record<string, any>) | false | null\n}) {\n  return new InputRule({\n    find: config.find,\n    handler: ({ state, range, match }) => {\n      const attributes = callOrReturn(config.getAttributes, undefined, match) || {}\n      const { tr } = state\n      const start = range.from\n      let end = range.to\n\n      const newNode = config.type.create(attributes)\n\n      if (match[1]) {\n        const offset = match[0].lastIndexOf(match[1])\n        let matchStart = start + offset\n\n        if (matchStart > end) {\n          matchStart = end\n        } else {\n          end = matchStart + match[1].length\n        }\n\n        // insert last typed character\n        const lastChar = match[0][match[0].length - 1]\n\n        tr.insertText(lastChar, start + match[0].length - 1)\n\n        // insert node from input rule\n        tr.replaceWith(matchStart, end, newNode)\n      } else if (match[0]) {\n        const insertionStart = config.type.isInline ? start : start - 1\n\n        tr.insert(insertionStart, config.type.create(attributes)).delete(tr.mapping.map(start), tr.mapping.map(end))\n      }\n\n      tr.scrollIntoView()\n    },\n    undoable: config.undoable,\n  })\n}\n","import type { NodeType } from '@tiptap/pm/model'\n\nimport type { InputRuleFinder } from '../InputRule.js'\nimport { InputRule } from '../InputRule.js'\nimport type { ExtendedRegExpMatchArray } from '../types.js'\nimport { callOrReturn } from '../utilities/callOrReturn.js'\n\n/**\n * Build an input rule that changes the type of a textblock when the\n * matched text is typed into it. When using a regular expresion youll\n * probably want the regexp to start with `^`, so that the pattern can\n * only occur at the start of a textblock.\n * @see https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#input-rules\n */\nexport function textblockTypeInputRule(config: {\n  find: InputRuleFinder\n  type: NodeType\n  undoable?: boolean\n  getAttributes?: Record<string, any> | ((match: ExtendedRegExpMatchArray) => Record<string, any>) | false | null\n}) {\n  return new InputRule({\n    find: config.find,\n    handler: ({ state, range, match }) => {\n      const $start = state.doc.resolve(range.from)\n      const attributes = callOrReturn(config.getAttributes, undefined, match) || {}\n\n      if (!$start.node(-1).canReplaceWith($start.index(-1), $start.indexAfter(-1), config.type)) {\n        return null\n      }\n\n      state.tr.delete(range.from, range.to).setBlockType(range.from, range.from, config.type, attributes)\n    },\n    undoable: config.undoable,\n  })\n}\n","import type { InputRuleFinder } from '../InputRule.js'\nimport { InputRule } from '../InputRule.js'\n\n/**\n * Build an input rule that replaces text when the\n * matched text is typed into it.\n * @see https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#input-rules\n */\nexport function textInputRule(config: { find: InputRuleFinder; replace: string; undoable?: boolean }) {\n  return new InputRule({\n    find: config.find,\n    handler: ({ state, range, match }) => {\n      let insert = config.replace\n      let start = range.from\n      const end = range.to\n\n      if (match[1]) {\n        const offset = match[0].lastIndexOf(match[1])\n\n        insert += match[0].slice(offset + match[1].length)\n        start += offset\n\n        const cutOff = start - end\n\n        if (cutOff > 0) {\n          insert = match[0].slice(offset - cutOff, offset) + insert\n          start = end\n        }\n      }\n\n      state.tr.insertText(insert, start, end)\n    },\n    undoable: config.undoable,\n  })\n}\n","import type { Node as ProseMirrorNode, NodeType } from '@tiptap/pm/model'\nimport { canJoin, findWrapping } from '@tiptap/pm/transform'\n\nimport type { Editor } from '../Editor.js'\nimport type { InputRuleFinder } from '../InputRule.js'\nimport { InputRule } from '../InputRule.js'\nimport type { ExtendedRegExpMatchArray } from '../types.js'\nimport { callOrReturn } from '../utilities/callOrReturn.js'\n\n/**\n * Build an input rule for automatically wrapping a textblock when a\n * given string is typed. When using a regular expresion youll\n * probably want the regexp to start with `^`, so that the pattern can\n * only occur at the start of a textblock.\n *\n * `type` is the type of node to wrap in.\n *\n * By default, if theres a node with the same type above the newly\n * wrapped node, the rule will try to join those\n * two nodes. You can pass a join predicate, which takes a regular\n * expression match and the node before the wrapped node, and can\n * return a boolean to indicate whether a join should happen.\n * @see https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#input-rules\n */\nexport function wrappingInputRule(config: {\n  find: InputRuleFinder\n  type: NodeType\n  keepMarks?: boolean\n  keepAttributes?: boolean\n  editor?: Editor\n  undoable?: boolean\n  getAttributes?: Record<string, any> | ((match: ExtendedRegExpMatchArray) => Record<string, any>) | false | null\n  joinPredicate?: (match: ExtendedRegExpMatchArray, node: ProseMirrorNode) => boolean\n}) {\n  return new InputRule({\n    find: config.find,\n    handler: ({ state, range, match, chain }) => {\n      const attributes = callOrReturn(config.getAttributes, undefined, match) || {}\n      const tr = state.tr.delete(range.from, range.to)\n      const $start = tr.doc.resolve(range.from)\n      const blockRange = $start.blockRange()\n      const wrapping = blockRange && findWrapping(blockRange, config.type, attributes)\n\n      if (!wrapping) {\n        return null\n      }\n\n      tr.wrap(blockRange, wrapping)\n\n      if (config.keepMarks && config.editor) {\n        const { selection, storedMarks } = state\n        const { splittableMarks } = config.editor.extensionManager\n        const marks = storedMarks || (selection.$to.parentOffset && selection.$from.marks())\n\n        if (marks) {\n          const filteredMarks = marks.filter(mark => splittableMarks.includes(mark.type.name))\n\n          tr.ensureMarks(filteredMarks)\n        }\n      }\n      if (config.keepAttributes) {\n        /** If the nodeType is `bulletList` or `orderedList` set the `nodeType` as `listItem` */\n        const nodeType =\n          config.type.name === 'bulletList' || config.type.name === 'orderedList' ? 'listItem' : 'taskList'\n\n        chain().updateAttributes(nodeType, attributes).run()\n      }\n\n      const before = tr.doc.resolve(range.from - 1).nodeBefore\n\n      if (\n        before &&\n        before.type === config.type &&\n        canJoin(tr.doc, range.from - 1) &&\n        (!config.joinPredicate || config.joinPredicate(match, before))\n      ) {\n        tr.join(range.from - 1)\n      }\n    },\n    undoable: config.undoable,\n  })\n}\n","export type Attributes = Record<string, any>\n\nexport type DOMOutputSpecElement = 0 | Attributes | DOMOutputSpecArray\n/**\n * Better describes the output of a `renderHTML` function in prosemirror\n * @see https://prosemirror.net/docs/ref/#model.DOMOutputSpec\n */\nexport type DOMOutputSpecArray =\n  | [string]\n  | [string, Attributes]\n  | [string, 0]\n  | [string, Attributes, 0]\n  | [string, Attributes, DOMOutputSpecArray | 0]\n  | [string, DOMOutputSpecArray]\n\n// JSX types for Tiptap's JSX runtime\n// These types only apply when using @jsxImportSource @tiptap/core\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace JSX {\n  export type Element = DOMOutputSpecArray\n  export interface IntrinsicElements {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    [key: string]: any\n  }\n  export interface ElementChildrenAttribute {\n    children: unknown\n  }\n}\n\nexport type JSXRenderer = (\n  tag: 'slot' | string | ((props?: Attributes) => DOMOutputSpecArray | DOMOutputSpecElement),\n  props?: Attributes,\n  ...children: JSXRenderer[]\n) => DOMOutputSpecArray | DOMOutputSpecElement\n\nexport function Fragment(props: { children: JSXRenderer[] }) {\n  return props.children\n}\n\nexport const h: JSXRenderer = (tag, attributes) => {\n  // Treat the slot tag as the Prosemirror hole to render content into\n  if (tag === 'slot') {\n    return 0\n  }\n\n  // If the tag is a function, call it with the props\n  if (tag instanceof Function) {\n    return tag(attributes)\n  }\n\n  const { children, ...rest } = attributes ?? {}\n\n  if (tag === 'svg') {\n    throw new Error('SVG elements are not supported in the JSX syntax, use the array syntax instead')\n  }\n\n  // Otherwise, return the tag, attributes, and children\n  return [tag, rest, children]\n}\n\n// See\n// https://esbuild.github.io/api/#jsx-import-source\n// https://www.typescriptlang.org/tsconfig/#jsxImportSource\n\nexport { h as createElement, h as jsx, h as jsxDEV, h as jsxs }\n","import type { Node as PMNode } from '@tiptap/pm/model'\nimport type { Decoration, DecorationSource, NodeView } from '@tiptap/pm/view'\n\nimport type { Editor } from '../Editor.js'\n\nconst isTouchEvent = (e: MouseEvent | TouchEvent): e is TouchEvent => {\n  return 'touches' in e\n}\n\n/**\n * Directions where resize handles can be placed\n *\n * @example\n * - `'top'` - Top edge handle\n * - `'bottom-right'` - Bottom-right corner handle\n */\nexport type ResizableNodeViewDirection =\n  | 'top'\n  | 'right'\n  | 'bottom'\n  | 'left'\n  | 'top-right'\n  | 'top-left'\n  | 'bottom-right'\n  | 'bottom-left'\n\n/**\n * Dimensions for the resizable node in pixels\n */\nexport type ResizableNodeDimensions = {\n  /** Width in pixels */\n  width: number\n  /** Height in pixels */\n  height: number\n}\n\n/**\n * Configuration options for creating a ResizableNodeView\n *\n * @example\n * ```ts\n * new ResizableNodeView({\n *   element: imgElement,\n *   node,\n *   getPos,\n *   onResize: (width, height) => {\n *     imgElement.style.width = `${width}px`\n *     imgElement.style.height = `${height}px`\n *   },\n *   onCommit: (width, height) => {\n *     editor.commands.updateAttributes('image', { width, height })\n *   },\n *   onUpdate: (node) => true,\n *   options: {\n *     directions: ['bottom-right', 'bottom-left'],\n *     min: { width: 100, height: 100 },\n *     preserveAspectRatio: true\n *   }\n * })\n * ```\n */\nexport type ResizableNodeViewOptions = {\n  /**\n   * The DOM element to make resizable (e.g., an img, video, or iframe element)\n   */\n  element: HTMLElement\n\n  /**\n   * The DOM element that will hold the editable content element\n   */\n  contentElement?: HTMLElement\n\n  /**\n   * The ProseMirror node instance\n   */\n  node: PMNode\n\n  /**\n   * The Tiptap editor instance\n   */\n  editor: Editor\n\n  /**\n   * Function that returns the current position of the node in the document\n   */\n  getPos: () => number | undefined\n\n  /**\n   * Callback fired continuously during resize with current dimensions.\n   * Use this to update the element's visual size in real-time.\n   *\n   * @param width - Current width in pixels\n   * @param height - Current height in pixels\n   *\n   * @example\n   * ```ts\n   * onResize: (width, height) => {\n   *   element.style.width = `${width}px`\n   *   element.style.height = `${height}px`\n   * }\n   * ```\n   */\n  onResize?: (width: number, height: number) => void\n\n  /**\n   * Callback fired once when resize completes with final dimensions.\n   * Use this to persist the new size to the node's attributes.\n   *\n   * @param width - Final width in pixels\n   * @param height - Final height in pixels\n   *\n   * @example\n   * ```ts\n   * onCommit: (width, height) => {\n   *   const pos = getPos()\n   *   if (pos !== undefined) {\n   *     editor.commands.updateAttributes('image', { width, height })\n   *   }\n   * }\n   * ```\n   */\n  onCommit: (width: number, height: number) => void\n\n  /**\n   * Callback for handling node updates.\n   * Return `true` to accept the update, `false` to reject it.\n   *\n   * @example\n   * ```ts\n   * onUpdate: (node, decorations, innerDecorations) => {\n   *   if (node.type !== this.node.type) return false\n   *   return true\n   * }\n   * ```\n   */\n  onUpdate: NodeView['update']\n\n  /**\n   * Optional configuration for resize behavior and styling\n   */\n  options?: {\n    /**\n     * Which resize handles to display.\n     * @default ['bottom-left', 'bottom-right', 'top-left', 'top-right']\n     *\n     * @example\n     * ```ts\n     * // Only show corner handles\n     * directions: ['top-left', 'top-right', 'bottom-left', 'bottom-right']\n     *\n     * // Only show right edge handle\n     * directions: ['right']\n     * ```\n     */\n    directions?: ResizableNodeViewDirection[]\n\n    /**\n     * Minimum dimensions in pixels\n     * @default { width: 8, height: 8 }\n     *\n     * @example\n     * ```ts\n     * min: { width: 100, height: 50 }\n     * ```\n     */\n    min?: Partial<ResizableNodeDimensions>\n\n    /**\n     * Maximum dimensions in pixels\n     * @default undefined (no maximum)\n     *\n     * @example\n     * ```ts\n     * max: { width: 1000, height: 800 }\n     * ```\n     */\n    max?: Partial<ResizableNodeDimensions>\n\n    /**\n     * Always preserve aspect ratio when resizing.\n     * When `false`, aspect ratio is preserved only when Shift key is pressed.\n     * @default false\n     *\n     * @example\n     * ```ts\n     * preserveAspectRatio: true // Always lock aspect ratio\n     * ```\n     */\n    preserveAspectRatio?: boolean\n\n    /**\n     * Custom CSS class names for styling\n     *\n     * @example\n     * ```ts\n     * className: {\n     *   container: 'resize-container',\n     *   wrapper: 'resize-wrapper',\n     *   handle: 'resize-handle',\n     *   resizing: 'is-resizing'\n     * }\n     * ```\n     */\n    className?: {\n      /** Class for the outer container element */\n      container?: string\n      /** Class for the wrapper element that contains the resizable element */\n      wrapper?: string\n      /** Class applied to all resize handles */\n      handle?: string\n      /** Class added to container while actively resizing */\n      resizing?: string\n    }\n\n    /**\n     * Optional callback for creating custom resize handle elements.\n     *\n     * This function allows developers to define their own handle element\n     * (e.g., custom icons, classes, or styles) for a given resize direction.\n     * It is called internally for each handle direction.\n     *\n     * @param direction - The direction of the handle being created (e.g., 'top', 'bottom-right').\n     * @returns The custom handle HTMLElement.\n     *\n     * @example\n     * ```ts\n     * createCustomHandle: (direction) => {\n     *   const handle = document.createElement('div')\n     *   handle.dataset.resizeHandle = direction\n     *   handle.style.position = 'absolute'\n     *   handle.className = 'tiptap-custom-handle'\n     *\n     *   const isTop = direction.includes('top')\n     *   const isBottom = direction.includes('bottom')\n     *   const isLeft = direction.includes('left')\n     *   const isRight = direction.includes('right')\n     *\n     *   if (isTop) handle.style.top = '0'\n     *   if (isBottom) handle.style.bottom = '0'\n     *   if (isLeft) handle.style.left = '0'\n     *   if (isRight) handle.style.right = '0'\n     *\n     *   // Edge handles span the full width or height\n     *   if (direction === 'top' || direction === 'bottom') {\n     *     handle.style.left = '0'\n     *     handle.style.right = '0'\n     *   }\n     *\n     *   if (direction === 'left' || direction === 'right') {\n     *     handle.style.top = '0'\n     *     handle.style.bottom = '0'\n     *   }\n     *\n     *   return handle\n     * }\n     * ```\n     */\n    createCustomHandle?: (direction: ResizableNodeViewDirection) => HTMLElement\n  }\n}\n\n/**\n * A NodeView implementation that adds resize handles to any DOM element.\n *\n * This class creates a resizable node view for Tiptap/ProseMirror editors.\n * It wraps your element with resize handles and manages the resize interaction,\n * including aspect ratio preservation, min/max constraints, and keyboard modifiers.\n *\n * @example\n * ```ts\n * // Basic usage in a Tiptap extension\n * addNodeView() {\n *   return ({ node, getPos }) => {\n *     const img = document.createElement('img')\n *     img.src = node.attrs.src\n *\n *     return new ResizableNodeView({\n *       element: img,\n *       node,\n *       getPos,\n *       onResize: (width, height) => {\n *         img.style.width = `${width}px`\n *         img.style.height = `${height}px`\n *       },\n *       onCommit: (width, height) => {\n *         this.editor.commands.updateAttributes('image', { width, height })\n *       },\n *       onUpdate: () => true,\n *       options: {\n *         min: { width: 100, height: 100 },\n *         preserveAspectRatio: true\n *       }\n *     })\n *   }\n * }\n * ```\n */\nexport class ResizableNodeView {\n  /** The ProseMirror node instance */\n  node: PMNode\n\n  /** The Tiptap editor instance */\n  editor: Editor\n\n  /** The DOM element being made resizable */\n  element: HTMLElement\n\n  /** The editable DOM element inside the DOM */\n  contentElement?: HTMLElement\n\n  /** The outer container element (returned as NodeView.dom) */\n  container: HTMLElement\n\n  /** The wrapper element that contains the element and handles */\n  wrapper: HTMLElement\n\n  /** Function to get the current node position */\n  getPos: () => number | undefined\n\n  /** Callback fired during resize */\n  onResize?: (width: number, height: number) => void\n\n  /** Callback fired when resize completes */\n  onCommit: (width: number, height: number) => void\n\n  /** Callback for node updates */\n  onUpdate?: NodeView['update']\n\n  /** Active resize handle directions */\n  directions: ResizableNodeViewDirection[] = ['bottom-left', 'bottom-right', 'top-left', 'top-right']\n\n  /** Minimum allowed dimensions */\n  minSize: ResizableNodeDimensions = {\n    height: 8,\n    width: 8,\n  }\n\n  /** Maximum allowed dimensions (optional) */\n  maxSize?: Partial<ResizableNodeDimensions>\n\n  /** Whether to always preserve aspect ratio */\n  preserveAspectRatio: boolean = false\n\n  /** CSS class names for elements */\n  classNames = {\n    container: '',\n    wrapper: '',\n    handle: '',\n    resizing: '',\n  }\n\n  /** Optional callback for creating custom resize handles */\n  createCustomHandle?: (direction: ResizableNodeViewDirection) => HTMLElement\n\n  /** Initial width of the element (for aspect ratio calculation) */\n  private initialWidth: number = 0\n\n  /** Initial height of the element (for aspect ratio calculation) */\n  private initialHeight: number = 0\n\n  /** Calculated aspect ratio (width / height) */\n  private aspectRatio: number = 1\n\n  /** Whether a resize operation is currently active */\n  private isResizing: boolean = false\n\n  /** The handle currently being dragged */\n  private activeHandle: ResizableNodeViewDirection | null = null\n\n  /** Starting mouse X position when resize began */\n  private startX: number = 0\n\n  /** Starting mouse Y position when resize began */\n  private startY: number = 0\n\n  /** Element width when resize began */\n  private startWidth: number = 0\n\n  /** Element height when resize began */\n  private startHeight: number = 0\n\n  /** Whether Shift key is currently pressed (for temporary aspect ratio lock) */\n  private isShiftKeyPressed: boolean = false\n\n  /** Last known editable state of the editor */\n  private lastEditableState: boolean | undefined = undefined\n\n  /** Map of handle elements by direction */\n  private handleMap = new Map<ResizableNodeViewDirection, HTMLElement>()\n\n  /**\n   * Creates a new ResizableNodeView instance.\n   *\n   * The constructor sets up the resize handles, applies initial sizing from\n   * node attributes, and configures all resize behavior options.\n   *\n   * @param options - Configuration options for the resizable node view\n   */\n  constructor(options: ResizableNodeViewOptions) {\n    this.node = options.node\n    this.editor = options.editor\n    this.element = options.element\n    this.contentElement = options.contentElement\n\n    this.getPos = options.getPos\n\n    this.onResize = options.onResize\n    this.onCommit = options.onCommit\n    this.onUpdate = options.onUpdate\n\n    if (options.options?.min) {\n      this.minSize = {\n        ...this.minSize,\n        ...options.options.min,\n      }\n    }\n\n    if (options.options?.max) {\n      this.maxSize = options.options.max\n    }\n\n    if (options?.options?.directions) {\n      this.directions = options.options.directions\n    }\n\n    if (options.options?.preserveAspectRatio) {\n      this.preserveAspectRatio = options.options.preserveAspectRatio\n    }\n\n    if (options.options?.className) {\n      this.classNames = {\n        container: options.options.className.container || '',\n        wrapper: options.options.className.wrapper || '',\n        handle: options.options.className.handle || '',\n        resizing: options.options.className.resizing || '',\n      }\n    }\n\n    if (options.options?.createCustomHandle) {\n      this.createCustomHandle = options.options.createCustomHandle\n    }\n\n    this.wrapper = this.createWrapper()\n    this.container = this.createContainer()\n\n    this.applyInitialSize()\n    this.attachHandles()\n\n    this.editor.on('update', this.handleEditorUpdate.bind(this))\n  }\n\n  /**\n   * Returns the top-level DOM node that should be placed in the editor.\n   *\n   * This is required by the ProseMirror NodeView interface. The container\n   * includes the wrapper, handles, and the actual content element.\n   *\n   * @returns The container element to be inserted into the editor\n   */\n  get dom() {\n    return this.container\n  }\n\n  get contentDOM() {\n    return this.contentElement\n  }\n\n  private handleEditorUpdate() {\n    const isEditable = this.editor.isEditable\n\n    // Only if state actually changed\n    if (isEditable === this.lastEditableState) {\n      return\n    }\n\n    this.lastEditableState = isEditable\n\n    if (!isEditable) {\n      this.removeHandles()\n    } else if (isEditable && this.handleMap.size === 0) {\n      this.attachHandles()\n    }\n  }\n\n  /**\n   * Called when the node's content or attributes change.\n   *\n   * Updates the internal node reference. If a custom `onUpdate` callback\n   * was provided, it will be called to handle additional update logic.\n   *\n   * @param node - The new/updated node\n   * @param decorations - Node decorations\n   * @param innerDecorations - Inner decorations\n   * @returns `false` if the node type has changed (requires full rebuild), otherwise the result of `onUpdate` or `true`\n   */\n  update(node: PMNode, decorations: readonly Decoration[], innerDecorations: DecorationSource): boolean {\n    if (node.type !== this.node.type) {\n      return false\n    }\n\n    this.node = node\n\n    if (this.onUpdate) {\n      return this.onUpdate(node, decorations, innerDecorations)\n    }\n\n    return true\n  }\n\n  /**\n   * Cleanup method called when the node view is being removed.\n   *\n   * Removes all event listeners to prevent memory leaks. This is required\n   * by the ProseMirror NodeView interface. If a resize is active when\n   * destroy is called, it will be properly cancelled.\n   */\n  destroy() {\n    if (this.isResizing) {\n      this.container.dataset.resizeState = 'false'\n\n      if (this.classNames.resizing) {\n        this.container.classList.remove(this.classNames.resizing)\n      }\n\n      document.removeEventListener('mousemove', this.handleMouseMove)\n      document.removeEventListener('mouseup', this.handleMouseUp)\n      document.removeEventListener('keydown', this.handleKeyDown)\n      document.removeEventListener('keyup', this.handleKeyUp)\n      this.isResizing = false\n      this.activeHandle = null\n    }\n\n    this.editor.off('update', this.handleEditorUpdate.bind(this))\n\n    this.container.remove()\n  }\n\n  /**\n   * Creates the outer container element.\n   *\n   * The container is the top-level element returned by the NodeView and\n   * wraps the entire resizable node. It's set up with flexbox to handle\n   * alignment and includes data attributes for styling and identification.\n   *\n   * @returns The container element\n   */\n  createContainer() {\n    const element = document.createElement('div')\n    element.dataset.resizeContainer = ''\n    element.dataset.node = this.node.type.name\n    element.style.display = 'flex'\n\n    if (this.classNames.container) {\n      element.className = this.classNames.container\n    }\n\n    element.appendChild(this.wrapper)\n\n    return element\n  }\n\n  /**\n   * Creates the wrapper element that contains the content and handles.\n   *\n   * The wrapper uses relative positioning so that resize handles can be\n   * positioned absolutely within it. This is the direct parent of the\n   * content element being made resizable.\n   *\n   * @returns The wrapper element\n   */\n  createWrapper() {\n    const element = document.createElement('div')\n    element.style.position = 'relative'\n    element.style.display = 'block'\n    element.dataset.resizeWrapper = ''\n\n    if (this.classNames.wrapper) {\n      element.className = this.classNames.wrapper\n    }\n\n    element.appendChild(this.element)\n\n    return element\n  }\n\n  /**\n   * Creates a resize handle element for a specific direction.\n   *\n   * Each handle is absolutely positioned and includes a data attribute\n   * identifying its direction for styling purposes.\n   *\n   * @param direction - The resize direction for this handle\n   * @returns The handle element\n   */\n  private createHandle(direction: ResizableNodeViewDirection): HTMLElement {\n    const handle = document.createElement('div')\n    handle.dataset.resizeHandle = direction\n    handle.style.position = 'absolute'\n\n    if (this.classNames.handle) {\n      handle.className = this.classNames.handle\n    }\n\n    return handle\n  }\n\n  /**\n   * Positions a handle element according to its direction.\n   *\n   * Corner handles (e.g., 'top-left') are positioned at the intersection\n   * of two edges. Edge handles (e.g., 'top') span the full width or height.\n   *\n   * @param handle - The handle element to position\n   * @param direction - The direction determining the position\n   */\n  private positionHandle(handle: HTMLElement, direction: ResizableNodeViewDirection): void {\n    const isTop = direction.includes('top')\n    const isBottom = direction.includes('bottom')\n    const isLeft = direction.includes('left')\n    const isRight = direction.includes('right')\n\n    if (isTop) {\n      handle.style.top = '0'\n    }\n\n    if (isBottom) {\n      handle.style.bottom = '0'\n    }\n\n    if (isLeft) {\n      handle.style.left = '0'\n    }\n\n    if (isRight) {\n      handle.style.right = '0'\n    }\n\n    // Edge handles span the full width or height\n    if (direction === 'top' || direction === 'bottom') {\n      handle.style.left = '0'\n      handle.style.right = '0'\n    }\n\n    if (direction === 'left' || direction === 'right') {\n      handle.style.top = '0'\n      handle.style.bottom = '0'\n    }\n  }\n\n  /**\n   * Creates and attaches all resize handles to the wrapper.\n   *\n   * Iterates through the configured directions, creates a handle for each,\n   * positions it, attaches the mousedown listener, and appends it to the DOM.\n   */\n  private attachHandles(): void {\n    this.directions.forEach(direction => {\n      let handle: HTMLElement\n\n      if (this.createCustomHandle) {\n        handle = this.createCustomHandle(direction)\n      } else {\n        handle = this.createHandle(direction)\n      }\n\n      if (!(handle instanceof HTMLElement)) {\n        console.warn(\n          `[ResizableNodeView] createCustomHandle(\"${direction}\") did not return an HTMLElement. Falling back to default handle.`,\n        )\n        handle = this.createHandle(direction)\n      }\n\n      if (!this.createCustomHandle) {\n        this.positionHandle(handle, direction)\n      }\n\n      handle.addEventListener('mousedown', event => this.handleResizeStart(event, direction))\n      handle.addEventListener('touchstart', event => this.handleResizeStart(event as unknown as MouseEvent, direction))\n\n      this.handleMap.set(direction, handle)\n\n      this.wrapper.appendChild(handle)\n    })\n  }\n\n  /**\n   * Removes all resize handles from the wrapper.\n   *\n   * Cleans up the handle map and removes each handle element from the DOM.\n   */\n  private removeHandles(): void {\n    this.handleMap.forEach(el => el.remove())\n    this.handleMap.clear()\n  }\n\n  /**\n   * Applies initial sizing from node attributes to the element.\n   *\n   * If width/height attributes exist on the node, they're applied to the element.\n   * Otherwise, the element's natural/current dimensions are measured. The aspect\n   * ratio is calculated for later use in aspect-ratio-preserving resizes.\n   */\n  private applyInitialSize(): void {\n    const width = this.node.attrs.width as number | undefined\n    const height = this.node.attrs.height as number | undefined\n\n    if (width) {\n      this.element.style.width = `${width}px`\n      this.initialWidth = width\n    } else {\n      this.initialWidth = this.element.offsetWidth\n    }\n\n    if (height) {\n      this.element.style.height = `${height}px`\n      this.initialHeight = height\n    } else {\n      this.initialHeight = this.element.offsetHeight\n    }\n\n    // Calculate aspect ratio for use during resizing\n    if (this.initialWidth > 0 && this.initialHeight > 0) {\n      this.aspectRatio = this.initialWidth / this.initialHeight\n    }\n  }\n\n  /**\n   * Initiates a resize operation when a handle is clicked.\n   *\n   * Captures the starting mouse position and element dimensions, sets up\n   * the resize state, adds the resizing class and state attribute, and\n   * attaches document-level listeners for mouse movement and keyboard input.\n   *\n   * @param event - The mouse down event\n   * @param direction - The direction of the handle being dragged\n   */\n  private handleResizeStart(event: MouseEvent | TouchEvent, direction: ResizableNodeViewDirection): void {\n    event.preventDefault()\n    event.stopPropagation()\n\n    // Capture initial state\n    this.isResizing = true\n    this.activeHandle = direction\n\n    if (isTouchEvent(event)) {\n      this.startX = event.touches[0].clientX\n      this.startY = event.touches[0].clientY\n    } else {\n      this.startX = event.clientX\n      this.startY = event.clientY\n    }\n\n    this.startWidth = this.element.offsetWidth\n    this.startHeight = this.element.offsetHeight\n\n    // Recalculate aspect ratio at resize start for accuracy\n    if (this.startWidth > 0 && this.startHeight > 0) {\n      this.aspectRatio = this.startWidth / this.startHeight\n    }\n\n    const pos = this.getPos()\n    if (pos !== undefined) {\n      // TODO: Select the node in the editor\n    }\n\n    // Update UI state\n    this.container.dataset.resizeState = 'true'\n\n    if (this.classNames.resizing) {\n      this.container.classList.add(this.classNames.resizing)\n    }\n\n    // Attach document-level listeners for resize\n    document.addEventListener('mousemove', this.handleMouseMove)\n    document.addEventListener('touchmove', this.handleTouchMove)\n    document.addEventListener('mouseup', this.handleMouseUp)\n    document.addEventListener('keydown', this.handleKeyDown)\n    document.addEventListener('keyup', this.handleKeyUp)\n  }\n\n  /**\n   * Handles mouse movement during an active resize.\n   *\n   * Calculates the delta from the starting position, computes new dimensions\n   * based on the active handle direction, applies constraints and aspect ratio,\n   * then updates the element's style and calls the onResize callback.\n   *\n   * @param event - The mouse move event\n   */\n  private handleMouseMove = (event: MouseEvent): void => {\n    if (!this.isResizing || !this.activeHandle) {\n      return\n    }\n\n    const deltaX = event.clientX - this.startX\n    const deltaY = event.clientY - this.startY\n\n    this.handleResize(deltaX, deltaY)\n  }\n\n  private handleTouchMove = (event: TouchEvent): void => {\n    if (!this.isResizing || !this.activeHandle) {\n      return\n    }\n\n    const touch = event.touches[0]\n    if (!touch) {\n      return\n    }\n\n    const deltaX = touch.clientX - this.startX\n    const deltaY = touch.clientY - this.startY\n\n    this.handleResize(deltaX, deltaY)\n  }\n\n  private handleResize(deltaX: number, deltaY: number) {\n    if (!this.activeHandle) {\n      return\n    }\n\n    const shouldPreserveAspectRatio = this.preserveAspectRatio || this.isShiftKeyPressed\n    const { width, height } = this.calculateNewDimensions(this.activeHandle, deltaX, deltaY)\n    const constrained = this.applyConstraints(width, height, shouldPreserveAspectRatio)\n\n    this.element.style.width = `${constrained.width}px`\n    this.element.style.height = `${constrained.height}px`\n\n    if (this.onResize) {\n      this.onResize(constrained.width, constrained.height)\n    }\n  }\n\n  /**\n   * Completes the resize operation when the mouse button is released.\n   *\n   * Captures final dimensions, calls the onCommit callback to persist changes,\n   * removes the resizing state and class, and cleans up document-level listeners.\n   */\n  private handleMouseUp = (): void => {\n    if (!this.isResizing) {\n      return\n    }\n\n    const finalWidth = this.element.offsetWidth\n    const finalHeight = this.element.offsetHeight\n\n    this.onCommit(finalWidth, finalHeight)\n\n    this.isResizing = false\n    this.activeHandle = null\n\n    // Remove UI state\n    this.container.dataset.resizeState = 'false'\n\n    if (this.classNames.resizing) {\n      this.container.classList.remove(this.classNames.resizing)\n    }\n\n    // Clean up document-level listeners\n    document.removeEventListener('mousemove', this.handleMouseMove)\n    document.removeEventListener('mouseup', this.handleMouseUp)\n    document.removeEventListener('keydown', this.handleKeyDown)\n    document.removeEventListener('keyup', this.handleKeyUp)\n  }\n\n  /**\n   * Tracks Shift key state to enable temporary aspect ratio locking.\n   *\n   * When Shift is pressed during resize, aspect ratio is preserved even if\n   * preserveAspectRatio is false.\n   *\n   * @param event - The keyboard event\n   */\n  private handleKeyDown = (event: KeyboardEvent): void => {\n    if (event.key === 'Shift') {\n      this.isShiftKeyPressed = true\n    }\n  }\n\n  /**\n   * Tracks Shift key release to disable temporary aspect ratio locking.\n   *\n   * @param event - The keyboard event\n   */\n  private handleKeyUp = (event: KeyboardEvent): void => {\n    if (event.key === 'Shift') {\n      this.isShiftKeyPressed = false\n    }\n  }\n\n  /**\n   * Calculates new dimensions based on mouse delta and resize direction.\n   *\n   * Takes the starting dimensions and applies the mouse movement delta\n   * according to the handle direction. For corner handles, both dimensions\n   * are affected. For edge handles, only one dimension changes. If aspect\n   * ratio should be preserved, delegates to applyAspectRatio.\n   *\n   * @param direction - The active resize handle direction\n   * @param deltaX - Horizontal mouse movement since resize start\n   * @param deltaY - Vertical mouse movement since resize start\n   * @returns The calculated width and height\n   */\n  private calculateNewDimensions(\n    direction: ResizableNodeViewDirection,\n    deltaX: number,\n    deltaY: number,\n  ): ResizableNodeDimensions {\n    let newWidth = this.startWidth\n    let newHeight = this.startHeight\n\n    const isRight = direction.includes('right')\n    const isLeft = direction.includes('left')\n    const isBottom = direction.includes('bottom')\n    const isTop = direction.includes('top')\n\n    // Apply horizontal delta\n    if (isRight) {\n      newWidth = this.startWidth + deltaX\n    } else if (isLeft) {\n      newWidth = this.startWidth - deltaX\n    }\n\n    // Apply vertical delta\n    if (isBottom) {\n      newHeight = this.startHeight + deltaY\n    } else if (isTop) {\n      newHeight = this.startHeight - deltaY\n    }\n\n    // For pure horizontal/vertical handles, only one dimension changes\n    if (direction === 'right' || direction === 'left') {\n      newWidth = this.startWidth + (isRight ? deltaX : -deltaX)\n    }\n\n    if (direction === 'top' || direction === 'bottom') {\n      newHeight = this.startHeight + (isBottom ? deltaY : -deltaY)\n    }\n\n    const shouldPreserveAspectRatio = this.preserveAspectRatio || this.isShiftKeyPressed\n\n    if (shouldPreserveAspectRatio) {\n      return this.applyAspectRatio(newWidth, newHeight, direction)\n    }\n\n    return { width: newWidth, height: newHeight }\n  }\n\n  /**\n   * Applies min/max constraints to dimensions.\n   *\n   * When aspect ratio is NOT preserved, constraints are applied independently\n   * to width and height. When aspect ratio IS preserved, constraints are\n   * applied while maintaining the aspect ratioif one dimension hits a limit,\n   * the other is recalculated proportionally.\n   *\n   * This ensures that aspect ratio is never broken when constrained.\n   *\n   * @param width - The unconstrained width\n   * @param height - The unconstrained height\n   * @param preserveAspectRatio - Whether to maintain aspect ratio while constraining\n   * @returns The constrained dimensions\n   */\n  private applyConstraints(width: number, height: number, preserveAspectRatio: boolean): ResizableNodeDimensions {\n    if (!preserveAspectRatio) {\n      // Independent constraints for each dimension\n      let constrainedWidth = Math.max(this.minSize.width, width)\n      let constrainedHeight = Math.max(this.minSize.height, height)\n\n      if (this.maxSize?.width) {\n        constrainedWidth = Math.min(this.maxSize.width, constrainedWidth)\n      }\n\n      if (this.maxSize?.height) {\n        constrainedHeight = Math.min(this.maxSize.height, constrainedHeight)\n      }\n\n      return { width: constrainedWidth, height: constrainedHeight }\n    }\n\n    // Aspect-ratio-aware constraints: adjust both dimensions proportionally\n    let constrainedWidth = width\n    let constrainedHeight = height\n\n    // Check minimum constraints\n    if (constrainedWidth < this.minSize.width) {\n      constrainedWidth = this.minSize.width\n      constrainedHeight = constrainedWidth / this.aspectRatio\n    }\n\n    if (constrainedHeight < this.minSize.height) {\n      constrainedHeight = this.minSize.height\n      constrainedWidth = constrainedHeight * this.aspectRatio\n    }\n\n    // Check maximum constraints\n    if (this.maxSize?.width && constrainedWidth > this.maxSize.width) {\n      constrainedWidth = this.maxSize.width\n      constrainedHeight = constrainedWidth / this.aspectRatio\n    }\n\n    if (this.maxSize?.height && constrainedHeight > this.maxSize.height) {\n      constrainedHeight = this.maxSize.height\n      constrainedWidth = constrainedHeight * this.aspectRatio\n    }\n\n    return { width: constrainedWidth, height: constrainedHeight }\n  }\n\n  /**\n   * Adjusts dimensions to maintain the original aspect ratio.\n   *\n   * For horizontal handles (left/right), uses width as the primary dimension\n   * and calculates height from it. For vertical handles (top/bottom), uses\n   * height as primary and calculates width. For corner handles, uses width\n   * as the primary dimension.\n   *\n   * @param width - The new width\n   * @param height - The new height\n   * @param direction - The active resize direction\n   * @returns Dimensions adjusted to preserve aspect ratio\n   */\n  private applyAspectRatio(\n    width: number,\n    height: number,\n    direction: ResizableNodeViewDirection,\n  ): ResizableNodeDimensions {\n    const isHorizontal = direction === 'left' || direction === 'right'\n    const isVertical = direction === 'top' || direction === 'bottom'\n\n    if (isHorizontal) {\n      // For horizontal resize, width is primary\n      return {\n        width,\n        height: width / this.aspectRatio,\n      }\n    }\n\n    if (isVertical) {\n      // For vertical resize, height is primary\n      return {\n        width: height * this.aspectRatio,\n        height,\n      }\n    }\n\n    // For corner resize, width is primary\n    return {\n      width,\n      height: width / this.aspectRatio,\n    }\n  }\n}\n\n/**\n * Alias for ResizableNodeView to maintain consistent naming.\n * @deprecated Use ResizableNodeView instead - will be removed in future versions.\n */\nexport const ResizableNodeview = ResizableNodeView\n","import type { NodeType } from '@tiptap/pm/model'\nimport { type EditorState, NodeSelection } from '@tiptap/pm/state'\n\nexport function canInsertNode(state: EditorState, nodeType: NodeType): boolean {\n  const { selection } = state\n  const { $from } = selection\n\n  // Special handling for NodeSelection\n  if (selection instanceof NodeSelection) {\n    const index = $from.index()\n    const parent = $from.parent\n\n    // Can we replace the selected node with the horizontal rule?\n    return parent.canReplaceWith(index, index + 1, nodeType)\n  }\n\n  // Default: check if we can insert at the current position\n  let depth = $from.depth\n\n  while (depth >= 0) {\n    const index = $from.index(depth)\n    const parent = $from.node(depth)\n    const match = parent.contentMatchAt(index)\n    if (match.matchType(nodeType)) {\n      return true\n    }\n    depth -= 1\n  }\n  return false\n}\n","// source: https://stackoverflow.com/a/6969486\nexport function escapeForRegEx(string: string): string {\n  return string.replace(/[-/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\n}\n","export function isString(value: any): value is string {\n  return typeof value === 'string'\n}\n","/**\n * @fileoverview Markdown utilities for creating standardized markdown specs.\n *\n * This module provides utilities for creating complete markdown specifications\n * for different types of nodes using unified syntax patterns.\n */\n\nexport * from './attributeUtils.js'\nexport * from './createAtomBlockMarkdownSpec.js'\nexport * from './createBlockMarkdownSpec.js'\nexport * from './createInlineMarkdownSpec.js'\nexport * from './parseIndentedBlocks.js'\nexport * from './renderNestedMarkdownContent.js'\n","/**\n * @fileoverview Utility functions for parsing and serializing markdown attributes.\n *\n * These utilities handle the common patterns for parsing attribute strings\n * in various markdown syntaxes like Pandoc attributes.\n */\n\n/**\n * Parses a Pandoc-style attribute string into an object.\n *\n * Supports the following patterns:\n * - Classes: `.className`  `{ class: 'className' }`\n * - IDs: `#myId`  `{ id: 'myId' }`\n * - Key-value pairs: `key=\"value\"`  `{ key: 'value' }`\n * - Boolean attributes: `disabled`  `{ disabled: true }`\n *\n * @param attrString - The attribute string to parse\n * @returns Parsed attributes object\n *\n * @example\n * ```ts\n * parseAttributes('.btn #submit disabled type=\"button\"')\n * //  { class: 'btn', id: 'submit', disabled: true, type: 'button' }\n * ```\n */\nexport function parseAttributes(attrString: string): Record<string, any> {\n  if (!attrString?.trim()) {\n    return {}\n  }\n\n  const attributes: Record<string, any> = {}\n\n  // First, extract and remove quoted strings to avoid parsing content inside them\n  const quotedStrings: string[] = []\n  const tempString = attrString.replace(/[\"']([^\"']*)[\"']/g, match => {\n    quotedStrings.push(match)\n    return `__QUOTED_${quotedStrings.length - 1}__`\n  })\n\n  // Parse classes (.className) - only outside of quoted strings\n  const classMatches = tempString.match(/(?:^|\\s)\\.([a-zA-Z][\\w-]*)/g)\n  if (classMatches) {\n    const classes = classMatches.map(match => match.trim().slice(1)) // Remove the dot\n    attributes.class = classes.join(' ')\n  }\n\n  // Parse IDs (#myId) - only outside of quoted strings\n  const idMatch = tempString.match(/(?:^|\\s)#([a-zA-Z][\\w-]*)/)\n  if (idMatch) {\n    attributes.id = idMatch[1]\n  }\n\n  // Parse key-value pairs (key=\"value\" or key='value') - restore quoted strings\n  const kvRegex = /([a-zA-Z][\\w-]*)\\s*=\\s*(__QUOTED_\\d+__)/g\n  const kvMatches = Array.from(tempString.matchAll(kvRegex))\n  kvMatches.forEach(([, key, quotedRef]) => {\n    const quotedIndex = parseInt(quotedRef.match(/__QUOTED_(\\d+)__/)?.[1] || '0', 10)\n    const quotedValue = quotedStrings[quotedIndex]\n    if (quotedValue) {\n      // Remove the outer quotes\n      attributes[key] = quotedValue.slice(1, -1)\n    }\n  })\n\n  // Parse boolean attributes (standalone words that aren't classes/IDs)\n  const cleanString = tempString\n    .replace(/(?:^|\\s)\\.([a-zA-Z][\\w-]*)/g, '') // Remove classes\n    .replace(/(?:^|\\s)#([a-zA-Z][\\w-]*)/g, '') // Remove IDs\n    .replace(/([a-zA-Z][\\w-]*)\\s*=\\s*__QUOTED_\\d+__/g, '') // Remove key-value pairs\n    .trim()\n\n  if (cleanString) {\n    const booleanAttrs = cleanString.split(/\\s+/).filter(Boolean)\n    booleanAttrs.forEach(attr => {\n      if (attr.match(/^[a-zA-Z][\\w-]*$/)) {\n        attributes[attr] = true\n      }\n    })\n  }\n\n  return attributes\n}\n\n/**\n * Serializes an attributes object back to a Pandoc-style attribute string.\n *\n * @param attributes - The attributes object to serialize\n * @returns Serialized attribute string\n *\n * @example\n * ```ts\n * serializeAttributes({ class: 'btn primary', id: 'submit', disabled: true, type: 'button' })\n * //  '.btn.primary #submit disabled type=\"button\"'\n * ```\n */\nexport function serializeAttributes(attributes: Record<string, any>): string {\n  if (!attributes || Object.keys(attributes).length === 0) {\n    return ''\n  }\n\n  const parts: string[] = []\n\n  // Handle classes\n  if (attributes.class) {\n    const classes = String(attributes.class).split(/\\s+/).filter(Boolean)\n    classes.forEach(cls => parts.push(`.${cls}`))\n  }\n\n  // Handle ID\n  if (attributes.id) {\n    parts.push(`#${attributes.id}`)\n  }\n\n  // Handle other attributes\n  Object.entries(attributes).forEach(([key, value]) => {\n    if (key === 'class' || key === 'id') {\n      return // Already handled\n    }\n\n    if (value === true) {\n      // Boolean attribute\n      parts.push(key)\n    } else if (value !== false && value != null) {\n      // Key-value attribute\n      parts.push(`${key}=\"${String(value)}\"`)\n    }\n  })\n\n  return parts.join(' ')\n}\n","import type {\n  JSONContent,\n  MarkdownParseHelpers,\n  MarkdownParseResult,\n  MarkdownToken,\n  MarkdownTokenizer,\n} from '../../types.js'\nimport {\n  parseAttributes as defaultParseAttributes,\n  serializeAttributes as defaultSerializeAttributes,\n} from './attributeUtils.js'\n\nexport interface AtomBlockMarkdownSpecOptions {\n  /** The Tiptap node name this spec is for */\n  nodeName: string\n  /** The markdown syntax name (defaults to nodeName if not provided) */\n  name?: string\n  /** Function to parse attributes from token attribute string */\n  parseAttributes?: (attrString: string) => Record<string, any>\n  /** Function to serialize attributes back to string for rendering */\n  serializeAttributes?: (attrs: Record<string, any>) => string\n  /** Default attributes to apply when parsing */\n  defaultAttributes?: Record<string, any>\n  /** Required attributes that must be present for successful parsing */\n  requiredAttributes?: string[]\n  /** Attributes that are allowed to be rendered back to markdown (whitelist) */\n  allowedAttributes?: string[]\n}\n\n/**\n * Creates a complete markdown spec for atomic block nodes using Pandoc syntax.\n *\n * The generated spec handles:\n * - Parsing self-closing blocks with `:::blockName {attributes}`\n * - Extracting and parsing attributes\n * - Validating required attributes\n * - Rendering blocks back to markdown\n *\n * @param options - Configuration for the atomic block markdown spec\n * @returns Complete markdown specification object\n *\n * @example\n * ```ts\n * const youtubeSpec = createAtomBlockMarkdownSpec({\n *   nodeName: 'youtube',\n *   requiredAttributes: ['src'],\n *   defaultAttributes: { start: 0 },\n *   allowedAttributes: ['src', 'start', 'width', 'height'] // Only these get rendered to markdown\n * })\n *\n * // Usage in extension:\n * export const Youtube = Node.create({\n *   // ... other config\n *   markdown: youtubeSpec\n * })\n * ```\n */\nexport function createAtomBlockMarkdownSpec(options: AtomBlockMarkdownSpecOptions): {\n  parseMarkdown: (token: MarkdownToken, h: MarkdownParseHelpers) => MarkdownParseResult\n  markdownTokenizer: MarkdownTokenizer\n  renderMarkdown: (node: JSONContent) => string\n} {\n  const {\n    nodeName,\n    name: markdownName,\n    parseAttributes = defaultParseAttributes,\n    serializeAttributes = defaultSerializeAttributes,\n    defaultAttributes = {},\n    requiredAttributes = [],\n    allowedAttributes,\n  } = options\n\n  // Use markdownName for syntax, fallback to nodeName\n  const blockName = markdownName || nodeName\n\n  // Helper function to filter attributes based on allowlist\n  const filterAttributes = (attrs: Record<string, any>) => {\n    if (!allowedAttributes) {\n      return attrs\n    }\n\n    const filtered: Record<string, any> = {}\n    allowedAttributes.forEach(key => {\n      if (key in attrs) {\n        filtered[key] = attrs[key]\n      }\n    })\n    return filtered\n  }\n\n  return {\n    parseMarkdown: (token: MarkdownToken, h: MarkdownParseHelpers) => {\n      const attrs = { ...defaultAttributes, ...token.attributes }\n      return h.createNode(nodeName, attrs, [])\n    },\n\n    markdownTokenizer: {\n      name: nodeName,\n      level: 'block' as const,\n      start(src: string) {\n        const regex = new RegExp(`^:::${blockName}(?:\\\\s|$)`, 'm')\n        const index = src.match(regex)?.index\n        return index !== undefined ? index : -1\n      },\n      tokenize(src, _tokens, _lexer) {\n        // Use non-global regex to match from the start of the string\n        // Include optional newline to ensure we consume the entire line\n        const regex = new RegExp(`^:::${blockName}(?:\\\\s+\\\\{([^}]*)\\\\})?\\\\s*:::(?:\\\\n|$)`)\n        const match = src.match(regex)\n\n        if (!match) {\n          return undefined\n        }\n\n        // Parse attributes if present\n        const attrString = match[1] || ''\n        const attributes = parseAttributes(attrString)\n\n        // Validate required attributes\n        const missingRequired = requiredAttributes.find(required => !(required in attributes))\n        if (missingRequired) {\n          return undefined\n        }\n\n        return {\n          type: nodeName,\n          raw: match[0],\n          attributes,\n        }\n      },\n    },\n\n    renderMarkdown: node => {\n      const filteredAttrs = filterAttributes(node.attrs || {})\n      const attrs = serializeAttributes(filteredAttrs)\n      const attrString = attrs ? ` {${attrs}}` : ''\n\n      return `:::${blockName}${attrString} :::`\n    },\n  }\n}\n","import type {\n  JSONContent,\n  MarkdownParseHelpers,\n  MarkdownParseResult,\n  MarkdownRendererHelpers,\n  MarkdownToken,\n  MarkdownTokenizer,\n} from '../../types.js'\nimport {\n  parseAttributes as defaultParseAttributes,\n  serializeAttributes as defaultSerializeAttributes,\n} from './attributeUtils.js'\n\nexport interface BlockMarkdownSpecOptions {\n  /** The Tiptap node name this spec is for */\n  nodeName: string\n  /** The markdown syntax name (defaults to nodeName if not provided) */\n  name?: string\n  /** Function to extract content from the node for serialization */\n  getContent?: (token: MarkdownToken) => string\n  /** Function to parse attributes from the attribute string */\n  parseAttributes?: (attrString: string) => Record<string, any>\n  /** Function to serialize attributes to string */\n  serializeAttributes?: (attrs: Record<string, any>) => string\n  /** Default attributes to apply when parsing */\n  defaultAttributes?: Record<string, any>\n  /** Content type: 'block' allows paragraphs/lists/etc, 'inline' only allows bold/italic/links/etc */\n  content?: 'block' | 'inline'\n  /** Allowlist of attributes to include in markdown (if not provided, all attributes are included) */\n  allowedAttributes?: string[]\n}\n\n/**\n * Creates a complete markdown spec for block-level nodes using Pandoc syntax.\n *\n * The generated spec handles:\n * - Parsing blocks with `:::blockName {attributes}` syntax\n * - Extracting and parsing attributes\n * - Rendering blocks back to markdown with proper formatting\n * - Nested content support\n *\n * @param options - Configuration for the block markdown spec\n * @returns Complete markdown specification object\n *\n * @example\n * ```ts\n * const calloutSpec = createBlockMarkdownSpec({\n *   nodeName: 'callout',\n *   defaultAttributes: { type: 'info' },\n *   allowedAttributes: ['type', 'title'] // Only these get rendered to markdown\n * })\n *\n * // Usage in extension:\n * export const Callout = Node.create({\n *   // ... other config\n *   markdown: calloutSpec\n * })\n * ```\n */\nexport function createBlockMarkdownSpec(options: BlockMarkdownSpecOptions): {\n  parseMarkdown: (token: MarkdownToken, h: MarkdownParseHelpers) => MarkdownParseResult\n  markdownTokenizer: MarkdownTokenizer\n  renderMarkdown: (node: JSONContent, h: MarkdownRendererHelpers) => string\n} {\n  const {\n    nodeName,\n    name: markdownName,\n    getContent,\n    parseAttributes = defaultParseAttributes,\n    serializeAttributes = defaultSerializeAttributes,\n    defaultAttributes = {},\n    content = 'block',\n    allowedAttributes,\n  } = options\n\n  // Use markdownName for syntax, fallback to nodeName\n  const blockName = markdownName || nodeName\n\n  // Helper function to filter attributes based on allowlist\n  const filterAttributes = (attrs: Record<string, any>) => {\n    if (!allowedAttributes) {\n      return attrs\n    }\n\n    const filtered: Record<string, any> = {}\n    allowedAttributes.forEach(key => {\n      if (key in attrs) {\n        filtered[key] = attrs[key]\n      }\n    })\n    return filtered\n  }\n\n  return {\n    parseMarkdown: (token, h) => {\n      let nodeContent: JSONContent[]\n\n      if (getContent) {\n        const contentResult = getContent(token)\n        // If getContent returns a string, wrap it in a text node\n        nodeContent = typeof contentResult === 'string' ? [{ type: 'text', text: contentResult }] : contentResult\n      } else if (content === 'block') {\n        nodeContent = h.parseChildren(token.tokens || [])\n      } else {\n        nodeContent = h.parseInline(token.tokens || [])\n      }\n\n      const attrs = { ...defaultAttributes, ...token.attributes }\n\n      return h.createNode(nodeName, attrs, nodeContent)\n    },\n\n    markdownTokenizer: {\n      name: nodeName,\n      level: 'block' as const,\n      start(src) {\n        const regex = new RegExp(`^:::${blockName}`, 'm')\n        const index = src.match(regex)?.index\n        return index !== undefined ? index : -1\n      },\n      tokenize(src, _tokens, lexer) {\n        // Match the opening tag with optional attributes\n        const openingRegex = new RegExp(`^:::${blockName}(?:\\\\s+\\\\{([^}]*)\\\\})?\\\\s*\\\\n`)\n        const openingMatch = src.match(openingRegex)\n\n        if (!openingMatch) {\n          return undefined\n        }\n\n        const [openingTag, attrString = ''] = openingMatch\n        const attributes = parseAttributes(attrString)\n\n        // Find the matching closing tag by tracking nesting level\n        let level = 1\n        const position = openingTag.length\n        let matchedContent = ''\n\n        // Pattern to match any block opening (:::word) or closing (:::)\n        const blockPattern = /^:::([\\w-]*)(\\s.*)?/gm\n        const remaining = src.slice(position)\n\n        blockPattern.lastIndex = 0\n\n        // run until no more matches are found\n        for (;;) {\n          const match = blockPattern.exec(remaining)\n          if (match === null) {\n            break\n          }\n          const matchPos = match.index\n          const blockType = match[1] // Empty string for closing tag, block name for opening\n\n          if (match[2]?.endsWith(':::')) {\n            // this is an atom ::: node, we skip it\n            continue\n          }\n\n          if (blockType) {\n            // Opening tag found - increase level\n            level += 1\n          } else {\n            // Closing tag found - decrease level\n            level -= 1\n\n            if (level === 0) {\n              // Found our matching closing tag\n              // Don't trim yet - keep newlines for tokenizer regex matching\n              const rawContent = remaining.slice(0, matchPos)\n              matchedContent = rawContent.trim()\n              const fullMatch = src.slice(0, position + matchPos + match[0].length)\n\n              // Tokenize the content\n              let contentTokens: MarkdownToken[] = []\n              if (matchedContent) {\n                if (content === 'block') {\n                  // Use rawContent for tokenization to preserve line boundaries for regex matching\n                  contentTokens = lexer.blockTokens(rawContent)\n\n                  // Parse inline tokens for any token that has text content but no tokens\n                  contentTokens.forEach(token => {\n                    if (token.text && (!token.tokens || token.tokens.length === 0)) {\n                      token.tokens = lexer.inlineTokens(token.text)\n                    }\n                  })\n\n                  // Clean up empty trailing paragraphs\n                  while (contentTokens.length > 0) {\n                    const lastToken = contentTokens[contentTokens.length - 1]\n                    if (lastToken.type === 'paragraph' && (!lastToken.text || lastToken.text.trim() === '')) {\n                      contentTokens.pop()\n                    } else {\n                      break\n                    }\n                  }\n                } else {\n                  contentTokens = lexer.inlineTokens(matchedContent)\n                }\n              }\n\n              return {\n                type: nodeName,\n                raw: fullMatch,\n                attributes,\n                content: matchedContent,\n                tokens: contentTokens,\n              }\n            }\n          }\n        }\n\n        // No matching closing tag found\n        return undefined\n      },\n    },\n\n    renderMarkdown: (node, h) => {\n      const filteredAttrs = filterAttributes(node.attrs || {})\n      const attrs = serializeAttributes(filteredAttrs)\n      const attrString = attrs ? ` {${attrs}}` : ''\n      const renderedContent = h.renderChildren(node.content || [], '\\n\\n')\n\n      return `:::${blockName}${attrString}\\n\\n${renderedContent}\\n\\n:::`\n    },\n  }\n}\n","import type {\n  JSONContent,\n  MarkdownParseHelpers,\n  MarkdownParseResult,\n  MarkdownToken,\n  MarkdownTokenizer,\n} from '../../types.js'\n\n/**\n * Parse shortcode attributes like 'id=\"madonna\" handle=\"john\" name=\"John Doe\"'\n * Requires all values to be quoted with either single or double quotes\n */\nfunction parseShortcodeAttributes(attrString: string): Record<string, any> {\n  if (!attrString.trim()) {\n    return {}\n  }\n\n  const attributes: Record<string, any> = {}\n  // Match key=value pairs, only accepting quoted values\n  const regex = /(\\w+)=(?:\"([^\"]*)\"|'([^']*)')/g\n  let match = regex.exec(attrString)\n\n  while (match !== null) {\n    const [, key, doubleQuoted, singleQuoted] = match\n    attributes[key] = doubleQuoted || singleQuoted\n    match = regex.exec(attrString)\n  }\n\n  return attributes\n}\n\n/**\n * Serialize attributes back to shortcode format\n * Always quotes all values with double quotes\n */\nfunction serializeShortcodeAttributes(attrs: Record<string, any>): string {\n  return Object.entries(attrs)\n    .filter(([, value]) => value !== undefined && value !== null)\n    .map(([key, value]) => `${key}=\"${value}\"`)\n    .join(' ')\n}\n\n/**\n * Configuration for an allowed attribute in markdown serialization.\n * Can be a simple string (attribute name) or an object with additional options.\n */\nexport type AllowedAttribute =\n  | string\n  | {\n      /** The attribute name */\n      name: string\n      /**\n       * If provided, the attribute will be skipped during serialization when its value\n       * equals this default value. This keeps markdown output clean by omitting\n       * attributes that have their default values.\n       */\n      skipIfDefault?: any\n    }\n\nexport interface InlineMarkdownSpecOptions {\n  /** The Tiptap node name this spec is for */\n  nodeName: string\n  /** The shortcode name (defaults to nodeName if not provided) */\n  name?: string\n  /** Function to extract content from the node for serialization */\n  getContent?: (node: any) => string\n  /** Function to parse attributes from the attribute string */\n  parseAttributes?: (attrString: string) => Record<string, any>\n  /** Function to serialize attributes to string */\n  serializeAttributes?: (attrs: Record<string, any>) => string\n  /** Default attributes to apply when parsing */\n  defaultAttributes?: Record<string, any>\n  /** Whether this is a self-closing shortcode (no content, like [emoji name=party]) */\n  selfClosing?: boolean\n  /**\n   * Allowlist of attributes to include in markdown serialization.\n   * If not provided, all attributes are included.\n   *\n   * Each item can be either:\n   * - A string: the attribute name (always included if present)\n   * - An object: `{ name: string, skipIfDefault?: any }` for conditional inclusion\n   *\n   * @example\n   * // Simple string attributes (backward compatible)\n   * allowedAttributes: ['id', 'label']\n   *\n   * // Mixed with conditional attributes\n   * allowedAttributes: [\n   *   'id',\n   *   'label',\n   *   { name: 'mentionSuggestionChar', skipIfDefault: '@' }\n   * ]\n   */\n  allowedAttributes?: AllowedAttribute[]\n}\n\n/**\n * Creates a complete markdown spec for inline nodes using attribute syntax.\n *\n * The generated spec handles:\n * - Parsing shortcode syntax with `[nodeName attributes]content[/nodeName]` format\n * - Self-closing shortcodes like `[emoji name=party_popper]`\n * - Extracting and parsing attributes from the opening tag\n * - Rendering inline elements back to shortcode markdown\n * - Supporting both content-based and self-closing inline elements\n *\n * @param options - Configuration for the inline markdown spec\n * @returns Complete markdown specification object\n *\n * @example\n * ```ts\n * // Self-closing mention: [mention id=\"madonna\" label=\"Madonna\"]\n * const mentionSpec = createInlineMarkdownSpec({\n *   nodeName: 'mention',\n *   selfClosing: true,\n *   defaultAttributes: { type: 'user' },\n *   allowedAttributes: ['id', 'label'] // Only these get rendered to markdown\n * })\n *\n * // Self-closing emoji: [emoji name=\"party_popper\"]\n * const emojiSpec = createInlineMarkdownSpec({\n *   nodeName: 'emoji',\n *   selfClosing: true,\n *   allowedAttributes: ['name']\n * })\n *\n * // With content: [highlight color=\"yellow\"]text[/highlight]\n * const highlightSpec = createInlineMarkdownSpec({\n *   nodeName: 'highlight',\n *   selfClosing: false,\n *   allowedAttributes: ['color', 'style']\n * })\n *\n * // Usage in extension:\n * export const Mention = Node.create({\n *   name: 'mention', // Must match nodeName\n *   // ... other config\n *   markdown: mentionSpec\n * })\n * ```\n */\nexport function createInlineMarkdownSpec(options: InlineMarkdownSpecOptions): {\n  parseMarkdown: (token: MarkdownToken, h: MarkdownParseHelpers) => MarkdownParseResult\n  markdownTokenizer: MarkdownTokenizer\n  renderMarkdown: (node: JSONContent) => string\n} {\n  const {\n    nodeName,\n    name: shortcodeName,\n    getContent,\n    parseAttributes = parseShortcodeAttributes,\n    serializeAttributes = serializeShortcodeAttributes,\n    defaultAttributes = {},\n    selfClosing = false,\n    allowedAttributes,\n  } = options\n\n  // Use shortcodeName for markdown syntax, fallback to nodeName\n  const shortcode = shortcodeName || nodeName\n\n  // Helper function to filter attributes based on allowlist\n  const filterAttributes = (attrs: Record<string, any>) => {\n    if (!allowedAttributes) {\n      return attrs\n    }\n\n    const filtered: Record<string, any> = {}\n    allowedAttributes.forEach(attr => {\n      // Handle both string and object formats for backward compatibility\n      const attrName = typeof attr === 'string' ? attr : attr.name\n      const skipIfDefault = typeof attr === 'string' ? undefined : attr.skipIfDefault\n\n      if (attrName in attrs) {\n        const value = attrs[attrName]\n\n        // Skip if value equals the default (when skipIfDefault is specified)\n        if (skipIfDefault !== undefined && value === skipIfDefault) {\n          return\n        }\n\n        filtered[attrName] = value\n      }\n    })\n    return filtered\n  }\n\n  // Escape special regex characters in shortcode name\n  const escapedShortcode = shortcode.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n\n  return {\n    parseMarkdown: (token: MarkdownToken, h: MarkdownParseHelpers) => {\n      const attrs = { ...defaultAttributes, ...token.attributes }\n\n      if (selfClosing) {\n        // Self-closing nodes like mentions are atomic - no content\n        return h.createNode(nodeName, attrs)\n      }\n\n      // Nodes with content\n      const content = getContent ? getContent(token) : token.content || ''\n      if (content) {\n        // For inline content, create text nodes using the proper helper\n        return h.createNode(nodeName, attrs, [h.createTextNode(content)])\n      }\n      return h.createNode(nodeName, attrs, [])\n    },\n\n    markdownTokenizer: {\n      name: nodeName,\n      level: 'inline' as const,\n      start(src: string) {\n        // Create a non-global version for finding the start position\n        const startPattern = selfClosing\n          ? new RegExp(`\\\\[${escapedShortcode}\\\\s*[^\\\\]]*\\\\]`)\n          : new RegExp(`\\\\[${escapedShortcode}\\\\s*[^\\\\]]*\\\\][\\\\s\\\\S]*?\\\\[\\\\/${escapedShortcode}\\\\]`)\n\n        const match = src.match(startPattern)\n        const index = match?.index\n        return index !== undefined ? index : -1\n      },\n      tokenize(src, _tokens, _lexer) {\n        // Use non-global regex to match from the start of the string\n        const tokenPattern = selfClosing\n          ? new RegExp(`^\\\\[${escapedShortcode}\\\\s*([^\\\\]]*)\\\\]`)\n          : new RegExp(`^\\\\[${escapedShortcode}\\\\s*([^\\\\]]*)\\\\]([\\\\s\\\\S]*?)\\\\[\\\\/${escapedShortcode}\\\\]`)\n\n        const match = src.match(tokenPattern)\n\n        if (!match) {\n          return undefined\n        }\n\n        let content = ''\n        let attrString = ''\n\n        if (selfClosing) {\n          // Self-closing: [shortcode attr=\"value\"]\n          const [, attrs] = match\n          attrString = attrs\n        } else {\n          // With content: [shortcode attr=\"value\"]content[/shortcode]\n          const [, attrs, contentMatch] = match\n          attrString = attrs\n          content = contentMatch || ''\n        }\n\n        // Parse attributes from the attribute string\n        const attributes = parseAttributes(attrString.trim())\n\n        return {\n          type: nodeName,\n          raw: match[0],\n          content: content.trim(),\n          attributes,\n        }\n      },\n    },\n\n    renderMarkdown: (node: JSONContent) => {\n      let content = ''\n      if (getContent) {\n        content = getContent(node)\n      } else if (node.content && node.content.length > 0) {\n        // Extract text from content array for inline nodes\n        content = node.content\n          .filter((child: any) => child.type === 'text')\n          .map((child: any) => child.text)\n          .join('')\n      }\n\n      const filteredAttrs = filterAttributes(node.attrs || {})\n      const attrs = serializeAttributes(filteredAttrs)\n      const attrString = attrs ? ` ${attrs}` : ''\n\n      if (selfClosing) {\n        return `[${shortcode}${attrString}]`\n      }\n\n      return `[${shortcode}${attrString}]${content}[/${shortcode}]`\n    },\n  }\n}\n","/**\n * @fileoverview Utility for parsing indented markdown blocks with hierarchical nesting.\n *\n * This utility handles the complex logic of parsing markdown blocks that can contain\n * nested content based on indentation levels, maintaining proper hierarchical structure\n * for lists, task lists, and other indented block types.\n */\n\nexport interface ParsedBlock {\n  type: string\n  raw: string\n  mainContent: string\n  indentLevel: number\n  nestedContent?: string\n  nestedTokens?: any[]\n  [key: string]: any\n}\n\nexport interface BlockParserConfig {\n  /** Regex pattern to match block items */\n  itemPattern: RegExp\n  /** Function to extract data from regex match */\n  extractItemData: (match: RegExpMatchArray) => {\n    mainContent: string\n    indentLevel: number\n    [key: string]: any\n  }\n  /** Function to create the final token */\n  createToken: (data: any, nestedTokens?: any[]) => ParsedBlock\n  /** Base indentation to remove from nested content (default: 2 spaces) */\n  baseIndentSize?: number\n  /**\n   * Custom parser for nested content. If provided, this will be called instead\n   * of the default lexer.blockTokens() for parsing nested content.\n   * This allows recursive parsing of the same block type.\n   */\n  customNestedParser?: (dedentedContent: string) => any[] | undefined\n}\n\n/**\n * Parses markdown text into hierarchical indented blocks with proper nesting.\n *\n * This utility handles:\n * - Line-by-line parsing with pattern matching\n * - Hierarchical nesting based on indentation levels\n * - Nested content collection and parsing\n * - Empty line handling\n * - Content dedenting for nested blocks\n *\n * The key difference from flat parsing is that this maintains the hierarchical\n * structure where nested items become `nestedTokens` of their parent items,\n * rather than being flattened into a single array.\n *\n * @param src - The markdown source text to parse\n * @param config - Configuration object defining how to parse and create tokens\n * @param lexer - Markdown lexer for parsing nested content\n * @returns Parsed result with hierarchical items, or undefined if no matches\n *\n * @example\n * ```ts\n * const result = parseIndentedBlocks(src, {\n *   itemPattern: /^(\\s*)([-+*])\\s+\\[([ xX])\\]\\s+(.*)$/,\n *   extractItemData: (match) => ({\n *     indentLevel: match[1].length,\n *     mainContent: match[4],\n *     checked: match[3].toLowerCase() === 'x'\n *   }),\n *   createToken: (data, nestedTokens) => ({\n *     type: 'taskItem',\n *     checked: data.checked,\n *     text: data.mainContent,\n *     nestedTokens\n *   })\n * }, lexer)\n * ```\n */\nexport function parseIndentedBlocks(\n  src: string,\n  config: BlockParserConfig,\n  lexer: {\n    inlineTokens: (src: string) => any[]\n    blockTokens: (src: string) => any[]\n  },\n):\n  | {\n      items: ParsedBlock[]\n      raw: string\n    }\n  | undefined {\n  const lines = src.split('\\n')\n  const items: ParsedBlock[] = []\n  let totalRaw = ''\n  let i = 0\n  const baseIndentSize = config.baseIndentSize || 2\n\n  while (i < lines.length) {\n    const currentLine = lines[i]\n    const itemMatch = currentLine.match(config.itemPattern)\n\n    if (!itemMatch) {\n      // Not a matching item - stop if we have items, otherwise this isn't our block type\n      if (items.length > 0) {\n        break\n      } else if (currentLine.trim() === '') {\n        i += 1\n        totalRaw = `${totalRaw}${currentLine}\\n`\n        continue\n      } else {\n        return undefined\n      }\n    }\n\n    const itemData = config.extractItemData(itemMatch)\n    const { indentLevel, mainContent } = itemData\n    totalRaw = `${totalRaw}${currentLine}\\n`\n\n    // Collect content for this item (including nested items)\n    const itemContent = [mainContent] // Start with the main text\n    i += 1\n\n    // Look ahead for nested content (indented more than current item)\n    while (i < lines.length) {\n      const nextLine = lines[i]\n\n      if (nextLine.trim() === '') {\n        // Empty line - might be end of nested content\n        const nextNonEmptyIndex = lines.slice(i + 1).findIndex(l => l.trim() !== '')\n        if (nextNonEmptyIndex === -1) {\n          // No more content\n          break\n        }\n\n        const nextNonEmpty = lines[i + 1 + nextNonEmptyIndex]\n        const nextIndent = nextNonEmpty.match(/^(\\s*)/)?.[1]?.length || 0\n\n        if (nextIndent > indentLevel) {\n          // Nested content continues after empty line\n          itemContent.push(nextLine)\n          totalRaw = `${totalRaw}${nextLine}\\n`\n          i += 1\n          continue\n        } else {\n          // End of nested content\n          break\n        }\n      }\n\n      const nextIndent = nextLine.match(/^(\\s*)/)?.[1]?.length || 0\n\n      if (nextIndent > indentLevel) {\n        // This is nested content for the current item\n        itemContent.push(nextLine)\n        totalRaw = `${totalRaw}${nextLine}\\n`\n        i += 1\n      } else {\n        // Same or less indentation - this belongs to parent level\n        break\n      }\n    }\n\n    // Parse nested content if present\n    let nestedTokens: any[] | undefined\n    const nestedContent = itemContent.slice(1)\n\n    if (nestedContent.length > 0) {\n      // Remove the base indentation from nested content\n      const dedentedNested = nestedContent\n        .map(nestedLine => nestedLine.slice(indentLevel + baseIndentSize)) // Remove base indent + 2 spaces\n        .join('\\n')\n\n      if (dedentedNested.trim()) {\n        // Use custom nested parser if provided, otherwise fall back to default\n        if (config.customNestedParser) {\n          nestedTokens = config.customNestedParser(dedentedNested)\n        } else {\n          nestedTokens = lexer.blockTokens(dedentedNested)\n        }\n      }\n    }\n\n    // Create the token using the provided factory function\n    const token = config.createToken(itemData, nestedTokens)\n    items.push(token)\n  }\n\n  if (items.length === 0) {\n    return undefined\n  }\n\n  return {\n    items,\n    raw: totalRaw,\n  }\n}\n","import type { JSONContent } from '@tiptap/core'\n\n/**\n * @fileoverview Utility functions for rendering nested content in markdown.\n *\n * This module provides reusable utilities for extensions that need to render\n * content with a prefix on the main line and properly indented nested content.\n */\n\n/**\n * Utility function for rendering content with a main line prefix and nested indented content.\n *\n * This function handles the common pattern of rendering content with:\n * 1. A main line with a prefix (like \"- \" for lists, \"> \" for blockquotes, etc.)\n * 2. Nested content that gets indented properly\n *\n * @param node - The ProseMirror node representing the content\n * @param h - The markdown renderer helper\n * @param prefixOrGenerator - Either a string prefix or a function that generates the prefix from context\n * @param ctx - Optional context object (used when prefixOrGenerator is a function)\n * @returns The rendered markdown string\n *\n * @example\n * ```ts\n * // For a bullet list item with static prefix\n * return renderNestedMarkdownContent(node, h, '- ')\n *\n * // For a task item with static prefix\n * const prefix = `- [${node.attrs?.checked ? 'x' : ' '}] `\n * return renderNestedMarkdownContent(node, h, prefix)\n *\n * // For a blockquote with static prefix\n * return renderNestedMarkdownContent(node, h, '> ')\n *\n * // For content with dynamic prefix based on context\n * return renderNestedMarkdownContent(node, h, ctx => {\n *   if (ctx.parentType === 'orderedList') {\n *     return `${ctx.index + 1}. `\n *   }\n *   return '- '\n * }, ctx)\n *\n * // Custom extension example\n * const CustomContainer = Node.create({\n *   name: 'customContainer',\n *   // ... other config\n *   markdown: {\n *     render: (node, h) => {\n *       const type = node.attrs?.type || 'info'\n *       return renderNestedMarkdownContent(node, h, `[${type}] `)\n *     }\n *   }\n * })\n * ```\n */\nexport function renderNestedMarkdownContent(\n  node: JSONContent,\n  h: {\n    renderChildren: (nodes: JSONContent[]) => string\n    indent: (text: string) => string\n  },\n  prefixOrGenerator: string | ((ctx: any) => string),\n  ctx?: any,\n): string {\n  if (!node || !Array.isArray(node.content)) {\n    return ''\n  }\n\n  // Determine the prefix based on the input\n  const prefix = typeof prefixOrGenerator === 'function' ? prefixOrGenerator(ctx) : prefixOrGenerator\n\n  const [content, ...children] = node.content\n\n  // Render the main content (typically a paragraph)\n  const mainContent = h.renderChildren([content])\n  const output = [`${prefix}${mainContent}`]\n\n  // Handle nested children with proper indentation\n  if (children && children.length > 0) {\n    children.forEach(child => {\n      const childContent = h.renderChildren([child])\n      if (childContent) {\n        // Split the child content by lines and indent each line\n        const indentedChild = childContent\n          .split('\\n')\n          .map(line => (line ? h.indent(line) : ''))\n          .join('\\n')\n        output.push(indentedChild)\n      }\n    })\n  }\n\n  return output.join('\\n')\n}\n","import type { Mark } from '@tiptap/pm/model'\nimport type { ViewMutationRecord } from '@tiptap/pm/view'\n\nimport type { Editor } from './Editor.js'\nimport type { MarkViewProps, MarkViewRendererOptions } from './types.js'\nimport { isAndroid, isiOS } from './utilities/index.js'\n\nexport function updateMarkViewAttributes(checkMark: Mark, editor: Editor, attrs: Record<string, any> = {}): void {\n  const { state } = editor\n  const { doc, tr } = state\n  const thisMark = checkMark\n\n  doc.descendants((node, pos) => {\n    const from = tr.mapping.map(pos)\n    const to = tr.mapping.map(pos) + node.nodeSize\n    let foundMark: Mark | null = null\n\n    // find the mark on the current node\n    node.marks.forEach(mark => {\n      if (mark !== thisMark) {\n        return false\n      }\n\n      foundMark = mark\n    })\n\n    if (!foundMark) {\n      return\n    }\n\n    // check if we need to update given the attributes\n    let needsUpdate = false\n    Object.keys(attrs).forEach(k => {\n      if (attrs[k] !== foundMark!.attrs[k]) {\n        needsUpdate = true\n      }\n    })\n\n    if (needsUpdate) {\n      const updatedMark = checkMark.type.create({\n        ...checkMark.attrs,\n        ...attrs,\n      })\n\n      tr.removeMark(from, to, checkMark.type)\n      tr.addMark(from, to, updatedMark)\n    }\n  })\n\n  if (tr.docChanged) {\n    editor.view.dispatch(tr)\n  }\n}\n\nexport class MarkView<Component, Options extends MarkViewRendererOptions = MarkViewRendererOptions> {\n  component: Component\n  editor: Editor\n  options: Options\n  mark: MarkViewProps['mark']\n  HTMLAttributes: MarkViewProps['HTMLAttributes']\n\n  constructor(component: Component, props: MarkViewProps, options?: Partial<Options>) {\n    this.component = component\n    this.editor = props.editor\n    this.options = { ...options } as Options\n    this.mark = props.mark\n    this.HTMLAttributes = props.HTMLAttributes\n  }\n\n  get dom(): HTMLElement {\n    return this.editor.view.dom\n  }\n\n  get contentDOM(): HTMLElement | null {\n    return null\n  }\n\n  /**\n   * Update the attributes of the mark in the document.\n   * @param attrs The attributes to update.\n   */\n  updateAttributes(attrs: Record<string, any>, checkMark?: Mark): void {\n    updateMarkViewAttributes(checkMark || this.mark, this.editor, attrs)\n  }\n\n  ignoreMutation(mutation: ViewMutationRecord): boolean {\n    if (!this.dom || !this.contentDOM) {\n      return true\n    }\n\n    if (typeof this.options.ignoreMutation === 'function') {\n      return this.options.ignoreMutation({ mutation })\n    }\n\n    if (mutation.type === 'selection') {\n      return false\n    }\n\n    if (\n      this.dom.contains(mutation.target) &&\n      mutation.type === 'childList' &&\n      (isiOS() || isAndroid()) &&\n      this.editor.isFocused\n    ) {\n      const changedNodes = [...Array.from(mutation.addedNodes), ...Array.from(mutation.removedNodes)] as HTMLElement[]\n\n      if (changedNodes.every(node => node.isContentEditable)) {\n        return false\n      }\n    }\n\n    if (this.contentDOM === mutation.target && mutation.type === 'attributes') {\n      return true\n    }\n\n    if (this.contentDOM.contains(mutation.target)) {\n      return false\n    }\n\n    return true\n  }\n}\n","import type { DOMOutputSpec, Node as ProseMirrorNode, NodeSpec, NodeType } from '@tiptap/pm/model'\n\nimport type { Editor } from './Editor.js'\nimport type { ExtendableConfig } from './Extendable.js'\nimport { Extendable } from './Extendable.js'\nimport type { Attributes, NodeViewRenderer, ParentConfig } from './types.js'\n\nexport interface NodeConfig<Options = any, Storage = any>\n  extends ExtendableConfig<Options, Storage, NodeConfig<Options, Storage>, NodeType> {\n  /**\n   * Node View\n   */\n  addNodeView?:\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        editor: Editor\n        type: NodeType\n        parent: ParentConfig<NodeConfig<Options, Storage>>['addNodeView']\n      }) => NodeViewRenderer | null)\n    | null\n\n  /**\n   * Defines if this node should be a top level node (doc)\n   * @default false\n   * @example true\n   */\n  topNode?: boolean\n\n  /**\n   * The content expression for this node, as described in the [schema\n   * guide](/docs/guide/#schema.content_expressions). When not given,\n   * the node does not allow any content.\n   *\n   * You can read more about it on the Prosemirror documentation here\n   * @see https://prosemirror.net/docs/guide/#schema.content_expressions\n   * @default undefined\n   * @example content: 'block+'\n   * @example content: 'headline paragraph block*'\n   */\n  content?:\n    | NodeSpec['content']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['content']\n        editor?: Editor\n      }) => NodeSpec['content'])\n\n  /**\n   * The marks that are allowed inside of this node. May be a\n   * space-separated string referring to mark names or groups, `\"_\"`\n   * to explicitly allow all marks, or `\"\"` to disallow marks. When\n   * not given, nodes with inline content default to allowing all\n   * marks, other nodes default to not allowing marks.\n   *\n   * @example marks: 'strong em'\n   */\n  marks?:\n    | NodeSpec['marks']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['marks']\n        editor?: Editor\n      }) => NodeSpec['marks'])\n\n  /**\n   * The group or space-separated groups to which this node belongs,\n   * which can be referred to in the content expressions for the\n   * schema.\n   *\n   * By default Tiptap uses the groups 'block' and 'inline' for nodes. You\n   * can also use custom groups if you want to group specific nodes together\n   * and handle them in your schema.\n   * @example group: 'block'\n   * @example group: 'inline'\n   * @example group: 'customBlock' // this uses a custom group\n   */\n  group?:\n    | NodeSpec['group']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['group']\n        editor?: Editor\n      }) => NodeSpec['group'])\n\n  /**\n   * Should be set to true for inline nodes. (Implied for text nodes.)\n   */\n  inline?:\n    | NodeSpec['inline']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['inline']\n        editor?: Editor\n      }) => NodeSpec['inline'])\n\n  /**\n   * Can be set to true to indicate that, though this isn't a [leaf\n   * node](https://prosemirror.net/docs/ref/#model.NodeType.isLeaf), it doesn't have directly editable\n   * content and should be treated as a single unit in the view.\n   *\n   * @example atom: true\n   */\n  atom?:\n    | NodeSpec['atom']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['atom']\n        editor?: Editor\n      }) => NodeSpec['atom'])\n\n  /**\n   * Controls whether nodes of this type can be selected as a [node\n   * selection](https://prosemirror.net/docs/ref/#state.NodeSelection). Defaults to true for non-text\n   * nodes.\n   *\n   * @default true\n   * @example selectable: false\n   */\n  selectable?:\n    | NodeSpec['selectable']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['selectable']\n        editor?: Editor\n      }) => NodeSpec['selectable'])\n\n  /**\n   * Determines whether nodes of this type can be dragged without\n   * being selected. Defaults to false.\n   *\n   * @default: false\n   * @example: draggable: true\n   */\n  draggable?:\n    | NodeSpec['draggable']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['draggable']\n        editor?: Editor\n      }) => NodeSpec['draggable'])\n\n  /**\n   * Can be used to indicate that this node contains code, which\n   * causes some commands to behave differently.\n   */\n  code?:\n    | NodeSpec['code']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['code']\n        editor?: Editor\n      }) => NodeSpec['code'])\n\n  /**\n   * Controls way whitespace in this a node is parsed. The default is\n   * `\"normal\"`, which causes the [DOM parser](https://prosemirror.net/docs/ref/#model.DOMParser) to\n   * collapse whitespace in normal mode, and normalize it (replacing\n   * newlines and such with spaces) otherwise. `\"pre\"` causes the\n   * parser to preserve spaces inside the node. When this option isn't\n   * given, but [`code`](https://prosemirror.net/docs/ref/#model.NodeSpec.code) is true, `whitespace`\n   * will default to `\"pre\"`. Note that this option doesn't influence\n   * the way the node is renderedthat should be handled by `toDOM`\n   * and/or styling.\n   */\n  whitespace?:\n    | NodeSpec['whitespace']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['whitespace']\n        editor?: Editor\n      }) => NodeSpec['whitespace'])\n\n  /**\n   * Allows a **single** node to be set as linebreak equivalent (e.g. hardBreak).\n   * When converting between block types that have whitespace set to \"pre\"\n   * and don't support the linebreak node (e.g. codeBlock) and other block types\n   * that do support the linebreak node (e.g. paragraphs) - this node will be used\n   * as the linebreak instead of stripping the newline.\n   *\n   * See [linebreakReplacement](https://prosemirror.net/docs/ref/#model.NodeSpec.linebreakReplacement).\n   */\n  linebreakReplacement?:\n    | NodeSpec['linebreakReplacement']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['linebreakReplacement']\n        editor?: Editor\n      }) => NodeSpec['linebreakReplacement'])\n\n  /**\n   * When enabled, enables both\n   * [`definingAsContext`](https://prosemirror.net/docs/ref/#model.NodeSpec.definingAsContext) and\n   * [`definingForContent`](https://prosemirror.net/docs/ref/#model.NodeSpec.definingForContent).\n   *\n   * @default false\n   * @example isolating: true\n   */\n  defining?:\n    | NodeSpec['defining']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['defining']\n        editor?: Editor\n      }) => NodeSpec['defining'])\n\n  /**\n   * When enabled (default is false), the sides of nodes of this type\n   * count as boundaries that regular editing operations, like\n   * backspacing or lifting, won't cross. An example of a node that\n   * should probably have this enabled is a table cell.\n   */\n  isolating?:\n    | NodeSpec['isolating']\n    | ((this: {\n        name: string\n        options: Options\n        storage: Storage\n        parent: ParentConfig<NodeConfig<Options, Storage>>['isolating']\n        editor?: Editor\n      }) => NodeSpec['isolating'])\n\n  /**\n   * Associates DOM parser information with this node, which can be\n   * used by [`DOMParser.fromSchema`](https://prosemirror.net/docs/ref/#model.DOMParser^fromSchema) to\n   * automatically derive a parser. The `node` field in the rules is\n   * implied (the name of this node will be filled in automatically).\n   * If you supply your own parser, you do not need to also specify\n   * parsing rules in your schema.\n   *\n   * @example parseHTML: [{ tag: 'div', attrs: { 'data-id': 'my-block' } }]\n   */\n  parseHTML?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    parent: ParentConfig<NodeConfig<Options, Storage>>['parseHTML']\n    editor?: Editor\n  }) => NodeSpec['parseDOM']\n\n  /**\n   * A description of a DOM structure. Can be either a string, which is\n   * interpreted as a text node, a DOM node, which is interpreted as\n   * itself, a `{dom, contentDOM}` object, or an array.\n   *\n   * An array describes a DOM element. The first value in the array\n   * should be a stringthe name of the DOM element, optionally prefixed\n   * by a namespace URL and a space. If the second element is plain\n   * object, it is interpreted as a set of attributes for the element.\n   * Any elements after that (including the 2nd if it's not an attribute\n   * object) are interpreted as children of the DOM elements, and must\n   * either be valid `DOMOutputSpec` values, or the number zero.\n   *\n   * The number zero (pronounced hole) is used to indicate the place\n   * where a node's child nodes should be inserted. If it occurs in an\n   * output spec, it should be the only child element in its parent\n   * node.\n   *\n   * @example toDOM: ['div[data-id=\"my-block\"]', { class: 'my-block' }, 0]\n   */\n  renderHTML?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          parent: ParentConfig<NodeConfig<Options, Storage>>['renderHTML']\n          editor?: Editor\n        },\n        props: {\n          node: ProseMirrorNode\n          HTMLAttributes: Record<string, any>\n        },\n      ) => DOMOutputSpec)\n    | null\n\n  /**\n   * renders the node as text\n   * @example renderText: () => 'foo\n   */\n  renderText?:\n    | ((\n        this: {\n          name: string\n          options: Options\n          storage: Storage\n          parent: ParentConfig<NodeConfig<Options, Storage>>['renderText']\n          editor?: Editor\n        },\n        props: {\n          node: ProseMirrorNode\n          pos: number\n          parent: ProseMirrorNode\n          index: number\n        },\n      ) => string)\n    | null\n\n  /**\n   * Add attributes to the node\n   * @example addAttributes: () => ({ class: 'foo' })\n   */\n  addAttributes?: (this: {\n    name: string\n    options: Options\n    storage: Storage\n    parent: ParentConfig<NodeConfig<Options, Storage>>['addAttributes']\n    editor?: Editor\n    // eslint-disable-next-line @typescript-eslint/no-empty-object-type\n  }) => Attributes | {}\n}\n\n/**\n * The Node class is used to create custom node extensions.\n * @see https://tiptap.dev/api/extensions#create-a-new-extension\n */\nexport class Node<Options = any, Storage = any> extends Extendable<Options, Storage, NodeConfig<Options, Storage>> {\n  type = 'node'\n\n  /**\n   * Create a new Node instance\n   * @param config - Node configuration object or a function that returns a configuration object\n   */\n  static create<O = any, S = any>(config: Partial<NodeConfig<O, S>> | (() => Partial<NodeConfig<O, S>>) = {}) {\n    // If the config is a function, execute it to get the configuration object\n    const resolvedConfig = typeof config === 'function' ? config() : config\n    return new Node<O, S>(resolvedConfig)\n  }\n\n  configure(options?: Partial<Options>) {\n    return super.configure(options) as Node<Options, Storage>\n  }\n\n  extend<\n    ExtendedOptions = Options,\n    ExtendedStorage = Storage,\n    ExtendedConfig extends NodeConfig<ExtendedOptions, ExtendedStorage> = NodeConfig<ExtendedOptions, ExtendedStorage>,\n  >(\n    extendedConfig?:\n      | (() => Partial<ExtendedConfig>)\n      | (Partial<ExtendedConfig> &\n          ThisType<{\n            name: string\n            options: ExtendedOptions\n            storage: ExtendedStorage\n            editor: Editor\n            type: NodeType\n          }>),\n  ): Node<ExtendedOptions, ExtendedStorage> {\n    // If the extended config is a function, execute it to get the configuration object\n    const resolvedConfig = typeof extendedConfig === 'function' ? extendedConfig() : extendedConfig\n    return super.extend(resolvedConfig) as Node<ExtendedOptions, ExtendedStorage>\n  }\n}\n","import { NodeSelection } from '@tiptap/pm/state'\nimport type { NodeView as ProseMirrorNodeView, ViewMutationRecord } from '@tiptap/pm/view'\n\nimport type { Editor as CoreEditor } from './Editor.js'\nimport type { DecorationWithType, NodeViewRendererOptions, NodeViewRendererProps } from './types.js'\nimport { isAndroid } from './utilities/isAndroid.js'\nimport { isiOS } from './utilities/isiOS.js'\n\n/**\n * Node views are used to customize the rendered DOM structure of a node.\n * @see https://tiptap.dev/guide/node-views\n */\nexport class NodeView<\n  Component,\n  NodeEditor extends CoreEditor = CoreEditor,\n  Options extends NodeViewRendererOptions = NodeViewRendererOptions,\n> implements ProseMirrorNodeView\n{\n  component: Component\n\n  editor: NodeEditor\n\n  options: Options\n\n  extension: NodeViewRendererProps['extension']\n\n  node: NodeViewRendererProps['node']\n\n  decorations: NodeViewRendererProps['decorations']\n\n  innerDecorations: NodeViewRendererProps['innerDecorations']\n\n  view: NodeViewRendererProps['view']\n\n  getPos: NodeViewRendererProps['getPos']\n\n  HTMLAttributes: NodeViewRendererProps['HTMLAttributes']\n\n  isDragging = false\n\n  constructor(component: Component, props: NodeViewRendererProps, options?: Partial<Options>) {\n    this.component = component\n    this.editor = props.editor as NodeEditor\n    this.options = {\n      stopEvent: null,\n      ignoreMutation: null,\n      ...options,\n    } as Options\n    this.extension = props.extension\n    this.node = props.node\n    this.decorations = props.decorations as DecorationWithType[]\n    this.innerDecorations = props.innerDecorations\n    this.view = props.view\n    this.HTMLAttributes = props.HTMLAttributes\n    this.getPos = props.getPos\n    this.mount()\n  }\n\n  mount() {\n    // eslint-disable-next-line\n    return\n  }\n\n  get dom(): HTMLElement {\n    return this.editor.view.dom as HTMLElement\n  }\n\n  get contentDOM(): HTMLElement | null {\n    return null\n  }\n\n  onDragStart(event: DragEvent) {\n    const { view } = this.editor\n    const target = event.target as HTMLElement\n\n    // get the drag handle element\n    // `closest` is not available for text nodes so we may have to use its parent\n    const dragHandle =\n      target.nodeType === 3 ? target.parentElement?.closest('[data-drag-handle]') : target.closest('[data-drag-handle]')\n\n    if (!this.dom || this.contentDOM?.contains(target) || !dragHandle) {\n      return\n    }\n\n    let x = 0\n    let y = 0\n\n    // calculate offset for drag element if we use a different drag handle element\n    if (this.dom !== dragHandle) {\n      const domBox = this.dom.getBoundingClientRect()\n      const handleBox = dragHandle.getBoundingClientRect()\n\n      // In React, we have to go through nativeEvent to reach offsetX/offsetY.\n      const offsetX = event.offsetX ?? (event as any).nativeEvent?.offsetX\n      const offsetY = event.offsetY ?? (event as any).nativeEvent?.offsetY\n\n      x = handleBox.x - domBox.x + offsetX\n      y = handleBox.y - domBox.y + offsetY\n    }\n\n    const clonedNode = this.dom.cloneNode(true) as HTMLElement\n\n    // Preserve the visual size of the original when using the clone as\n    // the drag image.\n    try {\n      const domBox = this.dom.getBoundingClientRect()\n      clonedNode.style.width = `${Math.round(domBox.width)}px`\n      clonedNode.style.height = `${Math.round(domBox.height)}px`\n      clonedNode.style.boxSizing = 'border-box'\n      // Ensure the clone doesn't capture pointer events while offscreen\n      clonedNode.style.pointerEvents = 'none'\n    } catch {\n      // ignore measurement errors (e.g. if element not in DOM)\n    }\n\n    // Some browsers (notably Safari) require the element passed to\n    // setDragImage to be present in the DOM. Using a detached node can\n    // cause the drag to immediately end.\n    let dragImageWrapper: HTMLElement | null = null\n\n    try {\n      dragImageWrapper = document.createElement('div')\n      dragImageWrapper.style.position = 'absolute'\n      dragImageWrapper.style.top = '-9999px'\n      dragImageWrapper.style.left = '-9999px'\n      dragImageWrapper.style.pointerEvents = 'none'\n      dragImageWrapper.appendChild(clonedNode)\n      document.body.appendChild(dragImageWrapper)\n\n      event.dataTransfer?.setDragImage(clonedNode, x, y)\n    } finally {\n      // Remove the wrapper on the next tick so the browser can use the\n      // element as the drag image. A 0ms timeout is enough in practice.\n      if (dragImageWrapper) {\n        setTimeout(() => {\n          try {\n            dragImageWrapper?.remove()\n          } catch {\n            // ignore removal errors\n          }\n        }, 0)\n      }\n    }\n\n    const pos = this.getPos()\n\n    if (typeof pos !== 'number') {\n      return\n    }\n    // we need to tell ProseMirror that we want to move the whole node\n    // so we create a NodeSelection\n    const selection = NodeSelection.create(view.state.doc, pos)\n    const transaction = view.state.tr.setSelection(selection)\n\n    view.dispatch(transaction)\n  }\n\n  stopEvent(event: Event) {\n    if (!this.dom) {\n      return false\n    }\n\n    if (typeof this.options.stopEvent === 'function') {\n      return this.options.stopEvent({ event })\n    }\n\n    const target = event.target as HTMLElement\n    const isInElement = this.dom.contains(target) && !this.contentDOM?.contains(target)\n\n    // any event from child nodes should be handled by ProseMirror\n    if (!isInElement) {\n      return false\n    }\n\n    const isDragEvent = event.type.startsWith('drag')\n    const isDropEvent = event.type === 'drop'\n    const isInput = ['INPUT', 'BUTTON', 'SELECT', 'TEXTAREA'].includes(target.tagName) || target.isContentEditable\n\n    // any input event within node views should be ignored by ProseMirror\n    if (isInput && !isDropEvent && !isDragEvent) {\n      return true\n    }\n\n    const { isEditable } = this.editor\n    const { isDragging } = this\n    const isDraggable = !!this.node.type.spec.draggable\n    const isSelectable = NodeSelection.isSelectable(this.node)\n    const isCopyEvent = event.type === 'copy'\n    const isPasteEvent = event.type === 'paste'\n    const isCutEvent = event.type === 'cut'\n    const isClickEvent = event.type === 'mousedown'\n\n    // ProseMirror tries to drag selectable nodes\n    // even if `draggable` is set to `false`\n    // this fix prevents that\n    if (!isDraggable && isSelectable && isDragEvent && event.target === this.dom) {\n      event.preventDefault()\n    }\n\n    if (isDraggable && isDragEvent && !isDragging && event.target === this.dom) {\n      event.preventDefault()\n      return false\n    }\n\n    // we have to store that dragging started\n    if (isDraggable && isEditable && !isDragging && isClickEvent) {\n      const dragHandle = target.closest('[data-drag-handle]')\n      const isValidDragHandle = dragHandle && (this.dom === dragHandle || this.dom.contains(dragHandle))\n\n      if (isValidDragHandle) {\n        this.isDragging = true\n\n        document.addEventListener(\n          'dragend',\n          () => {\n            this.isDragging = false\n          },\n          { once: true },\n        )\n\n        document.addEventListener(\n          'drop',\n          () => {\n            this.isDragging = false\n          },\n          { once: true },\n        )\n\n        document.addEventListener(\n          'mouseup',\n          () => {\n            this.isDragging = false\n          },\n          { once: true },\n        )\n      }\n    }\n\n    // these events are handled by prosemirror\n    if (isDragging || isDropEvent || isCopyEvent || isPasteEvent || isCutEvent || (isClickEvent && isSelectable)) {\n      return false\n    }\n\n    return true\n  }\n\n  /**\n   * Called when a DOM [mutation](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver) or a selection change happens within the view.\n   * @return `false` if the editor should re-read the selection or re-parse the range around the mutation\n   * @return `true` if it can safely be ignored.\n   */\n  ignoreMutation(mutation: ViewMutationRecord) {\n    if (!this.dom || !this.contentDOM) {\n      return true\n    }\n\n    if (typeof this.options.ignoreMutation === 'function') {\n      return this.options.ignoreMutation({ mutation })\n    }\n\n    // a leaf/atom node is like a black box for ProseMirror\n    // and should be fully handled by the node view\n    if (this.node.isLeaf || this.node.isAtom) {\n      return true\n    }\n\n    // ProseMirror should handle any selections\n    if (mutation.type === 'selection') {\n      return false\n    }\n\n    // try to prevent a bug on iOS and Android that will break node views on enter\n    // this is because ProseMirror cant preventDispatch on enter\n    // this will lead to a re-render of the node view on enter\n    // see: https://github.com/ueberdosis/tiptap/issues/1214\n    // see: https://github.com/ueberdosis/tiptap/issues/2534\n    if (\n      this.dom.contains(mutation.target) &&\n      mutation.type === 'childList' &&\n      (isiOS() || isAndroid()) &&\n      this.editor.isFocused\n    ) {\n      const changedNodes = [...Array.from(mutation.addedNodes), ...Array.from(mutation.removedNodes)] as HTMLElement[]\n\n      // well check if every changed node is contentEditable\n      // to make sure its probably mutated by ProseMirror\n      if (changedNodes.every(node => node.isContentEditable)) {\n        return false\n      }\n    }\n\n    // we will allow mutation contentDOM with attributes\n    // so we can for example adding classes within our node view\n    if (this.contentDOM === mutation.target && mutation.type === 'attributes') {\n      return true\n    }\n\n    // ProseMirror should handle any changes within contentDOM\n    if (this.contentDOM.contains(mutation.target)) {\n      return false\n    }\n\n    return true\n  }\n\n  /**\n   * Update the attributes of the prosemirror node.\n   */\n  updateAttributes(attributes: Record<string, any>): void {\n    this.editor.commands.command(({ tr }) => {\n      const pos = this.getPos()\n\n      if (typeof pos !== 'number') {\n        return false\n      }\n\n      tr.setNodeMarkup(pos, undefined, {\n        ...this.node.attrs,\n        ...attributes,\n      })\n\n      return true\n    })\n  }\n\n  /**\n   * Delete the node.\n   */\n  deleteNode(): void {\n    const from = this.getPos()\n\n    if (typeof from !== 'number') {\n      return\n    }\n    const to = from + this.node.nodeSize\n\n    this.editor.commands.deleteRange({ from, to })\n  }\n}\n","import type { MarkType } from '@tiptap/pm/model'\n\nimport { getMarksBetween } from '../helpers/getMarksBetween.js'\nimport type { PasteRuleFinder } from '../PasteRule.js'\nimport { PasteRule } from '../PasteRule.js'\nimport type { ExtendedRegExpMatchArray } from '../types.js'\nimport { callOrReturn } from '../utilities/callOrReturn.js'\n\n/**\n * Build an paste rule that adds a mark when the\n * matched text is pasted into it.\n * @see https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#paste-rules\n */\nexport function markPasteRule(config: {\n  find: PasteRuleFinder\n  type: MarkType\n  getAttributes?:\n    | Record<string, any>\n    | ((match: ExtendedRegExpMatchArray, event: ClipboardEvent) => Record<string, any>)\n    | false\n    | null\n}) {\n  return new PasteRule({\n    find: config.find,\n    handler: ({ state, range, match, pasteEvent }) => {\n      const attributes = callOrReturn(config.getAttributes, undefined, match, pasteEvent)\n\n      if (attributes === false || attributes === null) {\n        return null\n      }\n\n      const { tr } = state\n      const captureGroup = match[match.length - 1]\n      const fullMatch = match[0]\n      let markEnd = range.to\n\n      if (captureGroup) {\n        const startSpaces = fullMatch.search(/\\S/)\n        const textStart = range.from + fullMatch.indexOf(captureGroup)\n        const textEnd = textStart + captureGroup.length\n\n        const excludedMarks = getMarksBetween(range.from, range.to, state.doc)\n          .filter(item => {\n            // @ts-ignore\n            const excluded = item.mark.type.excluded as MarkType[]\n\n            return excluded.find(type => type === config.type && type !== item.mark.type)\n          })\n          .filter(item => item.to > textStart)\n\n        if (excludedMarks.length) {\n          return null\n        }\n\n        if (textEnd < range.to) {\n          tr.delete(textEnd, range.to)\n        }\n\n        if (textStart > range.from) {\n          tr.delete(range.from + startSpaces, textStart)\n        }\n\n        markEnd = range.from + startSpaces + captureGroup.length\n\n        tr.addMark(range.from + startSpaces, markEnd, config.type.create(attributes || {}))\n\n        tr.removeStoredMark(config.type)\n      }\n    },\n  })\n}\n","import type { NodeType } from '@tiptap/pm/model'\n\nimport type { PasteRuleFinder } from '../PasteRule.js'\nimport { PasteRule } from '../PasteRule.js'\nimport type { ExtendedRegExpMatchArray, JSONContent } from '../types.js'\nimport { callOrReturn } from '../utilities/index.js'\n\n/**\n * Build an paste rule that adds a node when the\n * matched text is pasted into it.\n * @see https://tiptap.dev/docs/editor/api/paste-rules\n */\nexport function nodePasteRule(config: {\n  find: PasteRuleFinder\n  type: NodeType\n  getAttributes?:\n    | Record<string, any>\n    | ((match: ExtendedRegExpMatchArray, event: ClipboardEvent) => Record<string, any>)\n    | false\n    | null\n  getContent?: JSONContent[] | ((attrs: Record<string, any>) => JSONContent[]) | false | null\n}) {\n  return new PasteRule({\n    find: config.find,\n    handler({ match, chain, range, pasteEvent }) {\n      const attributes = callOrReturn(config.getAttributes, undefined, match, pasteEvent)\n      const content = callOrReturn(config.getContent, undefined, attributes)\n\n      if (attributes === false || attributes === null) {\n        return null\n      }\n\n      const node = { type: config.type.name, attrs: attributes } as JSONContent\n\n      if (content) {\n        node.content = content\n      }\n\n      if (match.input) {\n        chain().deleteRange(range).insertContentAt(range.from, node)\n      }\n    },\n  })\n}\n","import type { PasteRuleFinder } from '../PasteRule.js'\nimport { PasteRule } from '../PasteRule.js'\n\n/**\n * Build an paste rule that replaces text when the\n * matched text is pasted into it.\n * @see https://tiptap.dev/docs/editor/extensions/custom-extensions/extend-existing#paste-rules\n */\nexport function textPasteRule(config: { find: PasteRuleFinder; replace: string }) {\n  return new PasteRule({\n    find: config.find,\n    handler: ({ state, range, match }) => {\n      let insert = config.replace\n      let start = range.from\n      const end = range.to\n\n      if (match[1]) {\n        const offset = match[0].lastIndexOf(match[1])\n\n        insert += match[0].slice(offset + match[1].length)\n        start += offset\n\n        const cutOff = start - end\n\n        if (cutOff > 0) {\n          insert = match[0].slice(offset - cutOff, offset) + insert\n          start = end\n        }\n      }\n\n      state.tr.insertText(insert, start, end)\n    },\n  })\n}\n","import type { Transaction } from '@tiptap/pm/state'\n\nexport interface TrackerResult {\n  position: number\n  deleted: boolean\n}\n\nexport class Tracker {\n  transaction: Transaction\n\n  currentStep: number\n\n  constructor(transaction: Transaction) {\n    this.transaction = transaction\n    this.currentStep = this.transaction.steps.length\n  }\n\n  map(position: number): TrackerResult {\n    let deleted = false\n\n    const mappedPosition = this.transaction.steps.slice(this.currentStep).reduce((newPosition, step) => {\n      const mapResult = step.getMap().mapResult(newPosition)\n\n      if (mapResult.deleted) {\n        deleted = true\n      }\n\n      return mapResult.pos\n    }, position)\n\n    return {\n      position: mappedPosition,\n      deleted,\n    }\n  }\n}\n","import { Mark, mergeAttributes } from '@tiptap/core'\nimport { Plugin, PluginKey } from '@tiptap/pm/state'\nimport type { Editor } from '@tiptap/core'\nimport type { CommentWithUser } from './comments'\n\nexport interface CommentMarkOptions {\n  onCommentClick?: (commentId: string) => void\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    comment: {\n      setComment: (commentId: string) => ReturnType\n      unsetComment: (commentId: string) => ReturnType\n    }\n  }\n}\n\nexport const CommentMark = Mark.create<CommentMarkOptions>({\n  name: 'comment',\n\n  addOptions() {\n    return {\n      onCommentClick: undefined,\n    }\n  },\n\n  addAttributes() {\n    return {\n      commentId: {\n        default: null,\n        parseHTML: (element) => element.getAttribute('data-comment-id'),\n        renderHTML: (attributes) => ({\n          'data-comment-id': attributes.commentId,\n        }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [{ tag: 'mark[data-comment-id]' }]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return [\n      'mark',\n      mergeAttributes(HTMLAttributes, {\n        class:\n          'bg-yellow-200/50 dark:bg-yellow-500/30 dark:text-foreground cursor-pointer hover:bg-yellow-300/60 dark:hover:bg-yellow-500/40 transition-colors rounded-sm',\n      }),\n      0,\n    ]\n  },\n\n  addCommands() {\n    return {\n      setComment:\n        (commentId: string) =>\n        ({ commands }) => {\n          return commands.setMark(this.name, { commentId })\n        },\n      unsetComment:\n        (commentId: string) =>\n        ({ tr, state }) => {\n          const { doc } = state\n          let found = false\n\n          doc.descendants((node, pos) => {\n            node.marks.forEach((mark) => {\n              if (mark.type.name === this.name && mark.attrs.commentId === commentId) {\n                tr.removeMark(pos, pos + node.nodeSize, mark.type)\n                found = true\n              }\n            })\n          })\n\n          return found\n        },\n    }\n  },\n\n  addProseMirrorPlugins() {\n    const { onCommentClick } = this.options\n\n    return [\n      new Plugin({\n        key: new PluginKey('commentClick'),\n        props: {\n          handleClick(view, pos) {\n            if (!onCommentClick) return false\n\n            const { state } = view\n            const $pos = state.doc.resolve(pos)\n            const marks = $pos.marks()\n\n            const commentMark = marks.find((mark) => mark.type.name === 'comment')\n            if (commentMark && commentMark.attrs.commentId) {\n              // Blur the editor to prevent keyboard popup on mobile\n              ;(view.dom as HTMLElement).blur()\n              onCommentClick(commentMark.attrs.commentId)\n              return true\n            }\n\n            return false\n          },\n        },\n      }),\n    ]\n  },\n})\n\n/**\n * Apply comment mark to the current selection\n */\nexport function addCommentMark(\n  editor: Editor,\n  commentId: string,\n  from: number,\n  to: number\n): void {\n  // Guard against editor not being ready\n  if (!editor.view || editor.isDestroyed) {\n    console.warn('Cannot add comment mark: editor not ready')\n    return\n  }\n  \n  editor\n    .chain()\n    .setTextSelection({ from, to })\n    .setComment(commentId)\n    .run()\n}\n\n/**\n * Remove comment mark from the document\n */\nexport function removeCommentMark(editor: Editor, commentId: string): void {\n  if (!editor.view || editor.isDestroyed) return\n  editor.chain().unsetComment(commentId).run()\n}\n\n/**\n * Re-apply comment marks based on quoted text matching.\n * Called when loading a post with existing comments.\n */\nexport function applyCommentMarks(\n  editor: Editor,\n  comments: CommentWithUser[]\n): void {\n  if (!editor.view || editor.isDestroyed) return\n  \n  const { doc } = editor.state\n  const textContent = doc.textContent\n\n  comments.forEach((comment) => {\n    if (!comment.quotedText || comment.parentId || comment.resolved) return // Skip replies\n\n    const index = textContent.indexOf(comment.quotedText)\n    if (index === -1) return // Text not found\n\n    // Find the actual position in the document\n    let currentPos = 0\n    let startPos: number | null = null\n    let endPos: number | null = null\n\n    doc.descendants((node, pos) => {\n      if (startPos !== null && endPos !== null) return false\n\n      if (node.isText && node.text) {\n        const nodeStart = currentPos\n        const nodeEnd = currentPos + node.text.length\n\n        if (startPos === null && nodeEnd > index) {\n          // Start is in this node\n          const offsetInNode = index - nodeStart\n          startPos = pos + offsetInNode\n        }\n\n        if (startPos !== null && endPos === null) {\n          const targetEnd = index + comment.quotedText.length\n          if (nodeEnd >= targetEnd) {\n            // End is in this node\n            const offsetInNode = targetEnd - nodeStart\n            endPos = pos + offsetInNode\n          }\n        }\n\n        currentPos = nodeEnd\n      }\n\n      return true\n    })\n\n    if (startPos !== null && endPos !== null) {\n      editor\n        .chain()\n        .setTextSelection({ from: startPos, to: endPos })\n        .setComment(comment.id)\n        .setTextSelection(endPos) // Deselect\n        .run()\n    }\n  })\n}\n\n/**\n * Scroll to a comment mark in the editor\n */\nexport function scrollToComment(editor: Editor, commentId: string): void {\n  if (!editor.view || editor.isDestroyed) return\n  \n  const { doc } = editor.state\n\n  doc.descendants((node, pos) => {\n    const commentMark = node.marks.find(\n      (mark) => mark.type.name === 'comment' && mark.attrs.commentId === commentId\n    )\n\n    if (commentMark) {\n      editor.chain().setTextSelection(pos).run()\n\n      // Scroll to the selection\n      const view = editor.view\n      const coords = view.coordsAtPos(pos)\n      const editorRect = view.dom.getBoundingClientRect()\n\n      if (coords.top < editorRect.top || coords.bottom > editorRect.bottom) {\n        view.dom.scrollIntoView({ behavior: 'smooth', block: 'center' })\n      }\n\n      return false // Stop iteration\n    }\n\n    return true\n  })\n}\n","/**\n * SSE (Server-Sent Events) streaming utilities\n * \n * Shared parsing logic for consuming SSE streams from AI endpoints.\n * Used by useChat, EditorPage, and other components that need streaming.\n */\n\nexport interface SSEEvent {\n  text?: string\n  thinking?: string\n  error?: string\n}\n\nexport interface SSEEventWithAccumulated extends SSEEvent {\n  /** Full accumulated text content so far */\n  fullContent: string\n}\n\nexport type SSEEventHandler = (event: SSEEventWithAccumulated) => void\n\n/**\n * Consume an SSE stream, calling onEvent for each parsed event.\n * Returns the accumulated text content.\n * \n * @param response - Fetch Response object with SSE body\n * @param onEvent - Callback for each parsed event\n * @param signal - Optional AbortSignal for cancellation\n * @returns Promise resolving to full accumulated text content\n */\nexport async function consumeSSEStream(\n  response: Response,\n  onEvent: SSEEventHandler,\n  signal?: AbortSignal\n): Promise<string> {\n  const reader = response.body?.getReader()\n  if (!reader) throw new Error('No response body')\n\n  const decoder = new TextDecoder()\n  let buffer = ''\n  let fullContent = ''\n\n  try {\n    while (true) {\n      // Check for abort\n      if (signal?.aborted) break\n\n      const { done, value } = await reader.read()\n      if (done) break\n\n      buffer += decoder.decode(value, { stream: true })\n      \n      // Process complete SSE lines\n      const lines = buffer.split('\\n')\n      buffer = lines.pop() || '' // Keep incomplete line in buffer\n\n      for (const line of lines) {\n        if (!line.startsWith('data: ')) continue\n        const data = line.slice(6) // Remove 'data: ' prefix\n        \n        if (data === '[DONE]') continue\n\n        try {\n          const parsed = JSON.parse(data)\n          if (parsed.error) {\n            onEvent({ error: parsed.error, fullContent })\n          } else {\n            if (parsed.text) {\n              fullContent += parsed.text\n            }\n            onEvent({ ...parsed, fullContent })\n          }\n        } catch (parseError) {\n          // If it's a real error (not JSON parse), rethrow\n          if (parseError instanceof Error && parseError.message !== 'Unexpected token') {\n            // Check if the error is from our handler\n            if (parseError.message && !parseError.message.includes('Unexpected')) {\n              throw parseError\n            }\n          }\n          // Ignore JSON parse errors for incomplete chunks\n        }\n      }\n    }\n  } finally {\n    reader.releaseLock()\n  }\n\n  return fullContent\n}\n\n/**\n * Parse title and subtitle from streaming markdown content.\n * \n * Extracts:\n * - Title from first line starting with \"# \"\n * - Subtitle from first italic line (*text* or _text_) after title\n * - Body from remaining content\n * \n * @param content - Full or partial markdown content\n * @returns Parsed title, subtitle, markdown body, and parsing state\n */\nexport function parseStreamingContent(content: string): {\n  title: string | null\n  subtitle: string | null\n  markdown: string\n  titleComplete: boolean\n  subtitleComplete: boolean\n  bodyStartIndex: number\n} {\n  let title: string | null = null\n  let subtitle: string | null = null\n  let titleComplete = false\n  let subtitleComplete = false\n  let bodyStartIndex = 0\n\n  // Parse title from first line\n  if (content.includes('\\n')) {\n    const firstLine = content.split('\\n')[0]\n    if (firstLine.startsWith('# ')) {\n      title = firstLine.slice(2).trim()\n      titleComplete = true\n      bodyStartIndex = firstLine.length + 1 // +1 for newline\n    }\n  }\n\n  // Parse subtitle (first italic line after title)\n  if (titleComplete) {\n    const afterTitle = content.slice(bodyStartIndex)\n    if (afterTitle.includes('\\n')) {\n      const lines = afterTitle.split('\\n')\n      let lineOffset = 0\n      \n      for (let i = 0; i < lines.length - 1; i++) {\n        const line = lines[i]\n        if (line.trim()) {\n          const italicMatch = line.trim().match(/^\\*(.+)\\*$/) || line.trim().match(/^_(.+)_$/)\n          if (italicMatch) {\n            subtitle = italicMatch[1]\n            subtitleComplete = true\n            bodyStartIndex += lineOffset + line.length + 1\n          } else {\n            // Non-italic line found - treat as body start\n            subtitleComplete = true\n            bodyStartIndex += lineOffset\n          }\n          break\n        }\n        lineOffset += line.length + 1 // +1 for newline\n      }\n    }\n  }\n\n  const markdown = titleComplete ? content.slice(bodyStartIndex).trim() : ''\n\n  return {\n    title,\n    subtitle,\n    markdown,\n    titleComplete,\n    subtitleComplete,\n    bodyStartIndex,\n  }\n}\n","'use client'\n\nimport { createContext, useContext, useState, useCallback, useRef, useEffect, useMemo, type ReactNode } from 'react'\nimport type { ChatMode, EditCommand, EssaySnapshot, EditHandler } from '../../types/editor'\nimport { consumeSSEStream } from '../../lib/sse'\n\n// Re-export for backward compatibility\nexport type { ChatMode, EssaySnapshot, EditHandler } from '../../types/editor'\n\nexport interface Message {\n  role: 'user' | 'assistant'\n  content: string\n  mode?: ChatMode\n  appliedEdits?: boolean\n  previousState?: EssaySnapshot\n}\n\nexport interface EssayContext {\n  title: string\n  subtitle?: string\n  markdown: string\n}\n\nexport type ExpandPlanHandler = (plan: string, wordCount: number) => void\n\ninterface ChatContextValue {\n  messages: Message[]\n  essayContext: EssayContext | null\n  isStreaming: boolean\n  isOpen: boolean\n  mode: ChatMode\n  webSearchEnabled: boolean\n  thinkingEnabled: boolean\n  selectedModel: string\n  \n  setEssayContext: (context: EssayContext | null) => void\n  sendMessage: (content: string) => Promise<void>\n  stopStreaming: () => void\n  addMessage: (role: 'user' | 'assistant', content: string) => void\n  clearMessages: () => void\n  setIsOpen: (open: boolean) => void\n  setMode: (mode: ChatMode) => void\n  setWebSearchEnabled: (enabled: boolean) => void\n  setThinkingEnabled: (enabled: boolean) => void\n  setSelectedModel: (modelId: string) => void\n  registerEditHandler: (handler: EditHandler | null) => void\n  undoEdit: (messageIndex: number) => void\n  registerExpandPlanHandler: (handler: ExpandPlanHandler | null) => void\n  expandPlan: (wordCount?: number) => void\n}\n\nconst ChatContext = createContext<ChatContextValue | null>(null)\n\n// Parse edit blocks from agent mode responses\nfunction parseEditBlocks(content: string): { edits: EditCommand[], cleanContent: string } {\n  const editRegex = /:::edit\\s*([\\s\\S]*?)\\s*:::/g\n  const edits: EditCommand[] = []\n  let cleanContent = content\n  \n  let match\n  while ((match = editRegex.exec(content)) !== null) {\n    try {\n      const edit = JSON.parse(match[1]) as EditCommand\n      edits.push(edit)\n      cleanContent = cleanContent.replace(match[0], '')\n    } catch {\n      console.warn('Failed to parse edit block:', match[1])\n    }\n  }\n  \n  cleanContent = cleanContent.replace(/\\n{3,}/g, '\\n\\n').trim()\n  \n  return { edits, cleanContent }\n}\n\n/**\n * Strip incomplete or complete :::edit blocks from content for display during streaming.\n * This hides the edit \"spew\" from the user while streaming.\n */\nfunction stripEditBlocksForDisplay(content: string): string {\n  // First, remove complete :::edit...::: blocks\n  let cleaned = content.replace(/:::edit\\s*[\\s\\S]*?\\s*:::/g, '')\n  \n  // Then, remove any incomplete :::edit block at the end (still streaming)\n  // This catches: \":::edit\", \":::edit\\n{\", \":::edit\\n{\\\"type\\\":\", etc.\n  cleaned = cleaned.replace(/:::edit\\s*[\\s\\S]*$/g, '')\n  \n  // Also handle partial opening (just \":::\" or \":::e\" at end)\n  cleaned = cleaned.replace(/:::[a-z]*$/gi, '')\n  \n  // Clean up multiple newlines\n  cleaned = cleaned.replace(/\\n{3,}/g, '\\n\\n').trim()\n  \n  return cleaned\n}\n\n/**\n * Clean plan mode output by extracting content from <plan> tags and stripping trailing text.\n */\nfunction cleanPlanOutput(content: string): string {\n  let cleaned = content\n  \n  // Extract content from <plan> tags if present\n  const planMatch = cleaned.match(/<plan>([\\s\\S]*?)<\\/plan>/i)\n  if (planMatch) {\n    cleaned = planMatch[1]\n  } else {\n    const openTagMatch = cleaned.match(/<plan>([\\s\\S]*)/i)\n    if (openTagMatch) {\n      cleaned = openTagMatch[1]\n    }\n  }\n  \n  // Strip any text after the last bullet point\n  const lines = cleaned.split('\\n')\n  let lastBulletIndex = -1\n  for (let i = lines.length - 1; i >= 0; i--) {\n    if (lines[i].trim().startsWith('- ')) {\n      lastBulletIndex = i\n      break\n    }\n  }\n  \n  if (lastBulletIndex === -1) {\n    return cleaned.trim()\n  }\n  \n  return lines.slice(0, lastBulletIndex + 1).join('\\n').trim()\n}\n\ninterface ChatProviderProps {\n  children: ReactNode\n  apiBasePath?: string\n  chatApiPath?: string // Custom path for chat API (defaults to apiBasePath + '/ai/chat' or '/api/ai/chat')\n  historyApiPath?: string // Custom path for history API (defaults to '/api/chat/history')\n}\n\nexport function ChatProvider({ \n  children, \n  apiBasePath = '/api/cms',\n  chatApiPath,\n  historyApiPath = '/api/chat/history',\n}: ChatProviderProps) {\n  const [messages, setMessages] = useState<Message[]>([])\n  const [essayContext, setEssayContext] = useState<EssayContext | null>(null)\n  const [isStreaming, setIsStreaming] = useState(false)\n  const [isOpen, setIsOpen] = useState(false)\n  const [mode, setMode] = useState<ChatMode>('ask')\n  const [webSearchEnabled, setWebSearchEnabled] = useState(false)\n  const [thinkingEnabled, setThinkingEnabled] = useState(false)\n  const [selectedModel, setSelectedModel] = useState('claude-sonnet')\n  \n  const editHandlerRef = useRef<EditHandler | null>(null)\n  const expandPlanHandlerRef = useRef<ExpandPlanHandler | null>(null)\n  const historyLoadedRef = useRef(false)\n  const abortControllerRef = useRef<AbortController | null>(null)\n  const essayContextRef = useRef<EssayContext | null>(null)\n  \n  // Keep ref in sync with state for use in async callbacks\n  useEffect(() => {\n    essayContextRef.current = essayContext\n  }, [essayContext])\n\n  // Resolve chat API path - use CMS API if not explicitly set\n  const resolvedChatApiPath = chatApiPath || `${apiBasePath}/ai/chat`\n  \n  const registerEditHandler = useCallback((handler: EditHandler | null) => {\n    editHandlerRef.current = handler\n  }, [])\n\n  const registerExpandPlanHandler = useCallback((handler: ExpandPlanHandler | null) => {\n    expandPlanHandlerRef.current = handler\n  }, [])\n\n  const stopStreaming = useCallback(() => {\n    if (abortControllerRef.current) {\n      abortControllerRef.current.abort()\n      abortControllerRef.current = null\n    }\n    setIsStreaming(false)\n  }, [])\n\n  // Preload history on mount\n  useEffect(() => {\n    if (historyLoadedRef.current) return\n    historyLoadedRef.current = true\n    \n    fetch(historyApiPath)\n      .then(res => res.ok ? res.json() : [])\n      .then((data: { role: 'user' | 'assistant'; content: string }[]) => {\n        if (data.length > 0) {\n          setMessages(data.map(m => ({ role: m.role, content: m.content })))\n        }\n      })\n      .catch(() => {})\n  }, [historyApiPath])\n\n  const saveMessage = useCallback((role: 'user' | 'assistant', content: string) => {\n    fetch(historyApiPath, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ role, content }),\n    }).catch(() => {})\n  }, [historyApiPath])\n\n  const sendMessage = useCallback(async (content: string) => {\n    if (!content.trim() || isStreaming) return\n\n    abortControllerRef.current = new AbortController()\n    const signal = abortControllerRef.current.signal\n\n    const userMessage: Message = { role: 'user', content: content.trim() }\n    const newMessages = [...messages, userMessage]\n    setMessages(newMessages)\n    setIsStreaming(true)\n\n    saveMessage('user', content.trim())\n\n    const assistantMessage: Message = { role: 'assistant', content: '', mode }\n    setMessages([...newMessages, assistantMessage])\n\n    try {\n      const response = await fetch(resolvedChatApiPath, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          messages: newMessages,\n          essayContext: essayContext,\n          mode: mode,\n          model: selectedModel,\n          useWebSearch: webSearchEnabled,\n          useThinking: thinkingEnabled,\n        }),\n        signal,\n      })\n\n      if (!response.ok) {\n        if (response.status === 503) {\n          throw new Error('AI service temporarily unavailable. Please try again.')\n        }\n        if (response.status === 429) {\n          throw new Error('Rate limit exceeded. Please wait before trying again.')\n        }\n        const errorText = await response.text()\n        let errorMessage = `Server error (${response.status}). Please try again.`\n        try {\n          const errorJson = JSON.parse(errorText)\n          if (errorJson.error) {\n            errorMessage = errorJson.error\n          }\n        } catch {\n          // Couldn't parse JSON, use default error message\n        }\n        throw new Error(errorMessage)\n      }\n\n      let appliedEdits = false\n\n      // Use shared SSE stream consumer - returns accumulated content\n      const assistantContent = await consumeSSEStream(response, (event) => {\n        if (event.error) {\n          throw new Error(event.error)\n        }\n        // Display cleaned content during streaming (strip edit blocks from view)\n        const displayContent = mode === 'agent' \n          ? stripEditBlocksForDisplay(event.fullContent)\n          : event.fullContent\n          \n        setMessages(prev => {\n          const updated = [...prev]\n          updated[updated.length - 1] = { role: 'assistant', content: displayContent, mode }\n          return updated\n        })\n      }, signal)\n      \n      // Process agent mode edits\n      if (mode === 'agent' && editHandlerRef.current && essayContextRef.current) {\n        const { edits, cleanContent } = parseEditBlocks(assistantContent)\n        \n        const previousState: EssaySnapshot = {\n          title: essayContextRef.current!.title,\n          subtitle: essayContextRef.current!.subtitle || '',\n          markdown: essayContextRef.current!.markdown,\n        }\n        \n        for (const edit of edits) {\n          const success = editHandlerRef.current(edit)\n          if (success) appliedEdits = true\n        }\n        \n        if (edits.length > 0) {\n          const finalContent = cleanContent || 'Edit applied.'\n          setMessages(prev => {\n            const updated = [...prev]\n            updated[updated.length - 1] = { \n              role: 'assistant', \n              content: finalContent,\n              mode,\n              appliedEdits,\n              previousState: appliedEdits ? previousState : undefined,\n            }\n            return updated\n          })\n          saveMessage('assistant', finalContent)\n        } else {\n          saveMessage('assistant', assistantContent)\n        }\n      } else if (mode === 'plan') {\n        const cleanedContent = cleanPlanOutput(assistantContent)\n        \n        setMessages(prev => {\n          const updated = [...prev]\n          updated[updated.length - 1] = { \n            role: 'assistant', \n            content: cleanedContent,\n            mode,\n          }\n          return updated\n        })\n        \n        saveMessage('assistant', cleanedContent)\n      } else {\n        saveMessage('assistant', assistantContent)\n      }\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        return\n      }\n      console.error('Chat error:', error)\n      const errorMessage = error instanceof Error ? error.message : 'Something went wrong'\n      setMessages(prev => {\n        const updated = [...prev]\n        updated[updated.length - 1] = { role: 'assistant', content: `Error: ${errorMessage}` }\n        return updated\n      })\n    } finally {\n      abortControllerRef.current = null\n      setIsStreaming(false)\n    }\n  }, [messages, isStreaming, essayContext, mode, webSearchEnabled, thinkingEnabled, selectedModel, saveMessage, resolvedChatApiPath])\n\n  const clearMessages = useCallback(() => {\n    setMessages([])\n  }, [])\n\n  const addMessage = useCallback((role: 'user' | 'assistant', content: string) => {\n    const message: Message = { role, content }\n    setMessages(prev => [...prev, message])\n    saveMessage(role, content)\n  }, [saveMessage])\n\n  const undoEdit = useCallback((messageIndex: number) => {\n    const message = messages[messageIndex]\n    if (!message?.previousState || !editHandlerRef.current) return\n    \n    const success = editHandlerRef.current({\n      type: 'replace_all',\n      title: message.previousState.title,\n      subtitle: message.previousState.subtitle,\n      markdown: message.previousState.markdown,\n    })\n    \n    if (success) {\n      setMessages(prev => {\n        const updated = [...prev]\n        updated[messageIndex] = {\n          ...updated[messageIndex],\n          appliedEdits: false,\n          previousState: undefined,\n        }\n        return updated\n      })\n    }\n  }, [messages])\n\n  const expandPlan = useCallback((wordCount: number = 800) => {\n    if (!expandPlanHandlerRef.current) return\n    \n    const lastAssistantMessage = [...messages].reverse().find(m => m.role === 'assistant')\n    if (!lastAssistantMessage?.content) return\n    \n    expandPlanHandlerRef.current(lastAssistantMessage.content, wordCount)\n    \n    setIsOpen(false)\n  }, [messages])\n\n  const value = useMemo<ChatContextValue>(() => ({\n    messages,\n    essayContext,\n    isStreaming,\n    isOpen,\n    mode,\n    webSearchEnabled,\n    thinkingEnabled,\n    selectedModel,\n    setEssayContext,\n    sendMessage,\n    stopStreaming,\n    addMessage,\n    clearMessages,\n    setIsOpen,\n    setMode,\n    setWebSearchEnabled,\n    setThinkingEnabled,\n    setSelectedModel,\n    registerEditHandler,\n    undoEdit,\n    registerExpandPlanHandler,\n    expandPlan,\n  }), [\n    messages,\n    essayContext,\n    isStreaming,\n    isOpen,\n    mode,\n    webSearchEnabled,\n    thinkingEnabled,\n    selectedModel,\n    sendMessage,\n    stopStreaming,\n    addMessage,\n    clearMessages,\n    registerEditHandler,\n    undoEdit,\n    registerExpandPlanHandler,\n    expandPlan,\n  ])\n\n  return (\n    <ChatContext.Provider value={value}>\n      {children}\n    </ChatContext.Provider>\n  )\n}\n\nexport function useChatContext() {\n  const context = useContext(ChatContext)\n  if (!context) {\n    throw new Error('useChatContext must be used within a ChatProvider')\n  }\n  return context\n}\n\n/** Optional chat context - returns null if not within ChatProvider */\nexport function useChatContextOptional() {\n  return useContext(ChatContext)\n}\n\nexport { ChatContext }\n","import { mergeAttributes, Node, textblockTypeInputRule } from '@tiptap/core'\n\n/**\n * The heading level options.\n */\nexport type Level = 1 | 2 | 3 | 4 | 5 | 6\n\nexport interface HeadingOptions {\n  /**\n   * The available heading levels.\n   * @default [1, 2, 3, 4, 5, 6]\n   * @example [1, 2, 3]\n   */\n  levels: Level[]\n\n  /**\n   * The HTML attributes for a heading node.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    heading: {\n      /**\n       * Set a heading node\n       * @param attributes The heading attributes\n       * @example editor.commands.setHeading({ level: 1 })\n       */\n      setHeading: (attributes: { level: Level }) => ReturnType\n      /**\n       * Toggle a heading node\n       * @param attributes The heading attributes\n       * @example editor.commands.toggleHeading({ level: 1 })\n       */\n      toggleHeading: (attributes: { level: Level }) => ReturnType\n    }\n  }\n}\n\n/**\n * This extension allows you to create headings.\n * @see https://www.tiptap.dev/api/nodes/heading\n */\nexport const Heading = Node.create<HeadingOptions>({\n  name: 'heading',\n\n  addOptions() {\n    return {\n      levels: [1, 2, 3, 4, 5, 6],\n      HTMLAttributes: {},\n    }\n  },\n\n  content: 'inline*',\n\n  group: 'block',\n\n  defining: true,\n\n  addAttributes() {\n    return {\n      level: {\n        default: 1,\n        rendered: false,\n      },\n    }\n  },\n\n  parseHTML() {\n    return this.options.levels.map((level: Level) => ({\n      tag: `h${level}`,\n      attrs: { level },\n    }))\n  },\n\n  renderHTML({ node, HTMLAttributes }) {\n    const hasLevel = this.options.levels.includes(node.attrs.level)\n    const level = hasLevel ? node.attrs.level : this.options.levels[0]\n\n    return [`h${level}`, mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0]\n  },\n\n  parseMarkdown: (token, helpers) => {\n    // Convert 'heading' token to heading node\n    // marked provides 'depth' property (1-6) for heading level\n    return helpers.createNode('heading', { level: token.depth || 1 }, helpers.parseInline(token.tokens || []))\n  },\n\n  renderMarkdown: (node, h) => {\n    const level = node.attrs?.level ? parseInt(node.attrs.level as string, 10) : 1\n    const headingChars = '#'.repeat(level)\n\n    if (!node.content) {\n      return ''\n    }\n\n    // Use current context for proper joining/spacing\n    return `${headingChars} ${h.renderChildren(node.content)}`\n  },\n\n  addCommands() {\n    return {\n      setHeading:\n        attributes =>\n        ({ commands }) => {\n          if (!this.options.levels.includes(attributes.level)) {\n            return false\n          }\n\n          return commands.setNode(this.name, attributes)\n        },\n      toggleHeading:\n        attributes =>\n        ({ commands }) => {\n          if (!this.options.levels.includes(attributes.level)) {\n            return false\n          }\n\n          return commands.toggleNode(this.name, 'paragraph', attributes)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return this.options.levels.reduce(\n      (items, level) => ({\n        ...items,\n        ...{\n          [`Mod-Alt-${level}`]: () => this.editor.commands.toggleHeading({ level }),\n        },\n      }),\n      {},\n    )\n  },\n\n  addInputRules() {\n    return this.options.levels.map(level => {\n      return textblockTypeInputRule({\n        find: new RegExp(`^(#{${Math.min(...this.options.levels)},${level}})\\\\s$`),\n        type: this.type,\n        getAttributes: {\n          level,\n        },\n      })\n    })\n  },\n})\n","import { Heading } from './heading.js'\n\nexport * from './heading.js'\n\nexport default Heading\n","import { mergeAttributes, Node } from '@tiptap/core'\n\nexport interface ParagraphOptions {\n  /**\n   * The HTML attributes for a paragraph node.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    paragraph: {\n      /**\n       * Toggle a paragraph\n       * @example editor.commands.toggleParagraph()\n       */\n      setParagraph: () => ReturnType\n    }\n  }\n}\n\n/**\n * This extension allows you to create paragraphs.\n * @see https://www.tiptap.dev/api/nodes/paragraph\n */\nexport const Paragraph = Node.create<ParagraphOptions>({\n  name: 'paragraph',\n\n  priority: 1000,\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    }\n  },\n\n  group: 'block',\n\n  content: 'inline*',\n\n  parseHTML() {\n    return [{ tag: 'p' }]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['p', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0]\n  },\n\n  parseMarkdown: (token, helpers) => {\n    const tokens = token.tokens || []\n\n    // Special case: if paragraph contains only a single image token,\n    // unwrap it to avoid nesting block elements incorrectly\n    if (tokens.length === 1 && tokens[0].type === 'image') {\n      // Parse the image token directly as a block element\n      return helpers.parseChildren([tokens[0]])\n    }\n\n    // Convert 'paragraph' token to paragraph node\n    return helpers.createNode(\n      'paragraph',\n      undefined, // no attributes for paragraph\n      helpers.parseInline(tokens),\n    )\n  },\n\n  renderMarkdown: (node, h) => {\n    if (!node || !Array.isArray(node.content)) {\n      return ''\n    }\n\n    return h.renderChildren(node.content)\n  },\n\n  addCommands() {\n    return {\n      setParagraph:\n        () =>\n        ({ commands }) => {\n          return commands.setNode(this.name)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Alt-0': () => this.editor.commands.setParagraph(),\n    }\n  },\n})\n","import { Paragraph } from './paragraph.js'\n\nexport * from './paragraph.js'\n\nexport default Paragraph\n","import { mergeAttributes, Node, wrappingInputRule } from '@tiptap/core'\n\nconst ListItemName = 'listItem'\nconst TextStyleName = 'textStyle'\n\nexport interface BulletListOptions {\n  /**\n   * The node name for the list items\n   * @default 'listItem'\n   * @example 'paragraph'\n   */\n  itemTypeName: string\n\n  /**\n   * HTML attributes to add to the bullet list element\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n\n  /**\n   * Keep the marks when splitting the list\n   * @default false\n   * @example true\n   */\n  keepMarks: boolean\n\n  /**\n   * Keep the attributes when splitting the list\n   * @default false\n   * @example true\n   */\n  keepAttributes: boolean\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    bulletList: {\n      /**\n       * Toggle a bullet list\n       */\n      toggleBulletList: () => ReturnType\n    }\n  }\n}\n\n/**\n * Matches a bullet list to a dash or asterisk.\n */\nexport const bulletListInputRegex = /^\\s*([-+*])\\s$/\n\n/**\n * This extension allows you to create bullet lists.\n * This requires the ListItem extension\n * @see https://tiptap.dev/api/nodes/bullet-list\n * @see https://tiptap.dev/api/nodes/list-item.\n */\nexport const BulletList = Node.create<BulletListOptions>({\n  name: 'bulletList',\n\n  addOptions() {\n    return {\n      itemTypeName: 'listItem',\n      HTMLAttributes: {},\n      keepMarks: false,\n      keepAttributes: false,\n    }\n  },\n\n  group: 'block list',\n\n  content() {\n    return `${this.options.itemTypeName}+`\n  },\n\n  parseHTML() {\n    return [{ tag: 'ul' }]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['ul', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0]\n  },\n\n  markdownTokenName: 'list',\n\n  parseMarkdown: (token, helpers) => {\n    if (token.type !== 'list' || (token as any).ordered) {\n      return []\n    }\n\n    return {\n      type: 'bulletList',\n      content: token.items ? helpers.parseChildren(token.items) : [],\n    }\n  },\n\n  renderMarkdown: (node, h) => {\n    if (!node.content) {\n      return ''\n    }\n\n    return h.renderChildren(node.content, '\\n')\n  },\n\n  markdownOptions: {\n    indentsContent: true,\n  },\n\n  addCommands() {\n    return {\n      toggleBulletList:\n        () =>\n        ({ commands, chain }) => {\n          if (this.options.keepAttributes) {\n            return chain()\n              .toggleList(this.name, this.options.itemTypeName, this.options.keepMarks)\n              .updateAttributes(ListItemName, this.editor.getAttributes(TextStyleName))\n              .run()\n          }\n          return commands.toggleList(this.name, this.options.itemTypeName, this.options.keepMarks)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-8': () => this.editor.commands.toggleBulletList(),\n    }\n  },\n\n  addInputRules() {\n    let inputRule = wrappingInputRule({\n      find: bulletListInputRegex,\n      type: this.type,\n    })\n\n    if (this.options.keepMarks || this.options.keepAttributes) {\n      inputRule = wrappingInputRule({\n        find: bulletListInputRegex,\n        type: this.type,\n        keepMarks: this.options.keepMarks,\n        keepAttributes: this.options.keepAttributes,\n        getAttributes: () => {\n          return this.editor.getAttributes(TextStyleName)\n        },\n        editor: this.editor,\n      })\n    }\n    return [inputRule]\n  },\n})\n","import { mergeAttributes, Node, renderNestedMarkdownContent } from '@tiptap/core'\n\nexport interface ListItemOptions {\n  /**\n   * The HTML attributes for a list item node.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n\n  /**\n   * The node type for bulletList nodes\n   * @default 'bulletList'\n   * @example 'myCustomBulletList'\n   */\n  bulletListTypeName: string\n\n  /**\n   * The node type for orderedList nodes\n   * @default 'orderedList'\n   * @example 'myCustomOrderedList'\n   */\n  orderedListTypeName: string\n}\n\n/**\n * This extension allows you to create list items.\n * @see https://www.tiptap.dev/api/nodes/list-item\n */\nexport const ListItem = Node.create<ListItemOptions>({\n  name: 'listItem',\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      bulletListTypeName: 'bulletList',\n      orderedListTypeName: 'orderedList',\n    }\n  },\n\n  content: 'paragraph block*',\n\n  defining: true,\n\n  parseHTML() {\n    return [\n      {\n        tag: 'li',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['li', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0]\n  },\n\n  markdownTokenName: 'list_item',\n\n  parseMarkdown: (token, helpers) => {\n    if (token.type !== 'list_item') {\n      return []\n    }\n\n    let content: any[] = []\n\n    if (token.tokens && token.tokens.length > 0) {\n      // Check if we have paragraph tokens (complex list items)\n      const hasParagraphTokens = token.tokens.some(t => t.type === 'paragraph')\n\n      if (hasParagraphTokens) {\n        // If we have paragraph tokens, parse them as block elements\n        content = helpers.parseChildren(token.tokens)\n      } else {\n        // Check if the first token is a text token with nested inline tokens\n        const firstToken = token.tokens[0]\n\n        if (firstToken && firstToken.type === 'text' && firstToken.tokens && firstToken.tokens.length > 0) {\n          // Parse the inline content from the text token\n          const inlineContent = helpers.parseInline(firstToken.tokens)\n\n          // Start with the paragraph containing the inline content\n          content = [\n            {\n              type: 'paragraph',\n              content: inlineContent,\n            },\n          ]\n\n          // If there are additional tokens after the first text token (like nested lists),\n          // parse them as block elements and add them\n          if (token.tokens.length > 1) {\n            const remainingTokens = token.tokens.slice(1)\n            const additionalContent = helpers.parseChildren(remainingTokens)\n            content.push(...additionalContent)\n          }\n        } else {\n          // Fallback: parse all tokens as block elements\n          content = helpers.parseChildren(token.tokens)\n        }\n      }\n    }\n\n    // Ensure we always have at least an empty paragraph\n    if (content.length === 0) {\n      content = [\n        {\n          type: 'paragraph',\n          content: [],\n        },\n      ]\n    }\n\n    return {\n      type: 'listItem',\n      content,\n    }\n  },\n\n  renderMarkdown: (node, h, ctx) => {\n    return renderNestedMarkdownContent(\n      node,\n      h,\n      (context: any) => {\n        if (context.parentType === 'bulletList') {\n          return '- '\n        }\n        if (context.parentType === 'orderedList') {\n          return `${context.index + 1}. `\n        }\n        // Fallback to bullet list for unknown parent types\n        return '- '\n      },\n      ctx,\n    )\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      Enter: () => this.editor.commands.splitListItem(this.name),\n      Tab: () => this.editor.commands.sinkListItem(this.name),\n      'Shift-Tab': () => this.editor.commands.liftListItem(this.name),\n    }\n  },\n})\n","import { Extension } from '@tiptap/core'\n\nimport { handleBackspace, handleDelete } from './listHelpers/index.js'\n\nexport type ListKeymapOptions = {\n  /**\n   * An array of list types. This is used for item and wrapper list matching.\n   * @default []\n   * @example [{ itemName: 'listItem', wrapperNames: ['bulletList', 'orderedList'] }]\n   */\n  listTypes: Array<{\n    itemName: string\n    wrapperNames: string[]\n  }>\n}\n\n/**\n * This extension registers custom keymaps to change the behaviour of the backspace and delete keys.\n * By default Prosemirror keyhandling will always lift or sink items so paragraphs are joined into\n * the adjacent or previous list item. This extension will prevent this behaviour and instead will\n * try to join paragraphs from two list items into a single list item.\n * @see https://www.tiptap.dev/api/extensions/list-keymap\n */\nexport const ListKeymap = Extension.create<ListKeymapOptions>({\n  name: 'listKeymap',\n\n  addOptions() {\n    return {\n      listTypes: [\n        {\n          itemName: 'listItem',\n          wrapperNames: ['bulletList', 'orderedList'],\n        },\n        {\n          itemName: 'taskItem',\n          wrapperNames: ['taskList'],\n        },\n      ],\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      Delete: ({ editor }) => {\n        let handled = false\n\n        this.options.listTypes.forEach(({ itemName }) => {\n          if (editor.state.schema.nodes[itemName] === undefined) {\n            return\n          }\n\n          if (handleDelete(editor, itemName)) {\n            handled = true\n          }\n        })\n\n        return handled\n      },\n      'Mod-Delete': ({ editor }) => {\n        let handled = false\n\n        this.options.listTypes.forEach(({ itemName }) => {\n          if (editor.state.schema.nodes[itemName] === undefined) {\n            return\n          }\n\n          if (handleDelete(editor, itemName)) {\n            handled = true\n          }\n        })\n\n        return handled\n      },\n      Backspace: ({ editor }) => {\n        let handled = false\n\n        this.options.listTypes.forEach(({ itemName, wrapperNames }) => {\n          if (editor.state.schema.nodes[itemName] === undefined) {\n            return\n          }\n\n          if (handleBackspace(editor, itemName, wrapperNames)) {\n            handled = true\n          }\n        })\n\n        return handled\n      },\n      'Mod-Backspace': ({ editor }) => {\n        let handled = false\n\n        this.options.listTypes.forEach(({ itemName, wrapperNames }) => {\n          if (editor.state.schema.nodes[itemName] === undefined) {\n            return\n          }\n\n          if (handleBackspace(editor, itemName, wrapperNames)) {\n            handled = true\n          }\n        })\n\n        return handled\n      },\n    }\n  },\n})\n","export * from './findListItemPos.js'\nexport * from './getNextListDepth.js'\nexport * from './handleBackspace.js'\nexport * from './handleDelete.js'\nexport * from './hasListBefore.js'\nexport * from './hasListItemAfter.js'\nexport * from './hasListItemBefore.js'\nexport * from './listItemHasSubList.js'\nexport * from './nextListIsDeeper.js'\nexport * from './nextListIsHigher.js'\n","import { getNodeType } from '@tiptap/core'\nimport type { NodeType } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\n\nexport const findListItemPos = (typeOrName: string | NodeType, state: EditorState) => {\n  const { $from } = state.selection\n  const nodeType = getNodeType(typeOrName, state.schema)\n\n  let currentNode = null\n  let currentDepth = $from.depth\n  let currentPos = $from.pos\n  let targetDepth: number | null = null\n\n  while (currentDepth > 0 && targetDepth === null) {\n    currentNode = $from.node(currentDepth)\n\n    if (currentNode.type === nodeType) {\n      targetDepth = currentDepth\n    } else {\n      currentDepth -= 1\n      currentPos -= 1\n    }\n  }\n\n  if (targetDepth === null) {\n    return null\n  }\n\n  return { $pos: state.doc.resolve(currentPos), depth: targetDepth }\n}\n","import { getNodeAtPosition } from '@tiptap/core'\nimport type { EditorState } from '@tiptap/pm/state'\n\nimport { findListItemPos } from './findListItemPos.js'\n\nexport const getNextListDepth = (typeOrName: string, state: EditorState) => {\n  const listItemPos = findListItemPos(typeOrName, state)\n\n  if (!listItemPos) {\n    return false\n  }\n\n  const [, depth] = getNodeAtPosition(state, typeOrName, listItemPos.$pos.pos + 4)\n\n  return depth\n}\n","import type { Editor } from '@tiptap/core'\nimport { isAtStartOfNode, isNodeActive } from '@tiptap/core'\nimport type { Node } from '@tiptap/pm/model'\n\nimport { findListItemPos } from './findListItemPos.js'\nimport { hasListBefore } from './hasListBefore.js'\nimport { hasListItemBefore } from './hasListItemBefore.js'\nimport { listItemHasSubList } from './listItemHasSubList.js'\n\nexport const handleBackspace = (editor: Editor, name: string, parentListTypes: string[]) => {\n  // this is required to still handle the undo handling\n  if (editor.commands.undoInputRule()) {\n    return true\n  }\n\n  // if the selection is not collapsed\n  // we can rely on the default backspace behavior\n  if (editor.state.selection.from !== editor.state.selection.to) {\n    return false\n  }\n\n  // if the current item is NOT inside a list item &\n  // the previous item is a list (orderedList or bulletList)\n  // move the cursor into the list and delete the current item\n  if (!isNodeActive(editor.state, name) && hasListBefore(editor.state, name, parentListTypes)) {\n    const { $anchor } = editor.state.selection\n\n    const $listPos = editor.state.doc.resolve($anchor.before() - 1)\n\n    const listDescendants: Array<{ node: Node; pos: number }> = []\n\n    $listPos.node().descendants((node, pos) => {\n      if (node.type.name === name) {\n        listDescendants.push({ node, pos })\n      }\n    })\n\n    const lastItem = listDescendants.at(-1)\n\n    if (!lastItem) {\n      return false\n    }\n\n    const $lastItemPos = editor.state.doc.resolve($listPos.start() + lastItem.pos + 1)\n\n    return editor\n      .chain()\n      .cut({ from: $anchor.start() - 1, to: $anchor.end() + 1 }, $lastItemPos.end())\n      .joinForward()\n      .run()\n  }\n\n  // if the cursor is not inside the current node type\n  // do nothing and proceed\n  if (!isNodeActive(editor.state, name)) {\n    return false\n  }\n\n  // if the cursor is not at the start of a node\n  // do nothing and proceed\n  if (!isAtStartOfNode(editor.state)) {\n    return false\n  }\n\n  const listItemPos = findListItemPos(name, editor.state)\n\n  if (!listItemPos) {\n    return false\n  }\n\n  const $prev = editor.state.doc.resolve(listItemPos.$pos.pos - 2)\n  const prevNode = $prev.node(listItemPos.depth)\n\n  const previousListItemHasSubList = listItemHasSubList(name, editor.state, prevNode)\n\n  // if the previous item is a list item and doesn't have a sublist, join the list items\n  if (hasListItemBefore(name, editor.state) && !previousListItemHasSubList) {\n    return editor.commands.joinItemBackward()\n  }\n\n  // otherwise in the end, a backspace should\n  // always just lift the list item if\n  // joining / merging is not possible\n  return editor.chain().liftListItem(name).run()\n}\n","import type { EditorState } from '@tiptap/pm/state'\n\nexport const hasListBefore = (editorState: EditorState, name: string, parentListTypes: string[]) => {\n  const { $anchor } = editorState.selection\n\n  const previousNodePos = Math.max(0, $anchor.pos - 2)\n\n  const previousNode = editorState.doc.resolve(previousNodePos).node()\n\n  if (!previousNode || !parentListTypes.includes(previousNode.type.name)) {\n    return false\n  }\n\n  return true\n}\n","import type { EditorState } from '@tiptap/pm/state'\n\nexport const hasListItemBefore = (typeOrName: string, state: EditorState): boolean => {\n  const { $anchor } = state.selection\n\n  const $targetPos = state.doc.resolve($anchor.pos - 2)\n\n  if ($targetPos.index() === 0) {\n    return false\n  }\n\n  if ($targetPos.nodeBefore?.type.name !== typeOrName) {\n    return false\n  }\n\n  return true\n}\n","import { getNodeType } from '@tiptap/core'\nimport type { Node } from '@tiptap/pm/model'\nimport type { EditorState } from '@tiptap/pm/state'\n\nexport const listItemHasSubList = (typeOrName: string, state: EditorState, node?: Node) => {\n  if (!node) {\n    return false\n  }\n\n  const nodeType = getNodeType(typeOrName, state.schema)\n\n  let hasSubList = false\n\n  node.descendants(child => {\n    if (child.type === nodeType) {\n      hasSubList = true\n    }\n  })\n\n  return hasSubList\n}\n","import type { Editor } from '@tiptap/core'\nimport { isAtEndOfNode, isNodeActive } from '@tiptap/core'\n\nimport { nextListIsDeeper } from './nextListIsDeeper.js'\nimport { nextListIsHigher } from './nextListIsHigher.js'\n\nexport const handleDelete = (editor: Editor, name: string) => {\n  // if the cursor is not inside the current node type\n  // do nothing and proceed\n  if (!isNodeActive(editor.state, name)) {\n    return false\n  }\n\n  // if the cursor is not at the end of a node\n  // do nothing and proceed\n  if (!isAtEndOfNode(editor.state, name)) {\n    return false\n  }\n\n  // if the selection is not collapsed, or not within a single node\n  // do nothing and proceed\n  const { selection } = editor.state\n  const { $from, $to } = selection\n\n  if (!selection.empty && $from.sameParent($to)) {\n    return false\n  }\n\n  // check if the next node is a list with a deeper depth\n  if (nextListIsDeeper(name, editor.state)) {\n    return editor\n      .chain()\n      .focus(editor.state.selection.from + 4)\n      .lift(name)\n      .joinBackward()\n      .run()\n  }\n\n  if (nextListIsHigher(name, editor.state)) {\n    return editor.chain().joinForward().joinBackward().run()\n  }\n\n  return editor.commands.joinItemForward()\n}\n","import type { EditorState } from '@tiptap/pm/state'\n\nimport { findListItemPos } from './findListItemPos.js'\nimport { getNextListDepth } from './getNextListDepth.js'\n\nexport const nextListIsDeeper = (typeOrName: string, state: EditorState) => {\n  const listDepth = getNextListDepth(typeOrName, state)\n  const listItemPos = findListItemPos(typeOrName, state)\n\n  if (!listItemPos || !listDepth) {\n    return false\n  }\n\n  if (listDepth > listItemPos.depth) {\n    return true\n  }\n\n  return false\n}\n","import type { EditorState } from '@tiptap/pm/state'\n\nimport { findListItemPos } from './findListItemPos.js'\nimport { getNextListDepth } from './getNextListDepth.js'\n\nexport const nextListIsHigher = (typeOrName: string, state: EditorState) => {\n  const listDepth = getNextListDepth(typeOrName, state)\n  const listItemPos = findListItemPos(typeOrName, state)\n\n  if (!listItemPos || !listDepth) {\n    return false\n  }\n\n  if (listDepth < listItemPos.depth) {\n    return true\n  }\n\n  return false\n}\n","import type { EditorState } from '@tiptap/pm/state'\n\nexport const hasListItemAfter = (typeOrName: string, state: EditorState): boolean => {\n  const { $anchor } = state.selection\n\n  const $targetPos = state.doc.resolve($anchor.pos - $anchor.parentOffset - 2)\n\n  if ($targetPos.index() === $targetPos.parent.childCount - 1) {\n    return false\n  }\n\n  if ($targetPos.nodeAfter?.type.name !== typeOrName) {\n    return false\n  }\n\n  return true\n}\n","import { Extension } from '@tiptap/core'\n\nimport type { BulletListOptions } from '../bullet-list/index.js'\nimport { BulletList } from '../bullet-list/index.js'\nimport type { ListItemOptions } from '../item/index.js'\nimport { ListItem } from '../item/index.js'\nimport type { ListKeymapOptions } from '../keymap/index.js'\nimport { ListKeymap } from '../keymap/index.js'\nimport type { OrderedListOptions } from '../ordered-list/index.js'\nimport { OrderedList } from '../ordered-list/index.js'\nimport type { TaskItemOptions } from '../task-item/index.js'\nimport { TaskItem } from '../task-item/index.js'\nimport type { TaskListOptions } from '../task-list/index.js'\nimport { TaskList } from '../task-list/index.js'\n\nexport interface ListKitOptions {\n  /**\n   * If set to false, the bulletList extension will not be registered\n   * @example table: false\n   */\n  bulletList: Partial<BulletListOptions> | false\n  /**\n   * If set to false, the listItem extension will not be registered\n   */\n  listItem: Partial<ListItemOptions> | false\n  /**\n   * If set to false, the listKeymap extension will not be registered\n   */\n  listKeymap: Partial<ListKeymapOptions> | false\n  /**\n   * If set to false, the orderedList extension will not be registered\n   */\n  orderedList: Partial<OrderedListOptions> | false\n  /**\n   * If set to false, the taskItem extension will not be registered\n   */\n  taskItem: Partial<TaskItemOptions> | false\n  /**\n   * If set to false, the taskList extension will not be registered\n   */\n  taskList: Partial<TaskListOptions> | false\n}\n\n/**\n * The table kit is a collection of table editor extensions.\n *\n * Its a good starting point for building your own table in Tiptap.\n */\nexport const ListKit = Extension.create<ListKitOptions>({\n  name: 'listKit',\n\n  addExtensions() {\n    const extensions = []\n\n    if (this.options.bulletList !== false) {\n      extensions.push(BulletList.configure(this.options.bulletList))\n    }\n\n    if (this.options.listItem !== false) {\n      extensions.push(ListItem.configure(this.options.listItem))\n    }\n\n    if (this.options.listKeymap !== false) {\n      extensions.push(ListKeymap.configure(this.options.listKeymap))\n    }\n\n    if (this.options.orderedList !== false) {\n      extensions.push(OrderedList.configure(this.options.orderedList))\n    }\n\n    if (this.options.taskItem !== false) {\n      extensions.push(TaskItem.configure(this.options.taskItem))\n    }\n\n    if (this.options.taskList !== false) {\n      extensions.push(TaskList.configure(this.options.taskList))\n    }\n\n    return extensions\n  },\n})\n","import { mergeAttributes, Node, wrappingInputRule } from '@tiptap/core'\n\nimport { buildNestedStructure, collectOrderedListItems, parseListItems } from './utils.js'\n\nconst ListItemName = 'listItem'\nconst TextStyleName = 'textStyle'\n\nexport interface OrderedListOptions {\n  /**\n   * The node type name for list items.\n   * @default 'listItem'\n   * @example 'myListItem'\n   */\n  itemTypeName: string\n\n  /**\n   * The HTML attributes for an ordered list node.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n\n  /**\n   * Keep the marks when splitting a list item.\n   * @default false\n   * @example true\n   */\n  keepMarks: boolean\n\n  /**\n   * Keep the attributes when splitting a list item.\n   * @default false\n   * @example true\n   */\n  keepAttributes: boolean\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    orderedList: {\n      /**\n       * Toggle an ordered list\n       * @example editor.commands.toggleOrderedList()\n       */\n      toggleOrderedList: () => ReturnType\n    }\n  }\n}\n\n/**\n * Matches an ordered list to a 1. on input (or any number followed by a dot).\n */\nexport const orderedListInputRegex = /^(\\d+)\\.\\s$/\n\n/**\n * This extension allows you to create ordered lists.\n * This requires the ListItem extension\n * @see https://www.tiptap.dev/api/nodes/ordered-list\n * @see https://www.tiptap.dev/api/nodes/list-item\n */\nexport const OrderedList = Node.create<OrderedListOptions>({\n  name: 'orderedList',\n\n  addOptions() {\n    return {\n      itemTypeName: 'listItem',\n      HTMLAttributes: {},\n      keepMarks: false,\n      keepAttributes: false,\n    }\n  },\n\n  group: 'block list',\n\n  content() {\n    return `${this.options.itemTypeName}+`\n  },\n\n  addAttributes() {\n    return {\n      start: {\n        default: 1,\n        parseHTML: element => {\n          return element.hasAttribute('start') ? parseInt(element.getAttribute('start') || '', 10) : 1\n        },\n      },\n      type: {\n        default: null,\n        parseHTML: element => element.getAttribute('type'),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'ol',\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    const { start, ...attributesWithoutStart } = HTMLAttributes\n\n    return start === 1\n      ? ['ol', mergeAttributes(this.options.HTMLAttributes, attributesWithoutStart), 0]\n      : ['ol', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0]\n  },\n\n  markdownTokenName: 'list',\n\n  parseMarkdown: (token, helpers) => {\n    if (token.type !== 'list' || !token.ordered) {\n      return []\n    }\n\n    const startValue = token.start || 1\n    const content = token.items ? parseListItems(token.items, helpers) : []\n\n    if (startValue !== 1) {\n      return {\n        type: 'orderedList',\n        attrs: { start: startValue },\n        content,\n      }\n    }\n\n    return {\n      type: 'orderedList',\n      content,\n    }\n  },\n\n  renderMarkdown: (node, h) => {\n    if (!node.content) {\n      return ''\n    }\n\n    return h.renderChildren(node.content, '\\n')\n  },\n\n  markdownTokenizer: {\n    name: 'orderedList',\n    level: 'block',\n    start: (src: string) => {\n      const match = src.match(/^(\\s*)(\\d+)\\.\\s+/)\n      const index = match?.index\n      return index !== undefined ? index : -1\n    },\n    tokenize: (src: string, _tokens, lexer) => {\n      const lines = src.split('\\n')\n      const [listItems, consumed] = collectOrderedListItems(lines)\n\n      if (listItems.length === 0) {\n        return undefined\n      }\n\n      const items = buildNestedStructure(listItems, 0, lexer)\n\n      if (items.length === 0) {\n        return undefined\n      }\n\n      const startValue = listItems[0]?.number || 1\n\n      return {\n        type: 'list',\n        ordered: true,\n        start: startValue,\n        items,\n        raw: lines.slice(0, consumed).join('\\n'),\n      } as unknown as object\n    },\n  },\n\n  markdownOptions: {\n    indentsContent: true,\n  },\n\n  addCommands() {\n    return {\n      toggleOrderedList:\n        () =>\n        ({ commands, chain }) => {\n          if (this.options.keepAttributes) {\n            return chain()\n              .toggleList(this.name, this.options.itemTypeName, this.options.keepMarks)\n              .updateAttributes(ListItemName, this.editor.getAttributes(TextStyleName))\n              .run()\n          }\n          return commands.toggleList(this.name, this.options.itemTypeName, this.options.keepMarks)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-7': () => this.editor.commands.toggleOrderedList(),\n    }\n  },\n\n  addInputRules() {\n    let inputRule = wrappingInputRule({\n      find: orderedListInputRegex,\n      type: this.type,\n      getAttributes: match => ({ start: +match[1] }),\n      joinPredicate: (match, node) => node.childCount + node.attrs.start === +match[1],\n    })\n\n    if (this.options.keepMarks || this.options.keepAttributes) {\n      inputRule = wrappingInputRule({\n        find: orderedListInputRegex,\n        type: this.type,\n        keepMarks: this.options.keepMarks,\n        keepAttributes: this.options.keepAttributes,\n        getAttributes: match => ({ start: +match[1], ...this.editor.getAttributes(TextStyleName) }),\n        joinPredicate: (match, node) => node.childCount + node.attrs.start === +match[1],\n        editor: this.editor,\n      })\n    }\n    return [inputRule]\n  },\n})\n","import type { JSONContent, MarkdownLexerConfiguration, MarkdownParseHelpers, MarkdownToken } from '@tiptap/core'\n\n/**\n * Matches an ordered list item line with optional leading whitespace.\n * Captures: (1) indentation spaces, (2) item number, (3) content after marker\n * Example matches: \"1. Item\", \"  2. Nested item\", \"    3. Deeply nested\"\n */\nconst ORDERED_LIST_ITEM_REGEX = /^(\\s*)(\\d+)\\.\\s+(.*)$/\n\n/**\n * Matches any line that starts with whitespace (indented content).\n * Used to identify continuation content that belongs to a list item.\n */\nconst INDENTED_LINE_REGEX = /^\\s/\n\n/**\n * Represents a parsed ordered list item with indentation information\n */\nexport interface OrderedListItem {\n  indent: number\n  number: number\n  content: string\n  raw: string\n}\n\n/**\n * Collects all ordered list items from lines, parsing them into a flat array\n * with indentation information. Stops collecting continuation content when\n * encountering nested list items, allowing them to be processed separately.\n *\n * @param lines - Array of source lines to parse\n * @returns Tuple of [listItems array, number of lines consumed]\n */\nexport function collectOrderedListItems(lines: string[]): [OrderedListItem[], number] {\n  const listItems: OrderedListItem[] = []\n  let currentLineIndex = 0\n  let consumed = 0\n\n  while (currentLineIndex < lines.length) {\n    const line = lines[currentLineIndex]\n    const match = line.match(ORDERED_LIST_ITEM_REGEX)\n\n    if (!match) {\n      break\n    }\n\n    const [, indent, number, content] = match\n    const indentLevel = indent.length\n    let itemContent = content\n    let nextLineIndex = currentLineIndex + 1\n    const itemLines = [line]\n\n    // Collect continuation lines for this item (but NOT nested list items)\n    while (nextLineIndex < lines.length) {\n      const nextLine = lines[nextLineIndex]\n      const nextMatch = nextLine.match(ORDERED_LIST_ITEM_REGEX)\n\n      // If it's another list item (nested or not), stop collecting\n      if (nextMatch) {\n        break\n      }\n\n      // Check for continuation content (non-list content)\n      if (nextLine.trim() === '') {\n        // Empty line\n        itemLines.push(nextLine)\n        itemContent += '\\n'\n        nextLineIndex += 1\n      } else if (nextLine.match(INDENTED_LINE_REGEX)) {\n        // Indented content - part of this item (but not a list item)\n        itemLines.push(nextLine)\n        itemContent += `\\n${nextLine.slice(indentLevel + 2)}` // Remove list marker indent\n        nextLineIndex += 1\n      } else {\n        // Non-indented line means end of list\n        break\n      }\n    }\n\n    listItems.push({\n      indent: indentLevel,\n      number: parseInt(number, 10),\n      content: itemContent.trim(),\n      raw: itemLines.join('\\n'),\n    })\n\n    consumed = nextLineIndex\n    currentLineIndex = nextLineIndex\n  }\n\n  return [listItems, consumed]\n}\n\n/**\n * Recursively builds a nested structure from a flat array of list items\n * based on their indentation levels. Creates proper markdown tokens with\n * nested lists where appropriate.\n *\n * @param items - Flat array of list items with indentation info\n * @param baseIndent - The indentation level to process at this recursion level\n * @param lexer - Markdown lexer for parsing inline and block content\n * @returns Array of list_item tokens with proper nesting\n */\nexport function buildNestedStructure(\n  items: OrderedListItem[],\n  baseIndent: number,\n  lexer: MarkdownLexerConfiguration,\n): unknown[] {\n  const result: unknown[] = []\n  let currentIndex = 0\n\n  while (currentIndex < items.length) {\n    const item = items[currentIndex]\n\n    if (item.indent === baseIndent) {\n      // This item belongs at the current level\n      const contentLines = item.content.split('\\n')\n      const mainText = contentLines[0]?.trim() || ''\n\n      const tokens = []\n\n      // Always wrap the main text in a paragraph token\n      if (mainText) {\n        tokens.push({\n          type: 'paragraph',\n          raw: mainText,\n          tokens: lexer.inlineTokens(mainText),\n        })\n      }\n\n      // Handle additional content after the main text\n      const additionalContent = contentLines.slice(1).join('\\n').trim()\n      if (additionalContent) {\n        // Parse as block tokens (handles mixed unordered lists, etc.)\n        const blockTokens = lexer.blockTokens(additionalContent)\n        tokens.push(...blockTokens)\n      }\n\n      // Look ahead to find nested items at deeper indent levels\n      let lookAheadIndex = currentIndex + 1\n      const nestedItems = []\n\n      while (lookAheadIndex < items.length && items[lookAheadIndex].indent > baseIndent) {\n        nestedItems.push(items[lookAheadIndex])\n        lookAheadIndex += 1\n      }\n\n      // If we have nested items, recursively build their structure\n      if (nestedItems.length > 0) {\n        // Find the next indent level (immediate children)\n        const nextIndent = Math.min(...nestedItems.map(nestedItem => nestedItem.indent))\n\n        // Build the nested list recursively with all nested items\n        // The recursive call will handle further nesting\n        const nestedListItems = buildNestedStructure(nestedItems, nextIndent, lexer)\n\n        // Create a nested list token\n        tokens.push({\n          type: 'list',\n          ordered: true,\n          start: nestedItems[0].number,\n          items: nestedListItems,\n          raw: nestedItems.map(nestedItem => nestedItem.raw).join('\\n'),\n        })\n      }\n\n      result.push({\n        type: 'list_item',\n        raw: item.raw,\n        tokens,\n      })\n\n      // Skip the nested items we just processed\n      currentIndex = lookAheadIndex\n    } else {\n      // This item has deeper indent than we're currently processing\n      // It should be handled by a recursive call\n      currentIndex += 1\n    }\n  }\n\n  return result\n}\n\n/**\n * Parses markdown list item tokens into Tiptap JSONContent structure,\n * ensuring text content is properly wrapped in paragraph nodes.\n *\n * @param items - Array of markdown tokens representing list items\n * @param helpers - Markdown parse helpers for recursive parsing\n * @returns Array of listItem JSONContent nodes\n */\nexport function parseListItems(items: MarkdownToken[], helpers: MarkdownParseHelpers): JSONContent[] {\n  return items.map(item => {\n    if (item.type !== 'list_item') {\n      return helpers.parseChildren([item])[0]\n    }\n\n    // Parse the tokens within the list item\n    const content: JSONContent[] = []\n\n    if (item.tokens && item.tokens.length > 0) {\n      item.tokens.forEach(itemToken => {\n        // If it's already a proper block node (paragraph, list, etc.), parse it directly\n        if (\n          itemToken.type === 'paragraph' ||\n          itemToken.type === 'list' ||\n          itemToken.type === 'blockquote' ||\n          itemToken.type === 'code'\n        ) {\n          content.push(...helpers.parseChildren([itemToken]))\n        } else if (itemToken.type === 'text' && itemToken.tokens) {\n          // If it's inline text tokens, wrap them in a paragraph\n          const inlineContent = helpers.parseChildren([itemToken])\n          content.push({\n            type: 'paragraph',\n            content: inlineContent,\n          })\n        } else {\n          // For any other content, try to parse it\n          const parsed = helpers.parseChildren([itemToken])\n          if (parsed.length > 0) {\n            content.push(...parsed)\n          }\n        }\n      })\n    }\n\n    return {\n      type: 'listItem',\n      content,\n    }\n  })\n}\n","import type { KeyboardShortcutCommand } from '@tiptap/core'\nimport {\n  getRenderedAttributes,\n  mergeAttributes,\n  Node,\n  renderNestedMarkdownContent,\n  wrappingInputRule,\n} from '@tiptap/core'\nimport type { Node as ProseMirrorNode } from '@tiptap/pm/model'\n\nexport interface TaskItemOptions {\n  /**\n   * A callback function that is called when the checkbox is clicked while the editor is in readonly mode.\n   * @param node The prosemirror node of the task item\n   * @param checked The new checked state\n   * @returns boolean\n   */\n  onReadOnlyChecked?: (node: ProseMirrorNode, checked: boolean) => boolean\n\n  /**\n   * Controls whether the task items can be nested or not.\n   * @default false\n   * @example true\n   */\n  nested: boolean\n\n  /**\n   * HTML attributes to add to the task item element.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n\n  /**\n   * The node type for taskList nodes\n   * @default 'taskList'\n   * @example 'myCustomTaskList'\n   */\n  taskListTypeName: string\n\n  /**\n   * Accessibility options for the task item.\n   * @default {}\n   * @example\n   * ```js\n   * {\n   *   checkboxLabel: (node) => `Task item: ${node.textContent || 'empty task item'}`\n   * }\n   */\n  a11y?: {\n    checkboxLabel?: (node: ProseMirrorNode, checked: boolean) => string\n  }\n}\n\n/**\n * Matches a task item to a - [ ] on input.\n */\nexport const inputRegex = /^\\s*(\\[([( |x])?\\])\\s$/\n\n/**\n * This extension allows you to create task items.\n * @see https://www.tiptap.dev/api/nodes/task-item\n */\nexport const TaskItem = Node.create<TaskItemOptions>({\n  name: 'taskItem',\n\n  addOptions() {\n    return {\n      nested: false,\n      HTMLAttributes: {},\n      taskListTypeName: 'taskList',\n      a11y: undefined,\n    }\n  },\n\n  content() {\n    return this.options.nested ? 'paragraph block*' : 'paragraph+'\n  },\n\n  defining: true,\n\n  addAttributes() {\n    return {\n      checked: {\n        default: false,\n        keepOnSplit: false,\n        parseHTML: element => {\n          const dataChecked = element.getAttribute('data-checked')\n\n          return dataChecked === '' || dataChecked === 'true'\n        },\n        renderHTML: attributes => ({\n          'data-checked': attributes.checked,\n        }),\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: `li[data-type=\"${this.name}\"]`,\n        priority: 51,\n      },\n    ]\n  },\n\n  renderHTML({ node, HTMLAttributes }) {\n    return [\n      'li',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, {\n        'data-type': this.name,\n      }),\n      [\n        'label',\n        [\n          'input',\n          {\n            type: 'checkbox',\n            checked: node.attrs.checked ? 'checked' : null,\n          },\n        ],\n        ['span'],\n      ],\n      ['div', 0],\n    ]\n  },\n\n  parseMarkdown: (token, h) => {\n    // Parse the task item's text content into paragraph content\n    const content = []\n\n    // First, add the main paragraph content\n    if (token.tokens && token.tokens.length > 0) {\n      // If we have tokens, create a paragraph with the inline content\n      content.push(h.createNode('paragraph', {}, h.parseInline(token.tokens)))\n    } else if (token.text) {\n      // If we have raw text, create a paragraph with text node\n      content.push(h.createNode('paragraph', {}, [h.createNode('text', { text: token.text })]))\n    } else {\n      // Fallback: empty paragraph\n      content.push(h.createNode('paragraph', {}, []))\n    }\n\n    // Then, add any nested content (like nested task lists)\n    if (token.nestedTokens && token.nestedTokens.length > 0) {\n      const nestedContent = h.parseChildren(token.nestedTokens)\n      content.push(...nestedContent)\n    }\n\n    return h.createNode('taskItem', { checked: token.checked || false }, content)\n  },\n\n  renderMarkdown: (node, h) => {\n    const checkedChar = node.attrs?.checked ? 'x' : ' '\n    const prefix = `- [${checkedChar}] `\n\n    return renderNestedMarkdownContent(node, h, prefix)\n  },\n\n  addKeyboardShortcuts() {\n    const shortcuts: {\n      [key: string]: KeyboardShortcutCommand\n    } = {\n      Enter: () => this.editor.commands.splitListItem(this.name),\n      'Shift-Tab': () => this.editor.commands.liftListItem(this.name),\n    }\n\n    if (!this.options.nested) {\n      return shortcuts\n    }\n\n    return {\n      ...shortcuts,\n      Tab: () => this.editor.commands.sinkListItem(this.name),\n    }\n  },\n\n  addNodeView() {\n    return ({ node, HTMLAttributes, getPos, editor }) => {\n      const listItem = document.createElement('li')\n      const checkboxWrapper = document.createElement('label')\n      const checkboxStyler = document.createElement('span')\n      const checkbox = document.createElement('input')\n      const content = document.createElement('div')\n\n      const updateA11Y = (currentNode: ProseMirrorNode) => {\n        checkbox.ariaLabel =\n          this.options.a11y?.checkboxLabel?.(currentNode, checkbox.checked) ||\n          `Task item checkbox for ${currentNode.textContent || 'empty task item'}`\n      }\n\n      updateA11Y(node)\n\n      checkboxWrapper.contentEditable = 'false'\n      checkbox.type = 'checkbox'\n      checkbox.addEventListener('mousedown', event => event.preventDefault())\n      checkbox.addEventListener('change', event => {\n        // if the editor isnt editable and we don't have a handler for\n        // readonly checks we have to undo the latest change\n        if (!editor.isEditable && !this.options.onReadOnlyChecked) {\n          checkbox.checked = !checkbox.checked\n\n          return\n        }\n\n        const { checked } = event.target as any\n\n        if (editor.isEditable && typeof getPos === 'function') {\n          editor\n            .chain()\n            .focus(undefined, { scrollIntoView: false })\n            .command(({ tr }) => {\n              const position = getPos()\n\n              if (typeof position !== 'number') {\n                return false\n              }\n              const currentNode = tr.doc.nodeAt(position)\n\n              tr.setNodeMarkup(position, undefined, {\n                ...currentNode?.attrs,\n                checked,\n              })\n\n              return true\n            })\n            .run()\n        }\n        if (!editor.isEditable && this.options.onReadOnlyChecked) {\n          // Reset state if onReadOnlyChecked returns false\n          if (!this.options.onReadOnlyChecked(node, checked)) {\n            checkbox.checked = !checkbox.checked\n          }\n        }\n      })\n\n      Object.entries(this.options.HTMLAttributes).forEach(([key, value]) => {\n        listItem.setAttribute(key, value)\n      })\n\n      listItem.dataset.checked = node.attrs.checked\n      checkbox.checked = node.attrs.checked\n\n      checkboxWrapper.append(checkbox, checkboxStyler)\n      listItem.append(checkboxWrapper, content)\n\n      Object.entries(HTMLAttributes).forEach(([key, value]) => {\n        listItem.setAttribute(key, value)\n      })\n\n      // Track the keys of previously rendered HTML attributes for proper removal\n      let prevRenderedAttributeKeys = new Set(Object.keys(HTMLAttributes))\n\n      return {\n        dom: listItem,\n        contentDOM: content,\n        update: updatedNode => {\n          if (updatedNode.type !== this.type) {\n            return false\n          }\n\n          listItem.dataset.checked = updatedNode.attrs.checked\n          checkbox.checked = updatedNode.attrs.checked\n          updateA11Y(updatedNode)\n\n          // Sync all HTML attributes from the updated node\n          const extensionAttributes = editor.extensionManager.attributes\n          const newHTMLAttributes = getRenderedAttributes(updatedNode, extensionAttributes)\n          const newKeys = new Set(Object.keys(newHTMLAttributes))\n\n          // Remove attributes that were previously rendered but are no longer present\n          // If the attribute exists in static options, restore it instead of removing\n          const staticAttrs = this.options.HTMLAttributes\n\n          prevRenderedAttributeKeys.forEach(key => {\n            if (!newKeys.has(key)) {\n              if (key in staticAttrs) {\n                listItem.setAttribute(key, staticAttrs[key])\n              } else {\n                listItem.removeAttribute(key)\n              }\n            }\n          })\n\n          // Update or add new attributes\n          Object.entries(newHTMLAttributes).forEach(([key, value]) => {\n            if (value === null || value === undefined) {\n              // If the attribute exists in static options, restore it instead of removing\n              if (key in staticAttrs) {\n                listItem.setAttribute(key, staticAttrs[key])\n              } else {\n                listItem.removeAttribute(key)\n              }\n            } else {\n              listItem.setAttribute(key, value)\n            }\n          })\n\n          // Update the tracked keys for next update\n          prevRenderedAttributeKeys = newKeys\n\n          return true\n        },\n      }\n    }\n  },\n\n  addInputRules() {\n    return [\n      wrappingInputRule({\n        find: inputRegex,\n        type: this.type,\n        getAttributes: match => ({\n          checked: match[match.length - 1] === 'x',\n        }),\n      }),\n    ]\n  },\n})\n","import { mergeAttributes, Node, parseIndentedBlocks } from '@tiptap/core'\n\nexport interface TaskListOptions {\n  /**\n   * The node type name for a task item.\n   * @default 'taskItem'\n   * @example 'myCustomTaskItem'\n   */\n  itemTypeName: string\n\n  /**\n   * The HTML attributes for a task list node.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    taskList: {\n      /**\n       * Toggle a task list\n       * @example editor.commands.toggleTaskList()\n       */\n      toggleTaskList: () => ReturnType\n    }\n  }\n}\n\n/**\n * This extension allows you to create task lists.\n * @see https://www.tiptap.dev/api/nodes/task-list\n */\nexport const TaskList = Node.create<TaskListOptions>({\n  name: 'taskList',\n\n  addOptions() {\n    return {\n      itemTypeName: 'taskItem',\n      HTMLAttributes: {},\n    }\n  },\n\n  group: 'block list',\n\n  content() {\n    return `${this.options.itemTypeName}+`\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: `ul[data-type=\"${this.name}\"]`,\n        priority: 51,\n      },\n    ]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['ul', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes, { 'data-type': this.name }), 0]\n  },\n\n  parseMarkdown: (token, h) => {\n    return h.createNode('taskList', {}, h.parseChildren(token.items || []))\n  },\n\n  renderMarkdown: (node, h) => {\n    if (!node.content) {\n      return ''\n    }\n\n    return h.renderChildren(node.content, '\\n')\n  },\n\n  markdownTokenizer: {\n    name: 'taskList',\n    level: 'block',\n    start(src) {\n      // Look for the start of a task list item\n      const index = src.match(/^\\s*[-+*]\\s+\\[([ xX])\\]\\s+/)?.index\n      return index !== undefined ? index : -1\n    },\n    tokenize(src, tokens, lexer) {\n      // Helper function to recursively parse task lists\n      const parseTaskListContent = (content: string): any[] | undefined => {\n        const nestedResult = parseIndentedBlocks(\n          content,\n          {\n            itemPattern: /^(\\s*)([-+*])\\s+\\[([ xX])\\]\\s+(.*)$/,\n            extractItemData: match => ({\n              indentLevel: match[1].length,\n              mainContent: match[4],\n              checked: match[3].toLowerCase() === 'x',\n            }),\n            createToken: (data, nestedTokens) => ({\n              type: 'taskItem',\n              raw: '',\n              mainContent: data.mainContent,\n              indentLevel: data.indentLevel,\n              checked: data.checked,\n              text: data.mainContent,\n              tokens: lexer.inlineTokens(data.mainContent),\n              nestedTokens,\n            }),\n            // Allow recursive nesting\n            customNestedParser: parseTaskListContent,\n          },\n          lexer,\n        )\n\n        if (nestedResult) {\n          // Return as task list token\n          return [\n            {\n              type: 'taskList',\n              raw: nestedResult.raw,\n              items: nestedResult.items,\n            },\n          ]\n        }\n\n        // Fall back to regular markdown parsing if not a task list\n        return lexer.blockTokens(content)\n      }\n\n      const result = parseIndentedBlocks(\n        src,\n        {\n          itemPattern: /^(\\s*)([-+*])\\s+\\[([ xX])\\]\\s+(.*)$/,\n          extractItemData: match => ({\n            indentLevel: match[1].length,\n            mainContent: match[4],\n            checked: match[3].toLowerCase() === 'x',\n          }),\n          createToken: (data, nestedTokens) => ({\n            type: 'taskItem',\n            raw: '',\n            mainContent: data.mainContent,\n            indentLevel: data.indentLevel,\n            checked: data.checked,\n            text: data.mainContent,\n            tokens: lexer.inlineTokens(data.mainContent),\n            nestedTokens,\n          }),\n          // Use the recursive parser for nested content\n          customNestedParser: parseTaskListContent,\n        },\n        lexer,\n      )\n\n      if (!result) {\n        return undefined\n      }\n\n      return {\n        type: 'taskList',\n        raw: result.raw,\n        items: result.items,\n      }\n    },\n  },\n\n  markdownOptions: {\n    indentsContent: true,\n  },\n\n  addCommands() {\n    return {\n      toggleTaskList:\n        () =>\n        ({ commands }) => {\n          return commands.toggleList(this.name, this.options.itemTypeName)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-9': () => this.editor.commands.toggleTaskList(),\n    }\n  },\n})\n","import { BulletList } from '@tiptap/extension-list'\n\nexport type { BulletListOptions } from '@tiptap/extension-list'\nexport { BulletList } from '@tiptap/extension-list'\n\nexport default BulletList\n","import { OrderedList } from '@tiptap/extension-list'\n\nexport type { OrderedListOptions } from '@tiptap/extension-list'\nexport { OrderedList } from '@tiptap/extension-list'\n\nexport default OrderedList\n","import { ListItem } from '@tiptap/extension-list'\n\nexport type { ListItemOptions } from '@tiptap/extension-list'\nexport { ListItem } from '@tiptap/extension-list'\n\nexport default ListItem\n","import { Mark, markInputRule, markPasteRule, mergeAttributes } from '@tiptap/core'\n\nexport interface CodeOptions {\n  /**\n   * The HTML attributes applied to the code element.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    code: {\n      /**\n       * Set a code mark\n       */\n      setCode: () => ReturnType\n      /**\n       * Toggle inline code\n       */\n      toggleCode: () => ReturnType\n      /**\n       * Unset a code mark\n       */\n      unsetCode: () => ReturnType\n    }\n  }\n}\n\n/**\n * Regular expressions to match inline code blocks enclosed in backticks.\n *  It matches:\n *     - An opening backtick, followed by\n *     - Any text that doesn't include a backtick (captured for marking), followed by\n *     - A closing backtick as the final character.\n *  This ensures that any text between backticks is formatted as code,\n *  regardless of the surrounding characters (exception being another backtick).\n */\nexport const inputRegex = /(^|[^`])`([^`]+)`(?!`)$/\n\n/**\n * Matches inline code while pasting.\n */\nexport const pasteRegex = /(^|[^`])`([^`]+)`(?!`)/g\n\n/**\n * This extension allows you to mark text as inline code.\n * @see https://tiptap.dev/api/marks/code\n */\nexport const Code = Mark.create<CodeOptions>({\n  name: 'code',\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    }\n  },\n\n  excludes: '_',\n\n  code: true,\n\n  exitable: true,\n\n  parseHTML() {\n    return [{ tag: 'code' }]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['code', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes), 0]\n  },\n\n  markdownTokenName: 'codespan',\n\n  parseMarkdown: (token, helpers) => {\n    // Convert 'codespan' token to code mark\n    // For codespan tokens, we use the raw text content, not tokens\n    return helpers.applyMark('code', [{ type: 'text', text: token.text || '' }])\n  },\n\n  renderMarkdown: (node, h) => {\n    if (!node.content) {\n      return ''\n    }\n\n    return `\\`${h.renderChildren(node.content)}\\``\n  },\n\n  addCommands() {\n    return {\n      setCode:\n        () =>\n        ({ commands }) => {\n          return commands.setMark(this.name)\n        },\n      toggleCode:\n        () =>\n        ({ commands }) => {\n          return commands.toggleMark(this.name)\n        },\n      unsetCode:\n        () =>\n        ({ commands }) => {\n          return commands.unsetMark(this.name)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-e': () => this.editor.commands.toggleCode(),\n    }\n  },\n\n  addInputRules() {\n    return [\n      markInputRule({\n        find: inputRegex,\n        type: this.type,\n      }),\n    ]\n  },\n\n  addPasteRules() {\n    return [\n      markPasteRule({\n        find: pasteRegex,\n        type: this.type,\n      }),\n    ]\n  },\n})\n","import { Code } from './code.js'\n\nexport * from './code.js'\n\nexport default Code\n","import { mergeAttributes, Node, textblockTypeInputRule } from '@tiptap/core'\nimport { Plugin, PluginKey, Selection, TextSelection } from '@tiptap/pm/state'\n\nconst DEFAULT_TAB_SIZE = 4\n\nexport interface CodeBlockOptions {\n  /**\n   * Adds a prefix to language classes that are applied to code tags.\n   * @default 'language-'\n   */\n  languageClassPrefix: string | null | undefined\n  /**\n   * Define whether the node should be exited on triple enter.\n   * @default true\n   */\n  exitOnTripleEnter: boolean | null | undefined\n  /**\n   * Define whether the node should be exited on arrow down if there is no node after it.\n   * @default true\n   */\n  exitOnArrowDown: boolean | null | undefined\n  /**\n   * The default language.\n   * @default null\n   * @example 'js'\n   */\n  defaultLanguage: string | null | undefined\n  /**\n   * Enable tab key for indentation in code blocks.\n   * @default false\n   */\n  enableTabIndentation: boolean | null | undefined\n  /**\n   * The number of spaces to use for tab indentation.\n   * @default 4\n   */\n  tabSize: number | null | undefined\n  /**\n   * Custom HTML attributes that should be added to the rendered HTML tag.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    codeBlock: {\n      /**\n       * Set a code block\n       * @param attributes Code block attributes\n       * @example editor.commands.setCodeBlock({ language: 'javascript' })\n       */\n      setCodeBlock: (attributes?: { language: string }) => ReturnType\n      /**\n       * Toggle a code block\n       * @param attributes Code block attributes\n       * @example editor.commands.toggleCodeBlock({ language: 'javascript' })\n       */\n      toggleCodeBlock: (attributes?: { language: string }) => ReturnType\n    }\n  }\n}\n\n/**\n * Matches a code block with backticks.\n */\nexport const backtickInputRegex = /^```([a-z]+)?[\\s\\n]$/\n\n/**\n * Matches a code block with tildes.\n */\nexport const tildeInputRegex = /^~~~([a-z]+)?[\\s\\n]$/\n\n/**\n * This extension allows you to create code blocks.\n * @see https://tiptap.dev/api/nodes/code-block\n */\nexport const CodeBlock = Node.create<CodeBlockOptions>({\n  name: 'codeBlock',\n\n  addOptions() {\n    return {\n      languageClassPrefix: 'language-',\n      exitOnTripleEnter: true,\n      exitOnArrowDown: true,\n      defaultLanguage: null,\n      enableTabIndentation: false,\n      tabSize: DEFAULT_TAB_SIZE,\n      HTMLAttributes: {},\n    }\n  },\n\n  content: 'text*',\n\n  marks: '',\n\n  group: 'block',\n\n  code: true,\n\n  defining: true,\n\n  addAttributes() {\n    return {\n      language: {\n        default: this.options.defaultLanguage,\n        parseHTML: element => {\n          const { languageClassPrefix } = this.options\n\n          if (!languageClassPrefix) {\n            return null\n          }\n\n          const classNames = [...(element.firstElementChild?.classList || [])]\n          const languages = classNames\n            .filter(className => className.startsWith(languageClassPrefix))\n            .map(className => className.replace(languageClassPrefix, ''))\n          const language = languages[0]\n\n          if (!language) {\n            return null\n          }\n\n          return language\n        },\n        rendered: false,\n      },\n    }\n  },\n\n  parseHTML() {\n    return [\n      {\n        tag: 'pre',\n        preserveWhitespace: 'full',\n      },\n    ]\n  },\n\n  renderHTML({ node, HTMLAttributes }) {\n    return [\n      'pre',\n      mergeAttributes(this.options.HTMLAttributes, HTMLAttributes),\n      [\n        'code',\n        {\n          class: node.attrs.language ? this.options.languageClassPrefix + node.attrs.language : null,\n        },\n        0,\n      ],\n    ]\n  },\n\n  markdownTokenName: 'code',\n\n  parseMarkdown: (token, helpers) => {\n    if (token.raw?.startsWith('```') === false && token.codeBlockStyle !== 'indented') {\n      return []\n    }\n\n    return helpers.createNode(\n      'codeBlock',\n      { language: token.lang || null },\n      token.text ? [helpers.createTextNode(token.text)] : [],\n    )\n  },\n\n  renderMarkdown: (node, h) => {\n    let output = ''\n    const language = node.attrs?.language || ''\n\n    if (!node.content) {\n      output = `\\`\\`\\`${language}\\n\\n\\`\\`\\``\n    } else {\n      const lines = [`\\`\\`\\`${language}`, h.renderChildren(node.content), '```']\n      output = lines.join('\\n')\n    }\n\n    return output\n  },\n\n  addCommands() {\n    return {\n      setCodeBlock:\n        attributes =>\n        ({ commands }) => {\n          return commands.setNode(this.name, attributes)\n        },\n      toggleCodeBlock:\n        attributes =>\n        ({ commands }) => {\n          return commands.toggleNode(this.name, 'paragraph', attributes)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Alt-c': () => this.editor.commands.toggleCodeBlock(),\n\n      // remove code block when at start of document or code block is empty\n      Backspace: () => {\n        const { empty, $anchor } = this.editor.state.selection\n        const isAtStart = $anchor.pos === 1\n\n        if (!empty || $anchor.parent.type.name !== this.name) {\n          return false\n        }\n\n        if (isAtStart || !$anchor.parent.textContent.length) {\n          return this.editor.commands.clearNodes()\n        }\n\n        return false\n      },\n\n      // handle tab indentation\n      Tab: ({ editor }) => {\n        if (!this.options.enableTabIndentation) {\n          return false\n        }\n\n        const tabSize = this.options.tabSize ?? DEFAULT_TAB_SIZE\n        const { state } = editor\n        const { selection } = state\n        const { $from, empty } = selection\n\n        if ($from.parent.type !== this.type) {\n          return false\n        }\n\n        const indent = ' '.repeat(tabSize)\n\n        if (empty) {\n          return editor.commands.insertContent(indent)\n        }\n\n        return editor.commands.command(({ tr }) => {\n          const { from, to } = selection\n          const text = state.doc.textBetween(from, to, '\\n', '\\n')\n          const lines = text.split('\\n')\n          const indentedText = lines.map(line => indent + line).join('\\n')\n\n          tr.replaceWith(from, to, state.schema.text(indentedText))\n          return true\n        })\n      },\n\n      // handle shift+tab reverse indentation\n      'Shift-Tab': ({ editor }) => {\n        if (!this.options.enableTabIndentation) {\n          return false\n        }\n\n        const tabSize = this.options.tabSize ?? DEFAULT_TAB_SIZE\n        const { state } = editor\n        const { selection } = state\n        const { $from, empty } = selection\n\n        if ($from.parent.type !== this.type) {\n          return false\n        }\n\n        if (empty) {\n          return editor.commands.command(({ tr }) => {\n            const { pos } = $from\n            const codeBlockStart = $from.start()\n            const codeBlockEnd = $from.end()\n\n            const allText = state.doc.textBetween(codeBlockStart, codeBlockEnd, '\\n', '\\n')\n            const lines = allText.split('\\n')\n\n            let currentLineIndex = 0\n            let charCount = 0\n            const relativeCursorPos = pos - codeBlockStart\n\n            for (let i = 0; i < lines.length; i += 1) {\n              if (charCount + lines[i].length >= relativeCursorPos) {\n                currentLineIndex = i\n                break\n              }\n              charCount += lines[i].length + 1\n            }\n\n            const currentLine = lines[currentLineIndex]\n            const leadingSpaces = currentLine.match(/^ */)?.[0] || ''\n            const spacesToRemove = Math.min(leadingSpaces.length, tabSize)\n\n            if (spacesToRemove === 0) {\n              return true\n            }\n\n            let lineStartPos = codeBlockStart\n            for (let i = 0; i < currentLineIndex; i += 1) {\n              lineStartPos += lines[i].length + 1\n            }\n\n            tr.delete(lineStartPos, lineStartPos + spacesToRemove)\n\n            const cursorPosInLine = pos - lineStartPos\n            if (cursorPosInLine <= spacesToRemove) {\n              tr.setSelection(TextSelection.create(tr.doc, lineStartPos))\n            }\n\n            return true\n          })\n        }\n\n        return editor.commands.command(({ tr }) => {\n          const { from, to } = selection\n          const text = state.doc.textBetween(from, to, '\\n', '\\n')\n          const lines = text.split('\\n')\n          const reverseIndentText = lines\n            .map(line => {\n              const leadingSpaces = line.match(/^ */)?.[0] || ''\n              const spacesToRemove = Math.min(leadingSpaces.length, tabSize)\n              return line.slice(spacesToRemove)\n            })\n            .join('\\n')\n\n          tr.replaceWith(from, to, state.schema.text(reverseIndentText))\n          return true\n        })\n      },\n\n      // exit node on triple enter\n      Enter: ({ editor }) => {\n        if (!this.options.exitOnTripleEnter) {\n          return false\n        }\n\n        const { state } = editor\n        const { selection } = state\n        const { $from, empty } = selection\n\n        if (!empty || $from.parent.type !== this.type) {\n          return false\n        }\n\n        const isAtEnd = $from.parentOffset === $from.parent.nodeSize - 2\n        const endsWithDoubleNewline = $from.parent.textContent.endsWith('\\n\\n')\n\n        if (!isAtEnd || !endsWithDoubleNewline) {\n          return false\n        }\n\n        return editor\n          .chain()\n          .command(({ tr }) => {\n            tr.delete($from.pos - 2, $from.pos)\n\n            return true\n          })\n          .exitCode()\n          .run()\n      },\n\n      // exit node on arrow down\n      ArrowDown: ({ editor }) => {\n        if (!this.options.exitOnArrowDown) {\n          return false\n        }\n\n        const { state } = editor\n        const { selection, doc } = state\n        const { $from, empty } = selection\n\n        if (!empty || $from.parent.type !== this.type) {\n          return false\n        }\n\n        const isAtEnd = $from.parentOffset === $from.parent.nodeSize - 2\n\n        if (!isAtEnd) {\n          return false\n        }\n\n        const after = $from.after()\n\n        if (after === undefined) {\n          return false\n        }\n\n        const nodeAfter = doc.nodeAt(after)\n\n        if (nodeAfter) {\n          return editor.commands.command(({ tr }) => {\n            tr.setSelection(Selection.near(doc.resolve(after)))\n            return true\n          })\n        }\n\n        return editor.commands.exitCode()\n      },\n    }\n  },\n\n  addInputRules() {\n    return [\n      textblockTypeInputRule({\n        find: backtickInputRegex,\n        type: this.type,\n        getAttributes: match => ({\n          language: match[1],\n        }),\n      }),\n      textblockTypeInputRule({\n        find: tildeInputRegex,\n        type: this.type,\n        getAttributes: match => ({\n          language: match[1],\n        }),\n      }),\n    ]\n  },\n\n  addProseMirrorPlugins() {\n    return [\n      // this plugin creates a code block for pasted content from VS Code\n      // we can also detect the copied code language\n      new Plugin({\n        key: new PluginKey('codeBlockVSCodeHandler'),\n        props: {\n          handlePaste: (view, event) => {\n            if (!event.clipboardData) {\n              return false\n            }\n\n            // dont create a new code block within code blocks\n            if (this.editor.isActive(this.type.name)) {\n              return false\n            }\n\n            const text = event.clipboardData.getData('text/plain')\n            const vscode = event.clipboardData.getData('vscode-editor-data')\n            const vscodeData = vscode ? JSON.parse(vscode) : undefined\n            const language = vscodeData?.mode\n\n            if (!text || !language) {\n              return false\n            }\n\n            const { tr, schema } = view.state\n\n            // prepare a text node\n            // strip carriage return chars from text pasted as code\n            // see: https://github.com/ProseMirror/prosemirror-view/commit/a50a6bcceb4ce52ac8fcc6162488d8875613aacd\n            const textNode = schema.text(text.replace(/\\r\\n?/g, '\\n'))\n\n            // create a code block with the text node\n            // replace selection with the code block\n            tr.replaceSelectionWith(this.type.create({ language }, textNode))\n\n            if (tr.selection.$from.parent.type !== this.type) {\n              // put cursor inside the newly created code block\n              tr.setSelection(TextSelection.near(tr.doc.resolve(Math.max(0, tr.selection.from - 2))))\n            }\n\n            // store meta information\n            // this is useful for other plugins that depends on the paste event\n            // like the paste rule plugin\n            tr.setMeta('paste', true)\n\n            view.dispatch(tr)\n\n            return true\n          },\n        },\n      }),\n    ]\n  },\n})\n","import { CodeBlock } from './code-block.js'\n\nexport * from './code-block.js'\n\nexport default CodeBlock\n","export type Attributes = Record<string, any>\n\nexport type DOMOutputSpecElement = 0 | Attributes | DOMOutputSpecArray\n/**\n * Better describes the output of a `renderHTML` function in prosemirror\n * @see https://prosemirror.net/docs/ref/#model.DOMOutputSpec\n */\nexport type DOMOutputSpecArray =\n  | [string]\n  | [string, Attributes]\n  | [string, 0]\n  | [string, Attributes, 0]\n  | [string, Attributes, DOMOutputSpecArray | 0]\n  | [string, DOMOutputSpecArray]\n\n// JSX types for Tiptap's JSX runtime\n// These types only apply when using @jsxImportSource @tiptap/core\n// eslint-disable-next-line @typescript-eslint/no-namespace\nexport namespace JSX {\n  export type Element = DOMOutputSpecArray\n  export interface IntrinsicElements {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    [key: string]: any\n  }\n  export interface ElementChildrenAttribute {\n    children: unknown\n  }\n}\n\nexport type JSXRenderer = (\n  tag: 'slot' | string | ((props?: Attributes) => DOMOutputSpecArray | DOMOutputSpecElement),\n  props?: Attributes,\n  ...children: JSXRenderer[]\n) => DOMOutputSpecArray | DOMOutputSpecElement\n\nexport function Fragment(props: { children: JSXRenderer[] }) {\n  return props.children\n}\n\nexport const h: JSXRenderer = (tag, attributes) => {\n  // Treat the slot tag as the Prosemirror hole to render content into\n  if (tag === 'slot') {\n    return 0\n  }\n\n  // If the tag is a function, call it with the props\n  if (tag instanceof Function) {\n    return tag(attributes)\n  }\n\n  const { children, ...rest } = attributes ?? {}\n\n  if (tag === 'svg') {\n    throw new Error('SVG elements are not supported in the JSX syntax, use the array syntax instead')\n  }\n\n  // Otherwise, return the tag, attributes, and children\n  return [tag, rest, children]\n}\n\n// See\n// https://esbuild.github.io/api/#jsx-import-source\n// https://www.typescriptlang.org/tsconfig/#jsxImportSource\n\nexport { h as createElement, h as jsx, h as jsxDEV, h as jsxs }\n","export * from '../dist/jsx-runtime/jsx-runtime.js'\n","/** @jsxImportSource @tiptap/core */\nimport { mergeAttributes, Node, wrappingInputRule } from '@tiptap/core'\n\nexport interface BlockquoteOptions {\n  /**\n   * HTML attributes to add to the blockquote element\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    blockQuote: {\n      /**\n       * Set a blockquote node\n       */\n      setBlockquote: () => ReturnType\n      /**\n       * Toggle a blockquote node\n       */\n      toggleBlockquote: () => ReturnType\n      /**\n       * Unset a blockquote node\n       */\n      unsetBlockquote: () => ReturnType\n    }\n  }\n}\n\n/**\n * Matches a blockquote to a `>` as input.\n */\nexport const inputRegex = /^\\s*>\\s$/\n\n/**\n * This extension allows you to create blockquotes.\n * @see https://tiptap.dev/api/nodes/blockquote\n */\nexport const Blockquote = Node.create<BlockquoteOptions>({\n  name: 'blockquote',\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n    }\n  },\n\n  content: 'block+',\n\n  group: 'block',\n\n  defining: true,\n\n  parseHTML() {\n    return [{ tag: 'blockquote' }]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return (\n      <blockquote {...mergeAttributes(this.options.HTMLAttributes, HTMLAttributes)}>\n        <slot />\n      </blockquote>\n    )\n  },\n\n  parseMarkdown: (token, helpers) => {\n    return helpers.createNode('blockquote', undefined, helpers.parseChildren(token.tokens || []))\n  },\n\n  renderMarkdown: (node, h) => {\n    if (!node.content) {\n      return ''\n    }\n\n    // Use a single '>' prefix regardless of nesting level\n    // Nested blockquotes will add their own '>' prefix recursively\n    const prefix = '>'\n    const result: string[] = []\n\n    node.content.forEach(child => {\n      // Render each child node as an array so it gets processed properly\n      const childContent = h.renderChildren([child])\n      const lines = childContent.split('\\n')\n\n      const linesWithPrefix = lines.map(line => {\n        // Don't add prefix to empty lines\n        if (line.trim() === '') {\n          return prefix\n        }\n\n        // Nested blockquotes will already have their own prefixes\n        // We just need to add our own prefix at the start\n        return `${prefix} ${line}`\n      })\n\n      result.push(linesWithPrefix.join('\\n'))\n    })\n\n    // Add separator lines between children\n    return result.join(`\\n${prefix}\\n`)\n  },\n\n  addCommands() {\n    return {\n      setBlockquote:\n        () =>\n        ({ commands }) => {\n          return commands.wrapIn(this.name)\n        },\n      toggleBlockquote:\n        () =>\n        ({ commands }) => {\n          return commands.toggleWrap(this.name)\n        },\n      unsetBlockquote:\n        () =>\n        ({ commands }) => {\n          return commands.lift(this.name)\n        },\n    }\n  },\n\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-b': () => this.editor.commands.toggleBlockquote(),\n    }\n  },\n\n  addInputRules() {\n    return [\n      wrappingInputRule({\n        find: inputRegex,\n        type: this.type,\n      }),\n    ]\n  },\n})\n","import { Blockquote } from './blockquote.jsx'\n\nexport * from './blockquote.jsx'\n\nexport default Blockquote\n","import { canInsertNode, isNodeSelection, mergeAttributes, Node, nodeInputRule } from '@tiptap/core'\nimport { NodeSelection, TextSelection } from '@tiptap/pm/state'\n\nexport interface HorizontalRuleOptions {\n  /**\n   * The HTML attributes for a horizontal rule node.\n   * @default {}\n   * @example { class: 'foo' }\n   */\n  HTMLAttributes: Record<string, any>\n  /**\n   * The default type to insert after the horizontal rule.\n   * @default \"paragraph\"\n   * @example \"heading\"\n   */\n  nextNodeType: string\n}\n\ndeclare module '@tiptap/core' {\n  interface Commands<ReturnType> {\n    horizontalRule: {\n      /**\n       * Add a horizontal rule\n       * @example editor.commands.setHorizontalRule()\n       */\n      setHorizontalRule: () => ReturnType\n    }\n  }\n}\n\n/**\n * This extension allows you to insert horizontal rules.\n * @see https://www.tiptap.dev/api/nodes/horizontal-rule\n */\nexport const HorizontalRule = Node.create<HorizontalRuleOptions>({\n  name: 'horizontalRule',\n\n  addOptions() {\n    return {\n      HTMLAttributes: {},\n      nextNodeType: 'paragraph',\n    }\n  },\n\n  group: 'block',\n\n  parseHTML() {\n    return [{ tag: 'hr' }]\n  },\n\n  renderHTML({ HTMLAttributes }) {\n    return ['hr', mergeAttributes(this.options.HTMLAttributes, HTMLAttributes)]\n  },\n\n  markdownTokenName: 'hr',\n\n  parseMarkdown: (token, helpers) => {\n    return helpers.createNode('horizontalRule')\n  },\n\n  renderMarkdown: () => {\n    return '---'\n  },\n\n  addCommands() {\n    return {\n      setHorizontalRule:\n        () =>\n        ({ chain, state }) => {\n          // Check if we can insert the node at the current selection\n          if (!canInsertNode(state, state.schema.nodes[this.name])) {\n            return false\n          }\n\n          const { selection } = state\n          const { $to: $originTo } = selection\n\n          const currentChain = chain()\n\n          if (isNodeSelection(selection)) {\n            currentChain.insertContentAt($originTo.pos, {\n              type: this.name,\n            })\n          } else {\n            currentChain.insertContent({ type: this.name })\n          }\n\n          return (\n            currentChain\n              // set cursor after horizontal rule\n              .command(({ state: chainState, tr, dispatch }) => {\n                if (dispatch) {\n                  const { $to } = tr.selection\n                  const posAfter = $to.end()\n\n                  if ($to.nodeAfter) {\n                    if ($to.nodeAfter.isTextblock) {\n                      tr.setSelection(TextSelection.create(tr.doc, $to.pos + 1))\n                    } else if ($to.nodeAfter.isBlock) {\n                      tr.setSelection(NodeSelection.create(tr.doc, $to.pos))\n                    } else {\n                      tr.setSelection(TextSelection.create(tr.doc, $to.pos))\n                    }\n                  } else {\n                    // add node after horizontal rule if its the end of the document\n                    const nodeType =\n                      chainState.schema.nodes[this.options.nextNodeType] || $to.parent.type.contentMatch.defaultType\n                    const node = nodeType?.create()\n\n                    if (node) {\n                      tr.insert(posAfter, node)\n                      tr.setSelection(TextSelection.create(tr.doc, posAfter + 1))\n                    }\n                  }\n\n                  tr.scrollIntoView()\n                }\n\n                return true\n              })\n              .run()\n          )\n        },\n    }\n  },\n\n  addInputRules() {\n    return [\n      nodeInputRule({\n        find: /^(?:---|-|___\\s|\\*\\*\\*\\s)$/,\n        type: this.type,\n      }),\n    ]\n  },\n})\n","import { HorizontalRule } from './horizontal-rule.js'\n\nexport * from './horizontal-rule.js'\n\nexport default HorizontalRule\n","import { marked } from 'marked'\nimport TurndownService from 'turndown'\n\n// Configure marked for consistent rendering\nmarked.setOptions({\n  gfm: true,\n  breaks: false,\n})\n\n/**\n * Render markdown to HTML\n */\nexport function renderMarkdown(markdown: string): string {\n  return marked.parse(markdown) as string\n}\n\n/**\n * Convert markdown to HTML with GFM and line breaks enabled.\n * Safe for client-side use in components like ChatPanel.\n */\nexport function markdownToHtml(markdown: string): string {\n  return marked.parse(markdown, { gfm: true, breaks: true }) as string\n}\n\n/**\n * @deprecated Use markdownToHtml with Tailwind Typography prose classes instead.\n * Kept for backwards compatibility.\n */\nexport function markdownToStyledHtml(markdown: string): string {\n  return markdownToHtml(markdown)\n}\n\n/**\n * Parse markdown to tokens (AST)\n */\nexport function parseMarkdown(markdown: string) {\n  return marked.lexer(markdown)\n}\n\n// Configure Turndown for HTML to markdown conversion\nconst turndownService = new TurndownService({\n  headingStyle: 'atx',\n  codeBlockStyle: 'fenced',\n  bulletListMarker: '-',\n})\n\n// Add strikethrough support (GFM extension)\nturndownService.addRule('strikethrough', {\n  filter: (node: HTMLElement) => {\n    const tagName = node.nodeName.toLowerCase()\n    return tagName === 'del' || tagName === 's' || tagName === 'strike'\n  },\n  replacement: (content) => `~~${content}~~`\n})\n\n/**\n * Convert HTML to markdown\n */\nexport function htmlToMarkdown(html: string): string {\n  return turndownService.turndown(html)\n}\n\n/**\n * Count words in text (markdown or plain text)\n */\nexport function wordCount(text: string): number {\n  if (!text) return 0\n  return text.trim().split(/\\s+/).filter(Boolean).length\n}\n\n/**\n * Generate URL-safe slug from title\n */\nexport function generateSlug(title: string): string {\n  return title\n    .toLowerCase()\n    .trim()\n    .replace(/[^\\w\\s-]/g, '')\n    .replace(/\\s+/g, '-')\n    .replace(/-+/g, '-')\n    .substring(0, 60)\n}\n\nimport sanitizeHtml from 'sanitize-html'\n\n/**\n * Render markdown to sanitized HTML.\n * Safe for public-facing pages where user content is displayed.\n */\nexport function renderMarkdownSanitized(markdown: string): string {\n  const html = renderMarkdown(markdown)\n  return sanitizeHtml(html, {\n    allowedTags: sanitizeHtml.defaults.allowedTags.concat(['img', 'h1', 'h2']),\n    allowedAttributes: {\n      ...sanitizeHtml.defaults.allowedAttributes,\n      img: ['src', 'alt', 'title'],\n      a: ['href', 'target', 'rel'],\n    },\n  })\n}\n","'use client'\n\nimport { useEffect, useMemo } from 'react'\nimport { useEditor, EditorContent, Editor } from '@tiptap/react'\nimport StarterKit from '@tiptap/starter-kit'\nimport Heading from '@tiptap/extension-heading'\nimport Paragraph from '@tiptap/extension-paragraph'\nimport BulletList from '@tiptap/extension-bullet-list'\nimport OrderedList from '@tiptap/extension-ordered-list'\nimport ListItem from '@tiptap/extension-list-item'\nimport Code from '@tiptap/extension-code'\nimport CodeBlock from '@tiptap/extension-code-block'\nimport Blockquote from '@tiptap/extension-blockquote'\nimport HorizontalRule from '@tiptap/extension-horizontal-rule'\nimport Placeholder from '@tiptap/extension-placeholder'\nimport Link from '@tiptap/extension-link'\nimport Image from '@tiptap/extension-image'\nimport Strike from '@tiptap/extension-strike'\nimport Underline from '@tiptap/extension-underline'\nimport { renderMarkdown, htmlToMarkdown } from '../../lib/markdown'\nimport { CommentMark } from '../../lib/comment-mark'\n\n// Inject placeholder CSS once (pseudo-elements can't use inline styles)\nconst PLACEHOLDER_STYLE_ID = 'tiptap-placeholder-css'\nfunction injectPlaceholderStyles() {\n  if (typeof document === 'undefined') return\n  if (document.getElementById(PLACEHOLDER_STYLE_ID)) return\n  const style = document.createElement('style')\n  style.id = PLACEHOLDER_STYLE_ID\n  style.textContent = `\n    .ProseMirror p.is-editor-empty:first-child::before {\n      content: attr(data-placeholder);\n      color: #9ca3af;\n      pointer-events: none;\n      float: left;\n      height: 0;\n    }\n    .dark .ProseMirror p.is-editor-empty:first-child::before {\n      color: #6b7280;\n    }\n  `\n  document.head.appendChild(style)\n}\n\nexport interface SelectionState {\n  hasSelection: boolean\n  text: string\n  from: number\n  to: number\n  hasExistingComment: boolean\n}\n\ninterface TiptapEditorProps {\n  content: string // markdown\n  onChange: (markdown: string) => void\n  placeholder?: string\n  autoFocus?: boolean\n  onEditorReady?: (editor: Editor) => void\n  onSelectionChange?: (selection: SelectionState | null) => void\n  onCommentClick?: (commentId: string) => void\n  proseClasses?: string\n}\n\nconst DEFAULT_PROSE_CLASSES = 'prose'\n\n// Custom Heading extension with per-level Tailwind classes\nconst StyledHeading = Heading.extend({\n  renderHTML({ node, HTMLAttributes }) {\n    const level = node.attrs.level as 1 | 2 | 3\n    const classes: Record<number, string> = {\n      1: 'text-[22px] leading-tight font-bold mb-6',\n      2: 'text-lg leading-snug font-bold mt-8 mb-4',\n      3: 'text-base leading-snug font-bold mt-6 mb-3',\n    }\n    return [`h${level}`, { ...HTMLAttributes, class: classes[level] || '' }, 0]\n  },\n})\n\n// Custom Strike extension with Cmd+Shift+X shortcut (standard in Google Docs, Word, etc.)\nconst CustomStrike = Strike.extend({\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-x': () => this.editor.commands.toggleStrike(),\n      'Mod-Shift-X': () => this.editor.commands.toggleStrike(),\n    }\n  },\n})\n\n// Custom BulletList with Cmd+Shift+8 shortcut (Google Docs standard)\nconst CustomBulletList = BulletList.extend({\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-8': () => this.editor.commands.toggleBulletList(),\n    }\n  },\n})\n\n// Custom OrderedList with Cmd+Shift+7 shortcut (Google Docs standard)\nconst CustomOrderedList = OrderedList.extend({\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-7': () => this.editor.commands.toggleOrderedList(),\n    }\n  },\n})\n\n// Custom Code with Cmd+E shortcut (Gmail, Slack, Notion standard)\nconst CustomCode = Code.extend({\n  addKeyboardShortcuts() {\n    return {\n      'Mod-e': () => this.editor.commands.toggleCode(),\n      'Mod-E': () => this.editor.commands.toggleCode(),\n    }\n  },\n})\n\n// Custom Blockquote with Cmd+Shift+B shortcut\nconst CustomBlockquote = Blockquote.extend({\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Shift-b': () => this.editor.commands.toggleBlockquote(),\n      'Mod-Shift-B': () => this.editor.commands.toggleBlockquote(),\n    }\n  },\n})\n\n// Custom CodeBlock with Cmd+Shift+C shortcut\nconst CustomCodeBlock = CodeBlock.extend({\n  addKeyboardShortcuts() {\n    return {\n      'Mod-Alt-c': () => this.editor.commands.toggleCodeBlock(),\n      'Mod-Alt-C': () => this.editor.commands.toggleCodeBlock(),\n    }\n  },\n})\n\nexport function TiptapEditor({ \n  content, \n  onChange, \n  placeholder = 'Start writing...',\n  autoFocus = false,\n  onEditorReady,\n  onSelectionChange,\n  onCommentClick,\n  proseClasses = DEFAULT_PROSE_CLASSES,\n}: TiptapEditorProps) {\n  // Inject placeholder styles on mount\n  useEffect(() => {\n    injectPlaceholderStyles()\n  }, [])\n\n  // Convert initial content to HTML once\n  const initialHtml = useMemo(() => content ? renderMarkdown(content) : '', [content])\n\n  // Memoize extensions with inline Tailwind styles (no external CSS needed)\n  const extensions = useMemo(() => [\n    StarterKit.configure({\n      // Disable extensions we're replacing with styled or custom versions\n      heading: false,\n      paragraph: false,\n      bulletList: false,\n      orderedList: false,\n      listItem: false,\n      code: false,\n      codeBlock: false,\n      blockquote: false,\n      horizontalRule: false,\n      strike: false, // Using custom Strike with Cmd+Shift+X shortcut\n    }),\n    // Styled heading with per-level classes\n    StyledHeading.configure({ levels: [1, 2, 3] }),\n    // Paragraph\n    Paragraph.configure({\n      HTMLAttributes: { class: 'mb-4 leading-relaxed' },\n    }),\n    // Lists with custom keyboard shortcuts (Cmd+Shift+8 for bullet, Cmd+Shift+7 for ordered)\n    CustomBulletList.configure({\n      HTMLAttributes: { class: 'list-disc pl-6 mb-4' },\n    }),\n    CustomOrderedList.configure({\n      HTMLAttributes: { class: 'list-decimal pl-6 mb-4' },\n    }),\n    ListItem.configure({\n      HTMLAttributes: { class: 'mb-2' },\n    }),\n    // Inline code with Cmd+E shortcut\n    CustomCode.configure({\n      HTMLAttributes: { class: 'bg-ab-neutral-subtle px-1.5 py-0.5 rounded text-sm font-mono' },\n    }),\n    // Code block with Cmd+Alt+C shortcut\n    CustomCodeBlock.configure({\n      HTMLAttributes: { class: 'bg-ab-neutral-subtle p-4 rounded-lg overflow-x-auto mb-4 text-sm font-mono' },\n    }),\n    // Blockquote with Cmd+Shift+B shortcut\n    CustomBlockquote.configure({\n      HTMLAttributes: { class: 'border-l-4 border-ab-neutral-border pl-4 italic text-ab-neutral-strong my-4' },\n    }),\n    // Horizontal rule\n    HorizontalRule.configure({\n      HTMLAttributes: { class: 'my-8 border-t border-ab-neutral-border' },\n    }),\n    // Strike with Cmd+Shift+X shortcut (Google Docs/Word standard)\n    CustomStrike,\n    // Underline with Cmd+U shortcut\n    Underline,\n    // Placeholder\n    Placeholder.configure({\n      placeholder,\n    }),\n    // Link (already styled) - Cmd+K is built-in\n    Link.configure({\n      openOnClick: false,\n      HTMLAttributes: {\n        class: 'text-ab-active underline',\n      },\n    }),\n    // Image (already styled)\n    Image.configure({\n      HTMLAttributes: {\n        class: 'rounded-lg max-w-full my-4',\n      },\n    }),\n    // Comments\n    CommentMark.configure({\n      onCommentClick,\n    }),\n  ], [placeholder, onCommentClick])\n\n  const editor = useEditor({\n    immediatelyRender: false, // Prevent SSR hydration mismatch\n    extensions,\n    content: initialHtml,\n    onUpdate: ({ editor }) => {\n      const html = editor.getHTML()\n      const markdown = htmlToMarkdown(html)\n      onChange(markdown)\n    },\n    onSelectionUpdate: ({ editor }) => {\n      if (!onSelectionChange) return\n      \n      const { from, to, empty } = editor.state.selection\n      if (empty) {\n        onSelectionChange(null)\n      } else {\n        const text = editor.state.doc.textBetween(from, to, ' ')\n        \n        // Check if selection contains any comment marks\n        let hasExistingComment = false\n        editor.state.doc.nodesBetween(from, to, (node) => {\n          if (node.marks.some(mark => mark.type.name === 'comment')) {\n            hasExistingComment = true\n            return false // stop iteration\n          }\n        })\n        \n        onSelectionChange({\n          hasSelection: true,\n          text,\n          from,\n          to,\n          hasExistingComment,\n        })\n      }\n    },\n    editorProps: {\n      attributes: {\n        class: `${proseClasses} min-h-[500px] outline-none`,\n      },\n      // Handle Tab key for list indentation\n      handleKeyDown: (view, event) => {\n        if (event.key === 'Tab') {\n          // Let TipTap handle Tab for list indentation\n          // This prevents Tab from navigating to other elements\n          const { state, dispatch } = view\n          const { $from } = state.selection\n          \n          // Check if we're in a list item\n          const listItem = $from.node(-1)\n          if (listItem && listItem.type.name === 'listItem') {\n            // Prevent default tab behavior (focus change)\n            event.preventDefault()\n            return false // Let TipTap's default list handling take over\n          }\n        }\n        return false\n      },\n    },\n  })\n\n  // Notify parent when editor is ready and auto-focus if requested\n  useEffect(() => {\n    if (editor) {\n      if (onEditorReady) {\n        onEditorReady(editor)\n      }\n      if (autoFocus) {\n        // Small delay to ensure DOM is ready\n        setTimeout(() => editor.commands.focus(), 0)\n      }\n    }\n  }, [editor, onEditorReady, autoFocus])\n\n  // Sync external content changes (e.g., loading saved post)\n  useEffect(() => {\n    if (editor && content !== undefined) {\n      const currentMarkdown = htmlToMarkdown(editor.getHTML())\n      // Only update if content is actually different to avoid cursor jumping\n      if (currentMarkdown !== content) {\n        const html = content ? renderMarkdown(content) : ''\n        editor.commands.setContent(html, { emitUpdate: false })\n      }\n    }\n  }, [editor, content])\n\n  return <EditorContent editor={editor} />\n}\n","'use client'\n\nimport { useState, useRef, useEffect, useCallback, useContext } from 'react'\nimport { AutobloggerPortal } from './Portal'\nimport { Loader2, X, Copy, Check, ArrowUp, Pencil, Undo2, ChevronDown, MessageSquare, Globe, Brain, Square, List } from 'lucide-react'\nimport { useChatContext, type ChatMode } from '../hooks/useChat'\nimport { DEFAULT_MODELS, type AIModelOption } from '../../lib/models'\nimport { ControlButton } from './ControlButton'\nimport { ModelSelector } from './ModelSelector'\nimport { markdownToHtml } from '../../lib/markdown'\nimport { DashboardContext } from '../context'\n\n/** Default prose classes for chat messages - uses Tailwind Typography */\nconst DEFAULT_PROSE_CLASSES = 'prose prose-chat dark:prose-invert'\n\n/** Strip <plan> tags for display during streaming */\nfunction stripPlanTags(content: string): string {\n  return content\n    .replace(/<plan>/gi, '')\n    .replace(/<\\/plan>/gi, '')\n}\n\ninterface ChatPanelProps {\n  /** @deprecated Models are now fetched from DashboardContext */\n  modelsApiPath?: string\n  /** Optional prose classes for message rendering */\n  proseClasses?: string\n  /** Optional callback when navigating (e.g., for expandPlan navigation) */\n  onNavigate?: (path: string) => void\n  /** Whether currently on an editor page (controls Draft Essay behavior) */\n  isOnEditor?: boolean\n}\n\nexport function ChatPanel({ \n  proseClasses = DEFAULT_PROSE_CLASSES,\n  onNavigate: onNavigateProp,\n  isOnEditor: isOnEditorProp,\n}: ChatPanelProps) {\n  const { \n    messages, \n    isStreaming, \n    isOpen: open, \n    setIsOpen,\n    sendMessage: contextSendMessage,\n    stopStreaming,\n    essayContext,\n    mode,\n    setMode,\n    undoEdit,\n    webSearchEnabled,\n    setWebSearchEnabled,\n    thinkingEnabled,\n    setThinkingEnabled,\n    selectedModel,\n    setSelectedModel,\n    expandPlan,\n  } = useChatContext()\n  \n  // Try to get navigate from dashboard context as fallback\n  const dashboardContext = useContext(DashboardContext)\n  const onNavigate = onNavigateProp ?? dashboardContext?.navigate\n  \n  // Use essayContext presence to detect if we're editing (works with autoblogger)\n  const isOnEditor = isOnEditorProp ?? !!essayContext\n  \n  const [input, setInput] = useState('')\n  // Always start hidden - let useEffect handle the animation\n  const [isAnimating, setIsAnimating] = useState(false)\n  const [isVisible, setIsVisible] = useState(false)\n  const [mounted, setMounted] = useState(typeof window !== 'undefined')\n  const [copiedIndex, setCopiedIndex] = useState<number | null>(null)\n  const [modeMenuOpen, setModeMenuOpen] = useState(false)\n  const modeMenuRef = useRef<HTMLDivElement>(null)\n  const messagesEndRef = useRef<HTMLDivElement>(null)\n  const messagesContainerRef = useRef<HTMLDivElement>(null)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const prevMessageCountRef = useRef(0)\n  const savedScrollPositionRef = useRef<number | null>(null)\n  const hasOpenedBeforeRef = useRef(false)\n  const lastUserMessageRef = useRef<HTMLDivElement>(null)\n  \n  \n  // Get models from dashboard context or use defaults\n  const contextModels = dashboardContext?.sharedData?.aiSettings?.availableModels as AIModelOption[] | undefined\n  const models = (contextModels && contextModels.length > 0) ? contextModels : DEFAULT_MODELS\n  const currentModel = models.find(m => m.id === selectedModel)\n  \n  const onClose = useCallback(() => setIsOpen(false), [setIsOpen])\n  \n  const copyToClipboard = useCallback(async (text: string, index: number) => {\n    await navigator.clipboard.writeText(text)\n    setCopiedIndex(index)\n    setTimeout(() => setCopiedIndex(null), 2000)\n  }, [])\n  \n  // Handle Draft Essay button - either expand in current editor or navigate to new editor\n  const handleDraftEssay = useCallback(() => {\n    // Find the last assistant message (the plan)\n    const lastAssistantMessage = [...messages].reverse().find(m => m.role === 'assistant')\n    if (!lastAssistantMessage?.content) return\n    \n    if (isOnEditor) {\n      // Already on editor page - use the registered handler and switch to agent mode\n      expandPlan()\n      setMode('agent')\n    } else if (onNavigate) {\n      // Not on editor - store plan in sessionStorage and navigate to new editor\n      sessionStorage.setItem('pendingPlan', lastAssistantMessage.content)\n      setIsOpen(false)\n      onNavigate('/editor?fromPlan=1')\n    } else {\n      // Fallback: try to navigate directly if no handler (browser navigation)\n      sessionStorage.setItem('pendingPlan', lastAssistantMessage.content)\n      setIsOpen(false)\n      window.location.href = '/writer/editor?fromPlan=1'\n    }\n  }, [messages, isOnEditor, expandPlan, setIsOpen, setMode, onNavigate])\n  \n  // Close mode menu on outside click\n  useEffect(() => {\n    function handleClick(e: MouseEvent) {\n      if (modeMenuRef.current && !modeMenuRef.current.contains(e.target as Node)) {\n        setModeMenuOpen(false)\n      }\n    }\n    document.addEventListener('mousedown', handleClick)\n    return () => document.removeEventListener('mousedown', handleClick)\n  }, [])\n  \n  // Client-side only for portal - ensure mounted after hydration\n  useEffect(() => {\n    if (!mounted) setMounted(true)\n  }, [mounted])\n\n  // Handle open/close - just set visibility\n  useEffect(() => {\n    if (open) {\n      setIsVisible(true)\n      // Lock body scroll on iOS\n      document.body.style.overflow = 'hidden'\n      document.body.style.position = 'fixed'\n      document.body.style.width = '100%'\n      document.body.style.top = `-${window.scrollY}px`\n    } else {\n      setIsAnimating(false)\n      // Restore body scroll\n      const scrollY = document.body.style.top\n      document.body.style.overflow = ''\n      document.body.style.position = ''\n      document.body.style.width = ''\n      document.body.style.top = ''\n      window.scrollTo(0, parseInt(scrollY || '0') * -1)\n      // Wait for animation to complete before hiding\n      const timer = setTimeout(() => {\n        setIsVisible(false)\n      }, 200)\n      return () => clearTimeout(timer)\n    }\n  }, [open])\n\n  // Start animation AFTER visibility is set (separate render cycle)\n  useEffect(() => {\n    if (isVisible && open && !isAnimating) {\n      // Double rAF ensures browser has painted initial state before animating\n      requestAnimationFrame(() => {\n        requestAnimationFrame(() => {\n          setIsAnimating(true)\n        })\n      })\n    }\n  }, [isVisible, open, isAnimating])\n\n  // Save scroll position when panel closes\n  useEffect(() => {\n    if (!open && messagesContainerRef.current) {\n      savedScrollPositionRef.current = messagesContainerRef.current.scrollTop\n    }\n  }, [open])\n\n  // Restore scroll position on re-open (flex-col-reverse handles first open naturally)\n  useEffect(() => {\n    if (!open || !isVisible) return\n    if (!hasOpenedBeforeRef.current) {\n      // First open - CSS flex-col-reverse handles this, just mark as opened\n      hasOpenedBeforeRef.current = true\n      return\n    }\n    \n    // Re-open: restore saved scroll position\n    const container = messagesContainerRef.current\n    if (container && savedScrollPositionRef.current !== null) {\n      setTimeout(() => {\n        container.scrollTop = savedScrollPositionRef.current!\n      }, 50)\n    }\n  }, [open, isVisible])\n  \n  // Handle new messages while open\n  useEffect(() => {\n    if (!open || !isVisible) return\n    \n    const prevCount = prevMessageCountRef.current\n    const currentCount = messages.length\n    \n    if (currentCount > prevCount && prevCount > 0) {\n      // New message added while panel is open - smooth scroll to bottom\n      setTimeout(() => {\n        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth', block: 'end' })\n      }, 50)\n    }\n    \n    prevMessageCountRef.current = currentCount\n  }, [messages.length, open, isVisible])\n\n  // During streaming, scroll until user's message reaches top of container\n  useEffect(() => {\n    if (!isStreaming) return\n    \n    const container = messagesContainerRef.current\n    const userMessage = lastUserMessageRef.current\n    if (!container || !userMessage) return\n    \n    // Get positions\n    const containerRect = container.getBoundingClientRect()\n    const messageRect = userMessage.getBoundingClientRect()\n    \n    // If user message is still below the top of container, scroll down\n    const distanceFromTop = messageRect.top - containerRect.top\n    if (distanceFromTop > 10) {\n      // Scroll by a portion of the distance, creates smooth catching up\n      container.scrollTop += Math.min(distanceFromTop * 0.3, 30)\n    }\n  }, [messages, isStreaming])\n\n  // Auto-resize textarea\n  useEffect(() => {\n    const textarea = textareaRef.current\n    if (textarea) {\n      textarea.style.height = 'auto'\n      textarea.style.height = `${Math.min(textarea.scrollHeight, 200)}px`\n    }\n  }, [input])\n\n\n  const sendMessage = useCallback(async () => {\n    if (!input.trim() || isStreaming) return\n    const content = input.trim()\n    setInput('')\n    await contextSendMessage(content)\n  }, [input, isStreaming, contextSendMessage])\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      sendMessage()\n    }\n    if (e.key === 'Escape') {\n      e.stopPropagation()\n      onClose()\n    }\n  }\n  \n  // Keyboard shortcut to toggle agent/ask mode (Cmd/Ctrl + Shift + A)\n  useEffect(() => {\n    const handleGlobalKeyDown = (e: KeyboardEvent) => {\n      if ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key.toLowerCase() === 'a') {\n        e.preventDefault()\n        if (essayContext) {\n          // With essay context: open chat if closed, toggle agent/ask if open\n          if (!open) {\n            setIsOpen(true)\n          }\n          setMode(mode === 'agent' ? 'ask' : 'agent')\n        } else {\n          // No essay context (dashboard): toggle chat open/closed\n          setIsOpen(!open)\n          setMode('ask')\n        }\n      }\n    }\n    \n    document.addEventListener('keydown', handleGlobalKeyDown)\n    return () => document.removeEventListener('keydown', handleGlobalKeyDown)\n  }, [open, setIsOpen, setMode, essayContext, mode])\n\n  if (!isVisible || !mounted) return null\n  \n  return (\n    <AutobloggerPortal>\n      {/* Backdrop */}\n      <div \n        className={`fixed inset-0 h-[100dvh] bg-black/20 z-[60] transition-opacity duration-200 ${isAnimating ? 'opacity-100' : 'opacity-0'}`}\n        onClick={onClose}\n      />\n      \n      {/* Panel */}\n      <div \n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-label=\"Chat\"\n        className={`fixed z-[70] flex flex-col bg-background text-foreground shadow-xl transition-transform duration-200 ease-out overflow-hidden inset-x-0 top-0 h-[100dvh] md:left-auto md:w-full md:max-w-[380px] md:border-l md:border-border ${isAnimating ? 'translate-x-0' : 'translate-x-full'}`}\n      >\n        {/* Header */}\n        <div className=\"flex-shrink-0 border-b border-border px-4 py-3 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <h2 className=\"font-medium\">Chat</h2>\n            {essayContext && (\n              <span className=\"inline-block px-2 py-0.5 text-xs font-medium rounded-full bg-muted text-muted-foreground truncate max-w-[140px]\">\n                {essayContext.title || 'Untitled'}\n              </span>\n            )}\n          </div>\n          <button\n            onClick={onClose}\n            className=\"w-9 h-9 md:w-8 md:h-8 rounded-md hover:bg-accent flex items-center justify-center text-muted-foreground\"\n            aria-label=\"Close chat\"\n          >\n            <X className=\"w-5 h-5 md:w-4 md:h-4\" />\n          </button>\n        </div>\n\n        {/* Messages - flex-col-reverse makes scroll naturally start at bottom */}\n        <div ref={messagesContainerRef} className=\"flex-1 overflow-y-auto flex flex-col-reverse\">\n          {messages.length === 0 ? (\n            <div className=\"h-full flex items-center justify-center\">\n              <div className=\"text-center max-w-xs px-6\">\n                <p className=\"text-muted-foreground text-sm\">\n                  {mode === 'plan'\n                    ? \"Describe your essay idea and I'll create a structured outline with section headers and key points.\"\n                    : essayContext \n                      ? \"Chat about your essay  ask for feedback, discuss ideas, or get help with specific sections.\"\n                      : \"Chat with AI to brainstorm ideas, get feedback, or explore topics.\"\n                  }\n                </p>\n              </div>\n            </div>\n          ) : (\n            <div className=\"px-4 py-4 space-y-4\">\n              {messages.map((message, index) => {\n                // Track last user message for scroll behavior\n                const isLastUserMessage = message.role === 'user' && \n                  !messages.slice(index + 1).some(m => m.role === 'user')\n                \n                return (\n                <div\n                  key={index}\n                  ref={isLastUserMessage ? lastUserMessageRef : undefined}\n                  className={`flex gap-3 group ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}\n                >\n                  <div\n                    className={`max-w-[85%] rounded-2xl px-3 py-2 text-base relative ${message.role === 'user' ? 'bg-primary text-primary-foreground' : 'bg-muted'}`}\n                  >\n                    {message.role === 'assistant' ? (\n                      <div \n                        className={`${proseClasses} [&>*:first-child]:mt-0 [&>*:last-child]:mb-0`}\n                        dangerouslySetInnerHTML={{ __html: markdownToHtml(stripPlanTags(message.content)) }}\n                      />\n                    ) : (\n                      <div className=\"whitespace-pre-wrap break-words\">\n                        {message.content}\n                      </div>\n                    )}\n                    {isStreaming && index === messages.length - 1 && message.role === 'assistant' && (\n                      <span className=\"inline-block w-1.5 h-3 bg-current ml-0.5 animate-pulse\" />\n                    )}\n                    {/* Action buttons for assistant messages */}\n                    {message.role === 'assistant' && !isStreaming && (\n                      <div className=\"absolute -bottom-6 left-0 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\n                        <button\n                          onClick={() => copyToClipboard(message.content, index)}\n                          className=\"text-muted-foreground hover:text-foreground p-1 rounded\"\n                          aria-label=\"Copy message\"\n                        >\n                          {copiedIndex === index ? (\n                            <Check className=\"w-3.5 h-3.5 text-green-500\" />\n                          ) : (\n                            <Copy className=\"w-3.5 h-3.5\" />\n                          )}\n                        </button>\n                        {/* Undo button for agent mode edits */}\n                        {message.appliedEdits && message.previousState && (\n                          <button\n                            onClick={() => undoEdit(index)}\n                            className=\"text-muted-foreground hover:text-foreground p-1 rounded\"\n                            aria-label=\"Undo edit\"\n                          >\n                            <Undo2 className=\"w-3.5 h-3.5\" />\n                          </button>\n                        )}\n                        {/* Draft Essay button for plan mode */}\n                        {message.mode === 'plan' && index === messages.length - 1 && message.content && (\n                          <button\n                            onClick={handleDraftEssay}\n                            className=\"text-xs text-muted-foreground hover:text-foreground px-1 rounded\"\n                          >\n                            Draft Essay\n                          </button>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )})}\n              <div ref={messagesEndRef} />\n            </div>\n          )}\n        </div>\n\n        {/* Input */}\n        <form \n          onSubmit={(e) => { e.preventDefault(); sendMessage(); }}\n          className=\"flex-shrink-0 border-t border-border bg-background p-3 pb-[calc(1rem+env(safe-area-inset-bottom,0px))]\"\n        >\n          {/* Controls Row: Mode Dropdown, Globe Toggle, Model Dropdown */}\n          <div className=\"pb-3 flex items-center gap-2\">\n            {/* Mode Dropdown */}\n            <div ref={modeMenuRef} className=\"relative\">\n              <button\n                type=\"button\"\n                onClick={() => setModeMenuOpen(!modeMenuOpen)}\n                title=\"Switch mode (A)\"\n                className={`inline-flex items-center gap-1 px-2.5 py-1 text-sm font-medium rounded-full transition-colors ${\n                  mode === 'ask' \n                    ? 'bg-ab-success/15 text-ab-success' \n                    : mode === 'agent' \n                      ? 'bg-muted text-muted-foreground'\n                      : 'bg-ab-warning/15 text-ab-warning'\n                }`}\n              >\n                {mode === 'ask' && <MessageSquare className=\"w-3.5 h-3.5\" />}\n                {mode === 'agent' && <Pencil className=\"w-3.5 h-3.5\" />}\n                {mode === 'plan' && <List className=\"w-3.5 h-3.5\" />}\n                {mode === 'ask' ? 'Ask' : mode === 'agent' ? 'Agent' : 'Plan'}\n                <ChevronDown className=\"w-3 h-3 opacity-60\" />\n              </button>\n              {modeMenuOpen && (\n                <div className=\"absolute bottom-full left-0 mb-1 min-w-[160px] bg-popover border border-border rounded-lg shadow-lg z-[100] py-1\">\n                  <button\n                    type=\"button\"\n                    onClick={() => { setMode('agent'); setModeMenuOpen(false); textareaRef.current?.focus() }}\n                    disabled={!essayContext}\n                    className=\"w-full px-3 py-2 text-left text-sm hover:bg-accent flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    <Pencil className=\"w-4 h-4\" />\n                    <span className=\"flex-1\">Agent</span>\n                    <span className=\"text-xs text-muted-foreground\">A</span>\n                    {mode === 'agent' && <Check className=\"w-4 h-4\" />}\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={() => { setMode('plan'); setModeMenuOpen(false); textareaRef.current?.focus() }}\n                    className=\"w-full px-3 py-2 text-left text-sm hover:bg-accent flex items-center gap-2\"\n                  >\n                    <List className=\"w-4 h-4\" />\n                    <span className=\"flex-1\">Plan</span>\n                    {mode === 'plan' && <Check className=\"w-4 h-4\" />}\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={() => { setMode('ask'); setModeMenuOpen(false); textareaRef.current?.focus() }}\n                    className=\"w-full px-3 py-2 text-left text-sm hover:bg-accent flex items-center gap-2\"\n                  >\n                    <MessageSquare className=\"w-4 h-4\" />\n                    <span className=\"flex-1\">Ask</span>\n                    {mode === 'ask' && <Check className=\"w-4 h-4\" />}\n                  </button>\n                </div>\n              )}\n            </div>\n            \n            {/* Web Search Toggle */}\n            <ControlButton\n              onClick={() => { setWebSearchEnabled(!webSearchEnabled); textareaRef.current?.focus() }}\n              active={webSearchEnabled}\n              title={webSearchEnabled ? \"Web search enabled (works with all models)\" : \"Enable web search (works with all models)\"}\n              tabIndex={-1}\n            >\n              <Globe className=\"w-[18px] h-[18px]\" />\n            </ControlButton>\n            \n            {/* Thinking Mode Toggle */}\n            <ControlButton\n              onClick={() => { setThinkingEnabled(!thinkingEnabled); textareaRef.current?.focus() }}\n              active={thinkingEnabled}\n              title={thinkingEnabled ? \"Thinking mode enabled\" : \"Enable thinking mode\"}\n              tabIndex={-1}\n            >\n              <Brain className=\"w-[18px] h-[18px]\" />\n            </ControlButton>\n            \n            {/* Model Dropdown */}\n            <ModelSelector\n              models={models}\n              selectedModel={selectedModel}\n              onModelChange={(id) => { setSelectedModel(id); textareaRef.current?.focus() }}\n              currentModel={currentModel}\n            />\n          </div>\n          <div className=\"flex items-end gap-2\">\n            <textarea\n              ref={textareaRef}\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder={\n                mode === 'plan'\n                  ? \"Describe your essay idea...\"\n                  : mode === 'agent' && essayContext\n                    ? \"Ask me to edit your essay...\"\n                    : essayContext \n                      ? \"Ask about your essay...\" \n                      : \"Ask anything...\"\n              }\n              className=\"flex-1 min-h-[44px] max-h-[120px] resize-none px-3 py-2.5 border border-input rounded-md bg-transparent text-base focus:outline-none\"\n              rows={1}\n              autoFocus\n            />\n            <button\n              type={isStreaming ? 'button' : 'submit'}\n              onClick={isStreaming ? stopStreaming : undefined}\n              disabled={!isStreaming && !input.trim()}\n              className=\"rounded-full w-11 h-11 md:w-10 md:h-10 flex-shrink-0 border border-input bg-secondary text-secondary-foreground hover:bg-secondary/80 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center touch-manipulation\"\n            >\n              {isStreaming ? (\n                <Square className=\"h-5 w-5 md:h-4 md:w-4 fill-current\" />\n              ) : (\n                <ArrowUp className=\"h-6 w-6 md:h-5 md:w-5\" />\n              )}\n            </button>\n          </div>\n        </form>\n      </div>\n    </AutobloggerPortal>\n  )\n}\n","'use client'\n\nimport { useState, useEffect, lazy, Suspense, type ReactNode } from 'react'\nimport { Save, Loader2 } from 'lucide-react'\nimport type { CustomFieldConfig, StylesConfig } from './types'\nimport { DashboardProvider, useDashboardContext, type Session, type EditorState, type EditHandler } from './context'\nimport { WriterDashboard } from './pages/WriterDashboard'\nimport { EditorPage } from './pages/EditorPage'\nimport { SettingsPage } from './pages/settings'\nimport { Navbar } from './components/Navbar'\nimport { ChatButton } from './components/ChatButton'\nimport { ThemeProvider } from './components/ThemeProvider'\n\n// Lazy load ChatPanel (only needed when chat is opened)\nconst ChatPanel = lazy(() => \n  import('./components/ChatPanel').then(m => ({ default: m.ChatPanel }))\n)\nimport { ChatProvider } from './hooks/useChat'\nimport { useDashboardKeyboard } from './hooks/useKeyboard'\nimport { useChatContextOptional } from './hooks/useChat'\nimport { Toaster } from './components/Toaster'\n\ninterface AutobloggerDashboardProps {\n  basePath?: string\n  apiBasePath?: string\n  styles?: StylesConfig\n  fields?: CustomFieldConfig[]\n  session?: Session | null\n  onEditorStateChange?: (state: EditorState | null) => void\n  onRegisterEditHandler?: (handler: EditHandler | null) => void\n  onToggleView?: (currentPath: string, slug?: string) => void\n  // Navbar props\n  onSignOut?: () => void\n  navbarRightSlot?: ReactNode\n  // Chat props\n  chatApiPath?: string\n  historyApiPath?: string\n  proseClasses?: string\n}\n\nexport function AutobloggerDashboard({\n  basePath = '/writer',\n  apiBasePath = '/api/cms',\n  styles,\n  fields = [],\n  session = null,\n  onEditorStateChange,\n  onRegisterEditHandler,\n  onToggleView,\n  onSignOut,\n  navbarRightSlot,\n  chatApiPath,\n  historyApiPath,\n  proseClasses,\n}: AutobloggerDashboardProps) {\n  // Resolve default paths\n  const resolvedChatApiPath = chatApiPath || `${apiBasePath}/ai/chat`\n  const resolvedHistoryApiPath = historyApiPath || `${apiBasePath}/chat/history`\n\n  // ThemeProvider is always used - it's self-contained and manages its own .dark class\n  // The ThemeProvider wraps content with .autoblogger container that gets .dark class when needed\n  return (\n    <ThemeProvider className=\"h-dvh bg-background text-foreground flex flex-col overscroll-none\">\n      <ChatProvider \n        apiBasePath={apiBasePath}\n        chatApiPath={resolvedChatApiPath}\n        historyApiPath={resolvedHistoryApiPath}\n      >\n        <DashboardProvider basePath={basePath} apiBasePath={apiBasePath} styles={styles} fields={fields} session={session} onEditorStateChange={onEditorStateChange} onRegisterEditHandler={onRegisterEditHandler}>\n          <DashboardLayout \n            basePath={basePath}\n            onToggleView={onToggleView}\n            onSignOut={onSignOut}\n            navbarRightSlot={navbarRightSlot}\n            proseClasses={proseClasses}\n          />\n        </DashboardProvider>\n      </ChatProvider>\n    </ThemeProvider>\n  )\n}\n\ninterface DashboardLayoutProps {\n  basePath: string\n  onToggleView?: (currentPath: string, slug?: string) => void\n  onSignOut?: () => void\n  navbarRightSlot?: ReactNode\n  proseClasses?: string\n}\n\nfunction DashboardLayout({ \n  basePath,\n  onToggleView,\n  onSignOut,\n  navbarRightSlot,\n  proseClasses,\n}: DashboardLayoutProps) {\n  const { currentPath, navigate, onEditorStateChange } = useDashboardContext()\n  const [editorState, setEditorState] = useState<EditorState | null>(null)\n  const chatContext = useChatContextOptional()\n\n  // Extract slug from editor path\n  const editorSlug = currentPath.startsWith('/editor/') \n    ? currentPath.replace('/editor/', '') \n    : currentPath === '/editor' ? undefined : undefined\n  \n  const isEditorPage = currentPath.startsWith('/editor')\n\n  // Handle editor state changes - track internally AND forward to host app\n  const handleEditorStateChange = (state: EditorState | null) => {\n    setEditorState(state)\n    onEditorStateChange?.(state)\n  }\n\n  // Sync essay context to chat when editor content changes\n  const setEssayContext = chatContext?.setEssayContext\n  useEffect(() => {\n    if (!setEssayContext) return\n    \n    if (isEditorPage && editorState?.content) {\n      // Set essay context when on editor page with content\n      setEssayContext({\n        title: editorState.content.title,\n        subtitle: editorState.content.subtitle,\n        markdown: editorState.content.markdown,\n      })\n    } else {\n      // Clear essay context when leaving editor\n      setEssayContext(null)\n    }\n  }, [isEditorPage, editorState?.content, setEssayContext])\n\n  useDashboardKeyboard({\n    basePath,\n    onToggleView: onToggleView ? () => onToggleView(currentPath, editorSlug) : undefined,\n    onToggleSettings: () => {\n      if (currentPath.startsWith('/settings')) navigate('/')\n      else navigate('/settings')\n    },\n    onNewPost: () => {\n      if (currentPath === '/' || currentPath === '') navigate('/editor')\n    },\n    onEscape: () => {\n      if (currentPath !== '/' && currentPath !== '') navigate('/')\n    },\n  })\n\n  // Build the right slot with save button, chat button, and any custom slot from host app\n  const rightSlotWithButtons = (\n    <>\n      {/* Save button - only show on editor page */}\n      {isEditorPage && editorState && (\n        <button\n          type=\"button\"\n          onClick={() => editorState.onSave('draft')}\n          disabled={!editorState.hasUnsavedChanges || !!editorState.savingAs}\n          className=\"w-10 h-10 rounded-md border border-border active:bg-accent md:hover:bg-accent text-muted-foreground flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed\"\n          aria-label=\"Save\"\n          title={editorState.hasUnsavedChanges ? 'Save changes (S)' : 'No unsaved changes'}\n        >\n          {editorState.savingAs ? (\n            <Loader2 className=\"w-5 h-5 animate-spin\" />\n          ) : (\n            <Save className=\"w-5 h-5\" />\n          )}\n        </button>\n      )}\n      {/* Chat button - built-in, always available */}\n      <ChatButton />\n      {/* Extra slot from host app */}\n      {navbarRightSlot}\n    </>\n  )\n\n  return (\n    <>\n      <Navbar\n        onSignOut={onSignOut}\n        rightSlot={rightSlotWithButtons}\n      />\n      <main className=\"flex-1 overflow-auto\">\n        <DashboardRouter path={currentPath} onEditorStateChange={handleEditorStateChange} />\n      </main>\n      {/* Chat Panel - built-in (lazy loaded) */}\n      <Suspense fallback={null}>\n        <ChatPanel proseClasses={proseClasses} />\n      </Suspense>\n      {/* Toast notifications */}\n      <Toaster />\n    </>\n  )\n}\n\nfunction DashboardRouter({ path, onEditorStateChange }: { path: string; onEditorStateChange?: (state: EditorState | null) => void }) {\n  // Strip query params from path for routing\n  const pathWithoutQuery = path.split('?')[0]\n  \n  if (pathWithoutQuery === '/' || pathWithoutQuery === '') return <WriterDashboard />\n  if (pathWithoutQuery.startsWith('/editor')) {\n    const slug = pathWithoutQuery.replace('/editor/', '').replace('/editor', '')\n    // Use slug as key to remount only when editing a different post\n    // Query params (like ?idea=...) will trigger the editor's internal effects instead of a full remount\n    return <EditorPage key={slug || 'new'} slug={slug || undefined} onEditorStateChange={onEditorStateChange} />\n  }\n  if (pathWithoutQuery.startsWith('/settings')) return <SettingsPage subPath={pathWithoutQuery.replace('/settings', '')} />\n  return <div className=\"max-w-4xl mx-auto px-6 py-8\"><p className=\"text-muted-foreground\">Page not found: {path}</p></div>\n}\n\nexport type { AutobloggerDashboardProps }\n","'use client'\n\nimport { useState, useEffect, useMemo, useRef } from 'react'\nimport { Globe, Brain, ArrowUp, ChevronDown, Check, X, Plus, Search, MoreVertical, ExternalLink } from 'lucide-react'\nimport { useDashboardContext } from '../context'\nimport { Skeleton } from '../components/Skeleton'\nimport { ControlButton } from '../components/ControlButton'\nimport { ModelSelector } from '../components/ModelSelector'\nimport { PageContainer } from '../components/PageContainer'\nimport { LENGTH_OPTIONS, DEFAULT_MODELS, type AIModelOption } from '../../lib/models'\nimport { formatRelativeTime } from '../../lib/format'\n\ninterface Post {\n  id: string\n  title: string\n  slug: string\n  status: 'draft' | 'published' | 'suggested' | 'deleted'\n  wordCount?: number\n  updatedAt: string\n  publishedAt: string | null\n}\n\ninterface SuggestedPost {\n  id: string\n  title: string\n  subtitle: string | null\n  slug: string\n  sourceUrl: string | null\n  createdAt: string\n  topic: { id: string; name: string } | null\n}\n\ntype TabType = 'all' | 'drafts' | 'published'\n\nexport function WriterDashboard() {\n  const { apiBasePath, navigate, sharedData, sharedDataLoading, removeSharedPost } = useDashboardContext()\n  // Initialize from sharedData if available (prevents flash on re-navigation)\n  const [posts, setPosts] = useState<Post[]>(() => (sharedData?.posts as Post[]) || [])\n  const [loading, setLoading] = useState(() => !sharedData && sharedDataLoading)\n  const [searchQuery, setSearchQuery] = useState('')\n  const [searchOpen, setSearchOpen] = useState(false)\n  const [activeTab, setActiveTab] = useState<TabType>('all')\n  const [suggestedPosts, setSuggestedPosts] = useState<SuggestedPost[]>(() => (sharedData?.suggestedPosts as SuggestedPost[]) || [])\n  const [autoDraftEnabled, setAutoDraftEnabled] = useState(() => sharedData?.settings.autoDraftEnabled || false)\n  const [suggestedOpen, setSuggestedOpen] = useState(false)\n  const [actionLoading, setActionLoading] = useState<string | null>(null)\n  \n  const [models, setModels] = useState<AIModelOption[]>(() => \n    (sharedData?.aiSettings.availableModels as AIModelOption[])?.length > 0 \n      ? (sharedData?.aiSettings.availableModels as AIModelOption[]) \n      : DEFAULT_MODELS\n  )\n  const [modelId, setModelId] = useState(() => sharedData?.aiSettings.defaultModel || 'claude-sonnet')\n  const [length, setLength] = useState<number>(500)\n  const [webEnabled, setWebEnabled] = useState(false)\n  const [thinkingEnabled, setThinkingEnabled] = useState(false)\n  const [lengthOpen, setLengthOpen] = useState(false)\n\n  // Sync with shared data from context (updates when data changes)\n  useEffect(() => {\n    if (sharedData) {\n      setPosts(sharedData.posts as Post[])\n      setSuggestedPosts(sharedData.suggestedPosts as SuggestedPost[])\n      setAutoDraftEnabled(sharedData.settings.autoDraftEnabled)\n      if (sharedData.aiSettings.availableModels.length > 0) {\n        setModels(sharedData.aiSettings.availableModels as AIModelOption[])\n      }\n      if (sharedData.aiSettings.defaultModel) {\n        setModelId(sharedData.aiSettings.defaultModel)\n      }\n      setLoading(false)\n    }\n  }, [sharedData])\n\n  // Also stop loading when sharedDataLoading becomes false (even if data is empty)\n  useEffect(() => {\n    if (!sharedDataLoading) {\n      setLoading(false)\n    }\n  }, [sharedDataLoading])\n\n  const currentModel = models.find(m => m.id === modelId)\n  const draftCount = useMemo(() => posts.filter(p => p.status === 'draft').length, [posts])\n  const publishedCount = useMemo(() => posts.filter(p => p.status === 'published').length, [posts])\n\n  const filteredPosts = useMemo(() => {\n    let result = posts.filter(p => p.status !== 'suggested' && p.status !== 'deleted')\n    if (searchQuery) {\n      result = result.filter(p => p.title.toLowerCase().includes(searchQuery.toLowerCase()))\n    }\n    if (activeTab === 'drafts') result = result.filter(p => p.status === 'draft')\n    else if (activeTab === 'published') result = result.filter(p => p.status === 'published')\n    return result.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime())\n  }, [posts, searchQuery, activeTab])\n\n  async function handleDelete(id: string) {\n    if (!confirm('Delete this post?')) return\n    await fetch(`${apiBasePath}/posts/${id}`, { method: 'DELETE' })\n    setPosts(posts.filter(p => p.id !== id))\n    // Also remove from shared data so it stays deleted after navigation\n    removeSharedPost(id)\n  }\n\n  async function handlePublish(id: string) {\n    await fetch(`${apiBasePath}/posts/${id}`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ status: 'published' }),\n    })\n    setPosts(posts.map(p => p.id === id ? { ...p, status: 'published' as const } : p))\n  }\n\n  async function handleUnpublish(id: string) {\n    await fetch(`${apiBasePath}/posts/${id}`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ status: 'draft' }),\n    })\n    setPosts(posts.map(p => p.id === id ? { ...p, status: 'draft' as const } : p))\n  }\n\n  async function handleAcceptSuggested(post: SuggestedPost) {\n    setActionLoading(post.id)\n    try {\n      const res = await fetch(`${apiBasePath}/posts/${post.id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: 'draft' }),\n      })\n      if (res.ok) navigate(`/editor/${post.slug}`)\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  async function handleRejectSuggested(post: SuggestedPost) {\n    if (!confirm(`Reject \"${post.title}\"?`)) return\n    setActionLoading(post.id)\n    try {\n      const res = await fetch(`${apiBasePath}/posts/${post.id}`, { method: 'DELETE' })\n      if (res.ok) setSuggestedPosts(suggestedPosts.filter(p => p.id !== post.id))\n    } finally {\n      setActionLoading(null)\n    }\n  }\n\n  function handleIdeaSubmit(e: React.FormEvent<HTMLFormElement>) {\n    e.preventDefault()\n    const formData = new FormData(e.currentTarget)\n    const idea = (formData.get('idea') as string)?.trim()\n    if (idea) {\n      const params = new URLSearchParams({\n        idea,\n        model: modelId,\n        length: String(length),\n        ...(webEnabled && { web: '1' }),\n        ...(thinkingEnabled && { thinking: '1' })\n      })\n      navigate(`/editor?${params}`)\n    }\n  }\n\n  if (loading) {\n    return (\n      <PageContainer>\n        <div className=\"mt-4 mb-8\">\n          <Skeleton className=\"h-6 w-48 mb-4\" />\n          <Skeleton className=\"h-24 w-full\" />\n        </div>\n        <div className=\"flex border-b border-border mb-6 gap-4\">\n          <Skeleton className=\"h-10 w-16\" />\n          <Skeleton className=\"h-10 w-20\" />\n          <Skeleton className=\"h-10 w-24\" />\n        </div>\n        {[1,2,3,4,5].map(i => (\n          <Skeleton key={i} className=\"h-16 mb-2\" />\n        ))}\n      </PageContainer>\n    )\n  }\n\n  return (\n    <PageContainer className=\"pb-16\">\n      <button\n        onClick={() => navigate('/editor')}\n        className=\"sm:hidden fixed right-6 w-14 h-14 rounded-full shadow-lg z-50 bg-primary text-primary-foreground flex items-center justify-center\"\n        style={{ bottom: 'calc(1.5rem + env(safe-area-inset-bottom, 0px))' }}\n      >\n        <Plus className=\"w-6 h-6\" />\n      </button>\n\n      <div className=\"mt-4 mb-8\">\n        <h2 className=\"text-lg font-semibold mb-4\">What's on your mind?</h2>\n        <form onSubmit={handleIdeaSubmit}>\n          <div className=\"relative\">\n            <textarea\n              name=\"idea\"\n              placeholder=\"Describe your idea...\"\n              rows={3}\n              className=\"w-full min-h-[100px] px-3 py-2 pr-14 border border-input rounded-md bg-transparent resize-none text-base focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring placeholder:text-muted-foreground\"\n              onKeyDown={(e) => {\n                if (e.key === 'Enter' && !e.shiftKey) {\n                  e.preventDefault()\n                  e.currentTarget.form?.requestSubmit()\n                }\n              }}\n            />\n            <button\n              type=\"submit\"\n              className=\"absolute bottom-3 right-3 rounded-full w-10 h-10 bg-secondary text-secondary-foreground flex items-center justify-center hover:bg-secondary/80\"\n            >\n              <ArrowUp className=\"w-5 h-5\" />\n            </button>\n          </div>\n          \n          <div className=\"flex items-center gap-2\">\n            <div className=\"relative\">\n              <ControlButton onClick={() => setLengthOpen(!lengthOpen)}>\n                {length} words\n                <ChevronDown className=\"w-3 h-3 opacity-60\" />\n              </ControlButton>\n              {lengthOpen && (\n                <div className=\"absolute top-full left-0 mt-1 bg-popover border border-border rounded-md shadow-md z-50\">\n                  {LENGTH_OPTIONS.map(len => (\n                    <button\n                      key={len}\n                      onClick={() => { setLength(len); setLengthOpen(false) }}\n                      className=\"w-full px-3 py-2 text-left text-sm hover:bg-accent flex items-center justify-between min-w-[120px]\"\n                    >\n                      {len} words\n                      {length === len && <Check className=\"w-4 h-4\" />}\n                    </button>\n                  ))}\n                </div>\n              )}\n            </div>\n            \n            <ControlButton onClick={() => setWebEnabled(!webEnabled)} active={webEnabled} title=\"Search the web (works with all models)\">\n              <Globe className=\"w-[18px] h-[18px]\" />\n            </ControlButton>\n            \n            <ControlButton onClick={() => setThinkingEnabled(!thinkingEnabled)} active={thinkingEnabled} title=\"Enable thinking mode\">\n              <Brain className=\"w-[18px] h-[18px]\" />\n            </ControlButton>\n            \n            <ModelSelector models={models} selectedModel={modelId} onModelChange={setModelId} currentModel={currentModel} />\n          </div>\n        </form>\n      </div>\n\n      {autoDraftEnabled && (\n        <section className=\"mb-8\">\n          <button onClick={() => setSuggestedOpen(!suggestedOpen)} className=\"flex items-center gap-2 text-lg font-semibold mb-4\">\n            <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${suggestedOpen ? '' : '-rotate-90'}`} />\n            Suggested\n            {suggestedPosts.length > 0 && (\n              <span className=\"bg-primary text-primary-foreground text-xs px-1.5 py-0.5 rounded-full min-w-[1.25rem] text-center\">\n                {suggestedPosts.length}\n              </span>\n            )}\n          </button>\n          {suggestedOpen && (\n            suggestedPosts.length > 0 ? (\n              <div className=\"space-y-2\">\n                {suggestedPosts.map(post => (\n                  <div key={post.id} className=\"flex items-center justify-between gap-4 py-3 border-b border-border\">\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium truncate\">{post.title}</p>\n                      <div className=\"flex items-center gap-3 text-sm text-muted-foreground\">\n                        {post.topic && <span className=\"bg-muted px-2 py-0.5 rounded text-xs\">{post.topic.name}</span>}\n                        <span>{new Date(post.createdAt).toLocaleDateString()}</span>\n                        {post.sourceUrl && (\n                          <a\n                            href={post.sourceUrl}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-1 hover:text-foreground\"\n                            onClick={(e) => e.stopPropagation()}\n                          >\n                            <ExternalLink className=\"h-3 w-3\" />\n                            Source\n                          </a>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2 flex-shrink-0\">\n                      <button\n                        onClick={() => handleRejectSuggested(post)}\n                        disabled={actionLoading === post.id}\n                        className=\"p-2 text-muted-foreground hover:text-foreground hover:bg-accent rounded-md\"\n                      >\n                        <X className=\"h-4 w-4\" />\n                      </button>\n                      <button\n                        onClick={() => handleAcceptSuggested(post)}\n                        disabled={actionLoading === post.id}\n                        className=\"px-3 py-1.5 bg-primary text-primary-foreground rounded text-sm flex items-center gap-1\"\n                      >\n                        <Check className=\"h-4 w-4\" />\n                        Accept\n                      </button>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <p className=\"text-muted-foreground text-sm\">\n                No suggested essays {' '}\n                <button\n                  onClick={() => navigate('/settings/topics')}\n                  className=\"text-primary hover:underline\"\n                >\n                  configure topics\n                </button>{' '}\n                to generate drafts\n              </p>\n            )\n          )}\n        </section>\n      )}\n\n      <div className=\"relative flex items-center justify-between border-b border-border\">\n        <div className={`flex ${searchOpen ? 'invisible sm:visible' : ''}`}>\n          {(['all', 'drafts', 'published'] as TabType[]).map(tab => (\n            <button\n              key={tab}\n              onClick={() => setActiveTab(tab)}\n              className={`px-4 py-3 text-sm font-medium border-b-2 -mb-px transition-colors ${\n                activeTab === tab ? 'border-foreground text-foreground' : 'border-transparent text-muted-foreground hover:text-foreground'\n              }`}\n            >\n              {tab.charAt(0).toUpperCase() + tab.slice(1)}\n              <span className=\"text-muted-foreground ml-1\">\n                ({tab === 'all' ? posts.filter(p => p.status !== 'suggested' && p.status !== 'deleted').length : tab === 'drafts' ? draftCount : publishedCount})\n              </span>\n            </button>\n          ))}\n        </div>\n        \n        <div className={`flex items-center gap-2 pb-2 ${searchOpen ? 'absolute inset-x-0 sm:relative' : ''}`}>\n          <button onClick={() => navigate('/editor')} className=\"hidden sm:flex p-2 text-muted-foreground hover:text-foreground rounded-md hover:bg-accent\">\n            <Plus className=\"w-4 h-4\" />\n          </button>\n          {searchOpen ? (\n            <div className=\"flex items-center gap-2 flex-1 sm:flex-initial\">\n              <input\n                type=\"search\"\n                placeholder=\"Search...\"\n                value={searchQuery}\n                onChange={e => setSearchQuery(e.target.value)}\n                autoFocus\n                className=\"flex-1 sm:w-48 px-3 py-1.5 text-base bg-background border border-border rounded-md outline-none focus-visible:border-ring\"\n              />\n              <button onClick={() => { setSearchOpen(false); setSearchQuery('') }} className=\"p-2 text-muted-foreground hover:text-foreground sm:hidden\">\n                <X className=\"w-4 h-4\" />\n              </button>\n            </div>\n          ) : (\n            <button onClick={() => setSearchOpen(true)} className=\"p-2 text-muted-foreground hover:text-foreground rounded-md hover:bg-accent\">\n              <Search className=\"w-4 h-4\" />\n            </button>\n          )}\n        </div>\n      </div>\n\n      <section>\n        {filteredPosts.length > 0 ? (\n          <div className=\"space-y-0\">\n            {filteredPosts.map(post => (\n              <PostItem\n                key={post.id}\n                post={post}\n                onNavigate={() => navigate(`/editor/${post.slug}`)}\n                onDelete={() => handleDelete(post.id)}\n                onPublish={() => handlePublish(post.id)}\n                onUnpublish={() => handleUnpublish(post.id)}\n                showStatus={activeTab === 'all'}\n              />\n            ))}\n          </div>\n        ) : (\n          <p className=\"text-muted-foreground py-8 text-center\">\n            {searchQuery ? 'No matching articles' : 'No articles yet'}\n          </p>\n        )}\n      </section>\n    </PageContainer>\n  )\n}\n\n// PostItem component matching the original design\ninterface PostItemProps {\n  post: Post\n  onNavigate: () => void\n  onDelete: () => void\n  onPublish: () => void\n  onUnpublish: () => void\n  showStatus?: boolean\n}\n\nfunction PostItem({ post, onNavigate, onDelete, onPublish, onUnpublish, showStatus }: PostItemProps) {\n  const [menuOpen, setMenuOpen] = useState(false)\n  const menuRef = useRef<HTMLDivElement>(null)\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    if (!menuOpen) return\n    function handleClick(e: MouseEvent) {\n      if (menuRef.current && !menuRef.current.contains(e.target as Node)) {\n        setMenuOpen(false)\n      }\n    }\n    document.addEventListener('click', handleClick)\n    return () => document.removeEventListener('click', handleClick)\n  }, [menuOpen])\n\n  return (\n    <div className=\"flex items-center justify-between py-4 border-b border-border group\">\n      <div className=\"flex-1 min-w-0\">\n        <button onClick={onNavigate} className=\"block text-left w-full\">\n          <h3 className=\"font-medium truncate group-hover:text-muted-foreground\">\n            {post.title || 'Untitled'}\n          </h3>\n          <p className=\"text-sm text-muted-foreground mt-1 flex items-center gap-2\">\n            {showStatus && (\n              <span className={`text-xs px-1.5 py-0.5 rounded uppercase font-medium ${\n                post.status === 'draft' \n                  ? 'bg-ab-warning/20 text-ab-warning'\n                  : 'bg-ab-success/20 text-ab-success'\n              }`}>\n                {post.status}\n              </span>\n            )}\n            <span>{formatRelativeTime(post.updatedAt)}{post.wordCount ? `  ${post.wordCount} words` : ''}</span>\n          </p>\n        </button>\n      </div>\n      \n      <div className=\"relative\" ref={menuRef}>\n        <button\n          onClick={() => setMenuOpen(!menuOpen)}\n          className=\"p-2 text-muted-foreground hover:text-foreground rounded-md hover:bg-accent\"\n        >\n          <MoreVertical className=\"w-4 h-4\" />\n        </button>\n        {menuOpen && (\n          <div className=\"absolute right-0 top-full mt-1 bg-popover border border-border rounded-md shadow-lg z-50 min-w-[12rem] md:min-w-[8rem] p-1\">\n            <button\n              onClick={() => { onNavigate(); setMenuOpen(false) }}\n              className=\"w-full px-3 py-2.5 md:px-2 md:py-1.5 min-h-[44px] md:min-h-0 text-left text-sm rounded-sm hover:bg-accent cursor-default\"\n            >\n              Edit\n            </button>\n            {post.status === 'draft' && (\n              <button\n                onClick={() => { onPublish(); setMenuOpen(false) }}\n                className=\"w-full px-3 py-2.5 md:px-2 md:py-1.5 min-h-[44px] md:min-h-0 text-left text-sm rounded-sm hover:bg-accent cursor-default\"\n              >\n                Publish\n              </button>\n            )}\n            {post.status === 'published' && (\n              <button\n                onClick={() => { onUnpublish(); setMenuOpen(false) }}\n                className=\"w-full px-3 py-2.5 md:px-2 md:py-1.5 min-h-[44px] md:min-h-0 text-left text-sm rounded-sm hover:bg-accent cursor-default\"\n              >\n                Unpublish\n              </button>\n            )}\n            <div className=\"h-px bg-border my-1\" />\n            <button\n              onClick={() => { onDelete(); setMenuOpen(false) }}\n              className=\"w-full px-3 py-2.5 md:px-2 md:py-1.5 min-h-[44px] md:min-h-0 text-left text-sm rounded-sm text-destructive hover:bg-accent cursor-default\"\n            >\n              Delete\n            </button>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { cn } from '../../lib/cn'\n\ninterface SkeletonProps {\n  className?: string\n}\n\n/**\n * Base skeleton component with pulse animation.\n */\nexport function Skeleton({ className }: SkeletonProps) {\n  return <div className={cn('animate-pulse bg-muted rounded', className)} />\n}\n\n/**\n * Skeleton for text content with multiple lines.\n */\nexport function SkeletonText({ \n  lines = 1, \n  className \n}: { \n  lines?: number\n  className?: string \n}) {\n  return (\n    <div className={cn('space-y-2', className)}>\n      {Array.from({ length: lines }).map((_, i) => (\n        <Skeleton \n          key={i} \n          className={cn(\n            'h-4',\n            // Make last line shorter for more natural look\n            i === lines - 1 && lines > 1 ? 'w-3/4' : 'w-full'\n          )} \n        />\n      ))}\n    </div>\n  )\n}\n\n/**\n * Skeleton for toolbar buttons.\n */\nexport function SkeletonButton({ className }: SkeletonProps) {\n  return <Skeleton className={cn('h-8 w-8', className)} />\n}\n\n/**\n * Skeleton for cards/panels.\n */\nexport function SkeletonCard({ className }: SkeletonProps) {\n  return <Skeleton className={cn('h-24 w-full rounded-lg', className)} />\n}\n\n/**\n * Skeleton for table rows.\n */\nexport function SkeletonTableRow({ columns = 4 }: { columns?: number }) {\n  return (\n    <tr>\n      {Array.from({ length: columns }).map((_, i) => (\n        <td key={i} className=\"px-4 py-3\">\n          <Skeleton className=\"h-4 w-full\" />\n        </td>\n      ))}\n    </tr>\n  )\n}\n","'use client'\n\nimport { cn } from '../../lib/cn'\n\ninterface PageContainerProps {\n  children: React.ReactNode\n  className?: string\n}\n\n/**\n * Shared page container with consistent max-width and padding.\n * Used by WriterDashboard, SettingsPage, and other full-page layouts.\n */\nexport function PageContainer({ children, className }: PageContainerProps) {\n  return (\n    <div className={cn('max-w-5xl mx-auto px-6 py-8', className)}>\n      {children}\n    </div>\n  )\n}\n","const MINUTE = 60_000, HOUR = 3_600_000, DAY = 86_400_000\n\n/**\n * Format a date as relative time (e.g., \"5m ago\", \"2h ago\", \"Yesterday\")\n */\nexport function formatRelativeTime(isoDate: string): string {\n  const date = new Date(isoDate)\n  const diffMs = Date.now() - date.getTime()\n  const mins = Math.floor(diffMs / MINUTE)\n  const hours = Math.floor(diffMs / HOUR)\n  const days = Math.floor(diffMs / DAY)\n  \n  if (mins < 1) return 'Just now'\n  if (mins < 60) return `${mins}m ago`\n  if (hours < 24) return `${hours}h ago`\n  if (days === 1) return 'Yesterday'\n  if (days < 7) return `${days}d ago`\n  return date.toLocaleDateString()\n}\n\n/**\n * Format a date for display\n */\nexport function formatDate(date: Date | string, options?: Intl.DateTimeFormatOptions): string {\n  const d = typeof date === 'string' ? new Date(date) : date\n  \n  const defaultOptions: Intl.DateTimeFormatOptions = {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  }\n  \n  return d.toLocaleDateString('en-US', options || defaultOptions)\n}\n\n/**\n * Format saved time for display (e.g., \"just now\", \"5m ago\", \"2:30 PM\")\n */\nexport function formatSavedTime(date: Date): string {\n  const now = new Date()\n  const diffMs = now.getTime() - date.getTime()\n  const diffSecs = Math.floor(diffMs / 1000)\n  const diffMins = Math.floor(diffMs / MINUTE)\n  \n  // Show relative time for recent saves\n  if (diffSecs < 10) return 'just now'\n  if (diffSecs < 60) return `${diffSecs}s ago`\n  if (diffMins < 60) return `${diffMins}m ago`\n  \n  // Show clock time for today\n  const isToday = date.toDateString() === now.toDateString()\n  if (isToday) {\n    return date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' })\n  }\n  \n  return date.toLocaleDateString('en-US', { \n    month: 'short', \n    day: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit',\n  })\n}\n\n/**\n * Count words in text\n */\nexport function countWords(text?: string | null): number {\n  if (!text) return 0\n  return text.split(/\\s+/).filter(Boolean).length\n}\n\n/**\n * Truncate text to a maximum length\n */\nexport function truncate(text: string, maxLength: number): string {\n  // Strip markdown formatting for description\n  const stripped = text\n    .replace(/#+\\s/g, '')\n    .replace(/\\*\\*/g, '')\n    .replace(/\\*/g, '')\n    .replace(/`/g, '')\n    .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1')\n    .replace(/\\n+/g, ' ')\n    .trim()\n  \n  if (stripped.length <= maxLength) return stripped\n  \n  return stripped.slice(0, maxLength - 3).trim() + '...'\n}\n","'use client'\n\nimport { useState, useEffect, useCallback, useRef, useMemo, lazy, Suspense } from 'react'\nimport type { Editor } from '@tiptap/react'\nimport { toast } from 'sonner'\nimport { useDashboardContext, type EditCommand } from '../context'\nimport { EditorToolbar } from '../components/EditorToolbar'\nimport type { SelectionState } from '../components/TiptapEditor'\nimport { CommentsPanel } from '../components/CommentsPanel'\n\n// Lazy load TiptapEditor (heavy Tiptap dependencies)\nconst TiptapEditor = lazy(() => \n  import('../components/TiptapEditor').then(m => ({ default: m.TiptapEditor }))\n)\nimport { TagsSection } from '../components/TagsSection'\nimport { useComments } from '../hooks/useComments'\nimport { useChatContextOptional } from '../hooks/useChat'\nimport { formatSavedTime, countWords } from '../../lib/format'\nimport { Skeleton } from '../components/Skeleton'\n\ninterface Tag {\n  id: string\n  name: string\n}\n\ninterface Post {\n  id?: string\n  title: string\n  subtitle: string\n  slug: string\n  markdown: string\n  status: 'draft' | 'published'\n  tags?: Tag[]\n  [key: string]: unknown\n}\n\ninterface Revision {\n  id: string\n  createdAt: string\n  title: string | null\n  subtitle: string | null\n  markdown: string\n  polyhedraShape?: string | null\n}\n\n// Content skeleton matching the editor layout\nfunction ContentSkeleton({ styles }: { styles: { container: string } }) {\n  return (\n    <div className={`${styles.container} pt-12 pb-24 mx-auto`}>\n      <div className=\"space-y-2 mb-8\">\n        <Skeleton className=\"h-8 w-4/5\" />\n        <Skeleton className=\"h-5 w-3/5\" />\n        <div className=\"!mt-4\">\n          <Skeleton className=\"h-3 w-24\" />\n        </div>\n      </div>\n      <div className=\"space-y-3\">\n        <Skeleton className=\"h-4 w-full\" />\n        <Skeleton className=\"h-4 w-full\" />\n        <Skeleton className=\"h-4 w-3/4\" />\n        <Skeleton className=\"h-4 w-full\" />\n        <Skeleton className=\"h-4 w-5/6\" />\n      </div>\n    </div>\n  )\n}\n\n// Auto-resizing textarea for title/subtitle\nfunction AutoResizeTextarea({\n  value,\n  onChange,\n  placeholder,\n  disabled,\n  className,\n}: {\n  value: string | null\n  onChange: (value: string) => void\n  placeholder?: string\n  disabled?: boolean\n  className?: string\n}) {\n  const ref = useRef<HTMLTextAreaElement>(null)\n\n  useEffect(() => {\n    if (ref.current) {\n      ref.current.style.height = 'auto'\n      ref.current.style.height = `${ref.current.scrollHeight}px`\n    }\n  }, [value])\n\n  return (\n    <textarea\n      ref={ref}\n      value={value ?? ''}\n      onChange={(e) => onChange(e.target.value)}\n      placeholder={placeholder}\n      disabled={disabled}\n      rows={1}\n      onKeyDown={(e) => { if (e.key === 'Enter') e.preventDefault() }}\n      className={`resize-none overflow-hidden ${className || ''}`}\n    />\n  )\n}\n\ninterface EditorPageProps {\n  slug?: string\n  onEditorStateChange?: (state: import('../context').EditorState | null) => void\n}\n\nexport function EditorPage({ slug, onEditorStateChange: onEditorStateChangeProp }: EditorPageProps) {\n  const { apiBasePath, styles, fields, navigate, basePath, onRegisterEditHandler, sharedData, updateSharedPost } = useDashboardContext()\n  const postUrlPattern = sharedData?.settings?.postUrlPattern ?? '/e/{slug}'\n  // Extract prefix from pattern (everything before {slug})\n  const urlPrefix = postUrlPattern.split('{slug}')[0]\n  const chatContext = useChatContextOptional()\n  // Extract stable references to avoid infinite loops in useEffects\n  const chatAddMessage = chatContext?.addMessage\n  const chatSelectedModel = chatContext?.selectedModel\n  // Use prop callback (passed from DashboardLayout for internal save button)\n  const onEditorStateChange = onEditorStateChangeProp\n  const [post, setPost] = useState<Post>({\n    title: '',\n    subtitle: '',\n    slug: '',\n    markdown: '',\n    status: 'draft',\n    tags: [],\n  })\n  const [loading, setLoading] = useState(!!slug)\n  const [saving, setSaving] = useState(false)\n  const [savingAs, setSavingAs] = useState<'draft' | 'published' | null>(null)\n  const [lastSaved, setLastSaved] = useState<Date | null>(null)\n  const [generating, setGenerating] = useState(false)\n  const abortControllerRef = useRef<AbortController | null>(null)\n  const savedContent = useRef<string>('')\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const hasTriggeredGeneration = useRef(false)\n  \n  // Rich text vs markdown mode\n  const [showMarkdown, setShowMarkdown] = useState(false)\n  const [editor, setEditor] = useState<Editor | null>(null)\n\n  // Auto-resize markdown textarea to fit content\n  useEffect(() => {\n    if (showMarkdown && textareaRef.current) {\n      textareaRef.current.style.height = 'auto'\n      // Use at least the viewport height minus header/footer space\n      const minHeight = Math.max(400, window.innerHeight - 300)\n      textareaRef.current.style.height = `${Math.max(minHeight, textareaRef.current.scrollHeight)}px`\n    }\n  }, [showMarkdown, post.markdown])\n\n  // Revision state\n  const [revisions, setRevisions] = useState<Revision[]>([])\n  const [revisionsLoading, setRevisionsLoading] = useState(false)\n  const [previewingRevision, setPreviewingRevision] = useState<Revision | null>(null)\n  const [originalPost, setOriginalPost] = useState<Post | null>(null)\n  \n  // Track original slug for redirect warning (when editing slug of previously-published post)\n  const [originalSlug, setOriginalSlug] = useState<string | null>(null)\n  const [wasPublished, setWasPublished] = useState(false)\n\n  // Helper to stringify with sorted keys (JSON.stringify is key-order sensitive)\n  const stableStringify = useCallback((obj: Record<string, unknown>) => \n    JSON.stringify(obj, Object.keys(obj).sort()), [])\n  \n  // Compute hasUnsavedChanges directly instead of using state + effect (avoids timing issues)\n  const hasUnsavedChanges = useMemo(() => {\n    // While previewing a revision, no unsaved changes\n    if (previewingRevision) return false\n    \n    const { id: _id, slug: _slug, status: _status, createdAt: _ca, updatedAt: _ua, publishedAt: _pa, tags: _tags, ...contentFields } = post\n    const current = stableStringify(contentFields)\n    \n    // For new posts (savedContent is empty), any content is unsaved\n    if (savedContent.current === '') {\n      return current !== \"{}\"\n    }\n    // For existing posts, compare against saved content\n    return current !== savedContent.current\n  }, [post, previewingRevision, stableStringify])\n\n  // Comments state\n  const [commentsOpen, setCommentsOpen] = useState(false)\n  \n  // Get session info from context (if provided)\n  const { session } = useDashboardContext()\n  const currentUserEmail = session?.user?.email || ''\n  const isAdmin = session?.user?.role === 'admin'\n\n  // Define savePost and handlePublish early (before hooks that depend on them)\n  const savePost = useCallback(async (silent = false) => {\n    // Confirm before updating published posts (unless silent auto-save)\n    if (!silent && post.status === 'published') {\n      if (!confirm('Update the published post?')) return\n    }\n    \n    if (!silent) {\n      setSaving(true)\n      setSavingAs('draft')\n    }\n    try {\n      const method = post.id ? 'PATCH' : 'POST'\n      const url = post.id ? `${apiBasePath}/posts/${post.id}` : `${apiBasePath}/posts`\n      \n      const res = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title: post.title || 'Untitled Draft',\n          subtitle: post.subtitle || null,\n          slug: post.slug || undefined,\n          markdown: post.markdown,\n          status: post.status,\n          tagIds: post.tags?.map(t => t.id),\n          ...Object.fromEntries(fields.map(f => [f.name, post[f.name]]))\n        }),\n      })\n      \n      const data = await res.json()\n      if (data.data) {\n        // Merge API response into existing post\n        setPost(prev => ({ ...prev, ...data.data }))\n        // Track all content fields for unsaved changes detection (merge current post with API response)\n        const mergedPost = { ...post, ...data.data }\n        const { id: _id, slug: _slug, status: _status, createdAt: _ca, updatedAt: _ua, publishedAt: _pa, tags: _tags, ...contentFields } = mergedPost\n        savedContent.current = stableStringify(contentFields)\n        setLastSaved(new Date())\n        // hasUnsavedChanges is now computed via useMemo, no need to set it\n        // Update shared data so dashboard shows the new/updated post\n        updateSharedPost(data.data)\n        if (!post.id && data.data.slug) {\n          // Replace history so back button goes to dashboard, not blank editor\n          navigate(`/editor/${data.data.slug}`, { skipConfirmation: true, replace: true })\n        }\n      }\n    } catch (err) {\n      console.error('Save failed:', err)\n      if (!silent) {\n        toast.error('Failed to save post')\n      }\n      throw err\n    } finally {\n      if (!silent) {\n        setSaving(false)\n        setSavingAs(null)\n      }\n    }\n  }, [post.id, post.title, post.subtitle, post.slug, post.markdown, post.status, post.tags, apiBasePath, fields, navigate, updateSharedPost])\n\n  const handlePublish = useCallback(async () => {\n    if (!confirm('Publish this essay?')) return\n    setSaving(true)\n    setSavingAs('published')\n    try {\n      const method = post.id ? 'PATCH' : 'POST'\n      const url = post.id ? `${apiBasePath}/posts/${post.id}` : `${apiBasePath}/posts`\n\n      const res = await fetch(url, {\n        method,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          title: post.title || 'Untitled',\n          subtitle: post.subtitle || null,\n          slug: post.slug || undefined, // API auto-generates from title if empty\n          markdown: post.markdown,\n          status: 'published',\n          tagIds: post.tags?.map(t => t.id),\n          ...Object.fromEntries(fields.map(f => [f.name, post[f.name]]))\n        }),\n      })\n\n      if (res.ok) {\n        const data = await res.json()\n        if (data.data) {\n          // Update local state with new post data (including generated slug and id)\n          setPost(prev => ({ ...prev, ...data.data }))\n          updateSharedPost(data.data)\n          // Track saved content to clear unsaved changes state\n          const { id: _id, slug: _slug, status: _status, createdAt: _ca, updatedAt: _ua, publishedAt: _pa, tags: _tags, ...contentFields } = { ...post, ...data.data }\n          savedContent.current = stableStringify(contentFields)\n        }\n        toast.success('Post published successfully!')\n        navigate('/', { skipConfirmation: true })\n      } else {\n        toast.error('Failed to publish post')\n      }\n    } catch (err) {\n      console.error('Publish failed:', err)\n      toast.error('Failed to publish post')\n    } finally {\n      setSaving(false)\n      setSavingAs(null)\n    }\n  }, [post, apiBasePath, fields, navigate, updateSharedPost, stableStringify])\n\n  // Comments hook - handles all comment logic\n  const comments = useComments({\n    postId: post.id || null,\n    editor,\n    apiBasePath,\n    onSave: async () => {\n      // Auto-save the post and return the new post ID\n      await savePost(true)\n      return post.id || null\n    },\n  })\n\n  // URL params for AI generation\n  const [urlParams, setUrlParams] = useState<{\n    idea?: string\n    model?: string\n    length?: string\n    web?: string\n    thinking?: string\n    comment?: string\n    fromPlan?: string\n  }>({})\n\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      const params = new URLSearchParams(window.location.search)\n      setUrlParams({\n        idea: params.get('idea') || undefined,\n        model: params.get('model') || undefined,\n        length: params.get('length') || undefined,\n        web: params.get('web') || undefined,\n        thinking: params.get('thinking') || undefined,\n        comment: params.get('comment') || undefined,\n        fromPlan: params.get('fromPlan') || undefined,\n      })\n    }\n  }, [])\n\n  // Handle comment URL param - open panel and scroll to comment\n  useEffect(() => {\n    if (urlParams.comment && !comments.loading && comments.list.length > 0) {\n      // Open the comments panel\n      setCommentsOpen(true)\n      // Set active comment and scroll to it\n      comments.setActiveId(urlParams.comment)\n      // Small delay to ensure panel is open before scrolling\n      setTimeout(() => {\n        comments.scrollTo(urlParams.comment!)\n      }, 100)\n    }\n  }, [urlParams.comment, comments.loading, comments.list.length])\n\n  // Load post if editing existing\n  useEffect(() => {\n    if (slug) {\n      fetch(`${apiBasePath}/posts`)\n        .then(r => r.json())\n        .then(d => {\n          const found = d.data?.find((p: Post) => p.slug === slug)\n          if (found) {\n            setPost(found)\n            // Track all content fields for unsaved changes detection (excludes metadata like id, dates, status)\n            const { id: _id, slug: _slug, status: _status, createdAt: _ca, updatedAt: _ua, publishedAt: _pa, tags: _tags, ...contentFields } = found\n            savedContent.current = stableStringify(contentFields)\n            // Initialize lastSaved from post's updatedAt so it shows \"Saved X ago\" not \"Not saved yet\"\n            if (found.updatedAt) {\n              setLastSaved(new Date(found.updatedAt))\n            }\n            // Track original slug and publication status for redirect warning\n            setOriginalSlug(found.slug)\n            setWasPublished(!!found.publishedAt)\n          }\n          setLoading(false)\n        })\n        .catch(() => setLoading(false))\n    }\n  }, [slug, apiBasePath])\n\n  // hasUnsavedChanges is now computed via useMemo (see above), no effect needed\n\n  // Report editor state to parent app (for navbar save button etc.)\n  // Use refs for callbacks to avoid triggering effect re-runs\n  const savePostRef = useRef(savePost)\n  const handlePublishRef = useRef(handlePublish)\n  const onEditorStateChangeRef = useRef(onEditorStateChange)\n  useEffect(() => { savePostRef.current = savePost }, [savePost])\n  useEffect(() => { handlePublishRef.current = handlePublish }, [handlePublish])\n  useEffect(() => { onEditorStateChangeRef.current = onEditorStateChange }, [onEditorStateChange])\n  \n  useEffect(() => {\n    if (!onEditorStateChangeRef.current) return\n\n    const confirmLeave = () => {\n      if (hasUnsavedChanges) {\n        return confirm('You have unsaved changes. Leave anyway?')\n      }\n      return true\n    }\n\n    onEditorStateChangeRef.current({\n      hasUnsavedChanges,\n      status: post.status,\n      savingAs,\n      onSave: (status) => {\n        if (status === 'draft') {\n          savePostRef.current()\n        } else {\n          handlePublishRef.current()\n        }\n      },\n      confirmLeave,\n      // Include content for chat integration\n      content: {\n        title: post.title,\n        subtitle: post.subtitle,\n        markdown: post.markdown,\n      },\n    })\n\n    return () => {\n      onEditorStateChangeRef.current?.(null)\n    }\n  }, [hasUnsavedChanges, post.status, savingAs, post.title, post.subtitle, post.markdown])\n\n  // Create edit handler for AI agent mode\n  const handleEdit = useCallback((edit: EditCommand): boolean => {\n    if (edit.type === 'replace_all') {\n      setPost(prev => ({\n        ...prev,\n        title: edit.title ?? prev.title,\n        subtitle: edit.subtitle ?? prev.subtitle,\n        markdown: edit.markdown ?? prev.markdown,\n      }))\n      return true\n    }\n\n    if (edit.type === 'replace_section' && edit.find && edit.replace !== undefined) {\n      // Use functional update to get current post state\n      let found = false\n      setPost(prev => {\n        if (prev.markdown.includes(edit.find!)) {\n          found = true\n          return { ...prev, markdown: prev.markdown.replace(edit.find!, edit.replace!) }\n        }\n        return prev\n      })\n      return found\n    }\n\n    if (edit.type === 'insert' && edit.replace !== undefined) {\n      if (edit.position === 'start') {\n        setPost(prev => ({ ...prev, markdown: edit.replace + prev.markdown }))\n        return true\n      }\n      if (edit.position === 'end') {\n        setPost(prev => ({ ...prev, markdown: prev.markdown + edit.replace }))\n        return true\n      }\n      if (edit.find) {\n        let found = false\n        setPost(prev => {\n          if (prev.markdown.includes(edit.find!)) {\n            found = true\n            const idx = prev.markdown.indexOf(edit.find!)\n            const insertPoint = edit.position === 'before' ? idx : idx + edit.find!.length\n            return {\n              ...prev,\n              markdown: prev.markdown.slice(0, insertPoint) + edit.replace + prev.markdown.slice(insertPoint),\n            }\n          }\n          return prev\n        })\n        return found\n      }\n      return false\n    }\n\n    if (edit.type === 'delete' && edit.find) {\n      let found = false\n      setPost(prev => {\n        if (prev.markdown.includes(edit.find!)) {\n          found = true\n          return { ...prev, markdown: prev.markdown.replace(edit.find!, '') }\n        }\n        return prev\n      })\n      return found\n    }\n\n    return false\n  }, [])\n\n  // Register edit handler with dashboard context (for external use)\n  useEffect(() => {\n    if (!onRegisterEditHandler) return\n    onRegisterEditHandler(handleEdit)\n    return () => { onRegisterEditHandler(null) }\n  }, [handleEdit, onRegisterEditHandler])\n\n  // Register edit handler with chat context (for AI agent mode)\n  const registerEditHandler = chatContext?.registerEditHandler\n  useEffect(() => {\n    if (!registerEditHandler) return\n    registerEditHandler(handleEdit)\n    return () => { registerEditHandler(null) }\n  }, [handleEdit, registerEditHandler])\n\n  // Expand plan into full essay - shared logic for both handler and URL param\n  const expandPlanToEssay = useCallback(async (plan: string, wordCount: number = 800) => {\n    // Don't expand if already generating or if there's content and user doesn't confirm\n    if (generating) return\n    if (post.title || post.subtitle || post.markdown) {\n      if (!confirm('This will replace your current content with a new essay. Continue?')) {\n        return\n      }\n    }\n\n    // Create abort controller for this generation\n    const abortController = new AbortController()\n    abortControllerRef.current = abortController\n\n    setGenerating(true)\n\n    try {\n      const res = await fetch(`${apiBasePath}/ai/generate`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          mode: 'expand_plan',\n          plan,\n          wordCount,\n          model: chatSelectedModel,\n        }),\n        signal: abortController.signal,\n      })\n\n      if (!res.ok) {\n        const error = await res.json().catch(() => ({ error: 'Generation failed' }))\n        console.error('Plan expansion failed:', error)\n        return\n      }\n\n      // Consume SSE stream with real-time title/subtitle parsing (same as idea generation)\n      const reader = res.body?.getReader()\n      if (!reader) return\n\n      const decoder = new TextDecoder()\n      let fullContent = ''\n      let titleExtracted = false\n      let subtitleExtracted = false\n      let bodyStartIndex = 0\n\n      while (true) {\n        const { done, value } = await reader.read()\n        if (done) break\n\n        const chunk = decoder.decode(value, { stream: true })\n        const sseLines = chunk.split('\\n')\n\n        for (const line of sseLines) {\n          if (line.startsWith('data: ')) {\n            const data = line.slice(6)\n            if (data === '[DONE]') continue\n            try {\n              const parsed = JSON.parse(data)\n              if (parsed.text) {\n                fullContent += parsed.text\n                \n                // Parse title as soon as first line is complete\n                if (!titleExtracted && fullContent.includes('\\n')) {\n                  const firstLine = fullContent.split('\\n')[0]\n                  if (firstLine.startsWith('# ')) {\n                    const title = firstLine.slice(2).trim()\n                    setPost(prev => ({ ...prev, title }))\n                    titleExtracted = true\n                    bodyStartIndex = firstLine.length + 1\n                  }\n                }\n                \n                // Parse subtitle as soon as second line is complete\n                if (titleExtracted && !subtitleExtracted) {\n                  const afterTitle = fullContent.slice(bodyStartIndex)\n                  if (afterTitle.includes('\\n')) {\n                    // Find first non-empty line (skip blank lines between title and subtitle)\n                    const lines = afterTitle.split('\\n')\n                    let lineOffset = 0\n                    let rawSubtitleLine = ''\n                    for (let i = 0; i < lines.length - 1; i++) { // -1 to ensure there's a newline after\n                      if (lines[i].trim()) {\n                        rawSubtitleLine = lines[i]\n                        break\n                      }\n                      lineOffset += lines[i].length + 1 // +1 for newline\n                    }\n                    \n                    if (rawSubtitleLine) {\n                      const subtitleLine = rawSubtitleLine.trim()\n                      const italicMatch = subtitleLine.match(/^\\*(.+)\\*$/) || subtitleLine.match(/^_(.+)_$/)\n                      if (italicMatch) {\n                        const subtitle = italicMatch[1]\n                        setPost(prev => ({ ...prev, subtitle }))\n                        subtitleExtracted = true\n                        bodyStartIndex += lineOffset + rawSubtitleLine.length + 1\n                      } else {\n                        // Non-italic line found - treat as body start\n                        subtitleExtracted = true\n                        bodyStartIndex += lineOffset // Start from this line\n                      }\n                    }\n                  }\n                }\n                \n                // Update markdown after title/subtitle are parsed\n                if (titleExtracted) {\n                  const bodyContent = fullContent.slice(bodyStartIndex).trim()\n                  setPost(prev => ({ ...prev, markdown: bodyContent }))\n                }\n              }\n            } catch {\n              // Ignore parse errors for incomplete chunks\n            }\n          }\n        }\n      }\n      \n      // Final cleanup\n      const finalBody = fullContent.slice(bodyStartIndex).trim()\n      setPost(prev => ({\n        ...prev,\n        markdown: finalBody,\n      }))\n      \n      // Add to chat history\n      if (chatAddMessage) {\n        chatContext.addMessage('assistant', ' Essay drafted from plan. You can now edit it or ask me questions about it.')\n      }\n    } catch (err) {\n      // Don't log abort errors - they're expected when user cancels\n      if (err instanceof Error && err.name === 'AbortError') {\n        // Generation was cancelled, keep whatever was generated\n        if (chatAddMessage) {\n          chatContext.addMessage('assistant', ' Generation stopped. You can continue editing what was generated.')\n        }\n      } else {\n        console.error('Plan expansion error:', err)\n      }\n    } finally {\n      setGenerating(false)\n      abortControllerRef.current = null\n    }\n  }, [generating, post.title, post.subtitle, post.markdown, apiBasePath, chatAddMessage, chatSelectedModel])\n\n  // Register expand plan handler for chat context\n  useEffect(() => {\n    if (!chatContext?.registerExpandPlanHandler) return\n\n    chatContext.registerExpandPlanHandler(expandPlanToEssay)\n\n    return () => {\n      chatContext.registerExpandPlanHandler(null)\n    }\n  }, [chatContext, expandPlanToEssay])\n\n  // Handle fromPlan URL param - load pending plan from sessionStorage and expand it\n  const hasTriggeredPlanExpansion = useRef(false)\n  useEffect(() => {\n    if (urlParams.fromPlan && !slug && !loading && !hasTriggeredPlanExpansion.current) {\n      hasTriggeredPlanExpansion.current = true\n      \n      // Get pending plan from sessionStorage\n      const pendingPlan = sessionStorage.getItem('pendingPlan')\n      if (pendingPlan) {\n        sessionStorage.removeItem('pendingPlan')\n        \n        // Clear the URL param\n        if (typeof window !== 'undefined') {\n          window.history.replaceState({}, '', `${basePath}/editor`)\n        }\n        \n        // Expand the plan\n        expandPlanToEssay(pendingPlan, 800)\n      }\n    }\n  }, [urlParams.fromPlan, slug, loading, basePath, expandPlanToEssay])\n\n  // Auto-save drafts (3s debounce)\n  // Deps include content fields to reset timer on each keystroke (debounce behavior)\n  useEffect(() => {\n    if (!post.id || post.status === 'published' || !hasUnsavedChanges || previewingRevision) return\n    const timeout = setTimeout(() => savePostRef.current(true), 3000)\n    return () => clearTimeout(timeout)\n  }, [post.id, post.status, post.title, post.subtitle, post.markdown, hasUnsavedChanges, previewingRevision])\n\n  // Warn on navigation with unsaved changes\n  useEffect(() => {\n    const handler = (e: BeforeUnloadEvent) => {\n      if (hasUnsavedChanges) {\n        e.preventDefault()\n        e.returnValue = ''\n      }\n    }\n    window.addEventListener('beforeunload', handler)\n    return () => window.removeEventListener('beforeunload', handler)\n  }, [hasUnsavedChanges])\n\n  // Keyboard shortcuts\n  useEffect(() => {\n    const handler = (e: KeyboardEvent) => {\n      // Cmd+S / Ctrl+S to save\n      if ((e.metaKey || e.ctrlKey) && e.key === 's') {\n        e.preventDefault()\n        if (!saving && !generating && !previewingRevision && hasUnsavedChanges) {\n          savePostRef.current()\n        }\n        return\n      }\n      \n      if (e.key === 'Escape') {\n        if (previewingRevision) {\n          cancelRevisionPreview()\n          e.stopImmediatePropagation()\n          return\n        }\n        // If generating, stop the generation but stay on the page\n        if (generating) {\n          if (abortControllerRef.current) {\n            abortControllerRef.current.abort()\n          }\n          e.stopImmediatePropagation()\n          return\n        }\n        if (hasUnsavedChanges && !confirm('You have unsaved changes. Leave anyway?')) return\n        navigate('/')\n      }\n    }\n    window.addEventListener('keydown', handler, true) // Use capture to run before dashboard handler\n    return () => window.removeEventListener('keydown', handler, true)\n  }, [hasUnsavedChanges, saving, generating, navigate, previewingRevision])\n\n  // Auto-generate from idea param\n  useEffect(() => {\n    if (urlParams.idea && !slug && !loading && !hasTriggeredGeneration.current) {\n      // Check if there's existing content that would be overwritten\n      if (post.title || post.subtitle || post.markdown) {\n        if (!confirm('This will replace your current content. Continue?')) {\n          hasTriggeredGeneration.current = true // Prevent re-triggering\n          // Clear the URL params\n          if (typeof window !== 'undefined') {\n            window.history.replaceState({}, '', `${basePath}/editor`)\n          }\n          return\n        }\n      }\n      \n      hasTriggeredGeneration.current = true\n      \n      // Create abort controller for this generation\n      const abortController = new AbortController()\n      abortControllerRef.current = abortController\n      \n      setGenerating(true)\n\n      // Store these values before clearing URL params\n      const generationPrompt = urlParams.idea\n      const wordCount = urlParams.length ? parseInt(urlParams.length) : 500\n\n      // Clear the URL params immediately\n      if (typeof window !== 'undefined') {\n        window.history.replaceState({}, '', `${basePath}/editor`)\n      }\n\n      const runGenerate = async () => {\n        try {\n          const res = await fetch(`${apiBasePath}/ai/generate`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              prompt: urlParams.idea,\n              wordCount,\n              model: urlParams.model,\n              useWebSearch: urlParams.web === '1',\n              useThinking: urlParams.thinking === '1',\n            }),\n            signal: abortController.signal,\n          })\n\n          if (!res.ok) {\n            const error = await res.json().catch(() => ({ error: 'Generation failed' }))\n            console.error('Generation failed:', error)\n            return\n          }\n\n          // Consume SSE stream with real-time title/subtitle parsing\n          const reader = res.body?.getReader()\n          if (!reader) return\n\n          const decoder = new TextDecoder()\n          let fullContent = ''\n          let titleExtracted = false\n          let subtitleExtracted = false\n          let bodyStartIndex = 0\n\n          while (true) {\n            const { done, value } = await reader.read()\n            if (done) break\n\n            const chunk = decoder.decode(value, { stream: true })\n            const sseLines = chunk.split('\\n')\n\n            for (const line of sseLines) {\n              if (line.startsWith('data: ')) {\n                const data = line.slice(6)\n                if (data === '[DONE]') continue\n                try {\n                  const parsed = JSON.parse(data)\n                  if (parsed.text) {\n                    fullContent += parsed.text\n                    \n                    // Parse title as soon as first line is complete\n                    if (!titleExtracted && fullContent.includes('\\n')) {\n                      const firstLine = fullContent.split('\\n')[0]\n                      if (firstLine.startsWith('# ')) {\n                        const title = firstLine.slice(2).trim()\n                        setPost(prev => ({ ...prev, title }))\n                        titleExtracted = true\n                        bodyStartIndex = firstLine.length + 1 // +1 for newline\n                      }\n                    }\n                    \n                    // Parse subtitle as soon as second line is complete\n                    if (titleExtracted && !subtitleExtracted) {\n                      const afterTitle = fullContent.slice(bodyStartIndex)\n                      if (afterTitle.includes('\\n')) {\n                        // Find first non-empty line (skip blank lines between title and subtitle)\n                        const lines = afterTitle.split('\\n')\n                        let lineOffset = 0\n                        let rawSubtitleLine = ''\n                        for (let i = 0; i < lines.length - 1; i++) { // -1 to ensure there's a newline after\n                          if (lines[i].trim()) {\n                            rawSubtitleLine = lines[i]\n                            break\n                          }\n                          lineOffset += lines[i].length + 1 // +1 for newline\n                        }\n                        \n                        if (rawSubtitleLine) {\n                          const subtitleLine = rawSubtitleLine.trim()\n                          const italicMatch = subtitleLine.match(/^\\*(.+)\\*$/) || subtitleLine.match(/^_(.+)_$/)\n                          if (italicMatch) {\n                            const subtitle = italicMatch[1]\n                            setPost(prev => ({ ...prev, subtitle }))\n                            subtitleExtracted = true\n                            bodyStartIndex += lineOffset + rawSubtitleLine.length + 1\n                          } else {\n                            // Non-italic line found - treat as body start\n                            subtitleExtracted = true\n                            bodyStartIndex += lineOffset // Start from this line\n                          }\n                        }\n                      }\n                    }\n                    \n                    // Only update markdown AFTER title/subtitle are parsed to avoid \"moving up\" effect\n                    // This ensures title goes directly to title field, not through markdown first\n                    if (titleExtracted) {\n                      const bodyContent = fullContent.slice(bodyStartIndex).trim()\n                      setPost(prev => ({ ...prev, markdown: bodyContent }))\n                    }\n                  }\n                } catch {\n                  // Ignore parse errors for incomplete chunks\n                }\n              }\n            }\n          }\n          \n          // Final cleanup - ensure body doesn't include title/subtitle\n          const finalBody = fullContent.slice(bodyStartIndex).trim()\n          setPost(prev => ({\n            ...prev,\n            markdown: finalBody,\n          }))\n          \n          // Add generation status to chat history (just a simple confirmation, not the full essay)\n          if (chatAddMessage) {\n            chatContext.addMessage('user', `Generate essay: ${generationPrompt}`)\n            chatContext.addMessage('assistant', ' Essay generated successfully. You can now edit it in the editor or ask me questions about it.')\n          }\n        } catch (err) {\n          // Don't log abort errors - they're expected when user cancels\n          if (err instanceof Error && err.name === 'AbortError') {\n            // Generation was cancelled, keep whatever was generated\n            if (chatAddMessage) {\n              chatContext.addMessage('user', `Generate essay: ${generationPrompt}`)\n              chatContext.addMessage('assistant', ' Generation stopped. You can continue editing what was generated.')\n            }\n          } else {\n            console.error('Generation error:', err)\n            // Add error message to chat if generation was interrupted\n            if (chatAddMessage) {\n              chatContext.addMessage('user', `Generate essay: ${generationPrompt}`)\n              chatContext.addMessage('assistant', ' Generation started but was interrupted. You can try again or continue editing what was generated.')\n            }\n          }\n        } finally {\n          setGenerating(false)\n          abortControllerRef.current = null\n        }\n      }\n\n      runGenerate()\n    }\n  }, [urlParams, slug, loading, apiBasePath, basePath, chatAddMessage])\n\n  // Fetch revisions\n  const fetchRevisions = useCallback(async () => {\n    if (!post.id) return\n    setRevisionsLoading(true)\n    try {\n      const res = await fetch(`${apiBasePath}/revisions?postId=${post.id}`)\n      const data = await res.json()\n      setRevisions(data.data || [])\n    } catch (err) {\n      console.error('Failed to fetch revisions:', err)\n    } finally {\n      setRevisionsLoading(false)\n    }\n  }, [post.id, apiBasePath])\n\n  // Preview a revision\n  const previewRevision = useCallback(async (revisionId: string) => {\n    const revision = revisions.find(r => r.id === revisionId)\n    if (!revision) return\n    \n    // Store original post state\n    if (!originalPost) {\n      setOriginalPost({ ...post })\n    }\n    \n    setPreviewingRevision(revision)\n    setPost(prev => ({\n      ...prev,\n      title: revision.title || prev.title,\n      subtitle: revision.subtitle || prev.subtitle,\n      markdown: revision.markdown,\n    }))\n  }, [revisions, post, originalPost])\n\n  // Cancel revision preview\n  const cancelRevisionPreview = useCallback(() => {\n    if (originalPost) {\n      setPost(originalPost)\n      setOriginalPost(null)\n    }\n    setPreviewingRevision(null)\n  }, [originalPost])\n\n  // Restore revision\n  const restoreRevision = useCallback(async () => {\n    if (!previewingRevision) return\n    setOriginalPost(null)\n    setPreviewingRevision(null)\n    // The post is already set to the revision content, just save it\n    await savePost()\n  }, [previewingRevision, savePost])\n\n  const handleUnpublish = async () => {\n    if (!confirm('Unpublish this essay?')) return\n    try {\n      const res = await fetch(`${apiBasePath}/posts/${post.id}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ status: 'draft' }),\n      })\n      if (res.ok) {\n        setPost(prev => ({ ...prev, status: 'draft' }))\n        toast.success('Post unpublished')\n      } else {\n        toast.error('Failed to unpublish post')\n      }\n    } catch (err) {\n      console.error('Unpublish failed:', err)\n      toast.error('Failed to unpublish post')\n    }\n  }\n\n  const words = countWords(post.markdown)\n  const isPublished = post.status === 'published'\n\n  // Loading skeleton\n  if (loading) {\n    return (\n      <div className=\"flex flex-col h-full\">\n        <EditorToolbar\n          textareaRef={textareaRef}\n          markdown=\"\"\n          onMarkdownChange={() => {}}\n          loading={true}\n        />\n        <main className=\"flex-1 overflow-auto pb-20 pt-[41px]\">\n          <ContentSkeleton styles={styles} />\n        </main>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      {/* Revision Preview Banner */}\n      {previewingRevision && (\n        <div className=\"bg-ab-warning/15 border-b border-ab-warning/30 px-4 py-2 flex items-center justify-between\">\n          <span className=\"text-sm text-ab-warning\">\n            Previewing revision from {new Date(previewingRevision.createdAt).toLocaleString()}\n          </span>\n          <div className=\"flex items-center gap-2\">\n            <button\n              onClick={cancelRevisionPreview}\n              className=\"px-3 py-1 text-sm border border-ab-warning/40 rounded hover:bg-ab-warning/20\"\n            >\n              Cancel\n            </button>\n            <button\n              onClick={restoreRevision}\n              className=\"px-3 py-1 text-sm bg-amber-600 text-white rounded hover:bg-amber-700\"\n            >\n              Restore\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Toolbar */}\n      {!previewingRevision && (\n        <EditorToolbar\n          editor={showMarkdown ? null : editor}\n          textareaRef={showMarkdown ? textareaRef : undefined}\n          markdown={post.markdown}\n          onMarkdownChange={(md) => setPost(prev => ({ ...prev, markdown: md }))}\n          showMarkdown={showMarkdown}\n          setShowMarkdown={setShowMarkdown}\n          aiGenerating={generating}\n          postSlug={slug}\n          revisions={post.id ? {\n            list: revisions,\n            loading: revisionsLoading,\n            previewLoading: false,\n            previewing: previewingRevision,\n            fetch: fetchRevisions,\n            preview: previewRevision,\n            cancel: cancelRevisionPreview,\n            restore: restoreRevision,\n          } : undefined}\n          apiBasePath={apiBasePath}\n          hasSelection={!!comments.selectedText && !comments.selectedText.hasExistingComment}\n          selectionHasComment={comments.selectedText?.hasExistingComment}\n          onAddComment={() => setCommentsOpen(true)}\n          commentsCount={comments.list.filter(c => !c.resolved).length}\n          onViewComments={() => setCommentsOpen(true)}\n        />\n      )}\n\n      {/* Editor Content - pt-[41px] accounts for fixed toolbar height when visible */}\n      <main className={`flex-1 overflow-auto pb-20 overscroll-contain touch-pan-y ${!previewingRevision ? 'pt-[41px]' : ''}`}>\n        <article className={`${styles.container} pt-12 pb-24 mx-auto`}>\n          {/* Header - Title & Subtitle */}\n          <header className=\"space-y-2 mb-8\">\n            {generating && !post.title ? (\n              <Skeleton className=\"h-8 w-4/5\" />\n            ) : (\n              <AutoResizeTextarea\n                value={post.title}\n                onChange={(val) => setPost(prev => ({ ...prev, title: val }))}\n                placeholder=\"Title\"\n                disabled={generating || !!previewingRevision}\n                className={`${styles.title} w-full bg-transparent border-none outline-none placeholder-ab-placeholder ${(generating || previewingRevision) ? 'opacity-60 cursor-not-allowed' : ''}`}\n              />\n            )}\n            {generating && !post.subtitle ? (\n              <Skeleton className=\"h-5 w-3/5\" />\n            ) : (\n              <AutoResizeTextarea\n                value={post.subtitle}\n                onChange={(val) => setPost(prev => ({ ...prev, subtitle: val }))}\n                placeholder=\"Subtitle\"\n                disabled={generating || !!previewingRevision}\n                className={`${styles.subtitle} w-full bg-transparent border-none outline-none placeholder-ab-placeholder ${(generating || previewingRevision) ? 'opacity-60 cursor-not-allowed' : ''}`}\n              />\n            )}\n            <div className=\"!mt-4\">\n              <span className={`${styles.byline} underline ${generating ? 'opacity-60' : ''}`}>\n                {session?.user?.name || session?.user?.email || 'Author'}\n              </span>\n            </div>\n          </header>\n\n          {/* Body */}\n          <div className=\"mt-8\">\n            {generating && !post.markdown ? (\n              <div className=\"space-y-3\">\n                <Skeleton className=\"h-4 w-full\" />\n                <Skeleton className=\"h-4 w-full\" />\n                <Skeleton className=\"h-4 w-3/4\" />\n                <Skeleton className=\"h-4 w-full\" />\n                <Skeleton className=\"h-4 w-5/6\" />\n              </div>\n            ) : showMarkdown ? (\n              <textarea\n                ref={textareaRef}\n                value={post.markdown}\n                onChange={e => setPost(prev => ({ ...prev, markdown: e.target.value }))}\n                placeholder=\"Start writing...\"\n                disabled={generating || !!previewingRevision}\n                className={`${styles.prose} w-full bg-transparent border-none outline-none resize-none overflow-hidden placeholder-muted-foreground leading-relaxed font-mono text-sm ${(generating || previewingRevision) ? 'opacity-60 cursor-not-allowed' : ''}`}\n              />\n            ) : (\n              <Suspense fallback={\n                <div className=\"space-y-3\">\n                  <Skeleton className=\"h-4 w-full\" />\n                  <Skeleton className=\"h-4 w-full\" />\n                  <Skeleton className=\"h-4 w-3/4\" />\n                </div>\n              }>\n                <TiptapEditor\n                  content={post.markdown}\n                  onChange={(md) => setPost(prev => ({ ...prev, markdown: md }))}\n                  onEditorReady={setEditor}\n                  autoFocus={!slug}\n                  proseClasses={styles.prose}\n                  onSelectionChange={(sel: SelectionState | null) => {\n                    if (sel?.hasSelection) {\n                      comments.setSelectedText({\n                        text: sel.text,\n                        from: sel.from,\n                        to: sel.to,\n                        hasExistingComment: sel.hasExistingComment,\n                      })\n                    } else {\n                      comments.setSelectedText(null)\n                    }\n                  }}\n                  onCommentClick={(commentId: string) => {\n                    comments.setActiveId(commentId)\n                    setCommentsOpen(true)\n                  }}\n                />\n              </Suspense>\n            )}\n          </div>\n\n          {/* Footer Metadata */}\n          {!previewingRevision && (\n            <div className=\"mt-12 pt-8 border-t border-border space-y-4\">\n              {/* URL */}\n              <div className=\"flex items-center justify-between text-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-muted-foreground w-14\">URL</span>\n                  <span className=\"text-muted-foreground/70\">{urlPrefix}</span>\n                  {isPublished ? (\n                    <span className=\"flex items-center gap-1.5 text-ab-neutral-strong\">\n                      {post.slug}\n                      <svg className=\"w-3 h-3 text-muted-foreground/70\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z\" />\n                      </svg>\n                    </span>\n                  ) : (\n                    <input\n                      type=\"text\"\n                      value={post.slug}\n                      onChange={(e) => setPost(prev => ({ ...prev, slug: e.target.value }))}\n                      placeholder=\"post-slug\"\n                      className=\"flex-1 bg-transparent border-none outline-none placeholder-muted-foreground text-ab-neutral-strong\"\n                    />\n                  )}\n                </div>\n              </div>\n              \n              {/* Slug change warning for previously-published posts */}\n              {wasPublished && originalSlug && post.slug !== originalSlug && !isPublished && (\n                <div className=\"flex items-start gap-2 p-3 rounded-md bg-ab-warning/10 border border-ab-warning/30 text-sm\">\n                  <svg className=\"w-4 h-4 text-ab-warning mt-0.5 flex-shrink-0\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                  </svg>\n                  <div className=\"text-ab-warning\">\n                    <span className=\"font-medium\">URL change detected.</span>\n                    {' '}Existing links to <code className=\"px-1 py-0.5 bg-ab-warning/20 rounded text-xs\">{urlPrefix}{originalSlug}</code> will automatically redirect to the new URL when you publish.\n                  </div>\n                </div>\n              )}\n\n              {/* Custom Fields (footer position) */}\n              {fields.filter(f => f.position === 'footer').map(field => {\n                const handleFieldChange = (name: string, value: unknown) => {\n                  setPost(prev => ({ ...prev, [name]: value }))\n                }\n                \n                // If no label, render component full-width (for section-style fields like SEO)\n                if (!field.label) {\n                  return (\n                    <div key={field.name} className=\"text-sm\">\n                      <field.component\n                        value={post[field.name] as any}\n                        onChange={(val: unknown) => setPost(prev => ({ ...prev, [field.name]: val }))}\n                        onFieldChange={handleFieldChange}\n                        post={post as any}\n                        disabled={saving || generating}\n                      />\n                    </div>\n                  )\n                }\n                \n                // With label, render inline row style\n                return (\n                  <div key={field.name} className=\"flex items-center justify-between text-sm gap-2\">\n                    <div className=\"flex items-center gap-2 flex-1\">\n                      <span className=\"text-muted-foreground w-14 flex-shrink-0\">{field.label}</span>\n                      <div className=\"flex-1\">\n                        <field.component\n                          value={post[field.name] as any}\n                          onChange={(val: unknown) => setPost(prev => ({ ...prev, [field.name]: val }))}\n                          onFieldChange={handleFieldChange}\n                          post={post as any}\n                          disabled={saving || generating}\n                        />\n                      </div>\n                    </div>\n                  </div>\n                )\n              })}\n\n              {/* Tags */}\n              <TagsSection\n                tags={post.tags || []}\n                onTagsChange={(tags) => setPost(prev => ({ ...prev, tags }))}\n                apiBasePath={apiBasePath}\n                disabled={saving || generating}\n              />\n\n              {/* Status */}\n              <div className=\"flex items-center justify-between text-sm\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-muted-foreground\">Status</span>\n                  <span className={isPublished ? \"text-xs text-ab-success-muted\" : \"text-xs text-muted-foreground/70\"}>\n                    {isPublished ? 'Published' : 'Draft'}\n                  </span>\n                </div>\n                \n                {/* Publish/Unpublish/Update button */}\n                {isPublished ? (\n                  hasUnsavedChanges ? (\n                    <button\n                      onClick={() => savePost()}\n                      disabled={saving || generating}\n                      className=\"px-3 py-1.5 text-sm bg-primary text-primary-foreground rounded-md hover:opacity-90 disabled:opacity-50 flex items-center gap-1\"\n                    >\n                      {savingAs && (\n                        <svg className=\"w-3 h-3 animate-spin\" viewBox=\"0 0 24 24\">\n                          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\" />\n                          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n                        </svg>\n                      )}\n                      Update\n                    </button>\n                  ) : (\n                    <button\n                      onClick={handleUnpublish}\n                      className=\"px-3 py-1.5 text-sm rounded-md border border-border text-muted-foreground hover:text-destructive hover:border-destructive/50 hover:bg-destructive/10 transition-colors\"\n                    >\n                      Unpublish\n                    </button>\n                  )\n                ) : (\n                  <button\n                    onClick={handlePublish}\n                    disabled={saving || generating}\n                    className=\"px-3 py-1.5 text-sm bg-primary text-primary-foreground rounded-md hover:opacity-90 disabled:opacity-50 flex items-center gap-1\"\n                  >\n                    {savingAs === 'published' && (\n                      <svg className=\"w-3 h-3 animate-spin\" viewBox=\"0 0 24 24\">\n                        <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" fill=\"none\" />\n                        <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\" />\n                      </svg>\n                    )}\n                    Publish\n                  </button>\n                )}\n              </div>\n\n              {/* Word count */}\n              <div className=\"text-sm text-muted-foreground pt-2 border-t border-border\">\n                {words.toLocaleString()} words  ~{Math.ceil(words / 200)} min read\n              </div>\n            </div>\n          )}\n        </article>\n      </main>\n\n      {/* Footer */}\n      <footer className=\"fixed bottom-0 left-0 right-0 border-t border-border px-4 py-3 bg-background touch-none\" style={{ paddingBottom: 'max(0.75rem, env(safe-area-inset-bottom))' }}>\n        <div className=\"flex items-center justify-end text-sm text-muted-foreground\">\n          {generating ? (\n            <button className=\"hover:text-foreground transition-colors\">\n              Press Esc to stop generating\n            </button>\n          ) : previewingRevision ? (\n            <button \n              onClick={cancelRevisionPreview}\n              className=\"hover:text-foreground transition-colors\"\n            >\n              Press Esc to cancel\n            </button>\n          ) : isPublished && post.publishedAt ? (\n            <span>Published {formatSavedTime(new Date(post.publishedAt as string))}</span>\n          ) : lastSaved ? (\n            <span>Saved {formatSavedTime(lastSaved)}</span>\n          ) : (\n            <span>Not saved yet</span>\n          )}\n        </div>\n      </footer>\n\n      {/* Comments Panel */}\n      {currentUserEmail && (\n        <CommentsPanel\n          comments={comments.list}\n          currentUserEmail={currentUserEmail}\n          isAdmin={isAdmin}\n          selectedText={comments.selectedText?.text ?? null}\n          onCreateComment={comments.create}\n          onReply={comments.reply}\n          onEdit={comments.edit}\n          onDelete={comments.remove}\n          onResolve={comments.resolve}\n          onCommentClick={comments.scrollTo}\n          activeCommentId={comments.activeId}\n          isOpen={commentsOpen}\n          onClose={() => setCommentsOpen(false)}\n          onClearSelection={() => comments.setSelectedText(null)}\n        />\n      )}\n    </div>\n  )\n}\n","'use client'\n\nimport type { RefObject } from 'react'\nimport type { Editor } from '@tiptap/react'\nimport { MessageSquarePlus, MessageSquare } from 'lucide-react'\nimport { ToolbarButton, Divider, SkeletonButton } from './toolbar/ToolbarButton'\nimport { FormatButtons } from './toolbar/FormatButtons'\nimport { BlockButtons } from './toolbar/BlockButtons'\nimport { MediaButtons } from './toolbar/MediaButtons'\nimport { HistoryButtons } from './toolbar/HistoryButtons'\nimport type { RevisionState } from '../../lib/editor-types'\n\ninterface EditorToolbarProps {\n  editor?: Editor | null\n  // For markdown mode\n  textareaRef?: RefObject<HTMLTextAreaElement | null>\n  markdown?: string\n  onMarkdownChange?: (markdown: string) => void\n  // Mode toggle\n  showMarkdown?: boolean\n  setShowMarkdown?: (show: boolean) => void\n  // Revision history\n  postSlug?: string\n  revisions?: RevisionState\n  // AI generation state (disables all toolbar buttons during generation)\n  aiGenerating?: boolean\n  // Comments\n  hasSelection?: boolean\n  selectionHasComment?: boolean\n  onAddComment?: () => void\n  commentsCount?: number\n  onViewComments?: () => void\n  // Loading state\n  loading?: boolean\n  // API base path\n  apiBasePath?: string\n}\n\nexport function EditorToolbar({\n  editor,\n  textareaRef,\n  markdown,\n  onMarkdownChange,\n  showMarkdown,\n  setShowMarkdown,\n  postSlug,\n  revisions,\n  aiGenerating,\n  hasSelection,\n  selectionHasComment,\n  onAddComment,\n  commentsCount,\n  onViewComments,\n  loading = false,\n  apiBasePath = '/api/cms',\n}: EditorToolbarProps) {\n  // Navbar height: py-4 (2rem) + h-10 mobile / h-9 desktop + border (1px)\n  // Mobile: 2rem + 2.5rem + 1px = 4.5rem + 1px, Desktop: 2rem + 2.25rem + 1px = 4.25rem + 1px\n  // Use rem for position so it scales with html font-size (for global-scale support)\n  // Use -2px overlap to prevent subpixel gap between navbar border and toolbar\n  if (loading) {\n    return (\n      <div className=\"fixed top-[4.125rem] left-0 right-0 z-40 flex items-center justify-start lg:justify-center gap-0.5 px-4 pt-4 pb-2 border-b border-border bg-background overflow-x-auto\">\n        <FormatButtons loading={true} />\n        <Divider />\n        <BlockButtons loading={true} />\n        <Divider />\n        <MediaButtons loading={true} />\n        <Divider />\n        <HistoryButtons loading={true} />\n        {/* Comment buttons skeleton */}\n        <Divider />\n        <SkeletonButton />\n        <SkeletonButton />\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"fixed top-[4.125rem] left-0 right-0 z-40 flex items-center justify-start lg:justify-center gap-0.5 px-4 pt-4 pb-2 border-b border-border bg-background overflow-x-auto\">\n      <FormatButtons\n        editor={editor}\n        textareaRef={textareaRef}\n        markdown={markdown}\n        onMarkdownChange={onMarkdownChange}\n        aiGenerating={aiGenerating}\n        apiBasePath={apiBasePath}\n      />\n\n      <Divider />\n\n      <BlockButtons\n        editor={editor}\n        textareaRef={textareaRef}\n        markdown={markdown}\n        onMarkdownChange={onMarkdownChange}\n        aiGenerating={aiGenerating}\n      />\n\n      <Divider />\n\n      <MediaButtons\n        editor={editor}\n        textareaRef={textareaRef}\n        markdown={markdown}\n        onMarkdownChange={onMarkdownChange}\n        aiGenerating={aiGenerating}\n        apiBasePath={apiBasePath}\n      />\n\n      <Divider />\n\n      <HistoryButtons\n        editor={editor}\n        textareaRef={textareaRef}\n        showMarkdown={showMarkdown}\n        setShowMarkdown={setShowMarkdown}\n        postSlug={postSlug}\n        revisions={revisions}\n        aiGenerating={aiGenerating}\n      />\n\n      {/* Comments - always visible */}\n      <Divider />\n      <ToolbarButton\n        onClick={onAddComment ?? (() => {})}\n        disabled={aiGenerating || !hasSelection || !onAddComment}\n        title={\n          hasSelection \n            ? 'New comment (M)' \n            : selectionHasComment \n              ? 'Text already has a comment' \n              : 'Select text to comment'\n        }\n      >\n        <MessageSquarePlus className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={onViewComments ?? (() => {})}\n        disabled={aiGenerating || !onViewComments}\n        title=\"View all comments\"\n      >\n        <span className=\"flex items-center gap-1\">\n          <MessageSquare className=\"w-5 h-5\" />\n          {commentsCount !== undefined && commentsCount > 0 && (\n            <span className=\"text-xs tabular-nums\">{commentsCount}</span>\n          )}\n        </span>\n      </ToolbarButton>\n    </div>\n  )\n}\n","'use client'\n\nimport { cn } from '../../../lib/cn'\nimport { Skeleton } from '../Skeleton'\n\n/** Shared toolbar button styles - use this for any toolbar button */\nexport const toolbarButtonStyles = {\n  base: 'px-3 py-2 text-sm font-medium rounded transition-colors shrink-0 flex items-center justify-center',\n  interactive: 'active:bg-accent md:hover:bg-accent',\n  disabled: 'disabled:opacity-50 disabled:cursor-not-allowed',\n  active: 'bg-accent text-accent-foreground',\n  inactive: 'text-muted-foreground',\n  /** Icon size for toolbar icons */\n  iconSize: 'w-5 h-5',\n}\n\n/** Get complete toolbar button className */\nexport function getToolbarButtonClass(active?: boolean, disabled?: boolean) {\n  return cn(\n    toolbarButtonStyles.base,\n    toolbarButtonStyles.interactive,\n    toolbarButtonStyles.disabled,\n    active && toolbarButtonStyles.active,\n    !active && toolbarButtonStyles.inactive\n  )\n}\n\ninterface ToolbarButtonProps {\n  onClick: () => void\n  active?: boolean\n  disabled?: boolean\n  children: React.ReactNode\n  title?: string\n}\n\nexport function ToolbarButton({ onClick, active, disabled, children, title }: ToolbarButtonProps) {\n  return (\n    <button\n      type=\"button\"\n      onClick={onClick}\n      disabled={disabled}\n      title={title}\n      tabIndex={-1}\n      className={getToolbarButtonClass(active, disabled)}\n    >\n      {children}\n    </button>\n  )\n}\n\nexport function Divider() {\n  return <div className=\"w-px h-7 bg-border mx-1.5 shrink-0\" />\n}\n\n/** Skeleton placeholder for a toolbar button - matches ToolbarButton dimensions */\nexport function SkeletonButton() {\n  return <Skeleton className=\"h-9 w-9 shrink-0\" />\n}\n","'use client'\n\nimport { useState, useEffect, useCallback } from 'react'\nimport type { Editor } from '@tiptap/react'\n\n// Cast editor to any for StarterKit command support\ntype AnyEditor = Editor & { chain: () => any; isActive: (name: string, attrs?: any) => boolean }\nimport type { RefObject } from 'react'\nimport { Loader2, Wand2, Heading1, Heading2, Heading3, Bold, Italic, Underline, Strikethrough } from 'lucide-react'\nimport { ToolbarButton, Divider, SkeletonButton } from './ToolbarButton'\nimport { setHeadingAtCursor, insertAtCursor } from '../../../lib/markdown-helpers'\n\ninterface FormatButtonsProps {\n  editor?: Editor | null\n  textareaRef?: RefObject<HTMLTextAreaElement | null>\n  markdown?: string\n  onMarkdownChange?: (markdown: string) => void\n  aiGenerating?: boolean\n  loading?: boolean\n  apiBasePath?: string\n}\n\nexport function FormatButtons({ editor: editorProp, textareaRef, markdown, onMarkdownChange, aiGenerating, loading, apiBasePath = '/api/cms' }: FormatButtonsProps) {\n  // Cast editor to any to support StarterKit commands\n  const editor = editorProp as any\n  const isMarkdownMode = !editor && textareaRef && markdown !== undefined && onMarkdownChange\n  const [hasSelection, setHasSelection] = useState(false)\n  const [isRewriting, setIsRewriting] = useState(false)\n\n  // Track text selection in the editor\n  useEffect(() => {\n    if (!editor) {\n      setHasSelection(false)\n      return\n    }\n\n    const updateSelection = () => {\n      const { from, to } = editor.state.selection\n      setHasSelection(from !== to)\n    }\n\n    editor.on('selectionUpdate', updateSelection)\n    editor.on('transaction', updateSelection)\n    \n    return () => {\n      editor.off('selectionUpdate', updateSelection)\n      editor.off('transaction', updateSelection)\n    }\n  }, [editor])\n\n  // Handle rewrite selected text\n  const handleRewrite = useCallback(async () => {\n    if (!editor || isRewriting) return\n    \n    const { from, to } = editor.state.selection\n    if (from === to) return\n\n    const selectedText = editor.state.doc.textBetween(from, to, ' ')\n    if (!selectedText.trim()) return\n\n    setIsRewriting(true)\n    try {\n      const res = await fetch(`${apiBasePath}/ai/rewrite`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ text: selectedText }),\n      })\n\n      if (!res.ok) {\n        const error = await res.json()\n        throw new Error(error.error || 'Rewrite failed')\n      }\n\n      const result = await res.json()\n      \n      // Replace the selected text with the rewritten version\n      editor.chain().focus().deleteSelection().insertContent(result.text).run()\n    } catch (err) {\n      console.error('Rewrite error:', err)\n      alert(err instanceof Error ? err.message : 'Failed to rewrite text')\n    } finally {\n      setIsRewriting(false)\n    }\n  }, [editor, isRewriting, apiBasePath])\n\n  const setHeading = (level: number) => {\n    if (textareaRef?.current && markdown !== undefined && onMarkdownChange) {\n      setHeadingAtCursor(textareaRef.current, level, markdown, onMarkdownChange)\n    }\n  }\n\n  const wrapSelection = (before: string, after: string) => {\n    if (editor) return\n    if (textareaRef?.current && markdown !== undefined && onMarkdownChange) {\n      insertAtCursor(textareaRef.current, before, after, markdown, onMarkdownChange)\n    }\n  }\n\n  // Skeleton state - render placeholders matching actual button layout\n  if (loading) {\n    return (\n      <>\n        {/* H1, H2, H3 */}\n        <SkeletonButton />\n        <SkeletonButton />\n        <SkeletonButton />\n        <Divider />\n        {/* Bold, Italic, Underline, Strikethrough */}\n        <SkeletonButton />\n        <SkeletonButton />\n        <SkeletonButton />\n        <SkeletonButton />\n        {/* AI Rewrite (shown in rich text mode) */}\n        <Divider />\n        <SkeletonButton />\n      </>\n    )\n  }\n\n  return (\n    <>\n      {/* Headings */}\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleHeading({ level: 1 }).run() : setHeading(1)}\n        active={editor?.isActive('heading', { level: 1 })}\n        disabled={aiGenerating}\n        title=\"Heading 1\"\n      >\n        <Heading1 className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleHeading({ level: 2 }).run() : setHeading(2)}\n        active={editor?.isActive('heading', { level: 2 })}\n        disabled={aiGenerating}\n        title=\"Heading 2\"\n      >\n        <Heading2 className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleHeading({ level: 3 }).run() : setHeading(3)}\n        active={editor?.isActive('heading', { level: 3 })}\n        disabled={aiGenerating}\n        title=\"Heading 3\"\n      >\n        <Heading3 className=\"w-5 h-5\" />\n      </ToolbarButton>\n\n      <Divider />\n\n      {/* Text formatting */}\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleBold().run() : wrapSelection('**', '**')}\n        active={editor?.isActive('bold')}\n        disabled={aiGenerating}\n        title=\"Bold (B)\"\n      >\n        <Bold className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleItalic().run() : wrapSelection('*', '*')}\n        active={editor?.isActive('italic')}\n        disabled={aiGenerating}\n        title=\"Italic (I)\"\n      >\n        <Italic className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleUnderline?.().run() : null}\n        active={editor?.isActive('underline')}\n        disabled={aiGenerating || !!isMarkdownMode}\n        title=\"Underline (U)\"\n      >\n        <Underline className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleStrike().run() : wrapSelection('~~', '~~')}\n        active={editor?.isActive('strike')}\n        disabled={aiGenerating}\n        title=\"Strikethrough (X)\"\n      >\n        <Strikethrough className=\"w-5 h-5\" />\n      </ToolbarButton>\n\n      {/* AI Rewrite (only in rich text mode, but always visible when not in markdown mode) */}\n      {!isMarkdownMode && (\n        <>\n          <Divider />\n          <ToolbarButton\n            onClick={handleRewrite}\n            disabled={!editor || !hasSelection || isRewriting || aiGenerating}\n            title={\n              !editor \n                ? 'Editor loading...' \n                : hasSelection \n                  ? 'Rewrite selection with AI' \n                  : 'Select text to rewrite'\n            }\n          >\n            {isRewriting ? (\n              <Loader2 className=\"w-5 h-5 animate-spin\" />\n            ) : (\n              <Wand2 className=\"w-5 h-5\" />\n            )}\n          </ToolbarButton>\n        </>\n      )}\n    </>\n  )\n}\n","/**\n * Helper functions for markdown mode in the editor toolbar.\n * Handles cursor-based text manipulation in textareas.\n */\n\n/**\n * Insert text before and after the current selection in a textarea.\n * Used for inline formatting like bold (**), italic (*), code (`), etc.\n */\nexport function insertAtCursor(\n  textarea: HTMLTextAreaElement,\n  before: string,\n  after: string,\n  markdown: string,\n  onMarkdownChange: (md: string) => void\n) {\n  const start = textarea.selectionStart\n  const end = textarea.selectionEnd\n  const selected = markdown.substring(start, end)\n  const newText = markdown.substring(0, start) + before + selected + after + markdown.substring(end)\n  onMarkdownChange(newText)\n  \n  // Restore focus and selection after React re-render\n  requestAnimationFrame(() => {\n    textarea.focus()\n    const newCursorPos = start + before.length + selected.length\n    textarea.setSelectionRange(newCursorPos, newCursorPos)\n  })\n}\n\n/**\n * Insert or toggle a block prefix at the start of the current line.\n * Used for lists (- ), blockquotes (> ), etc.\n */\nexport function insertBlockAtCursor(\n  textarea: HTMLTextAreaElement,\n  prefix: string,\n  markdown: string,\n  onMarkdownChange: (md: string) => void\n) {\n  const start = textarea.selectionStart\n  const end = textarea.selectionEnd\n  \n  // Find the start of the current line\n  let lineStart = start\n  while (lineStart > 0 && markdown[lineStart - 1] !== '\\n') {\n    lineStart--\n  }\n  \n  // Get current line content\n  let lineEnd = end\n  while (lineEnd < markdown.length && markdown[lineEnd] !== '\\n') {\n    lineEnd++\n  }\n  const lineContent = markdown.substring(lineStart, lineEnd)\n  \n  // Check if already has prefix, toggle off\n  if (lineContent.startsWith(prefix)) {\n    const newText = markdown.substring(0, lineStart) + lineContent.substring(prefix.length) + markdown.substring(lineEnd)\n    onMarkdownChange(newText)\n  } else {\n    const newText = markdown.substring(0, lineStart) + prefix + lineContent + markdown.substring(lineEnd)\n    onMarkdownChange(newText)\n  }\n  \n  requestAnimationFrame(() => {\n    textarea.focus()\n  })\n}\n\n/**\n * Set or toggle a heading level on the current line.\n * Replaces any existing heading prefix with the new level.\n */\nexport function setHeadingAtCursor(\n  textarea: HTMLTextAreaElement,\n  level: number,\n  markdown: string,\n  onMarkdownChange: (md: string) => void\n) {\n  const start = textarea.selectionStart\n  const end = textarea.selectionEnd\n  \n  // Find the start of the current line\n  let lineStart = start\n  while (lineStart > 0 && markdown[lineStart - 1] !== '\\n') {\n    lineStart--\n  }\n  \n  // Get current line content\n  let lineEnd = end\n  while (lineEnd < markdown.length && markdown[lineEnd] !== '\\n') {\n    lineEnd++\n  }\n  const lineContent = markdown.substring(lineStart, lineEnd)\n  \n  // Remove any existing heading prefix\n  const withoutHeading = lineContent.replace(/^#{1,6}\\s*/, '')\n  const newPrefix = '#'.repeat(level) + ' '\n  \n  // If the line already has this exact heading level, toggle it off\n  const currentHeadingMatch = lineContent.match(/^(#{1,6})\\s/)\n  if (currentHeadingMatch && currentHeadingMatch[1].length === level) {\n    // Toggle off - remove heading\n    const newText = markdown.substring(0, lineStart) + withoutHeading + markdown.substring(lineEnd)\n    onMarkdownChange(newText)\n  } else {\n    // Set new heading level\n    const newText = markdown.substring(0, lineStart) + newPrefix + withoutHeading + markdown.substring(lineEnd)\n    onMarkdownChange(newText)\n  }\n  \n  requestAnimationFrame(() => {\n    textarea.focus()\n  })\n}\n\n/**\n * Strip common markdown syntax from selected text.\n * Removes bold, italic, strikethrough, code, and links.\n */\nexport function clearMarkdownFormatting(\n  textarea: HTMLTextAreaElement,\n  markdown: string,\n  onMarkdownChange: (md: string) => void\n) {\n  const start = textarea.selectionStart\n  const end = textarea.selectionEnd\n  \n  if (start === end) return // No selection\n  \n  const selected = markdown.substring(start, end)\n  const cleaned = selected\n    .replace(/\\*\\*(.+?)\\*\\*/g, '$1')  // bold\n    .replace(/\\*(.+?)\\*/g, '$1')      // italic\n    .replace(/~~(.+?)~~/g, '$1')      // strikethrough\n    .replace(/`(.+?)`/g, '$1')        // inline code\n    .replace(/\\[(.+?)\\]\\(.+?\\)/g, '$1') // links\n  \n  const newText = markdown.substring(0, start) + cleaned + markdown.substring(end)\n  onMarkdownChange(newText)\n  \n  requestAnimationFrame(() => {\n    textarea.focus()\n    textarea.setSelectionRange(start, start + cleaned.length)\n  })\n}\n","'use client'\n\nimport type { Editor } from '@tiptap/react'\nimport type { RefObject } from 'react'\nimport { List, ListOrdered, Quote, Code2, Minus } from 'lucide-react'\nimport { ToolbarButton, SkeletonButton } from './ToolbarButton'\nimport { insertBlockAtCursor, insertAtCursor } from '../../../lib/markdown-helpers'\n\ninterface BlockButtonsProps {\n  editor?: Editor | null\n  textareaRef?: RefObject<HTMLTextAreaElement | null>\n  markdown?: string\n  onMarkdownChange?: (markdown: string) => void\n  aiGenerating?: boolean\n  loading?: boolean\n}\n\nexport function BlockButtons({ editor: editorProp, textareaRef, markdown, onMarkdownChange, aiGenerating, loading }: BlockButtonsProps) {\n  // Cast editor to any to support StarterKit commands\n  const editor = editorProp as any\n  // Skeleton state - render placeholders matching actual button layout\n  if (loading) {\n    return (\n      <>\n        {/* Bullet list, Numbered list */}\n        <SkeletonButton />\n        <SkeletonButton />\n        {/* Blockquote, Code block, Horizontal rule */}\n        <SkeletonButton />\n        <SkeletonButton />\n        <SkeletonButton />\n      </>\n    )\n  }\n  const isMarkdownMode = !editor && textareaRef && markdown !== undefined && onMarkdownChange\n\n  const insertBlock = (prefix: string) => {\n    if (textareaRef?.current && markdown !== undefined && onMarkdownChange) {\n      insertBlockAtCursor(textareaRef.current, prefix, markdown, onMarkdownChange)\n    }\n  }\n\n  const wrapSelection = (before: string, after: string) => {\n    if (editor) return\n    if (textareaRef?.current && markdown !== undefined && onMarkdownChange) {\n      insertAtCursor(textareaRef.current, before, after, markdown, onMarkdownChange)\n    }\n  }\n\n  const handleHorizontalRule = () => {\n    if (editor) {\n      editor.chain().focus().setHorizontalRule().run()\n    } else if (isMarkdownMode && textareaRef?.current) {\n      const textarea = textareaRef.current\n      const start = textarea.selectionStart\n      const newText = markdown!.substring(0, start) + '\\n---\\n' + markdown!.substring(start)\n      onMarkdownChange!(newText)\n      requestAnimationFrame(() => textarea.focus())\n    }\n  }\n\n  return (\n    <>\n      {/* Lists */}\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleBulletList().run() : insertBlock('- ')}\n        active={editor?.isActive('bulletList')}\n        disabled={aiGenerating}\n        title=\"Bullet list\"\n      >\n        <List className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleOrderedList().run() : insertBlock('1. ')}\n        active={editor?.isActive('orderedList')}\n        disabled={aiGenerating}\n        title=\"Numbered list\"\n      >\n        <ListOrdered className=\"w-5 h-5\" />\n      </ToolbarButton>\n\n      {/* Block elements */}\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleBlockquote().run() : insertBlock('> ')}\n        active={editor?.isActive('blockquote')}\n        disabled={aiGenerating}\n        title=\"Blockquote\"\n      >\n        <Quote className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={() => editor ? editor.chain().focus().toggleCodeBlock().run() : wrapSelection('```\\n', '\\n```')}\n        active={editor?.isActive('codeBlock')}\n        disabled={aiGenerating}\n        title=\"Code block\"\n      >\n        <Code2 className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton onClick={handleHorizontalRule} disabled={aiGenerating} title=\"Horizontal rule\">\n        <Minus className=\"w-5 h-5\" />\n      </ToolbarButton>\n    </>\n  )\n}\n","'use client'\n\nimport { useRef, useCallback } from 'react'\nimport type { Editor } from '@tiptap/react'\nimport type { RefObject } from 'react'\nimport { Link2, Image, RemoveFormatting } from 'lucide-react'\nimport { ToolbarButton, SkeletonButton } from './ToolbarButton'\nimport { clearMarkdownFormatting } from '../../../lib/markdown-helpers'\n\ninterface MediaButtonsProps {\n  editor?: Editor | null\n  textareaRef?: RefObject<HTMLTextAreaElement | null>\n  markdown?: string\n  onMarkdownChange?: (markdown: string) => void\n  aiGenerating?: boolean\n  loading?: boolean\n  apiBasePath?: string\n}\n\nexport function MediaButtons({ editor: editorProp, textareaRef, markdown, onMarkdownChange, aiGenerating, loading, apiBasePath = '/api/cms' }: MediaButtonsProps) {\n  // Cast editor to any to support StarterKit commands\n  const editor = editorProp as any\n  const fileInputRef = useRef<HTMLInputElement>(null)\n  const isMarkdownMode = !editor && textareaRef && markdown !== undefined && onMarkdownChange\n\n  const handleLinkClick = useCallback(() => {\n    if (editor) {\n      if (editor.isActive('link')) {\n        editor.chain().focus().unsetLink().run()\n        return\n      }\n      const url = window.prompt('Enter URL:')\n      if (url) {\n        editor.chain().focus().extendMarkRange('link').setLink({ href: url }).run()\n      }\n    } else if (isMarkdownMode) {\n      const url = window.prompt('Enter URL:')\n      if (url && textareaRef?.current) {\n        const textarea = textareaRef.current\n        const start = textarea.selectionStart\n        const end = textarea.selectionEnd\n        const selected = markdown!.substring(start, end) || 'link text'\n        const newText = markdown!.substring(0, start) + `[${selected}](${url})` + markdown!.substring(end)\n        onMarkdownChange!(newText)\n        requestAnimationFrame(() => textarea.focus())\n      }\n    }\n  }, [editor, isMarkdownMode, textareaRef, markdown, onMarkdownChange])\n\n  const handleImageUpload = useCallback(async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    // Client-side validation\n    const maxSize = 4 * 1024 * 1024 // 4MB\n    if (file.size > maxSize) {\n      alert(`Image too large (${(file.size / 1024 / 1024).toFixed(1)}MB). Maximum size is 4MB.`)\n      e.target.value = ''\n      return\n    }\n\n    const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp']\n    if (!validTypes.includes(file.type)) {\n      alert(`Invalid file type: ${file.type}. Supported types: JPEG, PNG, GIF, WebP.`)\n      e.target.value = ''\n      return\n    }\n\n    const formData = new FormData()\n    formData.append('image', file)\n\n    try {\n      const res = await fetch(`${apiBasePath}/upload`, {\n        method: 'POST',\n        body: formData,\n      })\n      \n      const data = await res.json()\n      \n      if (!res.ok) {\n        alert(data.error || 'Failed to upload image')\n        e.target.value = ''\n        return\n      }\n\n      // Handle both { url: ... } and { data: { url: ... } } response formats\n      const url = data.url || data.data?.url\n      if (url) {\n        if (editor) {\n          editor.chain().focus().setImage({ src: url }).run()\n        } else if (isMarkdownMode && textareaRef?.current) {\n          const textarea = textareaRef.current\n          const start = textarea.selectionStart\n          const newText = markdown!.substring(0, start) + `![image](${url})` + markdown!.substring(start)\n          onMarkdownChange!(newText)\n          requestAnimationFrame(() => textarea.focus())\n        }\n      } else {\n        alert('Upload succeeded but no URL returned')\n      }\n    } catch (err) {\n      alert('Failed to upload image. Please try again.')\n      console.error('Image upload error:', err)\n    }\n\n    e.target.value = ''\n  }, [editor, isMarkdownMode, textareaRef, markdown, onMarkdownChange, apiBasePath])\n\n  const handleClearFormatting = useCallback(() => {\n    if (editor) {\n      editor.chain().focus().unsetAllMarks().clearNodes().run()\n    } else if (isMarkdownMode && textareaRef?.current && markdown && onMarkdownChange) {\n      clearMarkdownFormatting(textareaRef.current, markdown, onMarkdownChange)\n    }\n  }, [editor, isMarkdownMode, textareaRef, markdown, onMarkdownChange])\n\n  // Skeleton state - render placeholders matching actual button layout\n  if (loading) {\n    return (\n      <>\n        {/* Link, Image, Clear formatting */}\n        <SkeletonButton />\n        <SkeletonButton />\n        <SkeletonButton />\n      </>\n    )\n  }\n\n  return (\n    <>\n      <ToolbarButton\n        onClick={handleLinkClick}\n        active={editor?.isActive('link')}\n        disabled={aiGenerating}\n        title=\"Insert link\"\n      >\n        <Link2 className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton onClick={() => fileInputRef.current?.click()} disabled={aiGenerating} title=\"Insert image\">\n        <Image className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        onChange={handleImageUpload}\n        className=\"hidden\"\n      />\n      <ToolbarButton onClick={handleClearFormatting} disabled={aiGenerating} title=\"Clear formatting\">\n        <RemoveFormatting className=\"w-5 h-5\" />\n      </ToolbarButton>\n    </>\n  )\n}\n","'use client'\n\nimport { useCallback } from 'react'\nimport type { Editor } from '@tiptap/react'\nimport type { RefObject } from 'react'\nimport { Undo2, Redo2, FileCode2 } from 'lucide-react'\nimport { ToolbarButton, Divider, SkeletonButton } from './ToolbarButton'\nimport { RevisionHistoryDropdown } from '../RevisionHistoryDropdown'\nimport type { RevisionState } from '../../../lib/editor-types'\n\ninterface HistoryButtonsProps {\n  editor?: Editor | null\n  textareaRef?: RefObject<HTMLTextAreaElement | null>\n  showMarkdown?: boolean\n  setShowMarkdown?: (show: boolean) => void\n  postSlug?: string\n  revisions?: RevisionState\n  aiGenerating?: boolean\n  loading?: boolean\n}\n\nexport function HistoryButtons({\n  editor: editorProp,\n  textareaRef,\n  showMarkdown,\n  setShowMarkdown,\n  postSlug,\n  revisions,\n  aiGenerating,\n  loading,\n}: HistoryButtonsProps) {\n  // Cast editor to any to support StarterKit commands\n  const editor = editorProp as any\n  \n  const handleUndo = useCallback(() => {\n    if (editor) {\n      editor.chain().focus().undo().run()\n    } else if (textareaRef?.current) {\n      textareaRef.current.focus()\n      document.execCommand('undo')\n    }\n  }, [editor, textareaRef])\n\n  const handleRedo = useCallback(() => {\n    if (editor) {\n      editor.chain().focus().redo().run()\n    } else if (textareaRef?.current) {\n      textareaRef.current.focus()\n      document.execCommand('redo')\n    }\n  }, [editor, textareaRef])\n\n  // Skeleton state - render placeholders matching actual button layout\n  if (loading) {\n    return (\n      <>\n        {/* Undo, Redo */}\n        <SkeletonButton />\n        <SkeletonButton />\n        {/* MD toggle */}\n        <Divider />\n        <SkeletonButton />\n        {/* Revision dropdown */}\n        <Divider />\n        <SkeletonButton />\n      </>\n    )\n  }\n\n  return (\n    <>\n      {/* Undo/Redo */}\n      <ToolbarButton\n        onClick={handleUndo}\n        disabled={aiGenerating || (editor ? !editor.can().undo() : false)}\n        title=\"Undo (Z)\"\n      >\n        <Undo2 className=\"w-5 h-5\" />\n      </ToolbarButton>\n      <ToolbarButton\n        onClick={handleRedo}\n        disabled={aiGenerating || (editor ? !editor.can().redo() : false)}\n        title=\"Redo (Z)\"\n      >\n        <Redo2 className=\"w-5 h-5\" />\n      </ToolbarButton>\n\n      {/* Markdown/Rich Text mode toggle */}\n      {setShowMarkdown && (\n        <>\n          <Divider />\n          <ToolbarButton\n            onClick={() => setShowMarkdown(!showMarkdown)}\n            active={showMarkdown}\n            disabled={aiGenerating}\n            title={showMarkdown ? 'Switch to rich text editor' : 'Switch to markdown mode'}\n          >\n            <FileCode2 className=\"w-5 h-5\" />\n          </ToolbarButton>\n        </>\n      )}\n\n      {/* Revision History */}\n      {revisions && (\n        <>\n          <Divider />\n          <RevisionHistoryDropdown\n            revisions={revisions.list}\n            loading={revisions.loading}\n            previewLoading={revisions.previewLoading}\n            disabled={aiGenerating || !postSlug}\n            isPreviewMode={!!revisions.previewing}\n            onOpen={revisions.fetch}\n            onSelect={revisions.preview}\n          />\n        </>\n      )}\n    </>\n  )\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { Loader2, History } from 'lucide-react'\nimport { formatRelativeTime } from '../../lib/format'\nimport type { RevisionSummary } from '../../lib/editor-types'\nimport { Dropdown, DropdownItem, DropdownLabel } from './Dropdown'\nimport { getToolbarButtonClass, toolbarButtonStyles } from './toolbar/ToolbarButton'\n\ninterface Props {\n  revisions: RevisionSummary[]\n  loading: boolean\n  previewLoading: boolean\n  disabled: boolean\n  isPreviewMode: boolean\n  onOpen: () => void\n  onSelect: (id: string) => void\n}\n\nexport function RevisionHistoryDropdown({\n  revisions,\n  loading,\n  previewLoading,\n  disabled,\n  isPreviewMode,\n  onOpen,\n  onSelect,\n}: Props) {\n  const [open, setOpen] = useState(false)\n\n  const handleOpenChange = (isOpen: boolean) => {\n    if (isOpen && !open) {\n      onOpen()\n    }\n    setOpen(isOpen)\n  }\n\n  const trigger = (\n    <button\n      type=\"button\"\n      disabled={disabled || isPreviewMode || previewLoading}\n      title={disabled ? 'Save post to enable history' : 'Revision history'}\n      className={getToolbarButtonClass(false, disabled || isPreviewMode || previewLoading)}\n    >\n      {previewLoading ? (\n        <Loader2 className={`${toolbarButtonStyles.iconSize} animate-spin`} />\n      ) : (\n        <History className={toolbarButtonStyles.iconSize} />\n      )}\n    </button>\n  )\n\n  return (\n    <Dropdown\n      trigger={trigger}\n      open={open}\n      onOpenChange={handleOpenChange}\n      disabled={disabled || isPreviewMode || previewLoading}\n      align=\"right\"\n      className=\"w-64 max-h-80 overflow-y-auto p-0\"\n    >\n      <DropdownLabel>Revision History</DropdownLabel>\n      <div className=\"border-t border-border\" />\n      \n      {loading ? (\n        <div className=\"flex items-center justify-center py-4\">\n          <Loader2 className=\"h-4 w-4 animate-spin text-gray-500\" />\n        </div>\n      ) : revisions.length === 0 ? (\n        <div className=\"py-4 text-center text-sm text-gray-500\">\n          No revisions yet\n        </div>\n      ) : (\n        revisions.map((rev) => (\n          <DropdownItem key={rev.id} onClick={() => onSelect(rev.id)}>\n            <div className=\"flex flex-col\">\n              <span className=\"text-sm truncate\">{rev.title || 'Untitled'}</span>\n              <span className=\"text-xs text-gray-500\">\n                {formatRelativeTime(rev.createdAt)}\n              </span>\n            </div>\n          </DropdownItem>\n        ))\n      )}\n    </Dropdown>\n  )\n}\n","'use client'\n\nimport { useState, useRef, useEffect, useCallback, createContext, useContext } from 'react'\nimport { AutobloggerPortal } from './Portal'\nimport { cn } from '../../lib/cn'\n\n// ============================================\n// DROPDOWN CONTEXT\n// ============================================\n\nconst DropdownContext = createContext<{ close: () => void } | null>(null)\n\n// ============================================\n// DROPDOWN CONTAINER\n// ============================================\n\ninterface DropdownProps {\n  /** The trigger element (button, avatar, etc.) */\n  trigger: React.ReactNode\n  /** Dropdown content */\n  children: React.ReactNode\n  /** Alignment relative to trigger */\n  align?: 'left' | 'right'\n  /** Custom width class */\n  className?: string\n  /** Controlled open state */\n  open?: boolean\n  /** Callback when open state changes */\n  onOpenChange?: (open: boolean) => void\n  /** Disable the dropdown */\n  disabled?: boolean\n}\n\nexport function Dropdown({\n  trigger,\n  children,\n  align = 'right',\n  className,\n  open: controlledOpen,\n  onOpenChange,\n  disabled,\n}: DropdownProps) {\n  const [internalOpen, setInternalOpen] = useState(false)\n  const [position, setPosition] = useState<{ top: number; left: number; right: number } | null>(null)\n  const [mounted, setMounted] = useState(false)\n  \n  const triggerRef = useRef<HTMLDivElement>(null)\n  const menuRef = useRef<HTMLDivElement>(null)\n  \n  // Controlled vs uncontrolled\n  const isControlled = controlledOpen !== undefined\n  const isOpen = isControlled ? controlledOpen : internalOpen\n  \n  // Calculate position synchronously\n  const updatePosition = useCallback(() => {\n    if (triggerRef.current) {\n      const rect = triggerRef.current.getBoundingClientRect()\n      setPosition({\n        top: rect.bottom + 4, // 4px gap\n        left: rect.left,\n        right: window.innerWidth - rect.right,\n      })\n    }\n  }, [])\n  \n  const setOpen = useCallback((value: boolean) => {\n    if (value) {\n      // Calculate position synchronously BEFORE opening to prevent flicker\n      updatePosition()\n    } else {\n      // Reset position when closing so next open recalculates\n      setPosition(null)\n    }\n    if (!isControlled) {\n      setInternalOpen(value)\n    }\n    onOpenChange?.(value)\n  }, [isControlled, onOpenChange, updatePosition])\n\n  // Mount check for portal\n  useEffect(() => {\n    setMounted(true)\n  }, [])\n\n  // For controlled mode, calculate position when externally opened\n  useEffect(() => {\n    if (isControlled && controlledOpen && !position) {\n      updatePosition()\n    }\n    if (isControlled && !controlledOpen) {\n      setPosition(null)\n    }\n  }, [isControlled, controlledOpen, position, updatePosition])\n\n  // Close on click outside is handled by the backdrop element below\n\n  // Lock scroll when dropdown is open\n  useEffect(() => {\n    if (!isOpen) return\n    \n    // Save current scroll position and lock body scroll\n    const scrollY = window.scrollY\n    document.body.style.position = 'fixed'\n    document.body.style.top = `-${scrollY}px`\n    document.body.style.left = '0'\n    document.body.style.right = '0'\n    document.body.style.overflow = 'hidden'\n    \n    return () => {\n      // Restore scroll position\n      document.body.style.position = ''\n      document.body.style.top = ''\n      document.body.style.left = ''\n      document.body.style.right = ''\n      document.body.style.overflow = ''\n      window.scrollTo(0, scrollY)\n    }\n  }, [isOpen])\n\n  // Close on escape\n  useEffect(() => {\n    if (!isOpen) return\n    \n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        setOpen(false)\n      }\n    }\n    \n    document.addEventListener('keydown', handleKeyDown)\n    return () => document.removeEventListener('keydown', handleKeyDown)\n  }, [isOpen, setOpen])\n\n  // Update position on scroll/resize\n  useEffect(() => {\n    if (!isOpen) return\n    \n    const handleUpdate = () => updatePosition()\n    window.addEventListener('scroll', handleUpdate, true)\n    window.addEventListener('resize', handleUpdate)\n    return () => {\n      window.removeEventListener('scroll', handleUpdate, true)\n      window.removeEventListener('resize', handleUpdate)\n    }\n  }, [isOpen, updatePosition])\n\n  const handleTriggerClick = () => {\n    if (disabled) return\n    setOpen(!isOpen)\n  }\n\n  const close = useCallback(() => setOpen(false), [setOpen])\n\n  // Handle backdrop click - closes dropdown and prevents click-through\n  const handleBackdropClick = useCallback((e: React.MouseEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setOpen(false)\n  }, [setOpen])\n\n  // Only render menu when open, mounted, AND position is calculated\n  const menu = isOpen && mounted && position ? (\n    <AutobloggerPortal>\n      <DropdownContext.Provider value={{ close }}>\n        {/* Invisible backdrop to capture clicks outside dropdown */}\n        <div\n          className=\"ab-dropdown-backdrop\"\n          onClick={handleBackdropClick}\n          onMouseDown={handleBackdropClick}\n        />\n        <div\n          ref={menuRef}\n          style={{\n            position: 'fixed',\n            top: position.top,\n            ...(align === 'right' \n              ? { right: position.right } \n              : { left: position.left }\n            ),\n          }}\n          className={cn(\n            'z-[80] min-w-[160px] bg-popover text-popover-foreground border border-border rounded-md shadow-lg p-1 overscroll-contain',\n            className\n          )}\n          onWheel={(e) => e.stopPropagation()}\n        >\n          {children}\n        </div>\n      </DropdownContext.Provider>\n    </AutobloggerPortal>\n  ) : null\n\n  return (\n    <>\n      <div ref={triggerRef} onClick={handleTriggerClick} className=\"shrink-0\">\n        {trigger}\n      </div>\n      {menu}\n    </>\n  )\n}\n\n// ============================================\n// DROPDOWN ITEM\n// ============================================\n\ninterface DropdownItemProps {\n  onClick?: () => void\n  destructive?: boolean\n  disabled?: boolean\n  children: React.ReactNode\n  className?: string\n}\n\nexport function DropdownItem({\n  onClick,\n  destructive,\n  disabled,\n  children,\n  className,\n}: DropdownItemProps) {\n  const context = useContext(DropdownContext)\n  \n  const handleClick = () => {\n    if (!disabled) {\n      onClick?.()\n      context?.close()\n    }\n  }\n\n  return (\n    <button\n      type=\"button\"\n      onClick={handleClick}\n      disabled={disabled}\n      className={cn(\n        'w-full px-3 py-2.5 md:px-2 md:py-1.5 min-h-[44px] md:min-h-0',\n        'text-left text-sm rounded-sm cursor-default',\n        'active:bg-accent md:hover:bg-accent focus:bg-accent focus:outline-none',\n        destructive && 'text-destructive',\n        disabled && 'opacity-50 cursor-not-allowed',\n        className\n      )}\n    >\n      {children}\n    </button>\n  )\n}\n\n// ============================================\n// DROPDOWN DIVIDER\n// ============================================\n\nexport function DropdownDivider() {\n  return <div className=\"h-px bg-border my-1\" />\n}\n\n// ============================================\n// DROPDOWN LABEL (non-interactive header)\n// ============================================\n\nexport function DropdownLabel({ children }: { children: React.ReactNode }) {\n  return (\n    <div className=\"px-3 py-1.5 md:px-2 md:py-1 text-xs font-medium text-muted-foreground\">\n      {children}\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useRef, useEffect, useCallback } from 'react'\nimport { AutobloggerPortal } from './Portal'\nimport { X, MessageSquare, ArrowUp, Loader2, ChevronDown, ChevronRight } from 'lucide-react'\nimport { cn } from '../../lib/cn'\nimport { CommentWithUser } from '../../lib/comments'\nimport { CommentThread } from './CommentThread'\n\ninterface CommentsPanelProps {\n  comments: CommentWithUser[]\n  currentUserEmail: string\n  isAdmin: boolean\n  selectedText: string | null\n  onCreateComment: (content: string) => Promise<void>\n  onReply: (parentId: string, content: string) => Promise<void>\n  onEdit: (commentId: string, content: string) => Promise<void>\n  onDelete: (commentId: string) => Promise<void>\n  onResolve: (commentId: string) => Promise<void>\n  onCommentClick: (commentId: string) => void\n  activeCommentId: string | null\n  isOpen: boolean\n  onClose: () => void\n  onClearSelection: () => void\n}\n\nexport function CommentsPanel({\n  comments,\n  currentUserEmail,\n  isAdmin,\n  selectedText,\n  onCreateComment,\n  onReply,\n  onEdit,\n  onDelete,\n  onResolve,\n  onCommentClick,\n  activeCommentId,\n  isOpen,\n  onClose,\n  onClearSelection,\n}: CommentsPanelProps) {\n  const [newComment, setNewComment] = useState('')\n  const [isAnimating, setIsAnimating] = useState(false)\n  const [isVisible, setIsVisible] = useState(false)\n  const [mounted, setMounted] = useState(false)\n  const [creating, setCreating] = useState(false)\n  const [showResolved, setShowResolved] = useState(false)\n  const textareaRef = useRef<HTMLTextAreaElement>(null)\n  const commentsEndRef = useRef<HTMLDivElement>(null)\n\n  // Separate open and resolved comments\n  const openComments = comments.filter((c) => !c.resolved)\n  const resolvedComments = comments.filter((c) => c.resolved)\n\n  // Client-side only for portal\n  useEffect(() => {\n    setMounted(true)\n  }, [])\n\n  // Handle open/close animation and body scroll lock\n  useEffect(() => {\n    if (isOpen) {\n      setIsVisible(true)\n      document.body.style.overflow = 'hidden'\n      document.body.style.position = 'fixed'\n      document.body.style.width = '100%'\n      document.body.style.top = `-${window.scrollY}px`\n      requestAnimationFrame(() => {\n        requestAnimationFrame(() => {\n          setIsAnimating(true)\n        })\n      })\n    } else {\n      setIsAnimating(false)\n      const scrollY = document.body.style.top\n      document.body.style.overflow = ''\n      document.body.style.position = ''\n      document.body.style.width = ''\n      document.body.style.top = ''\n      window.scrollTo(0, parseInt(scrollY || '0') * -1)\n      const timer = setTimeout(() => {\n        setIsVisible(false)\n      }, 200)\n      return () => clearTimeout(timer)\n    }\n  }, [isOpen])\n\n  // Focus textarea when selected text changes\n  useEffect(() => {\n    if (selectedText && isOpen) {\n      textareaRef.current?.focus()\n    }\n  }, [selectedText, isOpen])\n\n  // Auto-resize textarea as content grows\n  useEffect(() => {\n    const textarea = textareaRef.current\n    if (textarea) {\n      textarea.style.height = 'auto'\n      textarea.style.height = `${Math.min(textarea.scrollHeight, 120)}px`\n    }\n  }, [newComment])\n\n  const handleCreateComment = useCallback(async () => {\n    if (!newComment.trim() || !selectedText) return\n    setCreating(true)\n    try {\n      await onCreateComment(newComment.trim())\n      setNewComment('')\n      onClearSelection()\n    } finally {\n      setCreating(false)\n    }\n  }, [newComment, selectedText, onCreateComment, onClearSelection])\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault()\n      e.stopPropagation()\n      handleCreateComment()\n    }\n    if (e.key === 'Escape') {\n      e.stopPropagation()\n      if (selectedText) {\n        onClearSelection()\n        setNewComment('')\n      } else {\n        onClose()\n      }\n    }\n  }\n\n  if (!isVisible || !mounted) return null\n\n  return (\n    <AutobloggerPortal>\n      {/* Backdrop */}\n      <div\n        className={cn(\n          'fixed inset-0 h-[100dvh] bg-black/20 z-[60] transition-opacity duration-200',\n          isAnimating ? 'opacity-100' : 'opacity-0'\n        )}\n        onClick={onClose}\n      />\n\n      {/* Panel */}\n      <div\n        role=\"dialog\"\n        aria-modal=\"true\"\n        aria-label=\"Comments\"\n        className={cn(\n          'fixed z-[70] flex flex-col bg-background text-foreground shadow-xl transition-transform duration-200 ease-out overflow-hidden',\n          'inset-x-0 top-0 h-[100dvh]',\n          'md:left-auto md:w-full md:max-w-[380px] md:border-l md:border-border',\n          isAnimating ? 'translate-x-0' : 'translate-x-full'\n        )}\n      >\n        {/* Header */}\n        <div className=\"flex-shrink-0 border-b border-ab-neutral-border px-4 py-3 flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            <MessageSquare className=\"w-4 h-4 text-gray-500\" />\n            <h2 className=\"font-medium\">Comments</h2>\n            {openComments.length > 0 && (\n              <span className=\"text-xs text-gray-500\">\n                ({openComments.length})\n              </span>\n            )}\n          </div>\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"w-8 h-8 rounded-md hover:bg-ab-neutral-subtle flex items-center justify-center text-ab-neutral\"\n            aria-label=\"Close comments\"\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n\n        {/* New comment section - shown when text is selected */}\n        {selectedText && (\n          <div className=\"flex-shrink-0 border-b border-ab-neutral-border px-4 py-5 bg-ab-neutral-subtle/50\">\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex-1 px-2 py-1 bg-ab-highlight-strong rounded text-sm italic text-ab-neutral-strong line-clamp-2\">\n                \"{selectedText}\"\n              </div>\n              <button\n                type=\"button\"\n                onClick={() => {\n                  onClearSelection()\n                  setNewComment('')\n                }}\n                disabled={creating}\n                className=\"ml-2 text-xs text-ab-neutral hover:text-foreground disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n            </div>\n            <div className=\"flex items-end gap-2\">\n              <textarea\n                ref={textareaRef}\n                value={newComment}\n                onChange={(e) => setNewComment(e.target.value)}\n                onKeyDown={handleKeyDown}\n                placeholder=\"Add a comment...\"\n                className=\"flex-1 min-h-[60px] max-h-[120px] px-3 py-2 border border-ab-neutral-border rounded-md bg-ab-surface-input resize-none text-sm focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                rows={2}\n                enterKeyHint=\"send\"\n              />\n              <button\n                type=\"button\"\n                onClick={handleCreateComment}\n                disabled={creating || !newComment.trim()}\n                className=\"w-10 h-10 flex-shrink-0 rounded-full bg-ab-neutral-subtle border border-ab-neutral-border flex items-center justify-center disabled:opacity-50 hover:bg-ab-neutral-subtle/80\"\n              >\n                {creating ? (\n                  <Loader2 className=\"h-5 w-5 animate-spin\" />\n                ) : (\n                  <ArrowUp className=\"h-5 w-5\" />\n                )}\n              </button>\n            </div>\n          </div>\n        )}\n\n        {/* Comments list - hidden when composing new comment */}\n        <div className={cn(\"flex-1 overflow-y-auto\", selectedText && \"hidden\")}>\n          {comments.length === 0 ? (\n            <div className=\"h-full flex items-center justify-center\">\n              <div className=\"text-center max-w-xs px-6\">\n                <MessageSquare className=\"w-8 h-8 mx-auto mb-2 text-gray-400\" />\n                <p className=\"text-gray-500 text-sm\">\n                  No comments yet. Select text and click the comment button to add one.\n                </p>\n              </div>\n            </div>\n          ) : (\n            <div className=\"p-4 space-y-3\">\n              {/* Open comments */}\n              {openComments.map((comment) => (\n                <CommentThread\n                  key={comment.id}\n                  comment={comment}\n                  currentUserEmail={currentUserEmail}\n                  isAdmin={isAdmin}\n                  isActive={activeCommentId === comment.id}\n                  onReply={(content) => onReply(comment.id, content)}\n                  onEdit={(content) => onEdit(comment.id, content)}\n                  onDelete={() => onDelete(comment.id)}\n                  onResolve={() => onResolve(comment.id)}\n                  onClick={() => onCommentClick(comment.id)}\n                />\n              ))}\n\n              {/* Resolved comments section */}\n              {resolvedComments.length > 0 && (\n                <div className=\"pt-2\">\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowResolved(!showResolved)}\n                    className=\"w-full text-left text-sm text-ab-neutral hover:text-foreground transition-colors py-2\"\n                  >\n                    <span className=\"inline-flex items-center gap-1\">\n                      {showResolved ? <ChevronDown className=\"w-4 h-4\" /> : <ChevronRight className=\"w-4 h-4\" />}\n                      Resolved ({resolvedComments.length})\n                    </span>\n                  </button>\n                  {showResolved && (\n                    <div className=\"space-y-3 mt-2\">\n                      {resolvedComments.map((comment) => (\n                        <CommentThread\n                          key={comment.id}\n                          comment={comment}\n                          currentUserEmail={currentUserEmail}\n                          isAdmin={isAdmin}\n                          isActive={activeCommentId === comment.id}\n                          onReply={(content) => onReply(comment.id, content)}\n                          onEdit={(content) => onEdit(comment.id, content)}\n                          onDelete={() => onDelete(comment.id)}\n                          onResolve={() => onResolve(comment.id)}\n                          onClick={() => onCommentClick(comment.id)}\n                        />\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              <div ref={commentsEndRef} />\n            </div>\n          )}\n        </div>\n      </div>\n    </AutobloggerPortal>\n  )\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { MoreHorizontal, Reply, Check, Trash2, Pencil } from 'lucide-react'\nimport { cn } from '../../lib/cn'\nimport { CommentWithUser, canEditComment, canDeleteComment } from '../../lib/comments'\nimport { Dropdown, DropdownItem, DropdownDivider } from './Dropdown'\n\n// Simple relative time formatter\nfunction formatRelativeTime(dateStr: string): string {\n  const date = new Date(dateStr)\n  const now = new Date()\n  const diff = now.getTime() - date.getTime()\n  const minutes = Math.floor(diff / 60000)\n  const hours = Math.floor(diff / 3600000)\n  const days = Math.floor(diff / 86400000)\n\n  if (minutes < 1) return 'just now'\n  if (minutes < 60) return `${minutes}m ago`\n  if (hours < 24) return `${hours}h ago`\n  if (days < 7) return `${days}d ago`\n  return date.toLocaleDateString()\n}\n\ninterface CommentThreadProps {\n  comment: CommentWithUser\n  currentUserEmail: string\n  isAdmin: boolean\n  isActive: boolean\n  onReply: (content: string) => Promise<void>\n  onEdit: (content: string) => Promise<void>\n  onDelete: () => Promise<void>\n  onResolve: () => Promise<void>\n  onClick: () => void\n}\n\nexport function CommentThread({\n  comment,\n  currentUserEmail,\n  isAdmin,\n  isActive,\n  onReply,\n  onEdit,\n  onDelete,\n  onResolve,\n  onClick,\n}: CommentThreadProps) {\n  const [isReplying, setIsReplying] = useState(false)\n  const [isEditing, setIsEditing] = useState(false)\n  const [replyContent, setReplyContent] = useState('')\n  const [editContent, setEditContent] = useState(comment.content)\n  const [loading, setLoading] = useState(false)\n\n  const canEdit = canEditComment(comment, currentUserEmail)\n  const canDelete = canDeleteComment(comment, currentUserEmail, isAdmin)\n  const isOwn = comment.user.email === currentUserEmail\n\n  const handleReply = async () => {\n    if (!replyContent.trim()) return\n    setLoading(true)\n    try {\n      await onReply(replyContent.trim())\n      setReplyContent('')\n      setIsReplying(false)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleEdit = async () => {\n    if (!editContent.trim()) return\n    setLoading(true)\n    try {\n      await onEdit(editContent.trim())\n      setIsEditing(false)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleDelete = async () => {\n    if (!confirm('Delete this comment?')) return\n    setLoading(true)\n    try {\n      await onDelete()\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div\n      role=\"button\"\n      tabIndex={0}\n      onClick={onClick}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault()\n          onClick()\n        }\n      }}\n      className={cn(\n        'rounded-lg border p-3 transition-colors cursor-pointer',\n        isActive\n          ? 'border-ab-highlight-border bg-ab-highlight'\n          : 'border-ab-neutral-border bg-ab-surface-input',\n        comment.resolved && 'opacity-60'\n      )}\n    >\n      {/* Header */}\n      <div className=\"flex items-start justify-between gap-2 mb-2\">\n        <div className=\"flex items-center gap-2 text-sm\">\n          <span className=\"font-medium\">\n            {isOwn ? 'You' : comment.user.name || comment.user.email.split('@')[0]}\n          </span>\n          <span className=\"text-ab-neutral\">\n            {formatRelativeTime(comment.createdAt)}\n          </span>\n          {comment.resolved && (\n            <span className=\"inline-flex items-center gap-1 text-xs text-ab-success\">\n              <Check className=\"w-3 h-3\" />\n              Resolved\n            </span>\n          )}\n        </div>\n\n        {/* Dropdown menu */}\n        <div onClick={(e) => e.stopPropagation()}>\n          <Dropdown\n            trigger={\n              <button\n                type=\"button\"\n                className=\"w-6 h-6 rounded hover:bg-ab-neutral-subtle flex items-center justify-center text-ab-neutral\"\n              >\n                <MoreHorizontal className=\"w-4 h-4\" />\n              </button>\n            }\n            align=\"right\"\n            className=\"min-w-[140px]\"\n          >\n            <DropdownItem onClick={onResolve}>\n              <span className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4\" />\n                {comment.resolved ? 'Unresolve' : 'Resolve'}\n              </span>\n            </DropdownItem>\n            {canEdit && (\n              <DropdownItem onClick={() => setIsEditing(true)}>\n                <span className=\"flex items-center gap-2\">\n                  <Pencil className=\"w-4 h-4\" />\n                  Edit\n                </span>\n              </DropdownItem>\n            )}\n            {canDelete && (\n              <>\n                <DropdownDivider />\n                <DropdownItem onClick={handleDelete} destructive>\n                  <span className=\"flex items-center gap-2\">\n                    <Trash2 className=\"w-4 h-4\" />\n                    Delete\n                  </span>\n                </DropdownItem>\n              </>\n            )}\n          </Dropdown>\n        </div>\n      </div>\n\n      {/* Quoted text */}\n      {comment.quotedText && (\n        <div className=\"mb-2 px-2 py-1 bg-ab-highlight-strong rounded text-sm italic text-ab-neutral-strong line-clamp-2\">\n          \"{comment.quotedText}\"\n        </div>\n      )}\n\n      {/* Content */}\n      {isEditing ? (\n        <div className=\"space-y-2\">\n          <textarea\n            value={editContent}\n            onChange={(e) => {\n              setEditContent(e.target.value)\n              e.target.style.height = 'auto'\n              e.target.style.height = `${Math.min(e.target.scrollHeight, 120)}px`\n            }}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault()\n                e.stopPropagation()\n                handleEdit()\n              }\n              if (e.key === 'Escape') {\n                e.stopPropagation()\n                setIsEditing(false)\n                setEditContent(comment.content)\n              }\n            }}\n            onClick={(e) => e.stopPropagation()}\n            className=\"w-full min-h-[60px] max-h-[120px] px-3 py-2 border border-ab-neutral-border rounded-md bg-ab-surface-input resize-none text-sm focus:outline-none focus:ring-1 focus:ring-blue-500\"\n          />\n          <div className=\"flex gap-2 justify-end\">\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation()\n                setIsEditing(false)\n                setEditContent(comment.content)\n              }}\n              disabled={loading}\n              className=\"px-3 py-1.5 text-sm rounded-md hover:bg-ab-neutral-subtle disabled:opacity-50\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation()\n                handleEdit()\n              }}\n              disabled={loading || !editContent.trim()}\n              className=\"px-3 py-1.5 text-sm rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50\"\n            >\n              Save\n            </button>\n          </div>\n        </div>\n      ) : (\n        <p className=\"text-sm whitespace-pre-wrap\">{comment.content}</p>\n      )}\n\n      {/* Replies */}\n      {comment.replies && comment.replies.length > 0 && (\n        <div className=\"mt-3 pl-3 border-l-2 border-ab-neutral-border space-y-3\">\n          {comment.replies.map((reply) => (\n            <ReplyItem\n              key={reply.id}\n              reply={reply}\n              currentUserEmail={currentUserEmail}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Reply button / form */}\n      {!isEditing && (\n        <div className=\"mt-3\">\n          {isReplying ? (\n            <div className=\"space-y-2\">\n              <textarea\n                value={replyContent}\n                onChange={(e) => {\n                  setReplyContent(e.target.value)\n                  e.target.style.height = 'auto'\n                  e.target.style.height = `${Math.min(e.target.scrollHeight, 120)}px`\n                }}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault()\n                    e.stopPropagation()\n                    handleReply()\n                  }\n                  if (e.key === 'Escape') {\n                    e.stopPropagation()\n                    setIsReplying(false)\n                    setReplyContent('')\n                  }\n                }}\n                placeholder=\"Write a reply...\"\n                className=\"w-full min-h-[60px] max-h-[120px] px-3 py-2 border border-ab-neutral-border rounded-md bg-ab-surface-input resize-none text-sm focus:outline-none focus:ring-1 focus:ring-blue-500\"\n                onClick={(e) => e.stopPropagation()}\n              />\n              <div className=\"flex gap-2 justify-end\">\n                <button\n                  type=\"button\"\n                  onClick={(e) => {\n                    e.stopPropagation()\n                    setIsReplying(false)\n                    setReplyContent('')\n                  }}\n                  disabled={loading}\n                  className=\"px-3 py-1.5 text-sm rounded-md hover:bg-ab-neutral-subtle disabled:opacity-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"button\"\n                  onClick={(e) => {\n                    e.stopPropagation()\n                    handleReply()\n                  }}\n                  disabled={loading || !replyContent.trim()}\n                  className=\"px-3 py-1.5 text-sm rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50\"\n                >\n                  Reply\n                </button>\n              </div>\n            </div>\n          ) : (\n            <button\n              type=\"button\"\n              onClick={(e) => {\n                e.stopPropagation()\n                setIsReplying(true)\n              }}\n              className=\"inline-flex items-center gap-1 text-sm text-ab-neutral hover:text-foreground transition-colors\"\n            >\n              <Reply className=\"w-3.5 h-3.5\" />\n              Reply\n            </button>\n          )}\n        </div>\n      )}\n    </div>\n  )\n}\n\n// Simple reply display (no nested replies allowed)\nfunction ReplyItem({\n  reply,\n  currentUserEmail,\n}: {\n  reply: CommentWithUser\n  currentUserEmail: string\n}) {\n  const isOwn = reply.user.email === currentUserEmail\n\n  return (\n    <div className=\"text-sm\">\n      <div className=\"flex items-center gap-2 mb-1\">\n        <span className=\"font-medium\">\n          {isOwn ? 'You' : reply.user.name || reply.user.email.split('@')[0]}\n        </span>\n        <span className=\"text-ab-neutral text-xs\">\n          {formatRelativeTime(reply.createdAt)}\n        </span>\n      </div>\n      <p className=\"whitespace-pre-wrap text-ab-neutral-strong\">{reply.content}</p>\n    </div>\n  )\n}\n","/**\n * Comment types and client-side API helpers for the editor commenting system.\n * Used for collaborative inline comments on posts.\n */\n\n// Types matching Prisma schema + includes\nexport interface CommentUser {\n  id: string\n  name: string | null\n  email: string\n}\n\nexport interface CommentWithUser {\n  id: string\n  postId: string\n  userId: string\n  quotedText: string\n  content: string\n  parentId: string | null\n  resolved: boolean\n  createdAt: string\n  updatedAt: string\n  user: CommentUser\n  replies?: CommentWithUser[]\n}\n\nexport interface CreateCommentData {\n  quotedText: string\n  content: string\n  parentId?: string\n}\n\nexport interface SelectionState {\n  text: string\n  from: number\n  to: number\n  hasExistingComment?: boolean\n}\n\n// Permission helpers (compare by email since that's what we have in session)\nexport function canDeleteComment(\n  comment: CommentWithUser,\n  currentUserEmail: string,\n  isAdmin: boolean\n): boolean {\n  return comment.user.email === currentUserEmail || isAdmin\n}\n\nexport function canEditComment(\n  comment: CommentWithUser,\n  currentUserEmail: string\n): boolean {\n  return comment.user.email === currentUserEmail\n}\n\n// API client factory - creates functions bound to a specific API base path\nexport function createCommentsClient(apiBasePath: string = '/api/cms') {\n  return {\n    async fetchComments(postId: string): Promise<CommentWithUser[]> {\n      const res = await fetch(`${apiBasePath}/posts/${postId}/comments`)\n      if (!res.ok) throw new Error('Failed to fetch comments')\n      const json = await res.json()\n      return json.data || json\n    },\n\n    async createComment(\n      postId: string,\n      data: CreateCommentData\n    ): Promise<CommentWithUser> {\n      const res = await fetch(`${apiBasePath}/posts/${postId}/comments`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(data),\n      })\n      if (!res.ok) {\n        const error = await res.json()\n        throw new Error(error.error || 'Failed to create comment')\n      }\n      const json = await res.json()\n      return json.data || json\n    },\n\n    async updateComment(\n      postId: string,\n      commentId: string,\n      content: string\n    ): Promise<CommentWithUser> {\n      const res = await fetch(`${apiBasePath}/posts/${postId}/comments/${commentId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ content }),\n      })\n      if (!res.ok) {\n        const error = await res.json()\n        throw new Error(error.error || 'Failed to update comment')\n      }\n      const json = await res.json()\n      return json.data || json\n    },\n\n    async deleteComment(\n      postId: string,\n      commentId: string\n    ): Promise<void> {\n      const res = await fetch(`${apiBasePath}/posts/${postId}/comments/${commentId}`, {\n        method: 'DELETE',\n      })\n      if (!res.ok) {\n        const error = await res.json()\n        throw new Error(error.error || 'Failed to delete comment')\n      }\n    },\n\n    async toggleResolve(\n      postId: string,\n      commentId: string\n    ): Promise<CommentWithUser> {\n      const res = await fetch(`${apiBasePath}/posts/${postId}/comments/${commentId}/resolve`, {\n        method: 'POST',\n      })\n      if (!res.ok) {\n        const error = await res.json()\n        throw new Error(error.error || 'Failed to toggle resolve')\n      }\n      const json = await res.json()\n      return json.data || json\n    },\n\n    async resolveAllComments(\n      postId: string\n    ): Promise<{ resolved: number }> {\n      const res = await fetch(`${apiBasePath}/posts/${postId}/comments/resolve-all`, {\n        method: 'POST',\n      })\n      if (!res.ok) {\n        const error = await res.json()\n        throw new Error(error.error || 'Failed to resolve all comments')\n      }\n      const json = await res.json()\n      return json.data || json\n    },\n  }\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { ExpandableSection } from './ExpandableSection'\nimport { Dropdown, DropdownItem } from './Dropdown'\nimport { useDashboardContext } from '../context'\n\ninterface Tag {\n  id: string\n  name: string\n}\n\ninterface TagsSectionProps {\n  tags: Tag[]\n  onTagsChange: (tags: Tag[]) => void\n  apiBasePath: string\n  disabled?: boolean\n}\n\nexport function TagsSection({\n  tags,\n  onTagsChange,\n  apiBasePath,\n  disabled = false,\n}: TagsSectionProps) {\n  const { navigate } = useDashboardContext()\n  const [isExpanded, setIsExpanded] = useState(false)\n  const [availableTags, setAvailableTags] = useState<Tag[]>([])\n  const [loading, setLoading] = useState(false)\n  const [dropdownOpen, setDropdownOpen] = useState(false)\n\n  // Fetch available tags when section expands\n  useEffect(() => {\n    if (isExpanded && availableTags.length === 0) {\n      setLoading(true)\n      fetch(`${apiBasePath}/tags`)\n        .then(res => res.ok ? res.json() : Promise.reject())\n        .then(data => {\n          setAvailableTags(data.data || [])\n          setLoading(false)\n        })\n        .catch(() => setLoading(false))\n    }\n  }, [isExpanded, availableTags.length, apiBasePath])\n\n  const handleAddTag = (tagId: string) => {\n    const tagToAdd = availableTags.find(t => t.id === tagId)\n    if (tagToAdd && !tags.some(t => t.id === tagId)) {\n      onTagsChange([...tags, tagToAdd])\n    }\n    setDropdownOpen(false)\n  }\n\n  const handleRemoveTag = (tagId: string) => {\n    onTagsChange(tags.filter(t => t.id !== tagId))\n  }\n\n  // Tags not already selected\n  const unselectedTags = availableTags.filter(\n    at => !tags.some(t => t.id === at.id)\n  )\n\n  const tagSummary = tags.length === 0\n    ? 'no tags'\n    : tags.length === 1\n    ? '1 tag'\n    : `${tags.length} tags`\n\n  return (\n    <ExpandableSection\n      title=\"Tags\"\n      summary={tagSummary}\n      expanded={isExpanded}\n      onExpandedChange={setIsExpanded}\n    >\n      {/* Selected tags */}\n      {tags.length > 0 && (\n        <div className=\"flex flex-wrap gap-2\">\n          {tags.map(tag => (\n            <span\n              key={tag.id}\n              className=\"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-muted text-muted-foreground text-sm\"\n            >\n              {tag.name}\n              {!disabled && (\n                <button\n                  type=\"button\"\n                  onClick={() => handleRemoveTag(tag.id)}\n                  className=\"hover:text-red-500 transition-colors\"\n                >\n                  <svg className=\"h-3 w-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                  </svg>\n                </button>\n              )}\n            </span>\n          ))}\n        </div>\n      )}\n\n      {/* Add tag dropdown */}\n      {!disabled && (\n        <>\n          {loading ? (\n            <p className=\"text-sm text-muted-foreground\">Loading tags...</p>\n          ) : unselectedTags.length > 0 ? (\n            <div className=\"max-w-[200px]\">\n              <Dropdown\n                open={dropdownOpen}\n                onOpenChange={setDropdownOpen}\n                align=\"left\"\n                className=\"max-h-48 overflow-auto\"\n                trigger={\n                  <button\n                    type=\"button\"\n                    className=\"w-full h-8 px-3 text-sm text-left border border-border rounded-md bg-transparent flex items-center justify-between\"\n                  >\n                    <span className=\"text-muted-foreground\">Add tag...</span>\n                    <svg className=\"h-4 w-4 text-muted-foreground\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n                    </svg>\n                  </button>\n                }\n              >\n                {unselectedTags.map(tag => (\n                  <DropdownItem\n                    key={tag.id}\n                    onClick={() => handleAddTag(tag.id)}\n                  >\n                    {tag.name}\n                  </DropdownItem>\n                ))}\n              </Dropdown>\n            </div>\n          ) : availableTags.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground\">\n              No tags available.{' '}\n              <button\n                type=\"button\"\n                onClick={() => navigate('/settings/tags')}\n                className=\"underline hover:text-foreground transition-colors\"\n              >\n                Create tags in Settings\n              </button>\n            </p>\n          ) : (\n            <p className=\"text-sm text-muted-foreground\">All tags added</p>\n          )}\n        </>\n      )}\n    </ExpandableSection>\n  )\n}\n","'use client'\n\nimport { useState, ReactNode } from 'react'\n\ninterface ExpandableSectionProps {\n  /** Section title displayed in the header */\n  title: string\n  /** Optional summary text displayed on the right side of the header */\n  summary?: string\n  /** Whether the section is expanded by default */\n  defaultExpanded?: boolean\n  /** Controlled expanded state (makes component controlled) */\n  expanded?: boolean\n  /** Callback when expanded state changes */\n  onExpandedChange?: (expanded: boolean) => void\n  /** Content to render when expanded */\n  children: ReactNode\n  /** Additional className for the container */\n  className?: string\n}\n\nexport function ExpandableSection({\n  title,\n  summary,\n  defaultExpanded = false,\n  expanded: controlledExpanded,\n  onExpandedChange,\n  children,\n  className = '',\n}: ExpandableSectionProps) {\n  const [internalExpanded, setInternalExpanded] = useState(defaultExpanded)\n  \n  // Support both controlled and uncontrolled modes\n  const isControlled = controlledExpanded !== undefined\n  const isExpanded = isControlled ? controlledExpanded : internalExpanded\n  \n  const handleToggle = () => {\n    const newValue = !isExpanded\n    if (!isControlled) {\n      setInternalExpanded(newValue)\n    }\n    onExpandedChange?.(newValue)\n  }\n\n  return (\n    <div className={className}>\n      <button\n        type=\"button\"\n        onClick={handleToggle}\n        className=\"flex items-center justify-between gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors w-full\"\n      >\n        <span className=\"flex items-center gap-2\">\n          <span>{title}</span>\n          {summary && (\n            <span className=\"text-xs text-muted-foreground/70\">{summary}</span>\n          )}\n        </span>\n        <svg \n          className={`h-4 w-4 shrink-0 transition-transform duration-200 ${isExpanded ? 'rotate-180' : ''}`} \n          fill=\"none\" \n          viewBox=\"0 0 24 24\" \n          stroke=\"currentColor\"\n        >\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n        </svg>\n      </button>\n\n      {isExpanded && (\n        <div className=\"mt-4 space-y-3\">\n          {children}\n        </div>\n      )}\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useCallback, useEffect } from 'react'\nimport type { Editor } from '@tiptap/react'\nimport {\n  CommentWithUser,\n  SelectionState,\n  createCommentsClient,\n} from '../../lib/comments'\nimport {\n  addCommentMark,\n  removeCommentMark,\n  applyCommentMarks,\n  scrollToComment,\n} from '../../lib/comment-mark'\n\nexport interface UseCommentsOptions {\n  postId: string | null\n  editor: Editor | null\n  apiBasePath?: string\n  onSave?: () => Promise<string | null> // Called to auto-save post, returns postId\n}\n\nexport interface CommentsState {\n  list: CommentWithUser[]\n  loading: boolean\n  activeId: string | null\n  setActiveId: (id: string | null) => void\n  selectedText: SelectionState | null\n  setSelectedText: (selection: SelectionState | null) => void\n  postId: string | null\n  create: (content: string) => Promise<void>\n  reply: (parentId: string, content: string) => Promise<void>\n  edit: (commentId: string, content: string) => Promise<void>\n  remove: (commentId: string) => Promise<void>\n  resolve: (commentId: string) => Promise<void>\n  resolveAll: () => Promise<void>\n  scrollTo: (commentId: string) => void\n  openCount: number\n}\n\nexport function useComments({\n  postId: initialPostId,\n  editor,\n  apiBasePath = '/api/cms',\n  onSave,\n}: UseCommentsOptions): CommentsState {\n  const [postId, setPostId] = useState<string | null>(initialPostId)\n  const [comments, setComments] = useState<CommentWithUser[]>([])\n  const [loading, setLoading] = useState(false)\n  const [activeCommentId, setActiveCommentId] = useState<string | null>(null)\n  const [selectedText, setSelectedText] = useState<SelectionState | null>(null)\n\n  const client = createCommentsClient(apiBasePath)\n\n  // Update postId when it changes\n  useEffect(() => {\n    setPostId(initialPostId)\n  }, [initialPostId])\n\n  // Fetch comments when postId changes\n  useEffect(() => {\n    if (!postId) {\n      setComments([])\n      return\n    }\n\n    setLoading(true)\n    client.fetchComments(postId)\n      .then((data) => {\n        setComments(data)\n        // Apply comment marks to editor\n        if (editor) {\n          applyCommentMarks(editor, data)\n        }\n      })\n      .catch(console.error)\n      .finally(() => setLoading(false))\n  }, [postId, editor])\n\n  // Create a new comment\n  const createComment = useCallback(async (content: string) => {\n    if (!selectedText) return\n\n    // Auto-save the post first if it hasn't been saved yet\n    let effectivePostId = postId\n    if (!effectivePostId && onSave) {\n      effectivePostId = await onSave()\n      if (effectivePostId) {\n        setPostId(effectivePostId)\n      }\n    }\n\n    if (!effectivePostId) {\n      console.error('Cannot create comment: no post ID')\n      return\n    }\n\n    const comment = await client.createComment(effectivePostId, {\n      quotedText: selectedText.text,\n      content,\n    })\n\n    // Add highlight mark to editor\n    if (editor) {\n      addCommentMark(editor, comment.id, selectedText.from, selectedText.to)\n    }\n\n    // Add to list with empty replies array\n    setComments((prev) => [{ ...comment, replies: [] }, ...prev])\n    setSelectedText(null)\n  }, [postId, selectedText, editor, onSave, client])\n\n  // Reply to a comment\n  const replyToComment = useCallback(async (parentId: string, content: string) => {\n    if (!postId) return\n\n    const reply = await client.createComment(postId, {\n      quotedText: '',\n      content,\n      parentId,\n    })\n\n    // Add reply to parent's replies array\n    setComments((prev) =>\n      prev.map((c) =>\n        c.id === parentId\n          ? { ...c, replies: [...(c.replies || []), reply] }\n          : c\n      )\n    )\n  }, [postId, client])\n\n  // Edit a comment\n  const editComment = useCallback(async (commentId: string, content: string) => {\n    if (!postId) return\n\n    const updated = await client.updateComment(postId, commentId, content)\n\n    // Update in list (could be top-level or reply)\n    setComments((prev) =>\n      prev.map((c) => {\n        if (c.id === commentId) {\n          return { ...c, ...updated }\n        }\n        // Check in replies\n        if (c.replies) {\n          return {\n            ...c,\n            replies: c.replies.map((r) =>\n              r.id === commentId ? { ...r, ...updated } : r\n            ),\n          }\n        }\n        return c\n      })\n    )\n  }, [postId, client])\n\n  // Remove a comment\n  const removeComment = useCallback(async (commentId: string) => {\n    if (!postId) return\n\n    await client.deleteComment(postId, commentId)\n\n    // Remove highlight mark from editor\n    if (editor) {\n      removeCommentMark(editor, commentId)\n    }\n\n    // Remove from list (could be top-level or reply)\n    setComments((prev) => {\n      // Check if it's a top-level comment\n      const isTopLevel = prev.some((c) => c.id === commentId)\n      if (isTopLevel) {\n        return prev.filter((c) => c.id !== commentId)\n      }\n      // It's a reply\n      return prev.map((c) => ({\n        ...c,\n        replies: c.replies?.filter((r) => r.id !== commentId),\n      }))\n    })\n  }, [postId, editor, client])\n\n  // Resolve/unresolve a comment\n  const resolveComment = useCallback(async (commentId: string) => {\n    if (!postId) return\n\n    const updated = await client.toggleResolve(postId, commentId)\n\n    // Toggle highlight: remove when resolved, re-add when unresolved\n    if (editor) {\n      const comment = comments.find((c) => c.id === commentId)\n      if (updated.resolved) {\n        removeCommentMark(editor, commentId)\n      } else if (comment && selectedText) {\n        // Re-apply mark if unresolving\n        addCommentMark(editor, commentId, selectedText.from, selectedText.to)\n      }\n    }\n\n    // Update in list\n    setComments((prev) =>\n      prev.map((c) => (c.id === commentId ? { ...c, resolved: updated.resolved } : c))\n    )\n  }, [postId, editor, comments, selectedText, client])\n\n  // Resolve all comments\n  const resolveAllComments = useCallback(async () => {\n    if (!postId) return\n\n    await client.resolveAllComments(postId)\n\n    // Remove all highlight marks\n    if (editor) {\n      comments.filter((c) => !c.resolved && !c.parentId).forEach((c) => {\n        removeCommentMark(editor, c.id)\n      })\n    }\n\n    // Update all comments to resolved\n    setComments((prev) =>\n      prev.map((c) => ({ ...c, resolved: true }))\n    )\n  }, [postId, editor, comments, client])\n\n  // Scroll to a comment in the editor\n  const scrollToCommentMark = useCallback((commentId: string) => {\n    if (editor) {\n      scrollToComment(editor, commentId)\n    }\n    setActiveCommentId(commentId)\n  }, [editor])\n\n  // Count open comments (non-resolved, non-replies)\n  const openCount = comments.filter((c) => !c.resolved && !c.parentId).length\n\n  return {\n    list: comments,\n    loading,\n    activeId: activeCommentId,\n    setActiveId: setActiveCommentId,\n    selectedText,\n    setSelectedText,\n    postId,\n    create: createComment,\n    reply: replyToComment,\n    edit: editComment,\n    remove: removeComment,\n    resolve: resolveComment,\n    resolveAll: resolveAllComments,\n    scrollTo: scrollToCommentMark,\n    openCount,\n  }\n}\n","'use client'\n\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\nimport { PageContainer } from '../../components/PageContainer'\n\n// Extracted settings components\nimport { UsersSettings } from './UsersSettings'\nimport { GeneralSettings } from './GeneralSettings'\nimport { IntegrationsSettings } from './IntegrationsSettings'\nimport { CommentsSettings } from './CommentsSettings'\nimport { AISettings } from './AISettings'\nimport { TagsSettings } from './TagsSettings'\nimport { TopicsSettings } from './TopicsSettings'\nimport { PostsSettings } from './PostsSettings'\nimport { RevisionsSettings, RevisionDetail } from './RevisionsSettings'\nimport { CollapsibleTemplate } from './CollapsibleTemplate'\n\ninterface SettingsLink {\n  path: string\n  label: string\n  description: string\n  countKey?: string\n}\n\nexport function SettingsPage({ subPath }: { subPath: string }) {\n  const { navigate, sharedData, sharedDataLoading } = useDashboardContext()\n  const counts = sharedData?.counts || {}\n  const autoDraftEnabled = sharedData?.settings?.autoDraftEnabled ?? false\n  const loading = sharedDataLoading\n\n  const allSettingsLinks: SettingsLink[] = [\n    { path: '/settings/users', label: 'Users', description: 'Manage who can access the CMS', countKey: 'users' },\n    { path: '/settings/posts', label: 'All Posts', description: 'Manage all posts', countKey: 'posts' },\n    { path: '/settings/tags', label: 'Tags', description: 'Organize posts with tags', countKey: 'tags' },\n    { path: '/settings/ai', label: 'AI Settings', description: 'Configure AI models and rules' },\n    { path: '/settings/integrations', label: 'CMS Integrations', description: 'Connect to external CMS systems' },\n    { path: '/settings/revisions', label: 'Revisions', description: 'View revision history' },\n    { path: '/settings/comments', label: 'Comments', description: 'Manage post comments' },\n    { path: '/settings/topics', label: 'Topics', description: 'RSS subscriptions for auto-draft', countKey: 'topics' },\n    { path: '/settings/general', label: 'General', description: 'Post URLs and site settings' },\n  ]\n\n  // Filter out Topics if autoDraftEnabled is off\n  const settingsLinks = autoDraftEnabled \n    ? allSettingsLinks \n    : allSettingsLinks.filter(link => link.path !== '/settings/topics')\n\n  // Main settings overview\n  if (!subPath || subPath === '/') {\n    if (loading) {\n      return (\n        <PageContainer>\n          <Skeleton className=\"h-7 w-24 mb-6\" />\n          <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4\">\n            {[1, 2, 3, 4, 5, 6].map(i => (\n              <div key={i} className=\"p-4 sm:p-6 border border-border rounded-lg\">\n                <Skeleton className=\"h-4 w-16\" />\n                <Skeleton className=\"h-8 w-12 mt-2\" />\n              </div>\n            ))}\n          </div>\n        </PageContainer>\n      )\n    }\n\n    return (\n      <PageContainer>\n        <h2 className=\"text-lg font-semibold pb-3 mb-5 border-b border-border\">Settings</h2>\n        \n        <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4\">\n          {settingsLinks.map((item) => (\n            <button\n              key={item.path}\n              onClick={() => navigate(item.path)}\n              className=\"p-4 sm:p-6 border border-border rounded-lg text-left hover:bg-accent transition-colors\"\n            >\n              <p className=\"text-sm text-muted-foreground\">{item.label}</p>\n              {item.countKey ? (\n                <p className=\"text-2xl font-bold mt-1\">{counts[item.countKey] ?? 0}</p>\n              ) : (\n                <p className=\"text-sm text-muted-foreground mt-1\">Configure </p>\n              )}\n            </button>\n          ))}\n        </div>\n      </PageContainer>\n    )\n  }\n\n  // Sub-pages - each component renders its own header\n  const pageName = subPath.slice(1) // Remove leading /\n  \n  // Handle revision detail page: /revisions/:id\n  const revisionDetailMatch = pageName.match(/^revisions\\/(.+)$/)\n  \n  return (\n    <PageContainer>\n      {pageName === 'general' && <GeneralSettings />}\n      {pageName === 'users' && <UsersSettings />}\n      {pageName === 'ai' && <AISettings />}\n      {pageName === 'tags' && <TagsSettings />}\n      {pageName === 'topics' && <TopicsSettings />}\n      {pageName === 'integrations' && <IntegrationsSettings />}\n      {pageName === 'posts' && <PostsSettings />}\n      {pageName === 'revisions' && <RevisionsSettings />}\n      {revisionDetailMatch && <RevisionDetail revisionId={revisionDetailMatch[1]} />}\n      {pageName === 'comments' && <CommentsSettings />}\n    </PageContainer>\n  )\n}\n\n// Re-export types for external use\nexport * from './types'\n\n// Re-export CollapsibleTemplate for use in AI settings\nexport { CollapsibleTemplate }\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { MoreVertical } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\nimport type { User } from './types'\n\nexport function UsersSettings() {\n  const { apiBasePath } = useDashboardContext()\n  const [users, setUsers] = useState<User[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showForm, setShowForm] = useState(false)\n  const [editingUser, setEditingUser] = useState<User | null>(null)\n  const [formEmail, setFormEmail] = useState('')\n  const [formName, setFormName] = useState('')\n  const [formRole, setFormRole] = useState('writer')\n  const [formError, setFormError] = useState('')\n  const [saving, setSaving] = useState(false)\n  const [menuOpen, setMenuOpen] = useState<string | null>(null)\n\n  useEffect(() => {\n    fetch(`${apiBasePath}/users`)\n      .then(res => res.ok ? res.json() : Promise.reject())\n      .then(res => { setUsers(res.data || []); setLoading(false) })\n      .catch(() => setLoading(false))\n  }, [apiBasePath])\n\n  function resetForm() {\n    setFormEmail('')\n    setFormName('')\n    setFormRole('writer')\n    setFormError('')\n    setEditingUser(null)\n  }\n\n  function openNewForm() {\n    resetForm()\n    setShowForm(true)\n  }\n\n  function openEditForm(user: User) {\n    setEditingUser(user)\n    setFormEmail(user.email)\n    setFormName(user.name || '')\n    setFormRole(user.role)\n    setFormError('')\n    setShowForm(true)\n  }\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault()\n    if (!formEmail) return\n    setSaving(true)\n    setFormError('')\n\n    const url = editingUser ? `${apiBasePath}/users/${editingUser.id}` : `${apiBasePath}/users`\n    const method = editingUser ? 'PATCH' : 'POST'\n\n    const res = await fetch(url, {\n      method,\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ email: formEmail, name: formName || null, role: formRole }),\n    })\n\n    if (res.ok) {\n      const json = await res.json()\n      if (editingUser) {\n        setUsers(users.map(u => u.id === editingUser.id ? json.data : u))\n      } else {\n        setUsers([json.data, ...users])\n      }\n      setShowForm(false)\n      resetForm()\n    } else {\n      const result = await res.json().catch(() => ({}))\n      setFormError(result.error || `Failed to ${editingUser ? 'update' : 'create'} user`)\n    }\n    setSaving(false)\n  }\n\n  async function handleDeleteUser(id: string, email: string) {\n    if (!confirm(`Delete user \"${email}\"?`)) return\n    const res = await fetch(`${apiBasePath}/users/${id}`, { method: 'DELETE' })\n    if (res.ok) setUsers(users.filter(u => u.id !== id))\n    setMenuOpen(null)\n  }\n\n  function getRoleBadgeClasses(role: string) {\n    if (role === 'admin') return 'bg-primary text-primary-foreground'\n    if (role === 'drafter') return 'border border-border text-foreground'\n    return 'bg-secondary text-secondary-foreground'\n  }\n\n  if (loading) return <Skeleton className=\"h-32\" />\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Add/Edit Form - shown as separate view like old interface */}\n      {showForm ? (\n        <div className=\"max-w-md\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h2 className=\"text-lg font-semibold\">{editingUser ? 'Edit User' : 'Add User'}</h2>\n          </div>\n\n          {formError && (\n            <div className=\"bg-destructive/10 text-destructive p-3 rounded-lg text-sm mb-4\">\n              {formError}\n            </div>\n          )}\n\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <label htmlFor=\"email\" className=\"block text-sm font-medium\">Email *</label>\n              <input\n                type=\"email\"\n                id=\"email\"\n                value={formEmail}\n                onChange={e => setFormEmail(e.target.value)}\n                required\n                placeholder={editingUser ? undefined : 'user@example.com'}\n                className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <label htmlFor=\"name\" className=\"block text-sm font-medium\">Name</label>\n              <input\n                type=\"text\"\n                id=\"name\"\n                value={formName}\n                onChange={e => setFormName(e.target.value)}\n                placeholder={editingUser ? undefined : 'John Doe'}\n                className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <label htmlFor=\"role\" className=\"block text-sm font-medium\">Role</label>\n              <select\n                id=\"role\"\n                value={formRole}\n                onChange={e => setFormRole(e.target.value)}\n                className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent\"\n              >\n                <option value=\"drafter\">Drafter</option>\n                <option value=\"writer\">Writer</option>\n                <option value=\"admin\">Admin</option>\n              </select>\n            </div>\n\n            <div className=\"flex gap-4 pt-2\">\n              <button type=\"submit\" disabled={saving} className=\"px-4 py-2 bg-primary text-primary-foreground rounded-md disabled:opacity-50\">\n                {saving ? (editingUser ? 'Saving...' : 'Creating...') : (editingUser ? 'Save Changes' : 'Create User')}\n              </button>\n              <button type=\"button\" onClick={() => { setShowForm(false); resetForm() }} className=\"px-4 py-2 text-muted-foreground hover:text-foreground\">\n                Cancel\n              </button>\n            </div>\n          </form>\n        </div>\n      ) : (\n        <>\n          {/* Header */}\n          <div className=\"flex items-center justify-between\">\n            <h2 className=\"text-lg font-semibold\">Users</h2>\n            <button onClick={openNewForm} className=\"px-4 py-2 bg-primary text-primary-foreground rounded-md text-sm\">\n              Add User\n            </button>\n          </div>\n\n          {/* Desktop Table */}\n          <div className=\"hidden md:block rounded-md border border-border\">\n        <table className=\"w-full\">\n          <thead className=\"bg-muted/50\">\n            <tr>\n              <th className=\"px-4 py-3 text-left text-sm font-medium text-muted-foreground\">Email</th>\n              <th className=\"px-4 py-3 text-left text-sm font-medium text-muted-foreground\">Name</th>\n              <th className=\"px-4 py-3 text-left text-sm font-medium text-muted-foreground\">Role</th>\n              <th className=\"px-4 py-3 text-left text-sm font-medium text-muted-foreground\">Created</th>\n              <th className=\"px-4 py-3 text-right text-sm font-medium text-muted-foreground\">Actions</th>\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-border\">\n            {users.map(user => (\n              <tr key={user.id}>\n                <td className=\"px-4 py-3 text-sm max-w-[250px] truncate\">{user.email}</td>\n                <td className=\"px-4 py-3 text-sm text-muted-foreground max-w-[150px] truncate\">{user.name || ''}</td>\n                <td className=\"px-4 py-3 text-sm\">\n                  <span className={`inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold ${getRoleBadgeClasses(user.role)}`}>\n                    {user.role}\n                  </span>\n                </td>\n                <td className=\"px-4 py-3 text-sm text-muted-foreground\">{new Date(user.createdAt).toLocaleDateString()}</td>\n                <td className=\"px-4 py-3 text-right\">\n                  <div className=\"relative inline-block\">\n                    <button\n                      onClick={() => setMenuOpen(menuOpen === user.id ? null : user.id)}\n                      className=\"p-1.5 text-muted-foreground hover:text-foreground rounded hover:bg-accent\"\n                    >\n                      <MoreVertical className=\"h-4 w-4\" />\n                    </button>\n                    {menuOpen === user.id && (\n                      <div className=\"absolute right-0 top-full mt-1 bg-popover border border-border rounded-md shadow-md z-50 min-w-[100px] py-1\">\n                        <button\n                          onClick={() => { openEditForm(user); setMenuOpen(null) }}\n                          className=\"w-full px-3 py-2 text-left text-sm hover:bg-accent\"\n                        >\n                          Edit\n                        </button>\n                        <div className=\"h-px bg-border my-1\" />\n                        <button\n                          onClick={() => handleDeleteUser(user.id, user.email)}\n                          className=\"w-full px-3 py-2 text-left text-sm text-red-500 hover:bg-accent\"\n                        >\n                          Delete\n                        </button>\n                      </div>\n                    )}\n                  </div>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n        {users.length === 0 && (\n          <p className=\"p-8 text-center text-muted-foreground\">No users yet. Add one to get started.</p>\n        )}\n      </div>\n\n      {/* Mobile List */}\n      <div className=\"md:hidden divide-y divide-border rounded-md border border-border bg-background\">\n        {users.map(user => (\n          <div key={user.id} className=\"flex items-center justify-between gap-4 px-4 py-5\">\n            <div className=\"min-w-0 flex-1 space-y-1.5\">\n              <div className=\"flex items-center gap-2\">\n                <span className=\"font-medium truncate\">{user.email}</span>\n                <span className={`inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold ${getRoleBadgeClasses(user.role)}`}>\n                  {user.role}\n                </span>\n              </div>\n              <p className=\"text-sm text-muted-foreground truncate\">\n                {user.name || 'No name'}  Created {new Date(user.createdAt).toLocaleDateString()}\n              </p>\n            </div>\n            <div className=\"relative\">\n              <button\n                onClick={() => setMenuOpen(menuOpen === user.id ? null : user.id)}\n                className=\"p-1.5 text-muted-foreground hover:text-foreground rounded hover:bg-accent\"\n              >\n                <MoreVertical className=\"h-4 w-4\" />\n              </button>\n              {menuOpen === user.id && (\n                <div className=\"absolute right-0 top-full mt-1 bg-popover border border-border rounded-md shadow-md z-50 min-w-[100px] py-1\">\n                  <button\n                    onClick={() => { openEditForm(user); setMenuOpen(null) }}\n                    className=\"w-full px-3 py-2 text-left text-sm hover:bg-accent\"\n                  >\n                    Edit\n                  </button>\n                  <div className=\"h-px bg-border my-1\" />\n                  <button\n                    onClick={() => handleDeleteUser(user.id, user.email)}\n                    className=\"w-full px-3 py-2 text-left text-sm text-red-500 hover:bg-accent\"\n                  >\n                    Delete\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n        ))}\n          {users.length === 0 && (\n            <p className=\"p-8 text-center text-muted-foreground\">No users yet. Add one to get started.</p>\n          )}\n        </div>\n        </>\n      )}\n    </div>\n  )\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { Loader2 } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\n\nexport function GeneralSettings() {\n  const { apiBasePath, sharedData, refetchSharedData } = useDashboardContext()\n  const [postUrlPattern, setPostUrlPattern] = useState(sharedData?.settings?.postUrlPattern ?? '/e/{slug}')\n  const [saving, setSaving] = useState(false)\n  const [saved, setSaved] = useState(false)\n\n  async function handleSave() {\n    setSaving(true)\n    setSaved(false)\n    await fetch(`${apiBasePath}/settings`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ postUrlPattern }),\n    })\n    setSaving(false)\n    setSaved(true)\n    await refetchSharedData()\n    setTimeout(() => setSaved(false), 2000)\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h2 className=\"text-lg font-semibold\">General Settings</h2>\n        <p className=\"text-sm text-muted-foreground\">Configure site-wide settings.</p>\n      </div>\n\n      {/* Post URL Pattern Card */}\n      <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm\">\n        <div className=\"p-6 space-y-4\">\n          <div>\n            <h3 className=\"text-base font-medium\">Post URLs</h3>\n            <p className=\"text-sm text-muted-foreground\">Configure the URL pattern for published posts.</p>\n          </div>\n\n          <div className=\"space-y-2\">\n            <label htmlFor=\"postUrlPattern\" className=\"text-sm font-medium leading-none\">\n              URL Pattern\n            </label>\n            <input\n              id=\"postUrlPattern\"\n              type=\"text\"\n              value={postUrlPattern}\n              onChange={(e) => setPostUrlPattern(e.target.value)}\n              placeholder=\"/e/{slug}\"\n              className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n            />\n            <p className=\"text-sm text-muted-foreground\">\n              Use <code className=\"px-1 py-0.5 bg-muted rounded text-xs\">{'{slug}'}</code> as a placeholder for the post slug. Example: <code className=\"px-1 py-0.5 bg-muted rounded text-xs\">/blog/{'{slug}'}</code>\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* Save Button */}\n      <div className=\"flex items-center gap-3\">\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90 disabled:pointer-events-none disabled:opacity-50\"\n        >\n          {saving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n          {saving ? 'Saving...' : 'Save'}\n        </button>\n        {saved && (\n          <span className=\"text-sm text-ab-success\">\n            Saved!\n          </span>\n        )}\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Loader2 } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\n\nexport function IntegrationsSettings() {\n  const { apiBasePath, refetchSharedData } = useDashboardContext()\n  \n  // Prismic settings state\n  const [prismicEnabled, setPrismicEnabled] = useState(false)\n  const [prismicRepository, setPrismicRepository] = useState('')\n  const [prismicWriteToken, setPrismicWriteToken] = useState('')\n  const [prismicDocumentType, setPrismicDocumentType] = useState('autoblog')\n  const [prismicSyncMode, setPrismicSyncMode] = useState('stub')\n  const [prismicLocale, setPrismicLocale] = useState('en-us')\n  const [prismicAutoRename, setPrismicAutoRename] = useState(false)\n  const [hasWriteToken, setHasWriteToken] = useState(false)\n  const [hasEnvToken, setHasEnvToken] = useState(false)\n  const [configRepository, setConfigRepository] = useState<string | null>(null)\n  \n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [saved, setSaved] = useState(false)\n  const [error, setError] = useState('')\n\n  useEffect(() => {\n    fetch(`${apiBasePath}/settings/integrations`)\n      .then(res => res.ok ? res.json() : Promise.reject())\n      .then(res => {\n        const data = res.data?.prismic || {}\n        setPrismicEnabled(data.enabled ?? false)\n        setPrismicRepository(data.repository || data.configRepository || '')\n        setConfigRepository(data.configRepository ?? null)\n        setPrismicWriteToken(data.writeToken ?? '')\n        setPrismicDocumentType(data.documentType ?? 'autoblog')\n        setPrismicSyncMode(data.syncMode ?? 'stub')\n        setPrismicLocale(data.locale ?? 'en-us')\n        setPrismicAutoRename(data.autoRename ?? false)\n        setHasWriteToken(data.hasWriteToken ?? false)\n        setHasEnvToken(data.hasEnvToken ?? false)\n        setLoading(false)\n      })\n      .catch(() => setLoading(false))\n  }, [apiBasePath])\n\n  async function handleSave() {\n    setSaving(true)\n    setSaved(false)\n    setError('')\n\n    const res = await fetch(`${apiBasePath}/settings/integrations`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        prismicEnabled,\n        prismicRepository,\n        prismicWriteToken,\n        prismicDocumentType,\n        prismicSyncMode,\n        prismicLocale,\n        prismicAutoRename,\n      }),\n    })\n\n    if (!res.ok) {\n      const data = await res.json()\n      setError(data.error || 'Failed to save')\n      setSaving(false)\n      return\n    }\n\n    setSaving(false)\n    setSaved(true)\n    await refetchSharedData()\n    setTimeout(() => setSaved(false), 2000)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-7 w-32\" />\n        <div className=\"rounded-lg border bg-card p-6 space-y-4\">\n          <Skeleton className=\"h-5 w-24\" />\n          <Skeleton className=\"h-10 w-full\" />\n          <Skeleton className=\"h-10 w-full\" />\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h2 className=\"text-lg font-semibold\">CMS Integrations</h2>\n        <p className=\"text-sm text-muted-foreground\">Connect autoblogger to external CMS systems.</p>\n      </div>\n\n      {/* Prismic Integration Card */}\n      <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm\">\n        <div className=\"p-6 space-y-6\">\n          {/* Header with toggle */}\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-base font-medium\">Prismic</h3>\n              <p className=\"text-sm text-muted-foreground\">Sync posts to Prismic as stub documents.</p>\n            </div>\n            <button\n              onClick={() => setPrismicEnabled(!prismicEnabled)}\n              className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                prismicEnabled ? 'bg-foreground' : 'bg-muted'\n              }`}\n            >\n              <span\n                className={`inline-block h-4 w-4 transform rounded-full bg-background transition-transform ${\n                  prismicEnabled ? 'translate-x-6' : 'translate-x-1'\n                }`}\n              />\n            </button>\n          </div>\n\n          {/* Settings fields - only show if enabled */}\n          {prismicEnabled && (\n            <div className=\"space-y-4 pt-4 border-t border-border\">\n              {/* Repository */}\n              <div className=\"space-y-2\">\n                <label htmlFor=\"prismicRepository\" className=\"text-sm font-medium leading-none\">\n                  Repository Name\n                  {configRepository && prismicRepository === configRepository && (\n                    <span className=\"ml-2 text-xs font-normal text-ab-success\">\n                       From config\n                    </span>\n                  )}\n                </label>\n                <input\n                  id=\"prismicRepository\"\n                  type=\"text\"\n                  value={prismicRepository}\n                  onChange={(e) => setPrismicRepository(e.target.value)}\n                  placeholder={configRepository || \"my-repo\"}\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  {configRepository \n                    ? `Detected from your Prismic config. Change if needed.`\n                    : <>Your Prismic repository name (e.g., <code className=\"px-1 py-0.5 bg-muted rounded text-xs\">ordo-playground</code>)</>\n                  }\n                </p>\n              </div>\n\n              {/* Write Token */}\n              <div className=\"space-y-2\">\n                <label htmlFor=\"prismicWriteToken\" className=\"text-sm font-medium leading-none\">\n                  Write API Token\n                  {hasEnvToken && (\n                    <span className=\"ml-2 text-xs font-normal text-ab-success\">\n                       Using PRISMIC_WRITE_TOKEN from env\n                    </span>\n                  )}\n                </label>\n                <input\n                  id=\"prismicWriteToken\"\n                  type=\"password\"\n                  value={prismicWriteToken}\n                  onChange={(e) => setPrismicWriteToken(e.target.value)}\n                  placeholder={hasEnvToken ? 'Using env var (optional override)' : hasWriteToken ? '' : 'Enter token'}\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  {hasEnvToken \n                    ? 'Token detected from PRISMIC_WRITE_TOKEN environment variable. Leave blank to use it, or enter a different token to override.'\n                    : 'From Prismic Settings > API & Security > Repository Security'\n                  }\n                </p>\n              </div>\n\n              {/* Document Type */}\n              <div className=\"space-y-2\">\n                <label htmlFor=\"prismicDocumentType\" className=\"text-sm font-medium leading-none\">\n                  Document Type\n                </label>\n                <input\n                  id=\"prismicDocumentType\"\n                  type=\"text\"\n                  value={prismicDocumentType}\n                  onChange={(e) => setPrismicDocumentType(e.target.value)}\n                  placeholder=\"autoblog\"\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  The Prismic custom type to create for synced posts.\n                </p>\n              </div>\n\n              {/* Sync Mode */}\n              <div className=\"space-y-2\">\n                <label htmlFor=\"prismicSyncMode\" className=\"text-sm font-medium leading-none\">\n                  Sync Mode\n                </label>\n                <select\n                  id=\"prismicSyncMode\"\n                  value={prismicSyncMode}\n                  onChange={(e) => setPrismicSyncMode(e.target.value)}\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n                >\n                  <option value=\"stub\">Stub (minimal reference data)</option>\n                  <option value=\"full\">Full (sync all content)</option>\n                </select>\n                <p className=\"text-sm text-muted-foreground\">\n                  Stub mode creates minimal documents; content is fetched from autoblogger at render time.\n                </p>\n              </div>\n\n              {/* Locale */}\n              <div className=\"space-y-2\">\n                <label htmlFor=\"prismicLocale\" className=\"text-sm font-medium leading-none\">\n                  Locale\n                </label>\n                <input\n                  id=\"prismicLocale\"\n                  type=\"text\"\n                  value={prismicLocale}\n                  onChange={(e) => setPrismicLocale(e.target.value)}\n                  placeholder=\"en-us\"\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  The master locale for your Prismic repository.\n                </p>\n              </div>\n\n              {/* Auto-rename toggle */}\n              <div className=\"flex items-center justify-between pt-2\">\n                <div>\n                  <label htmlFor=\"prismicAutoRename\" className=\"text-sm font-medium leading-none\">\n                    Auto-update Document Name\n                  </label>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Automatically update the Prismic document display name from the post title when publishing.\n                  </p>\n                </div>\n                <button\n                  id=\"prismicAutoRename\"\n                  onClick={() => setPrismicAutoRename(!prismicAutoRename)}\n                  className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                    prismicAutoRename ? 'bg-foreground' : 'bg-muted'\n                  }`}\n                >\n                  <span\n                    className={`inline-block h-4 w-4 transform rounded-full bg-background transition-transform ${\n                      prismicAutoRename ? 'translate-x-6' : 'translate-x-1'\n                    }`}\n                  />\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Error message */}\n      {error && (\n        <div className=\"rounded-md bg-destructive/15 p-3 text-sm text-destructive\">\n          {error}\n        </div>\n      )}\n\n      {/* Save Button */}\n      <div className=\"flex items-center gap-3\">\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90 disabled:pointer-events-none disabled:opacity-50\"\n        >\n          {saving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n          {saving ? 'Saving...' : 'Save'}\n        </button>\n        {saved && (\n          <span className=\"text-sm text-ab-success\">\n            Saved!\n          </span>\n        )}\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\n\ninterface CommentWithDetails {\n  id: string\n  content: string\n  createdAt: string\n  resolved: boolean\n  deletedAt: string | null\n  parentId: string | null\n  post: { id: string; title: string; slug: string }\n  user: { name: string | null; email: string }\n}\n\nconst COMMENTS_PER_PAGE = 25\n\nexport function CommentsSettings() {\n  const { apiBasePath, navigate } = useDashboardContext()\n  const [comments, setComments] = useState<CommentWithDetails[]>([])\n  const [totalCount, setTotalCount] = useState(0)\n  const [loading, setLoading] = useState(true)\n  const [currentPage, setCurrentPage] = useState(1)\n  const [totalPages, setTotalPages] = useState(1)\n\n  useEffect(() => {\n    setLoading(true)\n    fetch(`${apiBasePath}/comments?page=${currentPage}&limit=${COMMENTS_PER_PAGE}`)\n      .then(res => res.ok ? res.json() : Promise.reject())\n      .then(res => {\n        setComments(res.data || [])\n        setTotalCount(res.total ?? res.data?.length ?? 0)\n        setTotalPages(res.totalPages || Math.ceil((res.total ?? res.data?.length ?? 0) / COMMENTS_PER_PAGE))\n        setLoading(false)\n      })\n      .catch(() => setLoading(false))\n  }, [apiBasePath, currentPage])\n\n  function getStatusBadge(comment: CommentWithDetails) {\n    const isDeleted = comment.deletedAt !== null\n    const isResolved = comment.resolved\n    \n    if (isDeleted) {\n      return { label: 'deleted', classes: 'bg-destructive text-destructive-foreground' }\n    }\n    if (isResolved) {\n      return { label: 'resolved', classes: 'bg-secondary text-secondary-foreground' }\n    }\n    return { label: 'active', classes: 'bg-primary text-primary-foreground' }\n  }\n\n  // Pagination component matching other settings pages\n  const PaginationControls = ({ position }: { position: 'top' | 'bottom' }) => {\n    if (totalPages <= 1) return null\n    \n    const getPageNumbers = () => {\n      const pages: (number | 'ellipsis-start' | 'ellipsis-end')[] = []\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) pages.push(i)\n      } else {\n        pages.push(1)\n        if (currentPage > 3) pages.push('ellipsis-start')\n        const start = Math.max(2, currentPage - 1)\n        const end = Math.min(totalPages - 1, currentPage + 1)\n        for (let i = start; i <= end; i++) {\n          if (!pages.includes(i)) pages.push(i)\n        }\n        if (currentPage < totalPages - 2) pages.push('ellipsis-end')\n        if (!pages.includes(totalPages)) pages.push(totalPages)\n      }\n      return pages\n    }\n\n    const spacingClass = position === 'bottom' ? 'mt-4' : ''\n    \n    return (\n      <nav role=\"navigation\" aria-label=\"pagination\" className={`mx-auto flex w-full justify-end ${spacingClass}`}>\n        <ul className=\"flex flex-row items-center gap-1\">\n          <li>\n            <button\n              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n              disabled={currentPage <= 1}\n              aria-label=\"Go to previous page\"\n              className=\"inline-flex items-center justify-center gap-1 whitespace-nowrap rounded-md text-sm font-medium h-9 px-2.5 hover:bg-accent hover:text-accent-foreground disabled:pointer-events-none disabled:opacity-50\"\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n              <span className=\"hidden sm:block\">Previous</span>\n            </button>\n          </li>\n          {getPageNumbers().map((page) => \n            typeof page === 'string' ? (\n              <li key={page}>\n                <span aria-hidden className=\"flex h-9 w-9 items-center justify-center\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </span>\n              </li>\n            ) : (\n              <li key={page}>\n                <button\n                  onClick={() => setCurrentPage(page)}\n                  aria-current={page === currentPage ? 'page' : undefined}\n                  className={`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-9 w-9 ${\n                    page === currentPage \n                      ? 'border border-input bg-background hover:bg-accent hover:text-accent-foreground' \n                      : 'hover:bg-accent hover:text-accent-foreground'\n                  }`}\n                >\n                  {page}\n                </button>\n              </li>\n            )\n          )}\n          <li>\n            <button\n              onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n              disabled={currentPage >= totalPages}\n              aria-label=\"Go to next page\"\n              className=\"inline-flex items-center justify-center gap-1 whitespace-nowrap rounded-md text-sm font-medium h-9 px-2.5 hover:bg-accent hover:text-accent-foreground disabled:pointer-events-none disabled:opacity-50\"\n            >\n              <span className=\"hidden sm:block\">Next</span>\n              <ChevronRight className=\"h-4 w-4\" />\n            </button>\n          </li>\n        </ul>\n      </nav>\n    )\n  }\n\n  if (loading && comments.length === 0) return <Skeleton className=\"h-32\" />\n\n  return (\n    <div>\n      {/* Header - matches AdminPageHeader pattern */}\n      <div className=\"flex items-end justify-between gap-4 mb-6 md:mb-8\">\n        <div className=\"shrink-0\">\n          <h1 className=\"text-lg font-bold\">Comments</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">{totalCount} total comment{totalCount !== 1 ? 's' : ''}</p>\n        </div>\n        <PaginationControls position=\"top\" />\n      </div>\n\n      {comments.length === 0 ? (\n        <div className=\"py-8 text-center text-muted-foreground\">No comments yet.</div>\n      ) : (\n        <>\n          {/* Desktop Table - matches AdminTable */}\n          <div className=\"hidden md:block rounded-md border\">\n            <table className=\"w-full caption-bottom text-sm\">\n              <thead className=\"[&_tr]:border-b\">\n                <tr className=\"border-b\">\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground max-w-[200px]\">Post</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Author</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground max-w-[300px]\">Comment</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Created</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Status</th>\n                  <th className=\"h-12 px-4 text-right align-middle font-medium text-muted-foreground\">Actions</th>\n                </tr>\n              </thead>\n              <tbody className=\"[&_tr:last-child]:border-0\">\n                {comments.map(comment => {\n                  const status = getStatusBadge(comment)\n                  const isReply = comment.parentId !== null\n                  const commentIdToOpen = comment.parentId || comment.id\n                  \n                  return (\n                    <tr key={comment.id} className=\"border-b\">\n                      <td className=\"p-4 align-middle\">\n                        <button\n                          onClick={() => navigate(`/editor/${comment.post.slug}`)}\n                          className=\"block truncate max-w-[200px] hover:underline text-left\"\n                        >\n                          {comment.post.title || 'Untitled'}\n                        </button>\n                      </td>\n                      <td className=\"p-4 align-middle text-muted-foreground\">\n                        {comment.user.name || comment.user.email}\n                      </td>\n                      <td className=\"p-4 align-middle\">\n                        <span className=\"block truncate max-w-[300px] text-muted-foreground\">\n                          {isReply && <span className=\"text-xs mr-1\"></span>}\n                          {comment.content.slice(0, 60)}{comment.content.length > 60 ? '...' : ''}\n                        </span>\n                      </td>\n                      <td className=\"p-4 align-middle text-muted-foreground\">\n                        {new Date(comment.createdAt).toLocaleString()}\n                      </td>\n                      <td className=\"p-4 align-middle\">\n                        <span className={`inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold ${status.classes}`}>\n                          {status.label}\n                        </span>\n                      </td>\n                      <td className=\"p-4 align-middle text-right\">\n                        <button\n                          onClick={() => navigate(`/editor/${comment.post.slug}?comment=${commentIdToOpen}`)}\n                          className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-8 px-3 hover:bg-accent text-muted-foreground hover:text-foreground\"\n                        >\n                          View\n                        </button>\n                      </td>\n                    </tr>\n                  )\n                })}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Mobile List - matches AdminTable mobile view */}\n          <div className=\"md:hidden divide-y rounded-md border bg-background\">\n            {comments.map(comment => {\n              const status = getStatusBadge(comment)\n              const isReply = comment.parentId !== null\n              const commentIdToOpen = comment.parentId || comment.id\n              \n              return (\n                <div key={comment.id} className=\"flex items-center justify-between gap-4 px-4 py-5\">\n                  <div className=\"min-w-0 flex-1 space-y-1.5\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium truncate\">\n                        {isReply && <span className=\"text-xs mr-1\"></span>}\n                        {comment.content.slice(0, 40)}{comment.content.length > 40 ? '...' : ''}\n                      </span>\n                      <span className={`inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold shrink-0 ${status.classes}`}>\n                        {status.label}\n                      </span>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground truncate\">\n                      {comment.user.name || comment.user.email}  {new Date(comment.createdAt).toLocaleDateString()}\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => navigate(`/editor/${comment.post.slug}?comment=${commentIdToOpen}`)}\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-8 px-3 hover:bg-accent text-muted-foreground hover:text-foreground shrink-0\"\n                  >\n                    View\n                  </button>\n                </div>\n              )\n            })}\n          </div>\n        </>\n      )}\n\n      {/* Bottom Pagination */}\n      <PaginationControls position=\"bottom\" />\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { ChevronDown, RotateCcw, Loader2 } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\nimport { CollapsibleTemplate } from './CollapsibleTemplate'\n\nexport function AISettings() {\n  const { apiBasePath, refetchSharedData } = useDashboardContext()\n  const [rules, setRules] = useState('')\n  const [chatRules, setChatRules] = useState('')\n  const [rewriteRules, setRewriteRules] = useState('')\n  const [autoDraftRules, setAutoDraftRules] = useState('')\n  const [planRules, setPlanRules] = useState('')\n  const [autoDraftWordCount, setAutoDraftWordCount] = useState(800)\n  const [autoDraftEnabled, setAutoDraftEnabled] = useState(false)\n  const [defaultModel, setDefaultModel] = useState('claude-sonnet')\n  const [models, setModels] = useState<{ id: string; name: string; description: string }[]>([])\n  const [generateTemplate, setGenerateTemplate] = useState<string | null>(null)\n  const [chatTemplate, setChatTemplate] = useState<string | null>(null)\n  const [rewriteTemplate, setRewriteTemplate] = useState<string | null>(null)\n  const [autoDraftTemplate, setAutoDraftTemplate] = useState<string | null>(null)\n  const [planTemplate, setPlanTemplate] = useState<string | null>(null)\n  const [expandPlanTemplate, setExpandPlanTemplate] = useState<string | null>(null)\n  const [agentTemplate, setAgentTemplate] = useState<string | null>(null)\n  const [defaultGenerateTemplate, setDefaultGenerateTemplate] = useState('')\n  const [defaultChatTemplate, setDefaultChatTemplate] = useState('')\n  const [defaultRewriteTemplate, setDefaultRewriteTemplate] = useState('')\n  const [defaultAutoDraftTemplate, setDefaultAutoDraftTemplate] = useState('')\n  const [defaultPlanRules, setDefaultPlanRules] = useState('')\n  const [defaultPlanTemplate, setDefaultPlanTemplate] = useState('')\n  const [defaultExpandPlanTemplate, setDefaultExpandPlanTemplate] = useState('')\n  const [defaultAgentTemplate, setDefaultAgentTemplate] = useState('')\n  const [anthropicKey, setAnthropicKey] = useState('')\n  const [openaiKey, setOpenaiKey] = useState('')\n  const [hasAnthropicEnvKey, setHasAnthropicEnvKey] = useState(false)\n  const [hasOpenaiEnvKey, setHasOpenaiEnvKey] = useState(false)\n  const [loading, setLoading] = useState(true)\n  const [saving, setSaving] = useState(false)\n  const [saved, setSaved] = useState(false)\n\n  useEffect(() => {\n    Promise.all([\n      fetch(`${apiBasePath}/ai/settings`).then(res => res.ok ? res.json() : Promise.reject()),\n      fetch(`${apiBasePath}/settings`).then(res => res.ok ? res.json() : Promise.reject()),\n    ])\n      .then(([aiRes, settingsRes]) => {\n        const data = aiRes.data || aiRes || {}\n        setRules(data.rules || '')\n        setChatRules(data.chatRules || '')\n        setRewriteRules(data.rewriteRules || '')\n        setAutoDraftRules(data.autoDraftRules || '')\n        setPlanRules(data.planRules || '')\n        setAutoDraftWordCount(data.autoDraftWordCount ?? 800)\n        setDefaultModel(data.defaultModel || 'claude-sonnet')\n        setModels(data.availableModels || [\n          { id: 'claude-sonnet', name: 'Sonnet 4.5', description: 'Fast, capable, best value' },\n          { id: 'claude-opus', name: 'Opus 4.5', description: 'Highest quality, slower' },\n          { id: 'gpt-5.2', name: 'GPT-5.2', description: 'Latest OpenAI flagship' },\n          { id: 'gpt-5-mini', name: 'GPT-5 Mini', description: 'Fast and cost-efficient' },\n        ])\n        setGenerateTemplate(data.generateTemplate ?? null)\n        setChatTemplate(data.chatTemplate ?? null)\n        setRewriteTemplate(data.rewriteTemplate ?? null)\n        setAutoDraftTemplate(data.autoDraftTemplate ?? null)\n        setPlanTemplate(data.planTemplate ?? null)\n        setExpandPlanTemplate(data.expandPlanTemplate ?? null)\n        setAgentTemplate(data.agentTemplate ?? null)\n        setDefaultGenerateTemplate(data.defaultGenerateTemplate || '')\n        setDefaultChatTemplate(data.defaultChatTemplate || '')\n        setDefaultRewriteTemplate(data.defaultRewriteTemplate || '')\n        setDefaultAutoDraftTemplate(data.defaultAutoDraftTemplate || '')\n        setDefaultPlanRules(data.defaultPlanRules || '')\n        setDefaultPlanTemplate(data.defaultPlanTemplate || '')\n        setDefaultExpandPlanTemplate(data.defaultExpandPlanTemplate || '')\n        setDefaultAgentTemplate(data.defaultAgentTemplate || '')\n        setAnthropicKey(data.anthropicKey || '')\n        setOpenaiKey(data.openaiKey || '')\n        setHasAnthropicEnvKey(data.hasAnthropicEnvKey ?? false)\n        setHasOpenaiEnvKey(data.hasOpenaiEnvKey ?? false)\n        setAutoDraftEnabled(settingsRes.data?.autoDraftEnabled ?? false)\n        setLoading(false)\n      })\n      .catch(() => setLoading(false))\n  }, [apiBasePath])\n\n  async function handleSave() {\n    setSaving(true)\n    setSaved(false)\n    await Promise.all([\n      fetch(`${apiBasePath}/ai/settings`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          rules, chatRules, rewriteRules, autoDraftRules, planRules, autoDraftWordCount, defaultModel,\n          generateTemplate, chatTemplate, rewriteTemplate, autoDraftTemplate, planTemplate, expandPlanTemplate, agentTemplate,\n          anthropicKey: anthropicKey || null,\n          openaiKey: openaiKey || null,\n        }),\n      }),\n      fetch(`${apiBasePath}/settings`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ autoDraftEnabled }),\n      }),\n    ])\n    setSaving(false)\n    setSaved(true)\n    await refetchSharedData()\n    setTimeout(() => setSaved(false), 2000)\n  }\n\n  if (loading) return <Skeleton className=\"h-32\" />\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h2 className=\"text-lg font-semibold\">AI Settings</h2>\n        <p className=\"text-sm text-muted-foreground\">Configure your AI writing assistant.</p>\n      </div>\n\n      {/* Section 1: Models */}\n      <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm\">\n        <div className=\"p-6 space-y-6\">\n          <div>\n            <h3 className=\"text-base font-medium\">Models</h3>\n            <p className=\"text-sm text-muted-foreground\">API keys and model configuration.</p>\n          </div>\n\n          <div className=\"grid gap-4 sm:grid-cols-2\">\n            <div className=\"space-y-2\">\n              <label htmlFor=\"anthropicKey\" className=\"text-sm font-medium leading-none\">Anthropic API Key</label>\n              {hasAnthropicEnvKey && !anthropicKey ? (\n                <div className=\"flex h-10 w-full items-center rounded-md border border-input bg-muted/50 px-3 py-2 text-sm\">\n                  <span className=\"text-muted-foreground\"></span>\n                  <span className=\"ml-2 text-xs text-ab-success\">(from environment)</span>\n                </div>\n              ) : (\n                <input\n                  id=\"anthropicKey\"\n                  type=\"password\"\n                  value={anthropicKey}\n                  onChange={e => setAnthropicKey(e.target.value)}\n                  placeholder={hasAnthropicEnvKey ? \"Override env variable...\" : \"sk-ant-...\"}\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 font-mono\"\n                  disabled={saving}\n                />\n              )}\n              <p className=\"text-xs text-muted-foreground\">\n                {hasAnthropicEnvKey && !anthropicKey \n                  ? 'Using ANTHROPIC_API_KEY from environment. Enter a value above to override.' \n                  : 'Required for Claude models (Sonnet, Opus)'}\n              </p>\n            </div>\n            <div className=\"space-y-2\">\n              <label htmlFor=\"openaiKey\" className=\"text-sm font-medium leading-none\">OpenAI API Key</label>\n              {hasOpenaiEnvKey && !openaiKey ? (\n                <div className=\"flex h-10 w-full items-center rounded-md border border-input bg-muted/50 px-3 py-2 text-sm\">\n                  <span className=\"text-muted-foreground\"></span>\n                  <span className=\"ml-2 text-xs text-ab-success\">(from environment)</span>\n                </div>\n              ) : (\n                <input\n                  id=\"openaiKey\"\n                  type=\"password\"\n                  value={openaiKey}\n                  onChange={e => setOpenaiKey(e.target.value)}\n                  placeholder={hasOpenaiEnvKey ? \"Override env variable...\" : \"sk-...\"}\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 font-mono\"\n                  disabled={saving}\n                />\n              )}\n              <p className=\"text-xs text-muted-foreground\">\n                {hasOpenaiEnvKey && !openaiKey \n                  ? 'Using OPENAI_API_KEY from environment. Enter a value above to override.' \n                  : 'Required for GPT models'}\n              </p>\n            </div>\n          </div>\n\n          <div className=\"flex items-center gap-4\">\n            <label className=\"text-sm font-medium leading-none shrink-0\">Default Model</label>\n            <div className=\"relative max-w-sm flex-1\">\n              <select\n                value={defaultModel}\n                onChange={e => setDefaultModel(e.target.value)}\n                className=\"h-10 w-full appearance-none rounded-md border border-input bg-background pl-3 pr-10 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 cursor-pointer\"\n              >\n                {models.map(model => (\n                  <option key={model.id} value={model.id}>{model.name}  {model.description}</option>\n                ))}\n              </select>\n              <ChevronDown className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 opacity-50 pointer-events-none\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Section 2: Prompts */}\n      <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm\">\n        <div className=\"p-6 space-y-6\">\n          <div>\n            <h3 className=\"text-base font-medium\">Prompts</h3>\n            <p className=\"text-sm text-muted-foreground\">Rules and templates for AI-generated content.</p>\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium leading-none\">Essay Writing Rules</label>\n            <p className=\"text-sm text-muted-foreground\">\n              Style and format rules for generated essays. Applied when generating or rewriting content.\n            </p>\n            <textarea\n              value={rules}\n              onChange={e => setRules(e.target.value)}\n              placeholder={`- Never use \"utilize\"  always say \"use\"\n- Avoid passive voice\n- Start with concrete scenes, not abstractions\n- Short paragraphs (3-4 sentences max)\n- Use em-dashes sparingly\n- End with forward motion, not tidy conclusions`}\n              className=\"flex min-h-[180px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 font-mono resize-none\"\n              disabled={saving}\n            />\n            <CollapsibleTemplate\n              label=\"Generate\"\n              value={generateTemplate}\n              defaultValue={defaultGenerateTemplate}\n              onChange={setGenerateTemplate}\n              onReset={() => setGenerateTemplate(null)}\n              placeholders=\"{{RULES}}, {{STYLE_EXAMPLES}}\"\n              disabled={saving}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium leading-none\">Chat Behavior Rules</label>\n            <p className=\"text-sm text-muted-foreground\">\n              How the assistant should behave during brainstorming conversations.\n            </p>\n            <textarea\n              value={chatRules}\n              onChange={e => setChatRules(e.target.value)}\n              placeholder={`- Be direct and concise\n- Push back on vague ideas\n- Ask clarifying questions before drafting\n- Challenge my assumptions`}\n              className=\"flex min-h-[140px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 font-mono resize-none\"\n              disabled={saving}\n            />\n            <CollapsibleTemplate\n              label=\"Chat\"\n              value={chatTemplate}\n              defaultValue={defaultChatTemplate}\n              onChange={setChatTemplate}\n              onReset={() => setChatTemplate(null)}\n              placeholders=\"{{RULES}}, {{CHAT_RULES}}, {{STYLE_EXAMPLES}}\"\n              disabled={saving}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium leading-none\">Rewrite Rules</label>\n            <p className=\"text-sm text-muted-foreground\">\n              Rules for cleaning up selected text with the rewrite tool.\n            </p>\n            <textarea\n              value={rewriteRules}\n              onChange={e => setRewriteRules(e.target.value)}\n              placeholder={`- Keep the same meaning, improve clarity\n- Maintain sentence length variety\n- Remove filler words\n- Don't add new ideas`}\n              className=\"flex min-h-[140px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 font-mono resize-none\"\n              disabled={saving}\n            />\n            <CollapsibleTemplate\n              label=\"Rewrite\"\n              value={rewriteTemplate}\n              defaultValue={defaultRewriteTemplate}\n              onChange={setRewriteTemplate}\n              onReset={() => setRewriteTemplate(null)}\n              placeholders=\"{{RULES}}, {{REWRITE_RULES}}, {{STYLE_EXAMPLES}}\"\n              disabled={saving}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium leading-none\">Auto-Draft Rules</label>\n            <p className=\"text-sm text-muted-foreground\">\n              Rules for generating essays from news articles via RSS feeds.\n            </p>\n            <textarea\n              value={autoDraftRules}\n              onChange={e => setAutoDraftRules(e.target.value)}\n              placeholder={`- Write original perspectives, don't summarize\n- Take a contrarian angle when appropriate\n- Include personal insights and experiences\n- Focus on implications, not just facts`}\n              className=\"flex min-h-[140px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 font-mono resize-none\"\n              disabled={saving}\n            />\n            <div className=\"flex items-center gap-4 pt-2\">\n              <div className=\"flex items-center gap-2\">\n                <label className=\"text-sm whitespace-nowrap\">Target word count:</label>\n                <input\n                  type=\"number\"\n                  min={200}\n                  max={3000}\n                  value={autoDraftWordCount}\n                  onChange={e => setAutoDraftWordCount(parseInt(e.target.value) || 800)}\n                  className=\"flex h-10 w-24 rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n                  disabled={saving}\n                />\n              </div>\n            </div>\n            <CollapsibleTemplate\n              label=\"Auto-Draft\"\n              value={autoDraftTemplate}\n              defaultValue={defaultAutoDraftTemplate}\n              onChange={setAutoDraftTemplate}\n              onReset={() => setAutoDraftTemplate(null)}\n              placeholders=\"{{AUTO_DRAFT_RULES}}, {{AUTO_DRAFT_WORD_COUNT}}, {{RULES}}, {{STYLE_EXAMPLES}}, {{TOPIC_NAME}}, {{ARTICLE_TITLE}}, {{ARTICLE_SUMMARY}}, {{ARTICLE_URL}}\"\n              disabled={saving}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium leading-none\">Plan Format Rules</label>\n            <p className=\"text-sm text-muted-foreground\">\n              Rules for essay plan structure and format in Plan mode.\n            </p>\n            <div className=\"flex items-center justify-end\">\n              {planRules && (\n                <button\n                  type=\"button\"\n                  onClick={() => setPlanRules('')}\n                  className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-7 px-2 hover:bg-accent hover:text-accent-foreground\"\n                >\n                  <RotateCcw className=\"h-3 w-3 mr-1\" />\n                  Reset to default\n                </button>\n              )}\n            </div>\n            <textarea\n              value={planRules || defaultPlanRules}\n              onChange={e => setPlanRules(e.target.value)}\n              className=\"flex min-h-[250px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 font-mono resize-none\"\n              disabled={saving}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium leading-none\">Plan Mode Template</label>\n            <p className=\"text-sm text-muted-foreground\">\n              Prompt template for Plan mode in chat.\n            </p>\n            <CollapsibleTemplate\n              label=\"Plan\"\n              value={planTemplate}\n              defaultValue={defaultPlanTemplate}\n              onChange={setPlanTemplate}\n              onReset={() => setPlanTemplate(null)}\n              placeholders=\"{{PLAN_RULES}}, {{STYLE_EXAMPLES}}\"\n              disabled={saving}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium leading-none\">Expand Plan Template</label>\n            <p className=\"text-sm text-muted-foreground\">\n              Prompt template for expanding a plan into a full essay.\n            </p>\n            <CollapsibleTemplate\n              label=\"Expand Plan\"\n              value={expandPlanTemplate}\n              defaultValue={defaultExpandPlanTemplate}\n              onChange={setExpandPlanTemplate}\n              onReset={() => setExpandPlanTemplate(null)}\n              placeholders=\"{{RULES}}, {{STYLE_EXAMPLES}}, {{PLAN}}\"\n              disabled={saving}\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium leading-none\">Agent Mode Template</label>\n            <p className=\"text-sm text-muted-foreground\">\n              Instructions for Agent mode in chat.\n            </p>\n            <CollapsibleTemplate\n              label=\"Agent\"\n              value={agentTemplate}\n              defaultValue={defaultAgentTemplate}\n              onChange={setAgentTemplate}\n              onReset={() => setAgentTemplate(null)}\n              placeholders=\"(no placeholders - appended to chat prompt)\"\n              disabled={saving}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Section 3: Features */}\n      <div className=\"rounded-lg border bg-card text-card-foreground shadow-sm\">\n        <div className=\"p-6 space-y-6\">\n          <div>\n            <h3 className=\"text-base font-medium\">Features</h3>\n            <p className=\"text-sm text-muted-foreground\">Enable or disable AI features.</p>\n          </div>\n\n          <div className=\"flex items-center justify-between\">\n            <div className=\"space-y-0.5\">\n              <label className=\"text-sm font-medium leading-none\">Auto-Draft</label>\n              <p className=\"text-sm text-muted-foreground\">\n                Enable RSS topic subscriptions and automatic draft generation.\n              </p>\n            </div>\n            <button\n              type=\"button\"\n              role=\"switch\"\n              aria-checked={autoDraftEnabled}\n              onClick={() => setAutoDraftEnabled(!autoDraftEnabled)}\n              className={`relative inline-flex h-6 w-11 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background ${autoDraftEnabled ? 'bg-foreground' : 'bg-input'}`}\n            >\n              <span\n                className={`pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform ${autoDraftEnabled ? 'translate-x-5' : 'translate-x-0'}`}\n              />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Save Button */}\n      <div className=\"flex items-center gap-3\">\n        <button\n          onClick={handleSave}\n          disabled={saving}\n          className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90 disabled:pointer-events-none disabled:opacity-50\"\n        >\n          {saving && <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />}\n          {saving ? 'Saving...' : 'Save'}\n        </button>\n        {saved && (\n          <span className=\"text-sm text-ab-success\">\n            Saved!\n          </span>\n        )}\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { ChevronDown, RotateCcw } from 'lucide-react'\n\ninterface CollapsibleTemplateProps {\n  label: string\n  value: string | null\n  defaultValue: string\n  onChange: (v: string) => void\n  onReset: () => void\n  placeholders: string\n  disabled?: boolean\n}\n\nexport function CollapsibleTemplate({ \n  label, \n  value, \n  defaultValue, \n  onChange, \n  onReset, \n  placeholders, \n  disabled \n}: CollapsibleTemplateProps) {\n  const [open, setOpen] = useState(false)\n  const isCustom = value !== null\n  const displayValue = value ?? defaultValue\n\n  return (\n    <div className=\"mt-2\">\n      <button\n        type=\"button\"\n        onClick={() => setOpen(!open)}\n        className=\"flex items-center gap-1 text-sm text-muted-foreground hover:text-foreground\"\n      >\n        <ChevronDown className={`h-4 w-4 transition-transform ${open ? '' : '-rotate-90'}`} />\n        {isCustom ? `Edit prompt template (customized)` : `Edit prompt template`}\n      </button>\n      {open && (\n        <div className=\"mt-2 space-y-2\">\n          <div className=\"flex items-center justify-between\">\n            <p className=\"text-xs text-muted-foreground\">Placeholders: {placeholders}</p>\n            {isCustom && (\n              <button type=\"button\" onClick={onReset} className=\"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground\">\n                <RotateCcw className=\"h-3 w-3\" /> Reset to default\n              </button>\n            )}\n          </div>\n          <textarea\n            value={displayValue}\n            onChange={e => onChange(e.target.value)}\n            rows={10}\n            className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent resize-none font-mono text-xs\"\n            disabled={disabled}\n          />\n        </div>\n      )}\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { MoreVertical } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\nimport type { Tag } from './types'\n\nexport function TagsSettings() {\n  const { apiBasePath } = useDashboardContext()\n  const [tags, setTags] = useState<Tag[]>([])\n  const [loading, setLoading] = useState(true)\n  const [dialogOpen, setDialogOpen] = useState(false)\n  const [editingTag, setEditingTag] = useState<Tag | null>(null)\n  const [tagName, setTagName] = useState('')\n  const [saving, setSaving] = useState(false)\n  const [error, setError] = useState('')\n  const [menuOpen, setMenuOpen] = useState<string | null>(null)\n\n  useEffect(() => {\n    fetchTags()\n  }, [apiBasePath])\n\n  async function fetchTags() {\n    const res = await fetch(`${apiBasePath}/tags`)\n    if (res.ok) {\n      const json = await res.json()\n      setTags(json.data || [])\n    }\n    setLoading(false)\n  }\n\n  function openCreateDialog() {\n    setEditingTag(null)\n    setTagName('')\n    setError('')\n    setDialogOpen(true)\n  }\n\n  function openEditDialog(tag: Tag) {\n    setEditingTag(tag)\n    setTagName(tag.name)\n    setError('')\n    setDialogOpen(true)\n    setMenuOpen(null)\n  }\n\n  async function handleDelete(tag: Tag) {\n    if (!confirm(`Delete tag \"${tag.name}\"? This will remove it from all posts.`)) return\n    const res = await fetch(`${apiBasePath}/tags/${tag.id}`, { method: 'DELETE' })\n    if (res.ok) {\n      fetchTags()\n    }\n    setMenuOpen(null)\n  }\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault()\n    if (!tagName.trim()) {\n      setError('Tag name is required')\n      return\n    }\n\n    setSaving(true)\n    setError('')\n\n    const url = editingTag\n      ? `${apiBasePath}/tags/${editingTag.id}`\n      : `${apiBasePath}/tags`\n    const method = editingTag ? 'PATCH' : 'POST'\n\n    const res = await fetch(url, {\n      method,\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ name: tagName.trim() }),\n    })\n\n    if (res.ok) {\n      setDialogOpen(false)\n      fetchTags()\n    } else {\n      const data = await res.json().catch(() => ({}))\n      setError(data.error || 'Failed to save tag')\n    }\n\n    setSaving(false)\n  }\n\n  if (loading) return <Skeleton className=\"h-32\" />\n\n  return (\n    <div>\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6 md:mb-8\">\n        <h2 className=\"text-lg font-semibold\">Tags</h2>\n        <button\n          onClick={openCreateDialog}\n          className=\"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90\"\n        >\n          Add Tag\n        </button>\n      </div>\n\n      {tags.length === 0 ? (\n        <div className=\"py-8 text-center text-muted-foreground\">No tags yet. Create one to get started.</div>\n      ) : (\n        <>\n          {/* Desktop Table */}\n          <div className=\"hidden md:block rounded-md border\">\n            <table className=\"w-full caption-bottom text-sm\">\n              <thead className=\"[&_tr]:border-b\">\n                <tr className=\"border-b\">\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Name</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Posts</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Created</th>\n                  <th className=\"h-12 px-4 text-right align-middle font-medium text-muted-foreground\">Actions</th>\n                </tr>\n              </thead>\n              <tbody className=\"[&_tr:last-child]:border-0\">\n                {tags.map(tag => (\n                  <tr key={tag.id} className=\"border-b\">\n                    <td className=\"p-4 align-middle\">\n                      <span className=\"block truncate max-w-[250px]\">{tag.name}</span>\n                    </td>\n                    <td className=\"p-4 align-middle text-muted-foreground\">{tag._count?.posts ?? 0}</td>\n                    <td className=\"p-4 align-middle text-muted-foreground\">\n                      {tag.createdAt ? new Date(tag.createdAt).toLocaleDateString() : ''}\n                    </td>\n                    <td className=\"p-4 align-middle text-right\">\n                      <div className=\"relative inline-block\">\n                        <button\n                          onClick={() => setMenuOpen(menuOpen === tag.id ? null : tag.id)}\n                          className=\"inline-flex items-center justify-center rounded-md h-8 w-8 hover:bg-accent text-muted-foreground\"\n                        >\n                          <MoreVertical className=\"h-4 w-4\" />\n                        </button>\n                        {menuOpen === tag.id && (\n                          <div className=\"absolute right-0 top-full mt-1 bg-popover border border-border rounded-md shadow-md z-50 min-w-[8rem] py-1\">\n                            <button\n                              onClick={() => openEditDialog(tag)}\n                              className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left hover:bg-accent\"\n                            >\n                              Edit\n                            </button>\n                            <div className=\"-mx-1 my-1 h-px bg-muted\" />\n                            <button\n                              onClick={() => handleDelete(tag)}\n                              className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left text-destructive hover:bg-accent\"\n                            >\n                              Delete\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n\n          {/* Mobile List */}\n          <div className=\"md:hidden divide-y rounded-md border bg-background\">\n            {tags.map(tag => (\n              <div key={tag.id} className=\"flex items-center justify-between gap-4 px-4 py-5\">\n                <div className=\"min-w-0 flex-1 space-y-1.5\">\n                  <span className=\"font-medium truncate block\">{tag.name}</span>\n                  <p className=\"text-sm text-muted-foreground truncate\">\n                    {tag._count?.posts ?? 0} posts  Created {tag.createdAt ? new Date(tag.createdAt).toLocaleDateString() : ''}\n                  </p>\n                </div>\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setMenuOpen(menuOpen === tag.id ? null : tag.id)}\n                    className=\"inline-flex items-center justify-center rounded-md h-8 w-8 hover:bg-accent text-muted-foreground\"\n                  >\n                    <MoreVertical className=\"h-4 w-4\" />\n                  </button>\n                  {menuOpen === tag.id && (\n                    <div className=\"absolute right-0 top-full mt-1 bg-popover border border-border rounded-md shadow-md z-50 min-w-[8rem] py-1\">\n                      <button\n                        onClick={() => openEditDialog(tag)}\n                        className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left hover:bg-accent\"\n                      >\n                        Edit\n                      </button>\n                      <div className=\"-mx-1 my-1 h-px bg-muted\" />\n                      <button\n                        onClick={() => handleDelete(tag)}\n                        className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left text-destructive hover:bg-accent\"\n                      >\n                        Delete\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </>\n      )}\n\n      {/* Dialog for Create/Edit */}\n      {dialogOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n          <div \n            className=\"fixed inset-0 bg-black/80\" \n            onClick={() => setDialogOpen(false)}\n          />\n          <div className=\"relative z-50 w-full max-w-sm bg-background border border-border rounded-lg shadow-lg\">\n            <div className=\"flex flex-col space-y-1.5 p-6\">\n              <h3 className=\"text-lg font-semibold leading-none tracking-tight\">\n                {editingTag ? 'Edit Tag' : 'Create Tag'}\n              </h3>\n            </div>\n            <form onSubmit={handleSubmit}>\n              <div className=\"px-6 pb-4\">\n                <div className=\"space-y-2\">\n                  <label htmlFor=\"tagName\" className=\"text-sm font-medium leading-none\">Name</label>\n                  <input\n                    id=\"tagName\"\n                    type=\"text\"\n                    value={tagName}\n                    onChange={(e) => setTagName(e.target.value)}\n                    placeholder=\"e.g. technology\"\n                    autoFocus\n                    className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n                  />\n                  {error && (\n                    <p className=\"text-sm text-destructive\">{error}</p>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex items-center justify-end gap-2 p-6 pt-0\">\n                <button\n                  type=\"button\"\n                  onClick={() => setDialogOpen(false)}\n                  disabled={saving}\n                  className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground disabled:opacity-50\"\n                >\n                  Cancel\n                </button>\n                <button\n                  type=\"submit\"\n                  disabled={saving}\n                  className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50\"\n                >\n                  {saving ? 'Saving...' : editingTag ? 'Save' : 'Create'}\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { Plus, Pencil, Trash2, Play, X } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\nimport type { Topic } from './types'\n\nexport function TopicsSettings() {\n  const { apiBasePath } = useDashboardContext()\n  const [topics, setTopics] = useState<Topic[]>([])\n  const [loading, setLoading] = useState(true)\n  const [showForm, setShowForm] = useState(false)\n  const [editingTopic, setEditingTopic] = useState<Topic | null>(null)\n  const [generating, setGenerating] = useState<string | null>(null)\n\n  // Form state\n  const [formName, setFormName] = useState('')\n  const [formKeywords, setFormKeywords] = useState('')\n  const [formFeeds, setFormFeeds] = useState('')\n  const [formFrequency, setFormFrequency] = useState('daily')\n  const [formMaxPerPeriod, setFormMaxPerPeriod] = useState(3)\n  const [formEssayFocus, setFormEssayFocus] = useState('')\n  const [formIsActive, setFormIsActive] = useState(true)\n\n  useEffect(() => {\n    fetchTopics()\n  }, [apiBasePath])\n\n  async function fetchTopics() {\n    const res = await fetch(`${apiBasePath}/topics`)\n    if (res.ok) {\n      const json = await res.json()\n      setTopics(json.data || [])\n    }\n    setLoading(false)\n  }\n\n  function resetForm() {\n    setFormName('')\n    setFormKeywords('')\n    setFormFeeds('')\n    setFormFrequency('daily')\n    setFormMaxPerPeriod(3)\n    setFormEssayFocus('')\n    setFormIsActive(true)\n  }\n\n  function openEditForm(topic: Topic) {\n    setEditingTopic(topic)\n    setFormName(topic.name)\n    setFormKeywords(JSON.parse(topic.keywords).join(', '))\n    setFormFeeds(JSON.parse(topic.rssFeeds).join('\\n'))\n    setFormFrequency(topic.frequency)\n    setFormMaxPerPeriod(topic.maxPerPeriod)\n    setFormEssayFocus(topic.essayFocus || '')\n    setFormIsActive(topic.isActive)\n    setShowForm(true)\n  }\n\n  function openNewForm() {\n    setEditingTopic(null)\n    resetForm()\n    setShowForm(true)\n  }\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault()\n    const data = {\n      name: formName,\n      keywords: formKeywords.split(',').map(k => k.trim()).filter(Boolean),\n      rssFeeds: formFeeds.split('\\n').map(f => f.trim()).filter(Boolean),\n      frequency: formFrequency,\n      maxPerPeriod: formMaxPerPeriod,\n      essayFocus: formEssayFocus || null,\n      isActive: formIsActive,\n    }\n\n    const url = editingTopic ? `${apiBasePath}/topics/${editingTopic.id}` : `${apiBasePath}/topics`\n    const method = editingTopic ? 'PATCH' : 'POST'\n\n    const res = await fetch(url, {\n      method,\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(data),\n    })\n\n    if (res.ok) {\n      setShowForm(false)\n      resetForm()\n      setEditingTopic(null)\n      fetchTopics()\n    }\n  }\n\n  async function handleDelete(id: string) {\n    if (!confirm('Delete this topic? This will also delete associated news items.')) return\n    const res = await fetch(`${apiBasePath}/topics/${id}`, { method: 'DELETE' })\n    if (res.ok) setTopics(topics.filter(t => t.id !== id))\n  }\n\n  async function handleGenerate(topicId: string) {\n    setGenerating(topicId)\n    try {\n      const res = await fetch(`${apiBasePath}/topics/${topicId}/generate`, { method: 'POST' })\n      if (res.ok) {\n        fetchTopics()\n      }\n    } finally {\n      setGenerating(null)\n    }\n  }\n\n  if (loading) return <Skeleton className=\"h-32\" />\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between\">\n        <h2 className=\"text-lg font-semibold\">Topics</h2>\n        <button onClick={openNewForm} className=\"flex items-center gap-1 px-3 py-1.5 bg-primary text-primary-foreground rounded-md text-sm\">\n          <Plus className=\"h-4 w-4\" /> New Topic\n        </button>\n      </div>\n      <p className=\"text-muted-foreground text-sm -mt-2\">RSS topic subscriptions for auto-generating draft posts.</p>\n\n      {showForm && (\n        <div className=\"border border-border rounded-lg p-4 space-y-4 bg-muted/30\">\n          <div className=\"flex items-center justify-between\">\n            <h3 className=\"font-medium\">{editingTopic ? 'Edit Topic' : 'New Topic'}</h3>\n            <button onClick={() => { setShowForm(false); resetForm(); setEditingTopic(null) }} className=\"text-muted-foreground hover:text-foreground\">\n              <X className=\"h-4 w-4\" />\n            </button>\n          </div>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Name</label>\n              <input\n                type=\"text\"\n                value={formName}\n                onChange={e => setFormName(e.target.value)}\n                required\n                className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent\"\n                placeholder=\"e.g. School Lunch Policy\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Keywords (comma-separated)</label>\n              <input\n                type=\"text\"\n                value={formKeywords}\n                onChange={e => setFormKeywords(e.target.value)}\n                className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent\"\n                placeholder=\"school lunch, USDA, nutrition\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">RSS Feed URLs (one per line)</label>\n              <textarea\n                value={formFeeds}\n                onChange={e => setFormFeeds(e.target.value)}\n                rows={3}\n                className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent resize-none font-mono text-sm\"\n                placeholder=\"https://example.com/feed.xml\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Frequency</label>\n                <select\n                  value={formFrequency}\n                  onChange={e => setFormFrequency(e.target.value)}\n                  className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent\"\n                >\n                  <option value=\"daily\">Daily</option>\n                  <option value=\"weekly\">Weekly</option>\n                  <option value=\"hourly\">Hourly</option>\n                  <option value=\"manual\">Manual</option>\n                </select>\n              </div>\n              <div>\n                <label className=\"block text-sm font-medium mb-1\">Max per period</label>\n                <input\n                  type=\"number\"\n                  min={1}\n                  max={20}\n                  value={formMaxPerPeriod}\n                  onChange={e => setFormMaxPerPeriod(parseInt(e.target.value) || 3)}\n                  className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent\"\n                />\n              </div>\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Essay Focus (optional)</label>\n              <textarea\n                value={formEssayFocus}\n                onChange={e => setFormEssayFocus(e.target.value)}\n                rows={2}\n                className=\"w-full px-3 py-2 border border-input rounded-md bg-transparent resize-none\"\n                placeholder=\"Specific angle or perspective for essays on this topic\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <input\n                type=\"checkbox\"\n                id=\"isActive\"\n                checked={formIsActive}\n                onChange={e => setFormIsActive(e.target.checked)}\n              />\n              <label htmlFor=\"isActive\" className=\"text-sm\">Active</label>\n            </div>\n            <div className=\"flex gap-2\">\n              <button type=\"submit\" className=\"px-4 py-2 bg-primary text-primary-foreground rounded-md\">\n                {editingTopic ? 'Update' : 'Create'}\n              </button>\n              <button type=\"button\" onClick={() => { setShowForm(false); resetForm(); setEditingTopic(null) }} className=\"px-4 py-2 border border-input rounded-md\">\n                Cancel\n              </button>\n            </div>\n          </form>\n        </div>\n      )}\n      \n      <div className=\"border border-border rounded-lg divide-y divide-border\">\n        {topics.map(topic => {\n          const keywords = JSON.parse(topic.keywords) as string[]\n          const feeds = JSON.parse(topic.rssFeeds) as string[]\n          return (\n            <div key={topic.id} className=\"p-4\">\n              <div className=\"flex items-start justify-between\">\n                <div>\n                  <div className=\"flex items-center gap-2\">\n                    <p className=\"font-medium\">{topic.name}</p>\n                    {!topic.isActive && <span className=\"text-xs bg-muted px-1.5 py-0.5 rounded\">Paused</span>}\n                  </div>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    {keywords.slice(0, 3).join(', ')}{keywords.length > 3 && ` +${keywords.length - 3}`}\n                  </p>\n                  <p className=\"text-xs text-muted-foreground mt-1\">\n                    {feeds.length} feed{feeds.length !== 1 ? 's' : ''}  {topic.frequency}  {topic._count?.posts ?? 0} posts\n                    {topic.lastRunAt && `  Last run: ${new Date(topic.lastRunAt).toLocaleDateString()}`}\n                  </p>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <button\n                    onClick={() => handleGenerate(topic.id)}\n                    disabled={generating !== null}\n                    className=\"p-1.5 text-muted-foreground hover:text-foreground disabled:opacity-50\"\n                    title=\"Generate now\"\n                  >\n                    <Play className={`h-4 w-4 ${generating === topic.id ? 'animate-pulse' : ''}`} />\n                  </button>\n                  <button onClick={() => openEditForm(topic)} className=\"p-1.5 text-muted-foreground hover:text-foreground\">\n                    <Pencil className=\"h-4 w-4\" />\n                  </button>\n                  <button onClick={() => handleDelete(topic.id)} className=\"p-1.5 text-red-500 hover:text-red-600\">\n                    <Trash2 className=\"h-4 w-4\" />\n                  </button>\n                </div>\n              </div>\n            </div>\n          )\n        })}\n        {topics.length === 0 && (\n          <p className=\"p-4 text-muted-foreground text-center\">No topics configured</p>\n        )}\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { ChevronLeft, ChevronRight, MoreVertical, MoreHorizontal } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\n\ninterface PostWithRevisions {\n  id: string\n  title: string\n  slug: string\n  status: string\n  updatedAt: string\n  _count?: { revisions: number }\n}\n\nconst POSTS_PER_PAGE = 25\n\nexport function PostsSettings() {\n  const { apiBasePath, navigate, sharedData } = useDashboardContext()\n  const postUrlPattern = sharedData?.settings?.postUrlPattern ?? '/e/{slug}'\n  const getPostUrl = (slug: string) => postUrlPattern.replace('{slug}', slug)\n  const [posts, setPosts] = useState<PostWithRevisions[]>([])\n  const [totalCount, setTotalCount] = useState(0)\n  const [loading, setLoading] = useState(true)\n  const [currentPage, setCurrentPage] = useState(1)\n  const [totalPages, setTotalPages] = useState(1)\n  const [menuOpen, setMenuOpen] = useState<string | null>(null)\n\n  useEffect(() => {\n    setLoading(true)\n    fetch(`${apiBasePath}/posts?all=1&page=${currentPage}&limit=${POSTS_PER_PAGE}&includeRevisionCount=1`)\n      .then(res => res.ok ? res.json() : Promise.reject())\n      .then(res => {\n        setPosts(res.data || [])\n        setTotalCount(res.total ?? res.data?.length ?? 0)\n        setTotalPages(Math.ceil((res.total ?? res.data?.length ?? 0) / POSTS_PER_PAGE))\n        setLoading(false)\n      })\n      .catch(() => setLoading(false))\n  }, [apiBasePath, currentPage])\n\n  async function handleDelete(post: PostWithRevisions) {\n    if (!confirm(`Delete \"${post.title || 'Untitled'}\"? This will also delete all revisions.`)) return\n    const res = await fetch(`${apiBasePath}/posts/${post.id}`, { method: 'DELETE' })\n    if (res.ok) {\n      setPosts(posts.filter(p => p.id !== post.id))\n      setTotalCount(c => c - 1)\n    }\n    setMenuOpen(null)\n  }\n\n  function getStatusBadgeClasses(status: string) {\n    if (status === 'published') return 'bg-primary text-primary-foreground'\n    if (status === 'deleted') return 'bg-destructive text-destructive-foreground'\n    return 'bg-secondary text-secondary-foreground'\n  }\n\n  const PaginationControls = ({ position }: { position: 'top' | 'bottom' }) => {\n    if (totalPages <= 1) return null\n    \n    const getPageNumbers = () => {\n      const pages: (number | 'ellipsis-start' | 'ellipsis-end')[] = []\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) pages.push(i)\n      } else {\n        pages.push(1)\n        if (currentPage > 3) pages.push('ellipsis-start')\n        const start = Math.max(2, currentPage - 1)\n        const end = Math.min(totalPages - 1, currentPage + 1)\n        for (let i = start; i <= end; i++) {\n          if (!pages.includes(i)) pages.push(i)\n        }\n        if (currentPage < totalPages - 2) pages.push('ellipsis-end')\n        if (!pages.includes(totalPages)) pages.push(totalPages)\n      }\n      return pages\n    }\n\n    const spacingClass = position === 'bottom' ? 'mt-4' : ''\n    \n    return (\n      <nav role=\"navigation\" aria-label=\"pagination\" className={`mx-auto flex w-full justify-end ${spacingClass}`}>\n        <ul className=\"flex flex-row items-center gap-1\">\n          <li>\n            <button\n              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n              disabled={currentPage <= 1}\n              aria-label=\"Go to previous page\"\n              className=\"inline-flex items-center justify-center gap-1 whitespace-nowrap rounded-md text-sm font-medium h-9 px-2.5 hover:bg-accent hover:text-accent-foreground disabled:pointer-events-none disabled:opacity-50\"\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n              <span className=\"hidden sm:block\">Previous</span>\n            </button>\n          </li>\n          {getPageNumbers().map((page) => \n            typeof page === 'string' ? (\n              <li key={page}>\n                <span aria-hidden className=\"flex h-9 w-9 items-center justify-center\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </span>\n              </li>\n            ) : (\n              <li key={page}>\n                <button\n                  onClick={() => setCurrentPage(page)}\n                  aria-current={page === currentPage ? 'page' : undefined}\n                  className={`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-9 w-9 ${\n                    page === currentPage \n                      ? 'border border-input bg-background hover:bg-accent hover:text-accent-foreground' \n                      : 'hover:bg-accent hover:text-accent-foreground'\n                  }`}\n                >\n                  {page}\n                </button>\n              </li>\n            )\n          )}\n          <li>\n            <button\n              onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n              disabled={currentPage >= totalPages}\n              aria-label=\"Go to next page\"\n              className=\"inline-flex items-center justify-center gap-1 whitespace-nowrap rounded-md text-sm font-medium h-9 px-2.5 hover:bg-accent hover:text-accent-foreground disabled:pointer-events-none disabled:opacity-50\"\n            >\n              <span className=\"hidden sm:block\">Next</span>\n              <ChevronRight className=\"h-4 w-4\" />\n            </button>\n          </li>\n        </ul>\n      </nav>\n    )\n  }\n\n  if (loading && posts.length === 0) return <Skeleton className=\"h-32\" />\n\n  return (\n    <div>\n      <div className=\"flex items-end justify-between gap-4 mb-6 md:mb-8\">\n        <div className=\"shrink-0\">\n          <h1 className=\"text-lg font-bold\">Posts</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">{totalCount} total post{totalCount !== 1 ? 's' : ''}</p>\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <PaginationControls position=\"top\" />\n          <button\n            onClick={() => navigate('/editor')}\n            className=\"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90\"\n          >\n            New Post\n          </button>\n        </div>\n      </div>\n\n      {posts.length === 0 ? (\n        <div className=\"py-8 text-center text-muted-foreground\">No posts yet.</div>\n      ) : (\n        <>\n          <div className=\"hidden md:block rounded-md border\">\n            <table className=\"w-full caption-bottom text-sm\">\n              <thead className=\"[&_tr]:border-b\">\n                <tr className=\"border-b\">\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Title</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Slug</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Status</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Revisions</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Updated</th>\n                  <th className=\"h-12 px-4 text-right align-middle font-medium text-muted-foreground\">Actions</th>\n                </tr>\n              </thead>\n              <tbody className=\"[&_tr:last-child]:border-0\">\n                {posts.map(post => (\n                  <tr key={post.id} className=\"border-b\">\n                    <td className=\"p-4 align-middle\">\n                      <span className=\"block truncate max-w-[200px]\">{post.title || 'Untitled'}</span>\n                    </td>\n                    <td className=\"p-4 align-middle\">\n                      <span className=\"block truncate max-w-[250px] text-muted-foreground font-mono\">{post.slug}</span>\n                    </td>\n                    <td className=\"p-4 align-middle\">\n                      <span className={`inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold ${getStatusBadgeClasses(post.status)}`}>\n                        {post.status}\n                      </span>\n                    </td>\n                    <td className=\"p-4 align-middle text-muted-foreground\">{post._count?.revisions ?? 0}</td>\n                    <td className=\"p-4 align-middle text-muted-foreground\">{new Date(post.updatedAt).toLocaleDateString()}</td>\n                    <td className=\"p-4 align-middle text-right\">\n                      <div className=\"relative inline-block\">\n                        <button\n                          onClick={() => setMenuOpen(menuOpen === post.id ? null : post.id)}\n                          className=\"inline-flex items-center justify-center rounded-md h-8 w-8 hover:bg-accent text-muted-foreground\"\n                        >\n                          <MoreVertical className=\"h-4 w-4\" />\n                        </button>\n                        {menuOpen === post.id && (\n                          <div className=\"absolute right-0 top-full mt-1 bg-popover border border-border rounded-md shadow-md z-50 min-w-[8rem] py-1\">\n                            <button\n                              onClick={() => { navigate(`/editor/${post.slug}`); setMenuOpen(null) }}\n                              className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left hover:bg-accent\"\n                            >\n                              Edit\n                            </button>\n                            {post.status === 'published' && (\n                              <a\n                                href={getPostUrl(post.slug)}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left hover:bg-accent\"\n                                onClick={() => setMenuOpen(null)}\n                              >\n                                View\n                              </a>\n                            )}\n                            <div className=\"-mx-1 my-1 h-px bg-muted\" />\n                            <button\n                              onClick={() => handleDelete(post)}\n                              className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left text-destructive hover:bg-accent\"\n                            >\n                              Delete\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n\n          <div className=\"md:hidden divide-y rounded-md border bg-background\">\n            {posts.map(post => (\n              <div key={post.id} className=\"flex items-center justify-between gap-4 px-4 py-5\">\n                <div className=\"min-w-0 flex-1 space-y-1.5\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium truncate\">{post.title || 'Untitled'}</span>\n                    <span className={`inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold shrink-0 ${getStatusBadgeClasses(post.status)}`}>\n                      {post.status}\n                    </span>\n                  </div>\n                  <p className=\"text-sm text-muted-foreground truncate\">\n                    {post.slug}  {post._count?.revisions ?? 0} rev  {new Date(post.updatedAt).toLocaleDateString()}\n                  </p>\n                </div>\n                <div className=\"relative\">\n                  <button\n                    onClick={() => setMenuOpen(menuOpen === post.id ? null : post.id)}\n                    className=\"inline-flex items-center justify-center rounded-md h-8 w-8 hover:bg-accent text-muted-foreground\"\n                  >\n                    <MoreVertical className=\"h-4 w-4\" />\n                  </button>\n                  {menuOpen === post.id && (\n                    <div className=\"absolute right-0 top-full mt-1 bg-popover border border-border rounded-md shadow-md z-50 min-w-[8rem] py-1\">\n                      <button\n                        onClick={() => { navigate(`/editor/${post.slug}`); setMenuOpen(null) }}\n                        className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left hover:bg-accent\"\n                      >\n                        Edit\n                      </button>\n                      {post.status === 'published' && (\n                        <a\n                          href={getPostUrl(post.slug)}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left hover:bg-accent\"\n                          onClick={() => setMenuOpen(null)}\n                        >\n                          View\n                        </a>\n                      )}\n                      <div className=\"-mx-1 my-1 h-px bg-muted\" />\n                      <button\n                        onClick={() => handleDelete(post)}\n                        className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none w-full text-left text-destructive hover:bg-accent\"\n                      >\n                        Delete\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        </>\n      )}\n\n      <PaginationControls position=\"bottom\" />\n    </div>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { ChevronLeft, ChevronRight, MoreHorizontal, RotateCcw } from 'lucide-react'\nimport { useDashboardContext } from '../../context'\nimport { Skeleton } from '../../components/Skeleton'\nimport type { Revision } from './types'\n\nconst REVISIONS_PER_PAGE = 25\n\nexport function RevisionsSettings() {\n  const { apiBasePath, navigate } = useDashboardContext()\n  const [revisions, setRevisions] = useState<Revision[]>([])\n  const [totalCount, setTotalCount] = useState(0)\n  const [loading, setLoading] = useState(true)\n  const [currentPage, setCurrentPage] = useState(1)\n  const [totalPages, setTotalPages] = useState(1)\n\n  useEffect(() => {\n    setLoading(true)\n    fetch(`${apiBasePath}/revisions?page=${currentPage}&limit=${REVISIONS_PER_PAGE}`)\n      .then(res => res.ok ? res.json() : Promise.reject())\n      .then(res => {\n        setRevisions(res.data || [])\n        setTotalCount(res.total ?? res.data?.length ?? 0)\n        setTotalPages(res.totalPages || Math.ceil((res.total ?? res.data?.length ?? 0) / REVISIONS_PER_PAGE))\n        setLoading(false)\n      })\n      .catch(() => setLoading(false))\n  }, [apiBasePath, currentPage])\n\n  function getStatusBadgeClasses(isCurrent: boolean) {\n    if (isCurrent) return 'bg-primary text-primary-foreground'\n    return 'bg-secondary text-secondary-foreground'\n  }\n\n  const PaginationControls = ({ position }: { position: 'top' | 'bottom' }) => {\n    if (totalPages <= 1) return null\n    \n    const getPageNumbers = () => {\n      const pages: (number | 'ellipsis-start' | 'ellipsis-end')[] = []\n      if (totalPages <= 7) {\n        for (let i = 1; i <= totalPages; i++) pages.push(i)\n      } else {\n        pages.push(1)\n        if (currentPage > 3) pages.push('ellipsis-start')\n        const start = Math.max(2, currentPage - 1)\n        const end = Math.min(totalPages - 1, currentPage + 1)\n        for (let i = start; i <= end; i++) {\n          if (!pages.includes(i)) pages.push(i)\n        }\n        if (currentPage < totalPages - 2) pages.push('ellipsis-end')\n        if (!pages.includes(totalPages)) pages.push(totalPages)\n      }\n      return pages\n    }\n\n    const spacingClass = position === 'bottom' ? 'mt-4' : ''\n    \n    return (\n      <nav role=\"navigation\" aria-label=\"pagination\" className={`mx-auto flex w-full justify-end ${spacingClass}`}>\n        <ul className=\"flex flex-row items-center gap-1\">\n          <li>\n            <button\n              onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n              disabled={currentPage <= 1}\n              aria-label=\"Go to previous page\"\n              className=\"inline-flex items-center justify-center gap-1 whitespace-nowrap rounded-md text-sm font-medium h-9 px-2.5 hover:bg-accent hover:text-accent-foreground disabled:pointer-events-none disabled:opacity-50\"\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n              <span className=\"hidden sm:block\">Previous</span>\n            </button>\n          </li>\n          {getPageNumbers().map((page) => \n            typeof page === 'string' ? (\n              <li key={page}>\n                <span aria-hidden className=\"flex h-9 w-9 items-center justify-center\">\n                  <MoreHorizontal className=\"h-4 w-4\" />\n                </span>\n              </li>\n            ) : (\n              <li key={page}>\n                <button\n                  onClick={() => setCurrentPage(page)}\n                  aria-current={page === currentPage ? 'page' : undefined}\n                  className={`inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium h-9 w-9 ${\n                    page === currentPage \n                      ? 'border border-input bg-background hover:bg-accent hover:text-accent-foreground' \n                      : 'hover:bg-accent hover:text-accent-foreground'\n                  }`}\n                >\n                  {page}\n                </button>\n              </li>\n            )\n          )}\n          <li>\n            <button\n              onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\n              disabled={currentPage >= totalPages}\n              aria-label=\"Go to next page\"\n              className=\"inline-flex items-center justify-center gap-1 whitespace-nowrap rounded-md text-sm font-medium h-9 px-2.5 hover:bg-accent hover:text-accent-foreground disabled:pointer-events-none disabled:opacity-50\"\n            >\n              <span className=\"hidden sm:block\">Next</span>\n              <ChevronRight className=\"h-4 w-4\" />\n            </button>\n          </li>\n        </ul>\n      </nav>\n    )\n  }\n\n  if (loading && revisions.length === 0) return <Skeleton className=\"h-32\" />\n\n  return (\n    <div>\n      <div className=\"flex items-end justify-between gap-4 mb-6 md:mb-8\">\n        <div className=\"shrink-0\">\n          <h1 className=\"text-lg font-bold\">Revisions</h1>\n          <p className=\"text-sm text-muted-foreground mt-1\">{totalCount} total revision{totalCount !== 1 ? 's' : ''}</p>\n        </div>\n        <PaginationControls position=\"top\" />\n      </div>\n\n      {revisions.length === 0 ? (\n        <div className=\"py-8 text-center text-muted-foreground\">No revisions yet.</div>\n      ) : (\n        <>\n          <div className=\"hidden md:block rounded-md border\">\n            <table className=\"w-full caption-bottom text-sm\">\n              <thead className=\"[&_tr]:border-b\">\n                <tr className=\"border-b\">\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Post</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Content Preview</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Created</th>\n                  <th className=\"h-12 px-4 text-left align-middle font-medium text-muted-foreground\">Status</th>\n                  <th className=\"h-12 px-4 text-right align-middle font-medium text-muted-foreground\">Actions</th>\n                </tr>\n              </thead>\n              <tbody className=\"[&_tr:last-child]:border-0\">\n                {revisions.map(revision => {\n                  const isCurrent = revision.post.markdown === revision.markdown\n                  return (\n                    <tr key={revision.id} className=\"border-b\">\n                      <td className=\"p-4 align-middle\">\n                        <button\n                          onClick={() => navigate(`/editor/${revision.post.slug}`)}\n                          className=\"block truncate max-w-[200px] hover:underline text-left\"\n                        >\n                          {revision.post.title || 'Untitled'}\n                        </button>\n                      </td>\n                      <td className=\"p-4 align-middle\">\n                        <span className=\"block truncate max-w-[300px] text-muted-foreground\">\n                          {revision.markdown.slice(0, 80)}{revision.markdown.length > 80 ? '...' : ''}\n                        </span>\n                      </td>\n                      <td className=\"p-4 align-middle text-muted-foreground\">\n                        {new Date(revision.createdAt).toLocaleString()}\n                      </td>\n                      <td className=\"p-4 align-middle\">\n                        <span className={`inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold ${getStatusBadgeClasses(isCurrent)}`}>\n                          {isCurrent ? 'current' : 'past'}\n                        </span>\n                      </td>\n                      <td className=\"p-4 align-middle text-right\">\n                        <button\n                          onClick={() => navigate(`/settings/revisions/${revision.id}`)}\n                          className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-8 px-3 hover:bg-accent text-muted-foreground hover:text-foreground\"\n                        >\n                          View\n                        </button>\n                      </td>\n                    </tr>\n                  )\n                })}\n              </tbody>\n            </table>\n          </div>\n\n          <div className=\"md:hidden divide-y rounded-md border bg-background\">\n            {revisions.map(revision => {\n              const isCurrent = revision.post.markdown === revision.markdown\n              return (\n                <div key={revision.id} className=\"flex items-center justify-between gap-4 px-4 py-5\">\n                  <div className=\"min-w-0 flex-1 space-y-1.5\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium truncate\">{revision.post.title || 'Untitled'}</span>\n                      <span className={`inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold shrink-0 ${getStatusBadgeClasses(isCurrent)}`}>\n                        {isCurrent ? 'current' : 'past'}\n                      </span>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground truncate\">\n                      {revision.markdown.slice(0, 40)}{revision.markdown.length > 40 ? '...' : ''}  {new Date(revision.createdAt).toLocaleDateString()}\n                    </p>\n                  </div>\n                  <button\n                    onClick={() => navigate(`/settings/revisions/${revision.id}`)}\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-8 px-3 hover:bg-accent text-muted-foreground hover:text-foreground shrink-0\"\n                  >\n                    View\n                  </button>\n                </div>\n              )\n            })}\n          </div>\n        </>\n      )}\n\n      <PaginationControls position=\"bottom\" />\n    </div>\n  )\n}\n\ninterface RevisionDetail {\n  id: string\n  postId: string\n  title: string | null\n  subtitle: string | null\n  markdown: string\n  createdAt: string\n  post: { id: string; title: string; slug: string; markdown: string }\n}\n\nexport function RevisionDetail({ revisionId }: { revisionId: string }) {\n  const { apiBasePath, navigate } = useDashboardContext()\n  const [revision, setRevision] = useState<RevisionDetail | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [restoring, setRestoring] = useState(false)\n\n  useEffect(() => {\n    fetch(`${apiBasePath}/revisions/${revisionId}`)\n      .then(res => res.ok ? res.json() : Promise.reject())\n      .then(res => {\n        setRevision(res.data)\n        setLoading(false)\n      })\n      .catch(() => setLoading(false))\n  }, [apiBasePath, revisionId])\n\n  async function handleRestore() {\n    if (!revision) return\n    if (!confirm('Restore this revision? This will replace the current post content.')) return\n    \n    setRestoring(true)\n    const res = await fetch(`${apiBasePath}/revisions/${revisionId}/restore`, { method: 'POST' })\n    if (res.ok) {\n      navigate(`/editor/${revision.post.slug}`)\n    }\n    setRestoring(false)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-6 w-32\" />\n        <Skeleton className=\"h-64\" />\n      </div>\n    )\n  }\n\n  if (!revision) {\n    return (\n      <div className=\"space-y-6\">\n        <button\n          onClick={() => navigate('/settings/revisions')}\n          className=\"text-sm text-muted-foreground hover:text-foreground flex items-center gap-1\"\n        >\n          <ChevronLeft className=\"h-4 w-4\" /> Back to Revisions\n        </button>\n        <p className=\"text-muted-foreground\">Revision not found.</p>\n      </div>\n    )\n  }\n\n  const isCurrent = revision.post.markdown === revision.markdown\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"space-y-1\">\n          <button\n            onClick={() => navigate('/settings/revisions')}\n            className=\"text-sm text-muted-foreground hover:text-foreground flex items-center gap-1\"\n          >\n            <ChevronLeft className=\"h-4 w-4\" /> Back to Revisions\n          </button>\n          <h2 className=\"text-lg font-semibold\">Revision Detail</h2>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          {isCurrent ? (\n            <span className=\"inline-flex items-center rounded-md px-2.5 py-0.5 text-xs font-semibold bg-primary text-primary-foreground\">\n              current\n            </span>\n          ) : (\n            <button\n              onClick={handleRestore}\n              disabled={restoring}\n              className=\"inline-flex items-center justify-center rounded-md text-sm font-medium h-9 px-4 bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50\"\n            >\n              <RotateCcw className=\"h-4 w-4 mr-2\" />\n              {restoring ? 'Restoring...' : 'Restore This Revision'}\n            </button>\n          )}\n        </div>\n      </div>\n\n      <div className=\"rounded-lg border bg-card p-4 space-y-2\">\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-sm text-muted-foreground\">Post</span>\n          <button\n            onClick={() => navigate(`/editor/${revision.post.slug}`)}\n            className=\"text-sm hover:underline\"\n          >\n            {revision.post.title || 'Untitled'}\n          </button>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-sm text-muted-foreground\">Title at revision</span>\n          <span className=\"text-sm\">{revision.title || ''}</span>\n        </div>\n        <div className=\"flex items-center justify-between\">\n          <span className=\"text-sm text-muted-foreground\">Created</span>\n          <span className=\"text-sm\">{new Date(revision.createdAt).toLocaleString()}</span>\n        </div>\n      </div>\n\n      <div className=\"space-y-2\">\n        <h3 className=\"text-sm font-medium\">Content</h3>\n        <div className=\"rounded-lg border bg-muted/30 p-4 max-h-96 overflow-auto\">\n          <pre className=\"text-sm whitespace-pre-wrap font-mono\">{revision.markdown}</pre>\n        </div>\n      </div>\n    </div>\n  )\n}\n","'use client'\n\nimport { useDashboardContext } from '../context'\nimport { Dropdown, DropdownItem, DropdownDivider } from './Dropdown'\nimport { ThemeToggle } from './ThemeToggle'\nimport { ChevronLeftIcon } from './Icons'\n\nexport interface NavbarProps {\n  // Callbacks\n  onSignOut?: () => void\n  // Extra slot for host-app specific buttons (e.g., additional actions)\n  rightSlot?: React.ReactNode\n}\n\nexport function Navbar({\n  onSignOut,\n  rightSlot,\n}: NavbarProps) {\n  const { session, currentPath, navigate, goBack, basePath } = useDashboardContext()\n\n  // Detect current route state\n  const isRoot = currentPath === '/' || currentPath === ''\n  const isSettings = currentPath.startsWith('/settings')\n\n  const handleBack = (e: React.MouseEvent<HTMLButtonElement>) => {\n    // Blur to clear focus/active state (prevents sticky highlight on mobile)\n    e.currentTarget.blur()\n    goBack()\n  }\n\n  const avatarTrigger = (\n    <button\n      type=\"button\"\n      className=\"relative w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-sm font-medium text-secondary-foreground active:ring-2 md:hover:ring-2 active:ring-ring md:hover:ring-ring transition-shadow\"\n    >\n      {session?.user?.email?.charAt(0).toUpperCase() || '?'}\n      <span className=\"absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-background\" />\n    </button>\n  )\n\n  return (\n    <header className=\"sticky top-0 z-50 border-b border-border bg-background overscroll-none\">\n      <div className=\"max-w-5xl mx-auto px-6 py-4 flex items-center justify-between\">\n        {/* Left side: Logo or back button */}\n        {isRoot ? (\n          <a href={basePath} className=\"font-medium flex items-center gap-1.5\">\n            Writer\n            <span className=\"text-xs px-1.5 py-0.5 bg-primary text-primary-foreground rounded\">AI</span>\n          </a>\n        ) : (\n          <button\n            type=\"button\"\n            onClick={handleBack}\n            className=\"h-10 px-3 -ml-3 gap-1.5 inline-flex items-center justify-center text-sm font-medium rounded-md active:bg-accent md:hover:bg-accent active:text-accent-foreground md:hover:text-accent-foreground touch-manipulation\"\n          >\n            <ChevronLeftIcon />\n            <span className=\"hidden sm:inline\">Back</span>\n          </button>\n        )}\n\n        {/* Right side: icons and user menu */}\n        <div className=\"flex items-center gap-2\">\n          {/* Extra slot from host app */}\n          {rightSlot}\n\n          {/* Theme toggle - always shown, uses internal theme context */}\n          <ThemeToggle />\n\n          {/* User menu */}\n          {session && (\n            <Dropdown trigger={avatarTrigger} align=\"right\" className=\"min-w-[180px]\">\n              {session.user?.role === 'admin' && (\n                <>\n                  {/* Settings toggle */}\n                  {!isSettings ? (\n                    <DropdownItem onClick={() => navigate('/settings')}>\n                      Go to settings\n                    </DropdownItem>\n                  ) : (\n                    <DropdownItem onClick={() => navigate('/')}>\n                      Back to writer\n                    </DropdownItem>\n                  )}\n                  <DropdownDivider />\n                </>\n              )}\n\n              {/* Back to site */}\n              <DropdownItem onClick={() => { window.location.href = '/' }}>\n                Back to site\n              </DropdownItem>\n\n              {/* Logout */}\n              {onSignOut && (\n                <DropdownItem onClick={onSignOut}>\n                  Logout\n                </DropdownItem>\n              )}\n            </Dropdown>\n          )}\n        </div>\n      </div>\n    </header>\n  )\n}\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useAutobloggerTheme } from '../hooks/useTheme'\nimport { SunIcon, MoonIcon } from './Icons'\nimport { cn } from '../../lib/cn'\n\ninterface ThemeToggleProps {\n  className?: string\n}\n\nexport function ThemeToggle({ className }: ThemeToggleProps) {\n  const { resolvedTheme, setTheme } = useAutobloggerTheme()\n  const [mounted, setMounted] = useState(false)\n\n  useEffect(() => setMounted(true), [])\n\n  const handleToggle = () => {\n    setTheme(resolvedTheme === 'dark' ? 'light' : 'dark')\n  }\n\n  return (\n    <button\n      type=\"button\"\n      onClick={handleToggle}\n      className={cn(\n        'w-10 h-10 rounded-md border border-border',\n        'active:bg-accent md:hover:bg-accent',\n        'text-muted-foreground',\n        'flex items-center justify-center',\n        className\n      )}\n      aria-label=\"Toggle dark mode\"\n    >\n      <div className=\"w-5 h-5 transition-transform duration-200 active:scale-90\">\n        {!mounted ? (\n          <div className=\"w-5 h-5\" />\n        ) : resolvedTheme === 'dark' ? (\n          <SunIcon className=\"w-5 h-5\" />\n        ) : (\n          <MoonIcon className=\"w-5 h-5\" />\n        )}\n      </div>\n    </button>\n  )\n}\n","import { cn } from '../../lib/cn'\n\ninterface IconProps {\n  className?: string\n}\n\n// Chat icon - speech bubble with 3 dots\nexport const ChatIcon = ({ className }: IconProps) => (\n  <svg className={cn('w-4 h-4', className)} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z\" />\n  </svg>\n)\n\n// Theme icons\nexport const SunIcon = ({ className }: IconProps) => (\n  <svg className={cn('w-4 h-4', className)} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z\" />\n  </svg>\n)\n\nexport const MoonIcon = ({ className }: IconProps) => (\n  <svg className={cn('w-4 h-4', className)} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z\" />\n  </svg>\n)\n\n// Navigation icons\nexport const ChevronLeftIcon = ({ className }: IconProps) => (\n  <svg className={cn('w-4 h-4', className)} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n  </svg>\n)\n","'use client'\n\nimport { ChatIcon } from './Icons'\nimport { useChatContextOptional } from '../hooks/useChat'\n\nexport function ChatButton() {\n  const chatContext = useChatContextOptional()\n  \n  // Don't render if not within ChatProvider\n  if (!chatContext) return null\n  \n  const { setIsOpen, isOpen } = chatContext\n  \n  return (\n    <button\n      type=\"button\"\n      onClick={() => setIsOpen(!isOpen)}\n      className={`w-10 h-10 rounded-md border border-border active:bg-accent md:hover:bg-accent flex items-center justify-center transition-colors ${isOpen ? 'bg-accent text-accent-foreground' : 'text-muted-foreground'}`}\n      aria-label=\"Toggle chat\"\n      title=\"Chat (A)\"\n    >\n      <ChatIcon className=\"w-5 h-5\" />\n    </button>\n  )\n}\n","'use client'\n\nimport { type ReactNode } from 'react'\nimport { AutobloggerThemeProvider } from '../hooks/useTheme'\n\ninterface ThemeProviderProps {\n  children: ReactNode\n  className?: string\n}\n\nexport function ThemeProvider({ children, className }: ThemeProviderProps) {\n  return (\n    <AutobloggerThemeProvider className={className}>\n      {children}\n    </AutobloggerThemeProvider>\n  )\n}\n","import { useEffect, useRef } from 'react'\n\ninterface KeyboardShortcut {\n  key: string\n  metaKey?: boolean\n  ctrlKey?: boolean\n  shiftKey?: boolean\n  altKey?: boolean\n  action: () => void\n  description?: string\n  allowInInput?: boolean  // If true, fires even when typing in inputs\n}\n\nexport function useKeyboard(shortcuts: KeyboardShortcut[], enabled: boolean = true) {\n  // Use ref to avoid effect re-running when shortcuts array reference changes\n  const shortcutsRef = useRef(shortcuts)\n  shortcutsRef.current = shortcuts\n\n  useEffect(() => {\n    if (!enabled) return\n\n    function handleKeyDown(event: KeyboardEvent) {\n      // Check if user is typing in an input\n      const target = event.target as HTMLElement\n      const isTyping = \n        target.tagName === 'INPUT' ||\n        target.tagName === 'TEXTAREA' ||\n        target.isContentEditable\n\n      // Check if event is inside a dialog/modal - let the modal handle its own Escape\n      const isInDialog = target && (\n        target.closest('[role=\"dialog\"]') ||\n        target.closest('[role=\"alertdialog\"]') ||\n        target.closest('[data-radix-dialog-content]') ||\n        target.closest('[data-radix-alert-dialog-content]')\n      )\n\n      for (const shortcut of shortcutsRef.current) {\n        // Skip if typing and shortcut doesn't allow it\n        if (isTyping && !shortcut.allowInInput) continue\n\n        // Skip Escape handling if inside a dialog - let the dialog close first\n        if (shortcut.key === 'Escape' && isInDialog) continue\n\n        const metaMatch = shortcut.metaKey ? event.metaKey || event.ctrlKey : true\n        const ctrlMatch = shortcut.ctrlKey ? event.ctrlKey : true\n        const shiftMatch = shortcut.shiftKey ? event.shiftKey : !event.shiftKey\n        const altMatch = shortcut.altKey ? event.altKey : !event.altKey\n        \n        // Check both e.key and e.code for matching\n        // When Alt/Option is pressed on Mac, the key character changes (e.g., m  )\n        const keyLower = event.key.toLowerCase()\n        const codeLower = event.code.toLowerCase()\n        const targetKey = shortcut.key.toLowerCase()\n        const keyMatch = keyLower === targetKey || \n          (shortcut.altKey && codeLower === `key${targetKey}`)\n\n        if (keyMatch && metaMatch && ctrlMatch && shiftMatch && altMatch) {\n          event.preventDefault()\n          shortcut.action()\n          break\n        }\n      }\n    }\n\n    window.addEventListener('keydown', handleKeyDown)\n    return () => window.removeEventListener('keydown', handleKeyDown)\n  }, [enabled])\n}\n\n// Dashboard-specific shortcuts\nexport function useDashboardKeyboard(options: {\n  basePath: string\n  onToggleView?: () => void\n  onToggleSettings?: () => void\n  onNewPost?: () => void\n  onEscape?: () => void\n}) {\n  const shortcuts: KeyboardShortcut[] = [\n    {\n      key: '/',\n      metaKey: true,\n      allowInInput: true,\n      action: () => options.onToggleView?.(),\n      description: 'Toggle view',\n    },\n    {\n      key: \"'\",\n      metaKey: true,\n      allowInInput: true,\n      action: () => options.onToggleSettings?.(),\n      description: 'Toggle settings',\n    },\n    {\n      key: 'n',\n      action: () => options.onNewPost?.(),\n      description: 'New post',\n    },\n    {\n      key: 'Escape',\n      allowInInput: true,\n      action: () => options.onEscape?.(),\n      description: 'Go back',\n    },\n  ]\n\n  useKeyboard(shortcuts, true)\n}\n","'use client'\n\nimport { useAutobloggerTheme } from '../hooks/useTheme'\nimport { Toaster as Sonner } from 'sonner'\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\n/**\n * Toaster component for displaying toast notifications.\n * Uses sonner library and respects autoblogger's internal theme.\n */\nexport function Toaster({ ...props }: ToasterProps) {\n  const { resolvedTheme } = useAutobloggerTheme()\n\n  return (\n    <Sonner\n      theme={resolvedTheme as ToasterProps['theme']}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            'group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg',\n          description: 'group-[.toast]:text-muted-foreground',\n          actionButton:\n            'group-[.toast]:bg-primary group-[.toast]:text-primary-foreground',\n          cancelButton:\n            'group-[.toast]:bg-muted group-[.toast]:text-muted-foreground',\n        },\n      }}\n      {...props}\n    />\n  )\n}\n","'use client'\n\n// Main dashboard component\nexport { AutobloggerDashboard } from './dashboard'\nexport type { AutobloggerDashboardProps } from './dashboard'\n\n// Navbar (for custom integrations)\nexport { Navbar } from './components/Navbar'\nexport type { NavbarProps } from './components/Navbar'\n\n// Theme toggle, provider, and hook\nexport { ThemeToggle } from './components/ThemeToggle'\nexport { ThemeProvider } from './components/ThemeProvider'\nexport { useAutobloggerTheme, useTheme } from './hooks/useTheme'\n\n// Icons\nexport { ChatIcon, SunIcon, MoonIcon, ChevronLeftIcon } from './components/Icons'\n\n// Context and types\nexport { useDashboardContext } from './context'\nexport type { Session, SessionUser, EditorState, EditorContent } from './context'\n\n// Client-side types\nexport type { CustomFieldConfig, CustomFieldProps, StylesConfig } from './types'\n\n// Comment components (for custom integrations)\nexport { CommentsPanel } from './components/CommentsPanel'\nexport { CommentThread } from './components/CommentThread'\nexport { useComments } from './hooks/useComments'\nexport type { CommentsState } from './hooks/useComments'\n\n// Chat components and context\nexport { ChatProvider, useChatContext, useChatContextOptional, ChatContext } from './hooks/useChat'\nexport type { \n  Message as ChatMessage,\n  EssayContext as ChatEssayContext,\n  EssaySnapshot,\n  ChatMode,\n  ExpandPlanHandler,\n} from './hooks/useChat'\n// EditCommand replaces the old EssayEdit (same structure, consolidated name)\nexport type { EditCommand, EditCommand as EssayEdit, EditHandler, EditHandler as ChatEditHandler } from '../types/editor'\nexport { ChatPanel } from './components/ChatPanel'\nexport { ChatButton } from './components/ChatButton'\nexport { useAIModels } from './hooks/useAIModels'\nexport { ModelSelector } from './components/ModelSelector'\nexport { ControlButton } from './components/ControlButton'\n\n// Types from lib\nexport type { AIModelOption } from '../lib/models'\n\n// Keyboard hook\nexport { useKeyboard, useDashboardKeyboard } from './hooks/useKeyboard'\n\n// Keyboard shortcuts\nexport { SHORTCUTS } from './shortcuts'\n\n// Global shortcuts for use outside dashboard\nexport { GlobalShortcuts } from './components/GlobalShortcuts'\n\n// Expandable section component (for consistent collapsible UI)\nexport { ExpandableSection } from './components/ExpandableSection'\n\n// SEO section component (for consistent SEO fields UI)\nexport { SeoSection } from './components/SeoSection'\n\n// Page container layout component\nexport { PageContainer } from './components/PageContainer'\n\n","'use client'\n\nimport { useState, useEffect } from 'react'\nimport type { AIModelOption } from '../../lib/models'\n\ninterface UseAIModelsOptions {\n  /** External selected model state (for context-managed selection) */\n  externalSelectedModel?: string\n  /** External setter (for context-managed selection) */\n  externalSetSelectedModel?: (id: string) => void\n  /** Custom API path for settings (defaults to /api/cms/ai/settings) */\n  apiPath?: string\n}\n\ninterface UseAIModelsResult {\n  models: AIModelOption[]\n  selectedModel: string\n  setSelectedModel: (id: string) => void\n  currentModel: AIModelOption | undefined\n  isLoading: boolean\n}\n\n/**\n * Hook to fetch available AI models and manage selection.\n * Fetches models from AI settings endpoint and sets default model on mount.\n * \n * Can use internal state (default) or external state (for context-managed selection).\n */\nexport function useAIModels(options?: UseAIModelsOptions): UseAIModelsResult {\n  const [models, setModels] = useState<AIModelOption[]>([])\n  const [internalSelectedModel, setInternalSelectedModel] = useState('')\n  const [isLoading, setIsLoading] = useState(true)\n\n  // Use external state if provided, otherwise internal\n  const selectedModel = options?.externalSelectedModel ?? internalSelectedModel\n  const setSelectedModel = options?.externalSetSelectedModel ?? setInternalSelectedModel\n  \n  const apiPath = options?.apiPath ?? '/api/cms/ai/settings'\n\n  useEffect(() => {\n    fetch(apiPath)\n      .then(res => {\n        if (!res.ok) throw new Error(`HTTP ${res.status}`)\n        return res.json()\n      })\n      .then(data => {\n        // Handle both wrapped { data: {...} } and unwrapped response formats\n        const settings = data.data || data\n        setModels(settings.availableModels || [])\n        if (settings.defaultModel && !selectedModel) {\n          setSelectedModel(settings.defaultModel)\n        }\n      })\n      .catch(console.error)\n      .finally(() => setIsLoading(false))\n  }, [apiPath]) // eslint-disable-line react-hooks/exhaustive-deps\n  // Intentionally omit selectedModel/setSelectedModel - we only want to set default on mount\n\n  const currentModel = models.find(m => m.id === selectedModel)\n\n  return {\n    models,\n    selectedModel,\n    setSelectedModel,\n    currentModel,\n    isLoading,\n  }\n}\n","/**\n * Predefined keyboard shortcuts for the dashboard.\n * These can be used with useKeyboard() hook.\n */\nexport const SHORTCUTS = {\n  THEME_TOGGLE: { key: '.', metaKey: true, allowInInput: true },\n  TOGGLE_VIEW: { key: '/', metaKey: true, allowInInput: true },  // essayeditor, homewriter\n  SETTINGS: { key: ';', metaKey: true, allowInInput: true },  // toggle to/from /settings\n  CHAT_TOGGLE: { key: 'k', metaKey: true, allowInInput: true },  // open/close chat panel\n  NEW_ARTICLE: { key: 'n' },\n  PREV: { key: 'ArrowLeft' },\n  NEXT: { key: 'ArrowRight' },\n  ESCAPE_BACK: { key: 'Escape', allowInInput: true },  // editorwriter\n  TOGGLE_CHAT_MODE: { key: 'a', metaKey: true, shiftKey: true, allowInInput: true },  // AskAgent mode\n} as const\n\nexport type ShortcutKey = keyof typeof SHORTCUTS\n","'use client'\n\nimport { useKeyboard } from '../hooks/useKeyboard'\n\ninterface GlobalShortcutsProps {\n  /** Path to navigate to when Cmd+/ is pressed (default: /writer) */\n  writerPath?: string\n}\n\n/**\n * Global keyboard shortcuts for use outside the dashboard.\n * Add this to your root layout to enable Cmd+/ navigation to the writer.\n * \n * Zero-config: just add <GlobalShortcuts /> to your root layout.\n */\nexport function GlobalShortcuts({ writerPath = '/writer' }: GlobalShortcutsProps = {}) {\n  useKeyboard([\n    {\n      key: '/',\n      metaKey: true,\n      allowInInput: true,\n      action: () => {\n        window.location.href = writerPath\n      },\n    },\n  ])\n\n  return null\n}\n","'use client'\n\nimport { useState } from 'react'\nimport { ExpandableSection } from './ExpandableSection'\n\ninterface Post {\n  title?: string\n  subtitle?: string\n  seoTitle?: string | null\n  seoDescription?: string | null\n  seoKeywords?: string | null\n  noIndex?: boolean\n}\n\ninterface SeoSectionProps {\n  post: Post\n  onFieldChange: (name: string, value: unknown) => void\n  disabled?: boolean\n}\n\nexport function SeoSection({\n  post,\n  onFieldChange,\n  disabled = false,\n}: SeoSectionProps) {\n  const [isExpanded, setIsExpanded] = useState(false)\n\n  const handleChange = (field: string, value: string | boolean) => {\n    onFieldChange(field, value === '' ? null : value)\n  }\n\n  const getSummary = () => {\n    const hasTitle = !!post.seoTitle\n    const hasDesc = !!post.seoDescription\n    const hasKeywords = !!post.seoKeywords\n    const isNoIndex = post.noIndex\n\n    if (!hasTitle && !hasDesc && !hasKeywords && !isNoIndex) {\n      return 'default'\n    }\n\n    const parts: string[] = []\n    if (hasTitle) parts.push('title')\n    if (hasDesc) parts.push('description')\n    if (hasKeywords) parts.push('keywords')\n    if (isNoIndex) parts.push('noindex')\n\n    return parts.join(', ')\n  }\n\n  return (\n    <ExpandableSection\n      title=\"SEO Settings\"\n      summary={getSummary()}\n      expanded={isExpanded}\n      onExpandedChange={setIsExpanded}\n    >\n      <div className=\"space-y-1\">\n        <label className=\"text-xs text-muted-foreground\">Title</label>\n        <input\n          type=\"text\"\n          value={post.seoTitle || ''}\n          onChange={(e) => handleChange('seoTitle', e.target.value)}\n          placeholder={post.title || 'Page title for search engines'}\n          disabled={disabled}\n          className=\"w-full h-8 px-3 text-sm border border-border rounded-md bg-transparent placeholder-muted-foreground/50 disabled:opacity-50\"\n        />\n      </div>\n\n      <div className=\"space-y-1\">\n        <label className=\"text-xs text-muted-foreground\">Description</label>\n        <textarea\n          value={post.seoDescription || ''}\n          onChange={(e) => handleChange('seoDescription', e.target.value)}\n          placeholder={post.subtitle || 'Brief description for search results'}\n          disabled={disabled}\n          rows={2}\n          className=\"w-full px-3 py-2 text-sm border border-border rounded-md bg-transparent placeholder-muted-foreground/50 resize-none disabled:opacity-50\"\n        />\n      </div>\n\n      <div className=\"space-y-1\">\n        <label className=\"text-xs text-muted-foreground\">Keywords</label>\n        <input\n          type=\"text\"\n          value={post.seoKeywords || ''}\n          onChange={(e) => handleChange('seoKeywords', e.target.value)}\n          placeholder=\"keyword1, keyword2, keyword3\"\n          disabled={disabled}\n          className=\"w-full h-8 px-3 text-sm border border-border rounded-md bg-transparent placeholder-muted-foreground/50 disabled:opacity-50\"\n        />\n      </div>\n\n      <label className=\"flex items-center gap-2 cursor-pointer\">\n        <input\n          type=\"checkbox\"\n          checked={post.noIndex || false}\n          onChange={(e) => handleChange('noIndex', e.target.checked)}\n          disabled={disabled}\n          className=\"h-4 w-4 rounded border-border\"\n        />\n        <span className=\"text-sm text-muted-foreground\">\n          Hide from search engines (noindex)\n        </span>\n      </label>\n    </ExpandableSection>\n  )\n}\n"],"mappings":"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","names":["jsx","useState","useRef","useEffect","jsx","isSafari","createContext","useContext","useState","useEffect","useCallback","useRef","jsx","useState","useEffect","jsx","TextSelection","Fragment","Selection","joinPoint","originalCommand","Schema","DOMParser","Node","NodeSelection","canSplit","Plugin","PluginKey","canJoin","mark","style","range","run","from","to","parseAttributes","serializeAttributes","h","nextIndent","command","__export","isTextSelection","isActive","document","first","newNextTypeAttributes","nextType","_a","_b","_c","handleBackspace","handleDelete","tr","Plugin","PluginKey","createContext","useContext","useState","useCallback","useRef","useEffect","useMemo","jsx","h","index_default","h","ListItemName","TextStyleName","h","Node","mergeAttributes","__export","getNodeType","isNodeActive","wrappingInputRule","renderNestedMarkdownContent","Extension","index_default","init_dist","index_default","init_dist","index_default","init_dist","inputRegex","index_default","h","Plugin","PluginKey","Selection","TextSelection","index_default","h","_a","init_jsx_runtime","inputRegex","index_default","init_jsx_runtime","h","NodeSelection","TextSelection","index_default","useEffect","useMemo","Image","Underline","jsx","index_default","editor","init_dist","useState","useRef","useEffect","useCallback","useContext","X","Check","ArrowUp","Pencil","Undo2","ChevronDown","MessageSquare","Globe","Brain","List","jsx","jsxs","DEFAULT_PROSE_CLASSES","useState","useEffect","lazy","Suspense","Loader2","useState","useEffect","useMemo","useRef","ChevronDown","Check","jsx","jsx","jsx","jsxs","useState","useEffect","useMemo","handleDelete","ChevronDown","Check","useRef","useState","useEffect","useCallback","useRef","useMemo","jsx","useState","useEffect","useCallback","jsx","jsxs","useState","useEffect","useCallback","Fragment","jsx","jsxs","useRef","useCallback","Fragment","jsx","jsxs","useRef","useCallback","useCallback","useState","Loader2","useState","useRef","useEffect","useCallback","createContext","useContext","Fragment","jsx","jsxs","jsx","jsxs","useState","Loader2","Fragment","jsx","jsxs","useCallback","jsx","jsxs","useState","useRef","useEffect","useCallback","X","MessageSquare","ArrowUp","Loader2","ChevronDown","useState","Check","Fragment","jsx","jsxs","formatRelativeTime","useState","handleDelete","Check","jsx","jsxs","useState","useRef","useEffect","useCallback","MessageSquare","X","Loader2","ArrowUp","ChevronDown","useState","useEffect","useState","jsx","jsxs","Fragment","jsx","jsxs","useState","useEffect","useState","useCallback","useEffect","useState","useEffect","useCallback","jsx","jsxs","TiptapEditor","useRef","useEffect","useState","useCallback","useMemo","useState","useEffect","MoreVertical","Fragment","jsx","jsxs","useState","useEffect","MoreVertical","useState","Loader2","jsx","jsxs","useState","useEffect","Loader2","Fragment","jsx","jsxs","useState","useEffect","Loader2","useState","useEffect","ChevronRight","MoreHorizontal","Fragment","jsx","jsxs","useState","useEffect","MoreHorizontal","ChevronRight","useState","useEffect","ChevronDown","RotateCcw","Loader2","useState","ChevronDown","jsx","jsxs","jsx","jsxs","useState","useEffect","ChevronDown","RotateCcw","Loader2","useState","useEffect","MoreVertical","Fragment","jsx","jsxs","useState","useEffect","handleDelete","MoreVertical","useState","useEffect","Plus","Pencil","Trash2","X","jsx","jsxs","useState","useEffect","handleDelete","Plus","X","Pencil","Trash2","useState","useEffect","ChevronLeft","ChevronRight","MoreVertical","MoreHorizontal","Fragment","jsx","jsxs","useState","useEffect","handleDelete","ChevronLeft","MoreHorizontal","ChevronRight","MoreVertical","useState","useEffect","ChevronLeft","ChevronRight","MoreHorizontal","RotateCcw","Fragment","jsx","jsxs","useState","useEffect","ChevronLeft","MoreHorizontal","ChevronRight","RotateCcw","jsx","jsxs","useState","useEffect","jsx","jsx","useState","useEffect","Fragment","jsx","jsxs","jsx","jsx","useEffect","useRef","jsx","Fragment","jsx","jsxs","ChatPanel","lazy","useState","useEffect","Loader2","Suspense","useState","useEffect","useState","jsx","jsxs","useState"]}