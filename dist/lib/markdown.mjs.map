{"version":3,"sources":["../../src/lib/markdown.ts"],"sourcesContent":["import { marked } from 'marked'\nimport TurndownService from 'turndown'\n\n// Configure marked for consistent rendering\nmarked.setOptions({\n  gfm: true,\n  breaks: false,\n})\n\n/**\n * Render markdown to HTML\n */\nexport function renderMarkdown(markdown: string): string {\n  return marked.parse(markdown) as string\n}\n\n/**\n * Convert markdown to HTML with GFM and line breaks enabled.\n * Safe for client-side use in components like ChatPanel.\n */\nexport function markdownToHtml(markdown: string): string {\n  return marked.parse(markdown, { gfm: true, breaks: true }) as string\n}\n\n/**\n * Parse markdown to tokens (AST)\n */\nexport function parseMarkdown(markdown: string) {\n  return marked.lexer(markdown)\n}\n\n// Configure Turndown for HTML to markdown conversion\nconst turndownService = new TurndownService({\n  headingStyle: 'atx',\n  codeBlockStyle: 'fenced',\n  bulletListMarker: '-',\n})\n\n/**\n * Convert HTML to markdown\n */\nexport function htmlToMarkdown(html: string): string {\n  return turndownService.turndown(html)\n}\n\n/**\n * Count words in text (markdown or plain text)\n */\nexport function wordCount(text: string): number {\n  if (!text) return 0\n  return text.trim().split(/\\s+/).filter(Boolean).length\n}\n\n/**\n * Generate URL-safe slug from title\n */\nexport function generateSlug(title: string): string {\n  return title\n    .toLowerCase()\n    .trim()\n    .replace(/[^\\w\\s-]/g, '')\n    .replace(/\\s+/g, '-')\n    .replace(/-+/g, '-')\n    .substring(0, 60)\n}\n\nimport sanitizeHtml from 'sanitize-html'\n\n/**\n * Render markdown to sanitized HTML.\n * Safe for public-facing pages where user content is displayed.\n */\nexport function renderMarkdownSanitized(markdown: string): string {\n  const html = renderMarkdown(markdown)\n  return sanitizeHtml(html, {\n    allowedTags: sanitizeHtml.defaults.allowedTags.concat(['img', 'h1', 'h2']),\n    allowedAttributes: {\n      ...sanitizeHtml.defaults.allowedAttributes,\n      img: ['src', 'alt', 'title'],\n      a: ['href', 'target', 'rel'],\n    },\n  })\n}\n"],"mappings":";AAAA,SAAS,cAAc;AACvB,OAAO,qBAAqB;AAiE5B,OAAO,kBAAkB;AA9DzB,OAAO,WAAW;AAAA,EAChB,KAAK;AAAA,EACL,QAAQ;AACV,CAAC;AAKM,SAAS,eAAe,UAA0B;AACvD,SAAO,OAAO,MAAM,QAAQ;AAC9B;AAMO,SAAS,eAAe,UAA0B;AACvD,SAAO,OAAO,MAAM,UAAU,EAAE,KAAK,MAAM,QAAQ,KAAK,CAAC;AAC3D;AAKO,SAAS,cAAc,UAAkB;AAC9C,SAAO,OAAO,MAAM,QAAQ;AAC9B;AAGA,IAAM,kBAAkB,IAAI,gBAAgB;AAAA,EAC1C,cAAc;AAAA,EACd,gBAAgB;AAAA,EAChB,kBAAkB;AACpB,CAAC;AAKM,SAAS,eAAe,MAAsB;AACnD,SAAO,gBAAgB,SAAS,IAAI;AACtC;AAKO,SAAS,UAAU,MAAsB;AAC9C,MAAI,CAAC,KAAM,QAAO;AAClB,SAAO,KAAK,KAAK,EAAE,MAAM,KAAK,EAAE,OAAO,OAAO,EAAE;AAClD;AAKO,SAAS,aAAa,OAAuB;AAClD,SAAO,MACJ,YAAY,EACZ,KAAK,EACL,QAAQ,aAAa,EAAE,EACvB,QAAQ,QAAQ,GAAG,EACnB,QAAQ,OAAO,GAAG,EAClB,UAAU,GAAG,EAAE;AACpB;AAQO,SAAS,wBAAwB,UAA0B;AAChE,QAAM,OAAO,eAAe,QAAQ;AACpC,SAAO,aAAa,MAAM;AAAA,IACxB,aAAa,aAAa,SAAS,YAAY,OAAO,CAAC,OAAO,MAAM,IAAI,CAAC;AAAA,IACzE,mBAAmB;AAAA,MACjB,GAAG,aAAa,SAAS;AAAA,MACzB,KAAK,CAAC,OAAO,OAAO,OAAO;AAAA,MAC3B,GAAG,CAAC,QAAQ,UAAU,KAAK;AAAA,IAC7B;AAAA,EACF,CAAC;AACH;","names":[]}