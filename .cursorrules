# Autoblogger - Cursor Rules

## Project Overview

Autoblogger is an AI-powered headless CMS that embeds into Next.js apps. It provides:
- AI writing assistance (Claude, GPT) with streaming
- WYSIWYG Tiptap editor with markdown sync
- Revision history and inline comments
- RSS auto-draft from topic subscriptions
- Destination adapters for syncing to external CMSs (Prismic, Contentful, Sanity)

## Architecture

### Package Structure
- `src/` - Main library source
  - `ai/` - AI provider integrations (Anthropic, OpenAI), prompts, streaming
  - `api/` - API route handlers for posts, comments, settings, AI
  - `auto-draft/` - RSS feed processing and auto-draft generation
  - `cli/` - CLI for `npx autoblogger init` and import
  - `data/` - Database access layer factories
  - `destinations/` - External CMS adapters (Prismic, etc.)
  - `lib/` - Utilities (markdown, comments, rich-text conversion)
  - `types/` - TypeScript types for models, config, destinations
  - `ui/` - React components and pages (dashboard, editor, settings)
- `packages/prismic/` - Optional Prismic integration package
- `prisma/schema.prisma` - Reference database schema

### Key Patterns

1. **Server/Client Split**
   - `src/index.ts` exports server-safe code (no React)
   - `src/ui/index.ts` exports React components
   - Types are split between `config.ts` (server-safe) and UI types

2. **Destination Adapters**
   - Interface: `Destination` with `onPublish`, `onUnpublish`, `onDelete`
   - Dynamic destinations: Configured via Settings UI (stored in DB)
   - Code destinations: Passed via `config.destinations` array
   - Webhooks: Simple POST to URLs on events

3. **AI Streaming**
   - Uses SSE (Server-Sent Events) for streaming responses
   - Provider abstraction in `src/ai/provider.ts`
   - Web search via OpenAI Responses API with `web_search` tool

4. **Database**
   - Uses host app's Prisma client (passed via config)
   - Reference schema in `prisma/schema.prisma`
   - IntegrationSettings model for dynamic destination config

## Current Feature Set

### Prismic Integration
- Dynamic destination configured via Settings UI
- Stub sync mode: Only syncs UID for collection slices
- Full sync mode: Syncs complete content as rich text
- Auto-rename option to update Prismic document name from title
- Token can be from env var or entered in UI

### Web Search
- OpenAI Responses API for web-grounded answers
- Works with all models - for Anthropic, fetches results then includes in context
- Toggle in chat UI (Globe icon)

### Thinking Mode
- Extended thinking for Claude models
- Configurable budget tokens
- Toggle in chat UI (Brain icon)

### Chat Modes
- **Ask**: Q&A about essay or general topics
- **Agent**: Direct editing with search/replace commands
- **Plan**: Generate essay outlines that can be expanded

## Code Style

- TypeScript strict mode
- React with 'use client' directive for client components
- Tailwind CSS with `ab-dark:` prefix for dark mode variants
- Component styling via `clsx` and `tailwind-merge`
- Sonner for toast notifications

## Build & Development

```bash
npm run build      # Build with tsup + tailwindcss
npm run dev        # Watch mode
npm run yalc:push  # Push to local yalc for testing
```

## Testing Changes

After making changes:
1. Run `npm run build` to compile
2. Use `yalc push` to update linked projects
3. Test in a Next.js app that imports autoblogger

## Recent Changes (v0.2.7)

- **Prismic Integration**: Full Settings UI, stub/full sync modes, auto-rename
- **Destinations System**: Adapter pattern for external CMS sync
- **Rich Text Converters**: Markdown to Prismic/Contentful/Sanity formats
- **Web Search**: OpenAI Responses API integration for all models
- **Thinking Mode**: Extended thinking for Claude
- **Post URL Pattern**: Configurable URL pattern in General Settings
- **Mobile UX**: Touch-friendly toolbar and navbar improvements
